{"version":3,"file":"index.af8a3098.js","sources":["../../vite/modulepreload-polyfill","../../src/polyfills.ts","../../plugin-vue:export-helper","../../../packages/editor/src/fields/Code.vue","../../../packages/editor/src/fields/CodeLink.vue","../../../packages/editor/src/fields/UISelect.vue","../../../packages/editor/src/layouts/CodeEditor.vue","../../../packages/utils/src/index.ts","../../../packages/editor/src/utils/undo-redo.ts","../../../packages/editor/src/utils/compose.ts","../../../packages/editor/src/services/BaseService.ts","../../../packages/editor/src/services/history.ts","../../../packages/editor/src/services/props.ts","../../../packages/editor/src/type.ts","../../../packages/editor/src/utils/editor.ts","../../../packages/editor/src/services/editor.ts","../../../packages/core/src/events.ts","../../../packages/editor/src/services/events.ts","../../../packages/editor/src/utils/props.ts","../../../packages/editor/src/layouts/AddPageBox.vue","../../../packages/editor/src/layouts/Resizer.vue","../../../packages/editor/src/layouts/Framework.vue","../../../packages/editor/src/components/Icon.vue","../../../packages/editor/src/components/ToolButton.vue","../../../packages/editor/src/layouts/NavMenu.vue","../../../packages/editor/src/layouts/PropsPanel.vue","../../../packages/editor/src/layouts/sidebar/ComponentListPanel.vue","../../../packages/editor/src/layouts/sidebar/LayerMenu.vue","../../../packages/editor/src/layouts/sidebar/LayerPanel.vue","../../../packages/editor/src/layouts/sidebar/Sidebar.vue","../../../packages/editor/src/layouts/workspace/PageBar.vue","../../../packages/stage/src/const.ts","../../../packages/stage/src/util.ts","../../../packages/stage/src/StageDragResize.ts","../../../packages/stage/src/Rule.ts","../../../packages/stage/src/StageMask.ts","../../../packages/stage/src/StageRender.ts","../../../packages/stage/src/StageCore.ts","../../../packages/editor/src/utils/scroll-viewer.ts","../../../packages/editor/src/components/ScrollViewer.vue","../../../packages/editor/src/layouts/workspace/ViewerMenu.vue","../../../packages/editor/src/layouts/workspace/Stage.vue","../../../packages/editor/src/layouts/workspace/Workspace.vue","../../../packages/editor/src/services/componentList.ts","../../../packages/editor/src/services/ui.ts","../../../packages/editor/src/Editor.vue","../../../packages/editor/src/index.ts","../../../packages/form/src/utils/form.ts","../../../packages/form/src/containers/Container.vue","../../../packages/form/src/containers/Fieldset.vue","../../../packages/form/src/containers/GroupListItem.vue","../../../packages/form/src/containers/GroupList.vue","../../../packages/form/src/containers/Panel.vue","../../../packages/form/src/containers/Row.vue","../../../packages/form/src/containers/Step.vue","../../../packages/form/src/containers/Table.vue","../../../packages/form/src/containers/Tabs.vue","../../../packages/form/src/utils/config.ts","../../../packages/form/src/utils/fieldProps.ts","../../../packages/form/src/utils/useAddField.ts","../../../packages/form/src/fields/Cascader.vue","../../../packages/form/src/fields/Checkbox.vue","../../../packages/form/src/fields/CheckboxGroup.vue","../../../packages/form/src/fields/ColorPicker.vue","../../../packages/form/src/fields/Date.vue","../../../packages/form/src/fields/Daterange.vue","../../../packages/form/src/fields/DateTime.vue","../../../packages/form/src/fields/Display.vue","../../../packages/form/src/fields/DynamicField.vue","../../../packages/form/src/fields/Hidden.vue","../../../packages/form/src/fields/Link.vue","../../../packages/form/src/fields/Number.vue","../../../packages/form/src/fields/RadioGroup.vue","../../../packages/form/src/fields/Select.vue","../../../packages/form/src/fields/Switch.vue","../../../packages/form/src/fields/Text.vue","../../../packages/form/src/fields/Textarea.vue","../../../packages/form/src/fields/Time.vue","../../../packages/form/src/Form.vue","../../../packages/form/src/FormDialog.vue","../../../packages/form/src/index.ts","../../../packages/table/src/ActionsColumn.vue","../../../packages/table/src/ExpandColumn.vue","../../../packages/table/src/utils.ts","../../../packages/table/src/PopoverColumn.vue","../../../packages/table/src/TextColumn.vue","../../../packages/table/src/Table.vue","../../../packages/table/src/index.ts","../../src/App.vue","../../src/config.ts","../../src/pages/Editor.vue","../../src/pages/Form.vue","../../src/pages/Table.vue","../../src/route.ts","../../src/main.ts"],"sourcesContent":["const p = function polyfill() {\n    const relList = document.createElement('link').relList;\n    if (relList && relList.supports && relList.supports('modulepreload')) {\n        return;\n    }\n    for (const link of document.querySelectorAll('link[rel=\"modulepreload\"]')) {\n        processPreload(link);\n    }\n    new MutationObserver((mutations) => {\n        for (const mutation of mutations) {\n            if (mutation.type !== 'childList') {\n                continue;\n            }\n            for (const node of mutation.addedNodes) {\n                if (node.tagName === 'LINK' && node.rel === 'modulepreload')\n                    processPreload(node);\n            }\n        }\n    }).observe(document, { childList: true, subtree: true });\n    function getFetchOpts(script) {\n        const fetchOpts = {};\n        if (script.integrity)\n            fetchOpts.integrity = script.integrity;\n        if (script.referrerpolicy)\n            fetchOpts.referrerPolicy = script.referrerpolicy;\n        if (script.crossorigin === 'use-credentials')\n            fetchOpts.credentials = 'include';\n        else if (script.crossorigin === 'anonymous')\n            fetchOpts.credentials = 'omit';\n        else\n            fetchOpts.credentials = 'same-origin';\n        return fetchOpts;\n    }\n    function processPreload(link) {\n        if (link.ep)\n            // ep marker = processed\n            return;\n        link.ep = true;\n        // prepopulate the load record\n        const fetchOpts = getFetchOpts(link);\n        fetch(link.href, fetchOpts);\n    }\n};__VITE_IS_MODERN__&&p();","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nif (typeof (window as any).global === 'undefined') {\n  (window as any).global = window;\n}\n","\nexport default (sfc, props) => {\n  const target = sfc.__vccOpts || sfc;\n  for (const [key, val] of props) {\n    target[key] = val;\n  }\n  return target;\n}\n","<template>\n  <magic-code-editor\n    :style=\"`height: ${height}`\"\n    :init-values=\"model[name]\"\n    :language=\"language\"\n    @save=\"save\"\n  ></magic-code-editor>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent } from 'vue';\n\nexport default defineComponent({\n  name: 'm-fields-vs-code',\n\n  props: ['model', 'name', 'config', 'prop'],\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    const language = computed(() => props.config.language || 'javascript');\n    const height = computed(() => `${document.body.clientHeight - 168}px`);\n\n    return {\n      height,\n      language,\n\n      save(v: string) {\n        props.model[props.name] = v;\n        emit('change', v);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <m-fields-link :config=\"formConfig\" :model=\"modelValue\" name=\"form\" @change=\"changeHandler\"></m-fields-link>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType, ref, watchEffect } from 'vue';\nimport serialize from 'serialize-javascript';\n\ninterface CodeLinkConfig {\n  type: 'code-link';\n  name: string;\n  text?: string;\n  formTitle?: string;\n}\n\nexport default defineComponent({\n  name: 'm-fields-code-link',\n\n  props: {\n    config: {\n      type: Object as PropType<CodeLinkConfig>,\n    },\n\n    model: {\n      type: Object,\n    },\n\n    name: {\n      type: String,\n    },\n\n    prop: {\n      type: String,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    const modelValue = ref<{ form: Record<string, any> }>({\n      form: {},\n    });\n\n    watchEffect(() => {\n      if (!props.model || !props.name) return;\n      modelValue.value.form[props.name] = serialize(props.model[props.name], {\n        space: 2,\n        unsafe: true,\n      }).replace(/\"(\\w+)\":\\s/g, '$1: ');\n    });\n\n    return {\n      modelValue,\n\n      formConfig: computed(() => ({\n        ...props.config,\n        text: '',\n        type: 'link',\n        form: [\n          {\n            name: props.name,\n            type: 'vs-code',\n          },\n        ],\n      })),\n\n      changeHandler(v: Record<string, any>) {\n        if (!props.name || !props.model) return;\n\n        try {\n          // eslint-disable-next-line no-eval\n          props.model[props.name] = eval(`${v[props.name]}`);\n          emit('change', props.model[props.name]);\n        } catch (e) {\n          console.error(e);\n        }\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <div class=\"m-fields-ui-select\" v-if=\"uiSelectMode\" @click=\"cancelHandler\">\n    <i class=\"el-icon-delete\" style=\"color: rgb(221, 75, 57)\">取消</i>\n  </div>\n  <div class=\"m-fields-ui-select\" v-else @click=\"startSelect\">\n    <i class=\"el-icon-thumb\"></i>\n    <span>{{ val ? toName + '_' + val : '点击此处选择' }}</span>\n    <i class=\"el-icon-delete\" @click.stop=\"deleteHandler\" v-if=\"val\"></i>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, ref } from 'vue';\n\nimport { FormState } from '@tmagic/form';\n\nimport { Services } from '@editor/type';\n\nexport default defineComponent({\n  name: 'm-fields-ui-select',\n\n  props: {\n    labelWidth: String,\n    config: Object,\n    model: Object,\n    prop: {\n      type: String,\n      default() {\n        return '';\n      },\n    },\n    name: String,\n  },\n\n  emits: ['change'],\n\n  setup(props: any, { emit }) {\n    const services = inject<Services>('services');\n    const mForm = inject<FormState>('mForm');\n    const val = computed(() => props.model[props.name]);\n    const uiSelectMode = ref(false);\n\n    const cancelHandler = () => {\n      if (!services?.uiService) return;\n      services.uiService.set<boolean>('uiSelectMode', false);\n      uiSelectMode.value = false;\n      globalThis.document.removeEventListener('ui-select', clickHandler as EventListener);\n    };\n\n    const clickHandler = ({ detail }: Event & { detail: any }) => {\n      if (detail.id) {\n        props.model[props.name] = detail.id;\n        emit('change', detail.id);\n        mForm?.$emit('field-change', props.prop, detail.id);\n      }\n\n      if (cancelHandler) {\n        cancelHandler();\n      }\n    };\n\n    return {\n      val,\n      uiSelectMode,\n      toName: computed(() => {\n        const config = services?.editorService.getNodeById(val.value);\n        return config?.name || '';\n      }),\n\n      startSelect() {\n        if (!services?.uiService) return;\n        services.uiService.set<boolean>('uiSelectMode', true);\n        uiSelectMode.value = true;\n        globalThis.document.addEventListener('ui-select', clickHandler as EventListener);\n      },\n\n      cancelHandler,\n\n      deleteHandler() {\n        if (props.model) {\n          props.model[props.name] = '';\n          emit('change', '');\n          mForm?.$emit('field-change', props.prop, '');\n        }\n      },\n    };\n  },\n});\n</script>\n<style lang=\"scss\">\n.m-fields-ui-select {\n  cursor: pointer;\n  i {\n    margin-right: 3px;\n  }\n  span {\n    color: #2882e0;\n  }\n}\n</style>\n","<template>\n  <div ref=\"codeEditor\" class=\"magic-code-editor\"></div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, onMounted, onUnmounted, ref, watch } from 'vue';\nimport * as monaco from 'monaco-editor';\nimport serialize from 'serialize-javascript';\n\nconst toString = (v: string | any, language: string): string => {\n  let value = '';\n  if (typeof v !== 'string') {\n    value = serialize(v, {\n      space: 2,\n      unsafe: true,\n    }).replace(/\"(\\w+)\":\\s/g, '$1: ');\n  } else {\n    value = v;\n  }\n  if (language === 'javascript' && value.startsWith('{') && value.endsWith('}')) {\n    value = `(${value})`;\n  }\n  return value;\n};\n\nexport default defineComponent({\n  name: 'magic-code-editor',\n\n  props: {\n    initValues: {\n      type: [String, Object],\n    },\n\n    modifiedValues: {\n      type: [String, Object],\n    },\n\n    type: {\n      type: [String],\n      default: () => '',\n    },\n\n    language: {\n      type: [String],\n      default: () => 'javascript',\n    },\n  },\n\n  emits: ['initd', 'save'],\n\n  setup(props, { emit }) {\n    let vsEditor: monaco.editor.IStandaloneCodeEditor | null = null;\n    let vsDiffEditor: monaco.editor.IStandaloneDiffEditor | null = null;\n    const values = ref('');\n    const loading = ref(false);\n    const codeEditor = ref<HTMLDivElement>();\n\n    const setEditorValue = (v: string | any, m: string | any) => {\n      values.value = toString(v, props.language);\n\n      if (props.type === 'diff') {\n        const originalModel = monaco.editor.createModel(values.value, 'text/javascript');\n        const modifiedModel = monaco.editor.createModel(toString(m, props.language), 'text/javascript');\n\n        return vsDiffEditor?.setModel({\n          original: originalModel,\n          modified: modifiedModel,\n        });\n      }\n\n      return vsEditor?.setValue(values.value);\n    };\n\n    const resizeHandler = () => {\n      vsEditor?.layout();\n      vsDiffEditor?.layout();\n    };\n\n    const getEditorValue = () =>\n      props.type === 'diff' ? vsDiffEditor?.getModifiedEditor().getValue() : vsEditor?.getValue();\n\n    const init = async () => {\n      if (!codeEditor.value) return;\n\n      const options = {\n        value: values.value,\n        language: props.language,\n        tabSize: 2,\n        theme: 'vs-dark',\n        fontFamily: 'dm, Menlo, Monaco, \"Courier New\", monospace',\n        fontSize: 15,\n        formatOnPaste: true,\n      };\n\n      if (props.type === 'diff') {\n        vsDiffEditor = monaco.editor.createDiffEditor(codeEditor.value, options);\n      } else {\n        vsEditor = monaco.editor.create(codeEditor.value, options);\n      }\n\n      setEditorValue(props.initValues, props.modifiedValues);\n\n      loading.value = false;\n\n      emit('initd', vsEditor);\n\n      codeEditor.value.addEventListener('keydown', (e) => {\n        if (e.keyCode === 83 && (navigator.platform.match('Mac') ? e.metaKey : e.ctrlKey)) {\n          e.preventDefault();\n          emit('save', getEditorValue());\n        }\n      });\n\n      if (props.type !== 'diff') {\n        vsEditor?.onDidBlurEditorWidget(() => {\n          emit('save', getEditorValue());\n        });\n      }\n\n      globalThis.addEventListener('resize', resizeHandler);\n    };\n\n    watch(\n      () => props.initValues,\n      (v, preV) => {\n        if (v !== preV) {\n          setEditorValue(props.initValues, props.modifiedValues);\n        }\n      },\n      {\n        deep: true,\n        immediate: true,\n      },\n    );\n\n    onMounted(async () => {\n      loading.value = true;\n\n      init();\n    });\n\n    onUnmounted(() => {\n      globalThis.removeEventListener('resize', resizeHandler);\n    });\n\n    return {\n      values,\n      loading,\n      codeEditor,\n\n      getEditor() {\n        return vsEditor || vsDiffEditor;\n      },\n\n      setEditorValue,\n\n      focus() {\n        vsEditor?.focus();\n        vsDiffEditor?.focus();\n      },\n    };\n  },\n});\n</script>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport moment from 'moment';\n\nimport { MNode } from '@tmagic/schema';\n\nexport const sleep = (ms: number): Promise<void> =>\n  new Promise((resolve) => {\n    const timer = setTimeout(() => {\n      clearTimeout(timer);\n      resolve();\n    }, ms);\n  });\n\nexport const datetimeFormatter = (v: string | Date, defaultValue = '-', f = 'YYYY-MM-DD HH:mm:ss') => {\n  let format = f;\n  if (format === 'timestamp') {\n    format = 'x';\n  }\n\n  if (v) {\n    let time = null;\n    if ((typeof v === 'string' && v.includes('Z')) || v.constructor === Date) {\n      // UTC字符串时间或Date对象格式化为北京时间\n      time = moment(v).utcOffset('+08:00').format(format);\n    } else {\n      time = moment(v).format(format);\n    }\n\n    if (format === 'x') {\n      return +time;\n    }\n    // 格式化为北京时间\n    if (time !== 'Invalid date') {\n      return time;\n    }\n    return defaultValue;\n  }\n  return defaultValue;\n};\n\nexport const asyncLoadJs = (() => {\n  // 正在加载或加载成功的存入此Map中\n  const documentMap = new Map();\n\n  return (url: string, crossOrigin?: string, document = globalThis.document) => {\n    let loaded = documentMap.get(document);\n    if (!loaded) {\n      loaded = new Map();\n      documentMap.set(document, loaded);\n    }\n\n    // 正在加载或已经加载成功的，直接返回\n    if (loaded.get(url)) return loaded.get(url);\n\n    const load = new Promise<void>((resolve, reject) => {\n      const script = document.createElement('script');\n      script.type = 'text/javascript';\n      if (crossOrigin) {\n        script.crossOrigin = crossOrigin;\n      }\n      script.src = url;\n      document.body.appendChild(script);\n      script.onload = () => {\n        resolve();\n      };\n      script.onerror = () => {\n        reject(new Error('加载失败'));\n      };\n      setTimeout(() => {\n        reject(new Error('timeout'));\n      }, 60 * 1000);\n    }).catch((err) => {\n      // 加载失败的，从map中移除，第二次加载时，可以再次执行加载\n      loaded.delete(url);\n      throw err;\n    });\n\n    loaded.set(url, load);\n    return loaded.get(url);\n  };\n})();\n\nexport const asyncLoadCss = function (url: string) {\n  return new Promise((resolve, reject) => {\n    const hasLoaded = globalThis.document.querySelector(`link[href=\"${url}\"]`);\n    if (hasLoaded) {\n      resolve(undefined);\n      return;\n    }\n\n    const node = document.createElement('link');\n    node.rel = 'stylesheet';\n    node.href = url;\n    document.getElementsByTagName('head')[0].appendChild(node);\n    node.onload = resolve;\n    node.onerror = reject;\n  });\n};\n\n// 驼峰转换横线\nexport const toLine = (name = '') => name.replace(/\\B([A-Z])/g, '-$1').toLowerCase();\n\nexport const toHump = (name = ''): string => name.replace(/-(\\w)/g, (all, letter) => letter.toUpperCase());\n\nexport const emptyFn = (): any => undefined;\n\n/**\n * 通过id获取组件在应用的子孙路径\n * @param {number | string} id 组件id\n * @param {Array} data 要查找的根容器节点\n * @return {Array} 组件在data中的子孙路径\n */\nexport const getNodePath = (id: number | string, data: MNode[] = []): MNode[] => {\n  const path: MNode[] = [];\n\n  const get = function (id: number | string, data: MNode[]): MNode | null {\n    if (!Array.isArray(data)) {\n      return null;\n    }\n\n    for (let i = 0, l = data.length; i < l; i++) {\n      const item: any = data[i];\n\n      path.push(item);\n      if (`${item.id}` === `${id}`) {\n        return item;\n      }\n\n      if (item.items) {\n        const node = get(id, item.items);\n        if (node) {\n          return node;\n        }\n      }\n\n      path.pop();\n    }\n\n    return null;\n  };\n\n  get(id, data);\n\n  return path;\n};\n\nexport const filterXSS = (str: string) =>\n  str.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/g, '&apos;');\n\nexport const getUrlParam = (param: string, url?: string) => {\n  const u = url || location.href;\n  const reg = new RegExp(`[?&#]${param}=([^&#]+)`, 'gi');\n\n  const matches = u.match(reg);\n  let strArr;\n  if (matches && matches.length > 0) {\n    strArr = matches[matches.length - 1].split('=');\n    if (strArr && strArr.length > 1) {\n      // 过滤XSS字符\n      return filterXSS(strArr[1]);\n    }\n    return '';\n  }\n  return '';\n};\n\nexport const isPop = (node: MNode): boolean => node.type.toLowerCase().endsWith('pop');\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { cloneDeep } from 'lodash-es';\n\nexport class UndoRedo<T = any> {\n  private elementList: T[];\n  private listCursor: number;\n  private listMaxSize: number;\n\n  constructor(listMaxSize = 200) {\n    const minListMaxSize = 2;\n    this.elementList = [];\n    this.listCursor = 0;\n    this.listMaxSize = listMaxSize > minListMaxSize ? listMaxSize : minListMaxSize;\n  }\n\n  public pushElement(element: T): void {\n    // 新元素进来时，把游标之外的元素全部丢弃，并把新元素放进来\n    this.elementList.splice(this.listCursor, this.elementList.length - this.listCursor, cloneDeep(element));\n    this.listCursor += 1;\n    // 如果list中的元素超过maxSize，则移除第一个元素\n    if (this.elementList.length > this.listMaxSize) {\n      this.elementList.shift();\n      this.listCursor -= 1;\n    }\n  }\n\n  public canUndo(): boolean {\n    return this.listCursor > 1;\n  }\n\n  // 返回undo后的当前元素\n  public undo(): T | null {\n    if (!this.canUndo()) {\n      return null;\n    }\n    this.listCursor -= 1;\n    return this.getCurrentElement();\n  }\n\n  public canRedo() {\n    return this.elementList.length > this.listCursor;\n  }\n\n  // 返回redo后的当前元素\n  public redo(): T | null {\n    if (!this.canRedo()) {\n      return null;\n    }\n    this.listCursor += 1;\n    return this.getCurrentElement();\n  }\n\n  public getCurrentElement(): T | null {\n    if (this.listCursor < 1) {\n      return null;\n    }\n    return cloneDeep(this.elementList[this.listCursor - 1]);\n  }\n}\n","/**\n * @param {Array} middleware\n * @return {Function}\n */\nexport const compose = (middleware: Function[]) => {\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware 必须是一个数组!');\n  for (const fn of middleware) {\n    if (typeof fn !== 'function') throw new TypeError('Middleware 必须由函数组成!');\n  }\n\n  /**\n   * @param {Object} args\n   * @return {Promise}\n   * @api public\n   */\n  return (args: any[], next?: Function) => {\n    // last called middleware #\n    let index = -1;\n    return dispatch(0);\n    function dispatch(i: number): Promise<void> {\n      if (i <= index) return Promise.reject(new Error('next() 被多次调用'));\n      index = i;\n      let fn = middleware[i];\n      if (i === middleware.length && next) fn = next;\n      if (!fn) return Promise.resolve();\n      try {\n        return Promise.resolve(fn(...args, dispatch.bind(null, i + 1)));\n      } catch (err) {\n        return Promise.reject(err);\n      }\n    }\n  };\n};\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from 'events';\n\nimport { compose } from '@editor/utils/compose';\n\nconst methodName = (prefix: string, name: string) => `${prefix}${name[0].toUpperCase()}${name.substring(1)}`;\n\nconst isError = (error: any): boolean => Object.prototype.toString.call(error) === '[object Error]';\n\n/**\n * 提供两种方式对Class进行扩展\n * 方法1：\n * 给Class中的每个方法都添加before after两个钩子\n * 给Class添加一个usePlugin方法，use方法可以传入一个包含before或者after方法的对象\n *\n * 例如：\n *   Class EditorService extends BaseService {\n *     constructor() {\n *       super(['add']);\n *     }\n *     add(value) { return result; }\n *   };\n *\n *   const editorService = new EditorService();\n *\n *   editorService.usePlugin({\n *     beforeAdd(value) { return [value] },\n *     afterAdd(value, result) {},\n *   });\n *\n *   editorService.add(); 最终会变成  () => {\n *    editorService.beforeAdd();\n *    editorService.add();\n *    editorService.afterAdd();\n *   }\n *\n * 调用时的参数会透传到before方法的参数中, 然后before的return 会作为原方法的参数和after的参数，after最后一个参数则是原方法的return值;\n * 如需终止后续方法调用可以return new Error();\n *\n * 方法2：\n * 给Class中的每个方法都添加中间件\n * 给Class添加一个use方法，use方法可以传入一个包含源对象方法名作为key值的对象\n *\n * 例如：\n *   Class EditorService extends BaseService {\n *     constructor() {\n *       super(['add']);\n *     }\n *     add(value) { return result; }\n *   };\n *\n *  const editorService = new EditorService();\n *  editorService.use({\n *    add(value, next) { console.log(value); next() },\n *  });\n */\nexport default class extends EventEmitter {\n  private pluginOptionsList: Record<string, Function[]> = {};\n  private middleware: Record<string, Function[]> = {};\n\n  constructor(methods: string[]) {\n    super();\n\n    methods.forEach((propertyName: string) => {\n      const scope = this as any;\n\n      const sourceMethod = scope[propertyName];\n\n      const beforeMethodName = methodName('before', propertyName);\n      const afterMethodName = methodName('after', propertyName);\n\n      this.pluginOptionsList[beforeMethodName] = [];\n      this.pluginOptionsList[afterMethodName] = [];\n      this.middleware[propertyName] = [];\n\n      const fn = compose(this.middleware[propertyName]);\n      Object.defineProperty(scope, propertyName, {\n        value: async (...args: any[]) => {\n          let beforeArgs = args;\n\n          for (const beforeMethod of this.pluginOptionsList[beforeMethodName]) {\n            let beforeReturnValue = (await beforeMethod(...beforeArgs)) || [];\n\n            if (isError(beforeReturnValue)) throw beforeReturnValue;\n\n            if (!Array.isArray(beforeReturnValue)) {\n              beforeReturnValue = [beforeReturnValue];\n            }\n\n            beforeArgs = beforeArgs.map((v: any, index: number) => {\n              if (typeof beforeReturnValue[index] === 'undefined') return v;\n              return beforeReturnValue[index];\n            });\n          }\n\n          let returnValue = await fn(beforeArgs, sourceMethod.bind(scope));\n\n          for (const afterMethod of this.pluginOptionsList[afterMethodName]) {\n            returnValue = await afterMethod(...beforeArgs, returnValue);\n\n            if (isError(returnValue)) throw returnValue;\n          }\n\n          return returnValue;\n        },\n      });\n    });\n  }\n\n  public use(options: Record<string, Function>) {\n    Object.entries(options).forEach(([methodName, method]: [string, Function]) => {\n      if (typeof method === 'function') this.middleware[methodName].push(method);\n    });\n  }\n\n  public usePlugin(options: Record<string, Function>) {\n    Object.entries(options).forEach(([methodName, method]: [string, Function]) => {\n      if (typeof method === 'function') this.pluginOptionsList[methodName].push(method);\n    });\n  }\n}\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { reactive } from 'vue';\n\nimport { Id, MPage } from '@tmagic/schema';\n\nimport { UndoRedo } from '@editor/utils/undo-redo';\n\nimport BaseService from './BaseService';\n\nexport interface StepValue {\n  data: MPage;\n  modifiedNodeIds: Map<Id, Id>;\n  nodeId: Id;\n}\n\nexport interface HistoryState {\n  pageId?: Id;\n  pageSteps: Record<Id, UndoRedo<StepValue>>;\n  canRedo: boolean;\n  canUndo: boolean;\n}\n\nclass History extends BaseService {\n  public state = reactive<HistoryState>({\n    pageSteps: {},\n    pageId: undefined,\n    canRedo: false,\n    canUndo: false,\n  });\n\n  constructor() {\n    super([]);\n\n    this.on('change', this.setCanUndoRedo);\n  }\n\n  public changePage(page: MPage): void {\n    if (!page) return;\n\n    this.state.pageId = page.id;\n\n    if (!this.state.pageSteps[this.state.pageId]) {\n      const undoRedo = new UndoRedo<StepValue>();\n\n      undoRedo.pushElement({\n        data: page,\n        modifiedNodeIds: new Map(),\n        nodeId: page.id,\n      });\n\n      this.state.pageSteps[this.state.pageId] = undoRedo;\n    }\n\n    this.setCanUndoRedo();\n  }\n\n  public empty(): void {\n    this.state.pageId = undefined;\n    this.state.pageSteps = {};\n    this.state.canRedo = false;\n    this.state.canUndo = false;\n  }\n\n  public push(state: StepValue): StepValue | null {\n    const undoRedo = this.getUndoRedo();\n    if (!undoRedo) return null;\n    undoRedo.pushElement(state);\n    this.emit('change', state);\n    return state;\n  }\n\n  public undo(): StepValue | null {\n    const undoRedo = this.getUndoRedo();\n    if (!undoRedo) return null;\n    const state = undoRedo.undo();\n    this.emit('change', state);\n    return state;\n  }\n\n  public redo(): StepValue | null {\n    const undoRedo = this.getUndoRedo();\n    if (!undoRedo) return null;\n    const state = undoRedo.redo();\n    this.emit('change', state);\n    return state;\n  }\n\n  public destroy(): void {\n    this.empty();\n    this.removeAllListeners();\n  }\n\n  private getUndoRedo() {\n    if (!this.state.pageId) return null;\n    return this.state.pageSteps[this.state.pageId];\n  }\n\n  private setCanUndoRedo(): void {\n    const undoRedo = this.getUndoRedo();\n    this.state.canRedo = undoRedo?.canRedo() || false;\n    this.state.canUndo = undoRedo?.canUndo() || false;\n  }\n}\n\nexport type HistoryService = History;\n\nexport default new History();\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { reactive } from 'vue';\nimport { cloneDeep } from 'lodash-es';\n\nimport type { FormConfig } from '@tmagic/form';\nimport type { MComponent, MNode } from '@tmagic/schema';\nimport { toLine } from '@tmagic/utils';\n\nimport type { PropsState } from '@editor/type';\nimport { DEFAULT_CONFIG, fillConfig, getDefaultPropsValue } from '@editor/utils/props';\n\nimport BaseService from './BaseService';\n\nclass Props extends BaseService {\n  private state = reactive<PropsState>({\n    propsConfigMap: {},\n    propsValueMap: {},\n  });\n\n  constructor() {\n    super(['setPropsConfig', 'getPropsConfig', 'setPropsValue', 'getPropsValue']);\n  }\n\n  public setPropsConfigs(configs: Record<string, FormConfig>) {\n    Object.keys(configs).forEach((type: string) => {\n      this.setPropsConfig(toLine(type), configs[type]);\n    });\n    this.emit('props-configs-change');\n  }\n\n  /**\n   * 为指定类型组件设置组件属性表单配置\n   * @param type 组件类型\n   * @param config 组件属性表单配置\n   */\n  public setPropsConfig(type: string, config: FormConfig) {\n    this.state.propsConfigMap[type] = fillConfig(Array.isArray(config) ? config : [config]);\n  }\n\n  /**\n   * 获取指点类型的组件属性表单配置\n   * @param type 组件类型\n   * @returns 组件属性表单配置\n   */\n  public async getPropsConfig(type: string): Promise<FormConfig> {\n    if (type === 'area') {\n      return await this.getPropsConfig('button');\n    }\n\n    return cloneDeep(this.state.propsConfigMap[type] || DEFAULT_CONFIG);\n  }\n\n  public setPropsValues(values: Record<string, MNode>) {\n    Object.keys(values).forEach((type: string) => {\n      this.setPropsValue(toLine(type), values[type]);\n    });\n  }\n\n  /**\n   * 为指点类型组件设置组件初始值\n   * @param type 组件类型\n   * @param value 组件初始值\n   */\n  public setPropsValue(type: string, value: MNode) {\n    this.state.propsValueMap[type] = value;\n  }\n\n  /**\n   * 获取指定类型的组件初始值\n   * @param type 组件类型\n   * @returns 组件初始值\n   */\n  public async getPropsValue(type: string) {\n    if (type === 'area') {\n      const value = (await this.getPropsValue('button')) as MComponent;\n      value.className = 'action-area';\n      value.text = '';\n      if (value.style) {\n        value.style.backgroundColor = 'rgba(255, 255, 255, 0)';\n      }\n      return value;\n    }\n\n    return cloneDeep({\n      ...getDefaultPropsValue(type),\n      ...(this.state.propsValueMap[type] || {}),\n    });\n  }\n}\n\nexport type PropsService = Props;\n\nexport default new Props();\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport type { Component } from 'vue';\n\nimport type { FormConfig } from '@tmagic/form';\nimport type { Id, MApp, MContainer, MNode, MPage } from '@tmagic/schema';\nimport type StageCore from '@tmagic/stage';\n\nimport type { ComponentListService } from '@editor/services/componentList';\nimport type { EditorService } from '@editor/services/editor';\nimport type { EventsService } from '@editor/services/events';\nimport type { HistoryService } from '@editor/services/history';\nimport type { PropsService } from '@editor/services/props';\nimport type { UiService } from '@editor/services/ui';\n\nexport type BeforeAdd = (config: MNode, parent: MContainer) => Promise<MNode> | MNode;\nexport type GetConfig = (config: FormConfig) => Promise<FormConfig> | FormConfig;\n\nexport interface InstallOptions {\n  [key: string]: any;\n}\n\nexport interface Services {\n  editorService: EditorService;\n  historyService: HistoryService;\n  eventsService: EventsService;\n  propsService: PropsService;\n  componentListService: ComponentListService;\n  uiService: UiService;\n}\n\nexport interface StoreState {\n  root: MApp | null;\n  page: MPage | null;\n  parent: MContainer | null;\n  node: MNode | null;\n  stage: StageCore | null;\n  modifiedNodeIds: Map<Id, Id>;\n}\n\nexport interface PropsState {\n  propsConfigMap: Record<string, FormConfig>;\n  propsValueMap: Record<string, MNode>;\n}\n\nexport interface ComponentGroupState {\n  list: ComponentGroup[];\n}\n\nexport interface SetColumnWidth {\n  left?: number;\n  center?: number | 'auto';\n  right?: number;\n}\n\nexport interface GetColumnWidth {\n  left: number;\n  center: number;\n  right: number;\n}\n\nexport interface StageRect {\n  width: number;\n  height: number;\n}\n\nexport interface UiState {\n  /** 当前点击画布是否触发选中，true: 不触发，false: 触发，默认为false */\n  uiSelectMode: boolean;\n  /** 是否显示整个配置源码， true: 显示， false: 不显示，默认为false */\n  showSrc: boolean;\n  /** 画布显示放大倍数，默认为 1 */\n  zoom: number;\n  /** 画布容器的宽高 */\n  stageContainerRect: StageRect;\n  /** 画布顶层div的宽高，可用于改变画布的大小 */\n  stageRect: StageRect;\n  /** 编辑器列布局每一列的宽度，分为左中右三列 */\n  columnWidth: GetColumnWidth;\n  /** 是否显示画布参考线，true: 显示，false: 不显示，默认为true */\n  showGuides: boolean;\n  /** 是否显示标尺，true: 显示，false: 不显示，默认为true */\n  showRule: boolean;\n}\n\nexport interface EditorNodeInfo {\n  node?: MNode;\n  parent?: MContainer;\n  page?: MPage;\n}\n\nexport interface AddMNode {\n  type: string;\n  name?: string;\n  [key: string]: any;\n}\n\n/**\n * 菜单按钮\n */\nexport interface MenuButton {\n  /**\n   * 按钮类型\n   * button: 只有文字不带边框的按钮\n   * text: 纯文本\n   * dropdown: 下拉菜单\n   * divider: 分隔线\n   * zoom: 放大缩小\n   */\n  type: 'button' | 'dropdown' | 'text' | 'divider' | 'zoom';\n  /** 展示的文案 */\n  text?: string;\n  /** 鼠标悬浮是显示的气泡中的文案 */\n  tooltip?: string;\n  /** element-plus icon class */\n  icon?: string | Component<{}, {}, any>;\n  /** 是否置灰，默认为false */\n  disabled?: boolean | ((data?: Services) => boolean);\n  /** 是否显示，默认为true */\n  display?: boolean | ((data?: Services) => boolean);\n  /** type为button/dropdown时点击运行的方法 */\n  handler?: (data?: Services) => Promise<any> | any;\n  /** type为dropdown时，下拉的菜单列表 */\n  items?: {\n    /** 展示的文案 */\n    text: string;\n    /** 点击运行的方法 */\n    handler(data: Services): any;\n  }[];\n}\n\nexport interface MenuComponent {\n  type: 'component';\n  /** Vue3组件 */\n  component: any;\n  /** 传入组件的props对象 */\n  props?: Record<string, any>;\n  /** 组件监听的事件对象，如：{ click: () => { console.log('click'); } } */\n  listeners?: Record<string, Function>;\n  slots?: Record<string, any>;\n  /** 是否显示，默认为true */\n  display?: boolean | ((data?: Services) => Promise<boolean> | boolean);\n}\n\n/**\n * '/': 分隔符\n * 'delete': 删除按钮\n * 'undo': 撤销按钮\n * 'redo': 恢复按钮\n * 'zoom-in': 放大按钮\n * 'zoom-out': 缩小按钮\n */\nexport type MenuItem =\n  | '/'\n  | 'delete'\n  | 'undo'\n  | 'redo'\n  | 'zoom'\n  | 'zoom-in'\n  | 'zoom-out'\n  | 'guides'\n  | 'rule'\n  | MenuButton\n  | MenuComponent;\n\n/** 工具栏 */\nexport interface MenuBarData {\n  /** 顶部工具栏左边项 */\n  left?: MenuItem[];\n  /** 顶部工具栏中间项 */\n  center?: MenuItem[];\n  /** 顶部工具栏右边项 */\n  right?: MenuItem[];\n}\n\nexport interface SideComponent extends MenuComponent {\n  /** 显示文案 */\n  text: string;\n  /** element-plus icon class */\n  icon: Component<{}, {}, any>;\n}\n\n/**\n * component-list: 组件列表\n * layer: 已选组件树\n */\nexport type SideItem = 'component-list' | 'layer' | SideComponent;\n\n/** 工具栏 */\nexport interface SideBarData {\n  /** 容器类型 */\n  type: 'tabs';\n  /** 默认激活的内容 */\n  status: string;\n  /** panel列表 */\n  items: SideItem[];\n}\n\nexport interface ComponentItem {\n  /** 显示文案 */\n  text: string;\n  /** 组件类型 */\n  type: string;\n  /** element-plus icon class */\n  icon?: string | Component;\n  [key: string]: any;\n}\n\nexport interface ComponentGroup {\n  /** 显示文案 */\n  title: string;\n  /** 组内列表 */\n  items: ComponentItem[];\n}\n\nexport enum LayerOffset {\n  TOP = 'top',\n  BOTTOM = 'bottom',\n}\n\n/** 容器布局 */\nexport enum Layout {\n  FLEX = 'flex',\n  FIXED = 'fixed',\n  RELATIVE = 'relative',\n  ABSOLUTE = 'absolute',\n}\n\nexport enum Keys {\n  ESCAPE = 'Space',\n}\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { random } from 'lodash-es';\n\nimport { Id, MApp, MContainer, MNode, MPage } from '@tmagic/schema';\nimport { getNodePath, isPop } from '@tmagic/utils';\n\nimport { Layout } from '@editor/type';\n\nexport const COPY_STORAGE_KEY = '$MagicEditorCopyData';\n\nexport const generateId = (type: string | number): string => `${type}_${random(10000, false)}`;\n\n/**\n * 获取所有页面配置\n * @param app DSL跟节点\n * @returns 所有页面配置\n */\nexport const getPageList = (app: MApp): MPage[] => {\n  if (app.items && Array.isArray(app.items)) {\n    return app.items.filter((item: MPage) => item.type === 'page');\n  }\n  return [];\n};\n\n/**\n * 获取所有页面名称\n * @param pages 所有页面配置\n * @returns 所有页面名称\n */\nexport const getPageNameList = (pages: MPage[]): string[] => pages.map((page: MPage) => page.name || 'index');\n\n/**\n * 新增页面时，生成页面名称\n * @param {Object} pageNameList 所有页面名称\n * @returns {string}\n */\nexport const generatePageName = (pageNameList: string[]): string => {\n  let pageLength = pageNameList.length;\n\n  if (!pageLength) return 'index';\n\n  let pageName = `page_${pageLength}`;\n  while (pageNameList.includes(pageName)) {\n    pageLength += 1;\n    pageName = `page_${pageLength}`;\n  }\n\n  return pageName;\n};\n\n/**\n * 新增页面时，生成页面名称\n * @param {Object} app 所有页面配置\n * @returns {string}\n */\nexport const generatePageNameByApp = (app: MApp): string => generatePageName(getPageNameList(getPageList(app)));\n\n/**\n * 复制页面时，需要把组件下关联的弹窗id换测复制出来的弹窗的id\n * @param {number} oldId 复制的源弹窗id\n * @param {number} popId 新的弹窗id\n * @param {Object} pageConfig 页面配置\n */\nconst updatePopId = (oldId: Id, popId: Id, pageConfig: MPage) => {\n  pageConfig.items?.forEach((config) => {\n    if (config.pop === oldId) {\n      config.pop = popId;\n      return;\n    }\n\n    if (config.popId === oldId) {\n      config.popId = popId;\n      return;\n    }\n\n    if (Array.isArray(config.items)) {\n      updatePopId(oldId, popId, config as MPage);\n    }\n  });\n};\n\n/**\n * 将组件与组件的子元素配置中的id都设置成一个新的ID\n * @param {Object} config 组件配置\n */\n/* eslint no-param-reassign: [\"error\", { \"props\": false }] */\nexport const setNewItemId = (config: MNode, parent?: MPage) => {\n  const oldId = config.id;\n\n  config.id = generateId(config.type);\n  config.name = `${config.name?.replace(/_(\\d+)$/, '')}_${config.id}`;\n\n  // 只有弹窗在页面下的一级子元素才有效\n  if (isPop(config) && parent?.type === 'page') {\n    updatePopId(oldId, config.id, parent);\n  }\n\n  if (config.items && Array.isArray(config.items)) {\n    config.items.forEach((item) => setNewItemId(item, config as MPage));\n  }\n};\n\n/**\n * @param {Object} node\n * @returns {boolean}\n */\nexport const isFixed = (node: MNode): boolean => node.style?.position === 'fixed';\n\nexport const getNodeIndex = (node: MNode, parent: MContainer): number => {\n  const items = parent?.items || [];\n  return items.findIndex((item: MNode) => `${item.id}` === `${node.id}`);\n};\n\nexport const toRelative = (node: MNode) => {\n  node.style = {\n    ...(node.style || {}),\n    position: 'relative',\n    top: 0,\n    left: 0,\n  };\n  return node;\n};\n\nexport const initPosition = (node: MNode, layout: Layout) => {\n  if (layout === Layout.ABSOLUTE) {\n    node.style = {\n      position: 'absolute',\n      ...(node.style || {}),\n    };\n    return node;\n  }\n\n  if (layout === Layout.RELATIVE) {\n    return toRelative(node);\n  }\n\n  return node;\n};\n\nexport const setLayout = (node: MNode, layout: Layout) => {\n  node.items?.forEach((child: MNode) => {\n    if (isPop(child)) return;\n\n    child.style = child.style || {};\n\n    // 是 fixed 不做处理\n    if (child.style.position === 'fixed') return;\n\n    if (layout !== Layout.RELATIVE) {\n      child.style.position = 'absolute';\n    } else {\n      toRelative(child);\n      child.style.right = 'auto';\n      child.style.bottom = 'auto';\n    }\n  });\n  return node;\n};\n\nexport const change2Fixed = (node: MNode, root: MApp) => {\n  const path = getNodePath(node.id, root.items);\n  const offset = {\n    left: 0,\n    top: 0,\n  };\n\n  path.forEach((value) => {\n    offset.left = offset.left + globalThis.parseFloat(value.style?.left || 0);\n    offset.top = offset.top + globalThis.parseFloat(value.style?.top || 0);\n  });\n\n  node.style = {\n    ...(node.style || {}),\n    ...offset,\n  };\n  return node;\n};\n\nexport const Fixed2Other = async (node: MNode, root: MApp, getLayout: (node: MNode) => Promise<Layout>) => {\n  const path = getNodePath(node.id, root.items);\n  const cur = path.pop();\n  const offset = {\n    left: cur?.style?.left || 0,\n    top: cur?.style?.top || 0,\n  };\n\n  path.forEach((value) => {\n    offset.left = offset.left - globalThis.parseFloat(value.style?.left || 0);\n    offset.top = offset.top - globalThis.parseFloat(value.style?.top || 0);\n  });\n\n  const parent = path.pop();\n  if (!parent) {\n    return toRelative(node);\n  }\n\n  const layout = await getLayout(parent);\n  if (layout !== Layout.RELATIVE) {\n    node.style = {\n      ...(node.style || {}),\n      ...offset,\n      position: 'absolute',\n    };\n    return node;\n  }\n\n  return toRelative(node);\n};\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { reactive, toRaw } from 'vue';\nimport { cloneDeep, mergeWith } from 'lodash-es';\nimport serialize from 'serialize-javascript';\n\nimport type { Id, MApp, MComponent, MContainer, MNode, MPage } from '@tmagic/schema';\nimport type StageCore from '@tmagic/stage';\nimport { getNodePath, isPop } from '@tmagic/utils';\n\nimport historyService, { StepValue } from '@editor/services/history';\nimport propsService from '@editor/services/props';\nimport type { AddMNode, EditorNodeInfo, StoreState } from '@editor/type';\nimport { LayerOffset, Layout } from '@editor/type';\nimport {\n  change2Fixed,\n  COPY_STORAGE_KEY,\n  Fixed2Other,\n  getNodeIndex,\n  initPosition,\n  isFixed,\n  setLayout,\n  setNewItemId,\n} from '@editor/utils/editor';\nimport { log } from '@editor/utils/logger';\n\nimport BaseService from './BaseService';\n\nclass Editor extends BaseService {\n  private isHistoryStateChange = false;\n\n  private state = reactive<StoreState>({\n    root: null,\n    page: null,\n    parent: null,\n    node: null,\n    stage: null,\n    modifiedNodeIds: new Map(),\n  });\n\n  constructor() {\n    super([\n      'getLayout',\n      'select',\n      'add',\n      'remove',\n      'update',\n      'sort',\n      'copy',\n      'paste',\n      'alignCenter',\n      'moveLayer',\n      'undo',\n      'redo',\n    ]);\n  }\n\n  /**\n   * 设置当前指点节点配置\n   * @param name 'root' | 'page' | 'parent' | 'node'\n   * @param value MNode\n   * @returns MNode\n   */\n  public set<T = MNode>(name: keyof StoreState, value: T) {\n    this.state[name] = value as any;\n    log('store set ', name, ' ', value);\n\n    if (name === 'root') {\n      this.emit('root-change', value);\n    }\n  }\n\n  /**\n   * 获取当前指点节点配置\n   * @param name  'root' | 'page' | 'parent' | 'node'\n   * @returns MNode\n   */\n  public get<T = MNode>(name: keyof StoreState): T {\n    return (this.state as any)[name];\n  }\n\n  /**\n   * 根据id获取组件、组件的父组件以及组件所属的页面节点\n   * @param {number | string} id 组件id\n   * @returns {EditorNodeInfo}\n   */\n  public getNodeInfo(id: Id): EditorNodeInfo {\n    const root = this.get<MApp | null>('root');\n    if (!root) return {};\n\n    if (id === root.id) {\n      return { node: root };\n    }\n\n    const path = getNodePath(id, root.items);\n\n    if (!path.length) return {};\n\n    path.unshift(root);\n    const info: EditorNodeInfo = {};\n\n    info.node = path[path.length - 1] as MComponent;\n    info.parent = path[path.length - 2] as MContainer;\n\n    path.forEach((item) => {\n      if (item.type === 'page') {\n        info.page = item as MPage;\n        return;\n      }\n    });\n\n    return info;\n  }\n\n  /**\n   * 根据ID获取指点节点配置\n   * @param id 组件ID\n   * @returns 组件节点配置\n   */\n  public getNodeById(id: Id): MNode | undefined {\n    const { node } = this.getNodeInfo(id);\n    return node;\n  }\n\n  /**\n   * 根据ID获取指点节点的父节点配置\n   * @param id 组件ID\n   * @returns 指点组件的父节点配置\n   */\n  public getParentById(id: Id): MContainer | undefined {\n    if (!this.get<MApp | null>('root')) return;\n    const { parent } = this.getNodeInfo(id);\n    return parent;\n  }\n\n  /**\n   * 只有容器拥有布局\n   */\n  public async getLayout(node: MNode): Promise<Layout> {\n    if (node.layout) {\n      return node.layout;\n    }\n\n    // 如果该节点没有设置position，则认为是流式布局，例如获取root的布局时\n    if (!node.style?.position) {\n      return Layout.RELATIVE;\n    }\n\n    return Layout.ABSOLUTE;\n  }\n\n  /**\n   * 选中指点节点（将指点节点设置成当前选中状态）\n   * @param config 指点节点配置或者ID\n   * @returns 当前选中的节点配置\n   */\n  public async select(config: MNode | Id): Promise<MNode> {\n    let id: Id;\n    if (typeof config === 'string' || typeof config === 'number') {\n      id = config;\n    } else {\n      id = config.id;\n    }\n    if (!id) {\n      throw new Error('没有ID，无法选中');\n    }\n\n    const { node, parent, page } = this.getNodeInfo(id);\n    if (!node) throw new Error('获取不到组件信息');\n\n    if (node.id === this.state.root?.id) {\n      throw new Error('不能选根节点');\n    }\n\n    this.set('node', node);\n    this.set('page', page || null);\n    this.set('parent', parent || null);\n\n    if (page) {\n      historyService.changePage(toRaw(page));\n    } else {\n      historyService.empty();\n    }\n\n    return node;\n  }\n\n  /**\n   * 向指点容器添加组件节点\n   * @param addConfig 将要添加的组件节点配置\n   * @param parent 要添加到的容器组件节点配置，如果不设置，默认为当前选中的组件的父节点\n   * @returns 添加后的节点\n   */\n  public async add({ type, ...config }: AddMNode, parent?: MContainer | null): Promise<MNode> {\n    const curNode = this.get<MContainer>('node');\n\n    let parentNode: MNode | undefined;\n\n    if (type === 'page') {\n      parentNode = this.get<MApp>('root');\n      // 由于支持中间件扩展，在parent参数为undefined时，parent会变成next函数\n    } else if (parent && typeof parent !== 'function') {\n      parentNode = parent;\n    } else if (curNode.items) {\n      parentNode = curNode;\n    } else {\n      parentNode = this.getParentById(curNode.id);\n    }\n\n    if (!parentNode) throw new Error('未找到父元素');\n\n    const layout = await this.getLayout(parentNode);\n    const newNode = initPosition({ ...toRaw(await propsService.getPropsValue(type)), ...config }, layout);\n\n    if ((parentNode?.type === 'app' || curNode.type === 'app') && newNode.type !== 'page') {\n      throw new Error('app下不能添加组件');\n    }\n\n    parentNode?.items?.push(newNode);\n\n    await this.get<StageCore>('stage')?.add({ config: cloneDeep(newNode), root: cloneDeep(this.get('root')) });\n\n    await this.select(newNode);\n\n    this.addModifiedNodeId(newNode.id);\n    this.pushHistoryState();\n\n    return newNode;\n  }\n\n  /**\n   * 删除组件\n   * @param {Object} node\n   * @return {Object} 删除的组件配置\n   */\n  public async remove(node: MNode): Promise<MNode | void> {\n    if (!node?.id) return;\n\n    const root = this.get<MApp | null>('root');\n\n    if (!root) throw new Error('没有root');\n\n    const { parent, node: curNode } = this.getNodeInfo(node.id);\n\n    if (!parent || !curNode) throw new Error('找不要删除的节点');\n\n    const index = getNodeIndex(curNode, parent);\n\n    if (typeof index !== 'number' || index === -1) throw new Error('找不要删除的节点');\n\n    parent.items?.splice(index, 1);\n    this.get<StageCore>('stage')?.remove({ id: node.id, root: this.get('root') });\n\n    if (node.type === 'page') {\n      await this.select(root.items[0] || root);\n    } else {\n      await this.select(parent);\n    }\n\n    this.addModifiedNodeId(parent.id);\n    this.pushHistoryState();\n\n    return node;\n  }\n\n  /**\n   * 更新节点\n   * @param config 新的节点配置，配置中需要有id信息\n   * @returns 更新后的节点配置\n   */\n  public async update(config: MNode): Promise<MNode> {\n    if (!config?.id) throw new Error('没有配置或者配置缺少id值');\n\n    const info = this.getNodeInfo(config.id);\n\n    if (!info.node) throw new Error(`获取不到id为${config.id}的节点`);\n\n    const node = cloneDeep(toRaw(info.node));\n\n    let newConfig = await this.toggleFixedPosition(toRaw(config), node, this.get<MApp>('root'));\n\n    newConfig = mergeWith(cloneDeep(node), newConfig, (objValue, srcValue) => {\n      if (Array.isArray(srcValue)) {\n        return srcValue;\n      }\n    });\n\n    if (!newConfig.type) throw new Error('配置缺少type值');\n\n    if (newConfig.type === 'app') {\n      this.set('root', newConfig);\n      return newConfig;\n    }\n\n    const { parent } = info;\n    if (!parent) throw new Error('获取不到父级节点');\n\n    const parentNodeItems = parent.items;\n    const index = getNodeIndex(newConfig, parent);\n\n    if (!parentNodeItems || typeof index === 'undefined' || index === -1) throw new Error('更新的节点未找到');\n\n    const newLayout = await this.getLayout(newConfig);\n    const layout = await this.getLayout(node);\n    if (newLayout !== layout) {\n      newConfig = setLayout(newConfig, newLayout);\n    }\n\n    parentNodeItems[index] = newConfig;\n\n    if (newConfig.id === this.get('node').id) {\n      this.set('node', newConfig);\n    }\n\n    this.get<StageCore>('stage')?.update({ config: cloneDeep(newConfig), root: this.get('root') });\n\n    if (newConfig.type === 'page') {\n      this.set('page', newConfig);\n    }\n\n    this.addModifiedNodeId(newConfig.id);\n    this.pushHistoryState();\n\n    return newConfig;\n  }\n\n  /**\n   * 将id为id1的组件移动到id为id2的组件位置上，例如：[1,2,3,4] -> sort(1,3) -> [2,1,3,4]\n   * @param id1 组件ID\n   * @param id2 组件ID\n   * @returns void\n   */\n  public async sort(id1: Id, id2: Id): Promise<void> {\n    const node = this.get<MNode>('node');\n    const parent = cloneDeep(toRaw(this.get<MContainer>('parent')));\n    const index2 = parent.items.findIndex((node: MNode) => `${node.id}` === `${id2}`);\n    // 在 id1 的兄弟组件中若无 id2 则直接 return\n    if (index2 < 0) return;\n    const index1 = parent.items.findIndex((node: MNode) => `${node.id}` === `${id1}`);\n\n    parent.items.splice(index2, 0, ...parent.items.splice(index1, 1));\n\n    await this.update(parent);\n    await this.select(node);\n\n    this.get<StageCore>('stage')?.update({ config: cloneDeep(node), root: this.get('root') });\n\n    this.addModifiedNodeId(parent.id);\n    this.pushHistoryState();\n  }\n\n  /**\n   * 将组将节点配置转化成string，然后存储到localStorage中\n   * @param config 组件节点配置\n   * @returns 组件节点配置\n   */\n  public async copy(config: MNode): Promise<void> {\n    globalThis.localStorage.setItem(COPY_STORAGE_KEY, serialize(config));\n  }\n\n  /**\n   * 从localStorage中获取节点，然后添加到当前容器中\n   * @param position 如果设置，指定组件位置\n   * @returns 添加后的组件节点配置\n   */\n  public async paste(position: { left?: number; top?: number } = {}): Promise<MNode | void> {\n    const configStr = globalThis.localStorage.getItem(COPY_STORAGE_KEY);\n    // eslint-disable-next-line prefer-const\n    let config: any = {};\n    if (!configStr) {\n      return;\n    }\n\n    try {\n      // eslint-disable-next-line no-eval\n      eval(`config = ${configStr}`);\n    } catch (e) {\n      console.error(e);\n      return;\n    }\n\n    setNewItemId(config, this.get('root'));\n    if (config.style) {\n      config.style = {\n        ...config.style,\n        ...position,\n      };\n    }\n\n    return await this.add(config);\n  }\n\n  /**\n   * 将指点节点设置居中\n   * @param config 组件节点配置\n   * @returns 当前组件节点配置\n   */\n  public async alignCenter(config: MNode): Promise<MNode | void> {\n    const parent = this.get<MContainer>('parent');\n    const node = this.get<MNode>('node');\n    const layout = await this.getLayout(parent);\n    if (layout === Layout.RELATIVE) {\n      return;\n    }\n\n    if (parent.style?.width && node.style?.width) {\n      node.style.left = (parent.style.width - node.style.width) / 2;\n    }\n\n    await this.update(node);\n    this.get<StageCore>('stage')?.update({ config: cloneDeep(toRaw(node)), root: this.get('root') });\n    this.addModifiedNodeId(config.id);\n    this.pushHistoryState();\n\n    return config;\n  }\n\n  /**\n   * 移动当前选中节点位置\n   * @param offset 偏移量\n   */\n  public async moveLayer(offset: number | LayerOffset): Promise<void> {\n    const parent = this.get<MContainer>('parent');\n    const node = this.get('node');\n    const brothers: MNode[] = parent?.items || [];\n    const index = brothers.findIndex((item) => `${item.id}` === `${node?.id}`);\n\n    if (offset === LayerOffset.BOTTOM) {\n      brothers.splice(brothers.length - 1, 0, brothers.splice(index, 1)[0]);\n    } else if (offset === LayerOffset.TOP) {\n      brothers.splice(0, 0, brothers.splice(index, 1)[0]);\n    } else {\n      brothers.splice(index + parseInt(`${offset}`, 10), 0, brothers.splice(index, 1)[0]);\n    }\n\n    this.get<StageCore>('stage')?.update({ config: cloneDeep(toRaw(parent)), root: this.get('root') });\n  }\n\n  /**\n   * 撤销当前操作\n   * @returns 上一次数据\n   */\n  public async undo(): Promise<StepValue | null> {\n    const value = historyService.undo();\n    await this.changeHistoryState(value);\n    return value;\n  }\n\n  /**\n   * 恢复到下一步\n   * @returns 下一步数据\n   */\n  public async redo(): Promise<StepValue | null> {\n    const value = historyService.redo();\n    await this.changeHistoryState(value);\n    return value;\n  }\n\n  public destroy() {\n    this.removeAllListeners();\n    this.set('root', null);\n    this.set('node', null);\n    this.set('page', null);\n    this.set('parent', null);\n  }\n\n  public resetModifiedNodeId() {\n    this.get<Map<Id, Id>>('modifiedNodeIds').clear();\n  }\n\n  private addModifiedNodeId(id: Id) {\n    if (!this.isHistoryStateChange) {\n      this.get<Map<Id, Id>>('modifiedNodeIds').set(id, id);\n    }\n  }\n\n  private pushHistoryState() {\n    const curNode = cloneDeep(toRaw(this.get('node')));\n    if (!this.isHistoryStateChange) {\n      historyService.push({\n        data: cloneDeep(toRaw(this.get('page'))),\n        modifiedNodeIds: this.get<Map<Id, Id>>('modifiedNodeIds'),\n        nodeId: curNode.id,\n      });\n    }\n    this.isHistoryStateChange = false;\n  }\n\n  private async changeHistoryState(value: StepValue | null) {\n    if (!value) return;\n\n    this.isHistoryStateChange = true;\n    await this.update(value.data);\n    this.set('modifiedNodeIds', value.modifiedNodeIds);\n    setTimeout(() => value.nodeId && this.select(value.nodeId), 0);\n  }\n\n  private async toggleFixedPosition(dist: MNode, src: MNode, root: MApp) {\n    let newConfig = cloneDeep(dist);\n\n    if (!isPop(src) && newConfig.style?.position) {\n      if (isFixed(newConfig) && !isFixed(src)) {\n        newConfig = change2Fixed(newConfig, root);\n      } else if (!isFixed(newConfig) && isFixed(src)) {\n        newConfig = await Fixed2Other(newConfig, root, this.getLayout);\n      }\n    }\n\n    return newConfig;\n  }\n}\n\nexport type EditorService = Editor;\n\nexport default new Editor();\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/**\n * 通用的事件处理\n */\n\nimport App from './App';\nimport Node from './Node';\n\nexport interface EventOption {\n  label: string;\n  value: string;\n}\n\nconst COMMON_EVENT_PREFIX = 'magic:common:events:';\nconst COMMON_METHOD_PREFIX = 'magic:common:actions:';\nconst CommonMethod = {\n  SHOW: 'show',\n  HIDE: 'hide',\n  SCROLL_TO_VIEW: 'scrollIntoView',\n  SCROLL_TO_TOP: 'scrollToTop',\n};\n\nexport const DEFAULT_EVENTS: EventOption[] = [{ label: '点击', value: `${COMMON_EVENT_PREFIX}click` }];\n\nexport const DEFAULT_METHODS: EventOption[] = [\n  { label: '显示', value: `${COMMON_METHOD_PREFIX}${CommonMethod.SHOW}` },\n  { label: '隐藏', value: `${COMMON_METHOD_PREFIX}${CommonMethod.HIDE}` },\n  { label: '滚动到该组件', value: `${COMMON_METHOD_PREFIX}${CommonMethod.SCROLL_TO_VIEW}` },\n  { label: '回到顶部', value: `${COMMON_METHOD_PREFIX}${CommonMethod.SCROLL_TO_TOP}` },\n];\n\nexport const getCommonEventName = (commonEventName: string, nodeId: string | number) => {\n  const returnName = `${commonEventName}:${nodeId}`;\n\n  if (commonEventName.startsWith(COMMON_EVENT_PREFIX)) return returnName;\n\n  return `${COMMON_EVENT_PREFIX}${returnName}`;\n};\n\nexport const isCommonMethod = (methodName: string) => methodName.startsWith(COMMON_METHOD_PREFIX);\n\n// 点击在组件内的某个元素上，需要向上寻找到当前组件\nconst getDirectComponent = (element: HTMLElement | null, app: App): Node | Boolean => {\n  if (!element) {\n    return false;\n  }\n\n  if (!element.id) {\n    return getDirectComponent(element.parentElement, app);\n  }\n\n  const node = app.page?.getNode(element.id);\n  if (!node) {\n    return false;\n  }\n\n  return node;\n};\n\nconst commonClickEventHandler = (app: App, eventName: string, e: any) => {\n  const node = getDirectComponent(e.target, app);\n\n  if (node) {\n    const { instance, data } = node as Node;\n    app.emit(getCommonEventName(eventName, data.id), instance);\n  }\n};\n\nexport const bindCommonEventListener = (app: App) => {\n  window.document.body.addEventListener('click', (e: any) => {\n    commonClickEventHandler(app, 'click', e);\n  });\n\n  window.document.body.addEventListener(\n    'click',\n    (e: any) => {\n      commonClickEventHandler(app, 'click:capture', e);\n    },\n    true,\n  );\n};\n\nexport const triggerCommonMethod = (methodName: string, node: Node) => {\n  const { instance } = node;\n\n  switch (methodName.replace(COMMON_METHOD_PREFIX, '')) {\n    case CommonMethod.SHOW:\n      instance.show();\n      break;\n\n    case CommonMethod.HIDE:\n      instance.hide();\n      break;\n\n    case CommonMethod.SCROLL_TO_VIEW:\n      instance.$el.scrollIntoView({ behavior: 'smooth' });\n      break;\n\n    case CommonMethod.SCROLL_TO_TOP:\n      window.scrollTo({ top: 0, behavior: 'smooth' });\n      break;\n\n    default:\n      break;\n  }\n};\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { reactive } from 'vue';\nimport { cloneDeep } from 'lodash-es';\n\nimport { DEFAULT_EVENTS, DEFAULT_METHODS, EventOption } from '@tmagic/core';\nimport { toLine } from '@tmagic/utils';\n\nimport type { ComponentGroup } from '@editor/type';\n\nimport BaseService from './BaseService';\n\nconst eventMap: Record<string, EventOption[]> = reactive({});\nconst methodMap: Record<string, EventOption[]> = reactive({});\n\nclass Events extends BaseService {\n  constructor() {\n    super([]);\n  }\n\n  public init(componentGroupList: ComponentGroup[]) {\n    componentGroupList.forEach((group) => {\n      group.items.forEach((element) => {\n        const type = toLine(element.type);\n        if (!this.getEvent(type)) {\n          this.setEvent(type, DEFAULT_EVENTS);\n        }\n        if (!this.getMethod(type)) {\n          this.setMethod(type, DEFAULT_METHODS);\n        }\n      });\n    });\n  }\n\n  public setEvents(events: Record<string, EventOption[]>) {\n    Object.keys(events).forEach((type: string) => {\n      this.setEvent(toLine(type), events[type] || []);\n    });\n  }\n\n  public setEvent(type: string, events: EventOption[]) {\n    eventMap[type] = [...DEFAULT_EVENTS, ...events];\n  }\n\n  public getEvent(type: string): EventOption[] {\n    return cloneDeep(eventMap[type] || DEFAULT_EVENTS);\n  }\n\n  public setMethods(methods: Record<string, EventOption[]>) {\n    Object.keys(methods).forEach((type: string) => {\n      this.setMethod(toLine(type), methods[type] || []);\n    });\n  }\n\n  public setMethod(type: string, method: EventOption[]) {\n    methodMap[type] = [...DEFAULT_METHODS, ...method];\n  }\n\n  public getMethod(type: string) {\n    return cloneDeep(methodMap[type] || DEFAULT_METHODS);\n  }\n}\n\nexport type EventsService = Events;\n\nexport default new Events();\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { FormConfig, FormState } from '@tmagic/form';\n\nimport editorService from '@editor/services/editor';\nimport eventsService from '@editor/services/events';\nimport { generateId } from '@editor/utils/editor';\n\n/**\n * 统一为组件属性表单加上事件、高级、样式配置\n * @param config 组件属性配置\n * @returns Object\n */\nexport const fillConfig = (config: FormConfig = []) => [\n  {\n    type: 'tab',\n    items: [\n      {\n        title: '属性',\n        labelWidth: '80px',\n        items: [\n          // 组件类型，必须要有\n          {\n            text: 'type',\n            name: 'type',\n            type: 'hidden',\n          },\n          // 组件id，必须要有\n          {\n            name: 'id',\n            type: 'display',\n            text: 'id',\n          },\n          {\n            name: 'name',\n            text: '组件名称',\n          },\n          ...config,\n        ],\n      },\n      {\n        title: '样式',\n        labelWidth: '80px',\n        items: [\n          {\n            name: 'style',\n            items: [\n              {\n                type: 'fieldset',\n                legend: '位置',\n                items: [\n                  {\n                    name: 'position',\n                    type: 'checkbox',\n                    activeValue: 'fixed',\n                    inactiveValue: 'absolute',\n                    defaultValue: 'absolute',\n                    text: '固定定位',\n                  },\n                  {\n                    name: 'left',\n                    text: 'left',\n                  },\n                  {\n                    name: 'top',\n                    text: 'top',\n                    disabled: (vm: FormState, { model }: any) =>\n                      model.position === 'fixed' && model._magic_position === 'fixedBottom',\n                  },\n                  {\n                    name: 'right',\n                    text: 'right',\n                  },\n                  {\n                    name: 'bottom',\n                    text: 'bottom',\n                    disabled: (vm: FormState, { model }: any) =>\n                      model.position === 'fixed' && model._magic_position === 'fixedTop',\n                  },\n                ],\n              },\n              {\n                type: 'fieldset',\n                legend: '盒子',\n                items: [\n                  {\n                    name: 'width',\n                    text: '宽度',\n                  },\n                  {\n                    name: 'height',\n                    text: '高度',\n                  },\n                ],\n              },\n              {\n                type: 'fieldset',\n                legend: '背景',\n                items: [\n                  {\n                    name: 'backgroundImage',\n                    text: '背景图',\n                  },\n                  {\n                    name: 'backgroundColor',\n                    text: '背景颜色',\n                    type: 'colorPicker',\n                  },\n                  {\n                    name: 'backgroundRepeat',\n                    text: '背景图重复',\n                    type: 'select',\n                    defaultValue: 'no-repeat',\n                    options: [\n                      { text: 'repeat', value: 'repeat' },\n                      { text: 'repeat-x', value: 'repeat-x' },\n                      { text: 'repeat-y', value: 'repeat-y' },\n                      { text: 'no-repeat', value: 'no-repeat' },\n                      { text: 'inherit', value: 'inherit' },\n                    ],\n                  },\n                  {\n                    name: 'backgroundSize',\n                    text: '背景图大小',\n                    defaultValue: '100% 100%',\n                  },\n                ],\n              },\n            ],\n          },\n        ],\n      },\n      {\n        title: '事件',\n        items: [\n          {\n            type: 'table',\n            name: 'events',\n            items: [\n              {\n                name: 'name',\n                label: '事件名',\n                type: 'select',\n                options: (mForm: FormState, { formValue }: any) =>\n                  eventsService.getEvent(formValue.type).map((option) => ({\n                    text: option.label,\n                    value: option.value,\n                  })),\n              },\n              {\n                name: 'to',\n                label: '联动组件',\n                type: 'ui-select',\n              },\n              {\n                name: 'method',\n                label: '动作',\n                type: 'select',\n                options: (mForm: FormState, { model }: any) => {\n                  const node = editorService.getNodeById(model.to);\n                  if (!node) return [];\n\n                  return eventsService.getMethod(node.type).map((option) => ({\n                    text: option.label,\n                    value: option.value,\n                  }));\n                },\n              },\n            ],\n          },\n        ],\n      },\n      {\n        title: '高级',\n        labelWidth: '80px',\n        items: [\n          {\n            type: 'code-link',\n            name: 'created',\n            text: 'created',\n            formTitle: 'created',\n          },\n        ],\n      },\n    ],\n  },\n];\n\n// 默认组件属性表单配置\nexport const DEFAULT_CONFIG: FormConfig = fillConfig([]);\n\n/**\n * 获取默认属性配置\n * @param type 组件类型\n * @returns Object\n */\nexport const getDefaultPropsValue = (type: string) => ({\n  type,\n  id: generateId(type),\n  style: {},\n  name: type,\n});\n","<template>\n  <div class=\"m-editor-empty-panel\">\n    <div class=\"m-editor-empty-content\">\n      <div class=\"m-editor-empty-button\" @click=\"clickHandler\">\n        <div>\n          <el-icon><plus /></el-icon>\n        </div>\n        <p>新增页面</p>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, inject, toRaw } from 'vue';\nimport { Plus } from '@element-plus/icons';\n\nimport { Services } from '@editor/type';\nimport { generatePageNameByApp } from '@editor/utils';\n\nexport default defineComponent({\n  components: { Plus },\n\n  setup() {\n    const services = inject<Services>('services');\n\n    return {\n      clickHandler() {\n        const { editorService } = services || {};\n\n        if (!editorService) return;\n\n        editorService.add({\n          type: 'page',\n          name: generatePageNameByApp(toRaw(editorService.get('root'))),\n        });\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <span ref=\"target\" class=\"m-editor-resizer\">\n    <slot></slot>\n  </span>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, inject, onMounted, onUnmounted, ref, toRaw } from 'vue';\nimport Gesto from 'gesto';\n\nimport { Services } from '@editor/type';\n\nexport default defineComponent({\n  name: 'm-editor-resize',\n\n  props: {\n    type: {\n      type: String,\n    },\n  },\n\n  setup(props) {\n    const services = inject<Services>('services');\n\n    const target = ref<HTMLSpanElement>();\n\n    let getso: Gesto;\n\n    onMounted(() => {\n      if (!target.value) return;\n      getso = new Gesto(target.value, {\n        container: window,\n        pinchOutside: true,\n      }).on('drag', (e) => {\n        if (!target.value || !services) return;\n\n        let { left, right } = {\n          ...toRaw(services.uiService.get('columnWidth')),\n        };\n        if (props.type === 'left') {\n          left += e.deltaX;\n        } else if (props.type === 'right') {\n          right -= e.deltaX;\n        }\n        services.uiService.set('columnWidth', {\n          left,\n          right,\n        });\n      });\n    });\n\n    onUnmounted(() => {\n      getso?.unset();\n    });\n\n    return {\n      target,\n    };\n  },\n});\n</script>\n","<template>\n  <div class=\"m-editor\">\n    <slot name=\"nav\" class=\"m-editor-nav-menu\"></slot>\n\n    <magic-code-editor v-if=\"showSrc\" class=\"m-editor-content\" :init-values=\"root\" @save=\"saveCode\"></magic-code-editor>\n\n    <div class=\"m-editor-content\" v-else>\n      <div class=\"m-editor-framework-left\" :style=\"`width: ${columnWidth?.left}px`\">\n        <slot name=\"sidebar\"></slot>\n      </div>\n\n      <resizer type=\"left\"></resizer>\n\n      <template v-if=\"pageLength > 0\">\n        <div class=\"m-editor-framework-center\" :style=\"`width: ${columnWidth?.center}px`\">\n          <slot name=\"workspace\"></slot>\n        </div>\n\n        <resizer type=\"right\"></resizer>\n\n        <div class=\"m-editor-framework-right\" :style=\"`width: ${columnWidth?.right}px`\">\n          <el-scrollbar>\n            <slot name=\"propsPanel\"></slot>\n          </el-scrollbar>\n        </div>\n      </template>\n\n      <slot v-else name=\"empty\">\n        <add-page-box></add-page-box>\n      </slot>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject } from 'vue';\n\nimport type { MApp } from '@tmagic/schema';\n\nimport { GetColumnWidth, Services } from '@editor/type';\n\nimport AddPageBox from './AddPageBox.vue';\nimport Resizer from './Resizer.vue';\n\nexport default defineComponent({\n  components: {\n    AddPageBox,\n    Resizer,\n  },\n\n  setup() {\n    const services = inject<Services>('services');\n\n    const root = computed(() => services?.editorService.get<MApp>('root'));\n\n    return {\n      root,\n      pageLength: computed(() => root.value?.items?.length || 0),\n      showSrc: computed(() => services?.uiService.get<boolean>('showSrc')),\n      columnWidth: computed(() => services?.uiService.get<GetColumnWidth>('columnWidth')),\n\n      saveCode(value: string) {\n        try {\n          // eslint-disable-next-line no-eval\n          services?.editorService.set('root', eval(value));\n        } catch (e: any) {\n          console.error(e);\n        }\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-icon v-if=\"!icon\"><edit></edit></el-icon>\n  <img v-else-if=\"typeof icon === 'string' && icon.startsWith('http')\" :src=\"icon\" />\n  <i v-else-if=\"typeof icon === 'string'\" :class=\"icon\"></i>\n  <el-icon v-else><component :is=\"toRaw(icon)\"></component></el-icon>\n</template>\n\n<script lang=\"ts\">\nimport { Component, defineComponent, PropType, toRaw } from 'vue';\nimport { Edit } from '@element-plus/icons';\n\nexport default defineComponent({\n  name: 'm-icon',\n\n  components: { Edit },\n\n  props: {\n    icon: {\n      type: [String, Object] as PropType<string | Component>,\n    },\n  },\n\n  setup() {\n    return {\n      toRaw,\n    };\n  },\n});\n</script>\n","<template>\n  <div v-if=\"display\" class=\"menu-item\">\n    <el-divider v-if=\"item.type === 'divider'\" direction=\"vertical\"></el-divider>\n    <div v-else-if=\"item.type === 'text'\" class=\"menu-item-text\">{{ item.text }}</div>\n\n    <template v-else-if=\"item.type === 'zoom'\">\n      <m-icon :icon=\"ZoomIn\" @click=\"zoomInHandler\"></m-icon>\n      <span class=\"menu-item-text\" style=\"margin: 0 5px\">{{ parseInt(`${zoom * 100}`, 10) }}%</span>\n      <m-icon :icon=\"ZoomOut\" @click=\"zoomOutHandler\"></m-icon>\n    </template>\n\n    <el-tooltip\n      v-else-if=\"item.type === 'button'\"\n      effect=\"dark\"\n      placement=\"bottom-start\"\n      :content=\"item.tooltip || item.text\"\n    >\n      <el-button size=\"small\" type=\"text\" :disabled=\"disabled\" @click=\"buttonHandler(item)\"\n        ><m-icon :icon=\"item.icon\"></m-icon><span>{{ item.text }}</span></el-button\n      >\n    </el-tooltip>\n\n    <el-dropdown v-else-if=\"item.type === 'dropdown'\" trigger=\"click\" :disabled=\"disabled\" @command=\"dropdownHandler\">\n      <span class=\"el-dropdown-link menubar-menu-button\">\n        {{ item.text }}<el-icon class=\"el-icon--right\"><arrow-down></arrow-down></el-icon>\n      </span>\n      <template #dropdown>\n        <el-dropdown-menu v-if=\"item.items && item.items.length\">\n          <el-dropdown-item v-for=\"(subItem, index) in item.items\" :key=\"index\" :command=\"{ item, subItem }\">{{\n            subItem.text\n          }}</el-dropdown-item>\n        </el-dropdown-menu>\n      </template>\n    </el-dropdown>\n\n    <component v-else-if=\"item.type === 'component'\" v-bind=\"item.props || {}\" :is=\"item.component\"></component>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType } from 'vue';\nimport { ArrowDown, Back, Delete, Grid, Right, ScaleToOriginal, ZoomIn, ZoomOut } from '@element-plus/icons';\n\nimport MIcon from '@editor/components/Icon.vue';\nimport type { MenuButton, MenuComponent, MenuItem, Services } from '@editor/type';\n\nexport default defineComponent({\n  components: { MIcon, ArrowDown },\n\n  props: {\n    data: {\n      type: [Object, String] as PropType<MenuItem | string>,\n      require: true,\n      default: () => ({\n        type: 'text',\n        display: false,\n      }),\n    },\n  },\n\n  setup(props) {\n    const services = inject<Services>('services');\n    const uiService = services?.uiService;\n\n    const zoomInHandler = () => uiService?.set('zoom', zoom.value + 0.1);\n    const zoomOutHandler = () => uiService?.set('zoom', zoom.value - 0.1);\n\n    const zoom = computed((): number => uiService?.get<number>('zoom') ?? 1);\n    const showGuides = computed((): boolean => uiService?.get<boolean>('showGuides') ?? true);\n    const showRule = computed((): boolean => uiService?.get<boolean>('showRule') ?? true);\n\n    const item = computed((): MenuButton | MenuComponent => {\n      if (typeof props.data !== 'string') {\n        return props.data;\n      }\n      switch (props.data) {\n        case '/':\n          return {\n            type: 'divider',\n          };\n        case 'zoom':\n          return {\n            type: 'zoom',\n          };\n        case 'delete':\n          return {\n            type: 'button',\n            icon: Delete,\n            tooltip: '刪除',\n            disabled: () => services?.editorService.get('node')?.type === 'page',\n            handler: () => services?.editorService.remove(services?.editorService.get('node')),\n          };\n        case 'undo':\n          return {\n            type: 'button',\n            icon: Back,\n            tooltip: '后退',\n            disabled: () => !services?.historyService.state.canUndo,\n            handler: () => services?.editorService.undo(),\n          };\n        case 'redo':\n          return {\n            type: 'button',\n            icon: Right,\n            tooltip: '前进',\n            disabled: () => !services?.historyService.state.canRedo,\n            handler: () => services?.editorService.redo(),\n          };\n        case 'zoom-in':\n          return {\n            type: 'button',\n            icon: ZoomIn,\n            tooltip: '放大',\n            handler: zoomInHandler,\n          };\n        case 'zoom-out':\n          return {\n            type: 'button',\n            icon: ZoomOut,\n            tooltip: '縮小',\n            handler: zoomOutHandler,\n          };\n        case 'rule':\n          return {\n            type: 'button',\n            icon: ScaleToOriginal,\n            tooltip: showRule.value ? '隐藏标尺' : '显示标尺',\n            handler: () => uiService?.set('showRule', !showRule.value),\n          };\n        case 'guides':\n          return {\n            type: 'button',\n            icon: Grid,\n            tooltip: showGuides.value ? '隐藏参考线' : '显示参考线',\n            handler: () => uiService?.set('showGuides', !showGuides.value),\n          };\n        default:\n          return {\n            type: 'text',\n            text: props.data,\n          };\n      }\n    });\n\n    const disabled = computed(() => {\n      if (typeof item.value === 'string') return false;\n      if (item.value.type === 'component') return false;\n      if (typeof item.value.disabled === 'function') {\n        return item.value.disabled(services);\n      }\n      return item.value.disabled;\n    });\n\n    return {\n      ZoomIn,\n      ZoomOut,\n\n      item,\n      zoom,\n      disabled,\n      display: computed(() => {\n        if (!item.value) return false;\n        if (typeof item.value === 'string') return true;\n        if (typeof item.value.display === 'function') {\n          return item.value.display(services);\n        }\n        return item.value.display ?? true;\n      }),\n\n      zoomInHandler,\n      zoomOutHandler,\n\n      dropdownHandler(command: any) {\n        if (command.item.handler) {\n          command.item.handler(services);\n        }\n      },\n\n      buttonHandler(item: MenuButton | MenuComponent) {\n        if (disabled.value) return;\n        if (typeof (item as MenuButton).handler === 'function') {\n          (item as MenuButton).handler?.(services);\n        }\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <div class=\"m-editor-nav-menu\" :style=\"{ height: `${height}px` }\">\n    <div v-for=\"key in keys\" :class=\"`menu-${key}`\" :key=\"key\" :style=\"`width: ${columnWidth?.[key]}px`\">\n      <tool-button :data=\"item\" v-for=\"(item, index) in data[key]\" :key=\"index\"></tool-button>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType } from 'vue';\n\nimport ToolButton from '@editor/components/ToolButton.vue';\nimport { GetColumnWidth, MenuBarData, Services } from '@editor/type';\n\nexport default defineComponent({\n  name: 'nav-menu',\n\n  components: { ToolButton },\n\n  props: {\n    data: {\n      type: Object as PropType<MenuBarData>,\n      default: () => ({}),\n    },\n\n    height: {\n      type: Number,\n    },\n  },\n\n  setup(props) {\n    const services = inject<Services>('services');\n\n    return {\n      keys: computed(() => Object.keys(props.data) as Array<keyof MenuBarData>),\n\n      columnWidth: computed(() => services?.uiService.get<GetColumnWidth>('columnWidth')),\n    };\n  },\n});\n</script>\n","<template>\n  <m-form\n    class=\"m-editor-props-panel\"\n    popper-class=\"m-editor-props-panel-popper\"\n    ref=\"configForm\"\n    size=\"small\"\n    :init-values=\"values\"\n    :config=\"curFormConfig\"\n    @change=\"submit\"\n  ></m-form>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, getCurrentInstance, inject, onMounted, ref, watchEffect } from 'vue';\nimport { ElMessage } from 'element-plus';\n\nimport type { FormValue, MForm } from '@tmagic/form';\nimport type { MNode } from '@tmagic/schema';\n\nimport type { Services } from '@editor/type';\n\nexport default defineComponent({\n  name: 'm-editor-props-panel',\n\n  emits: ['mounted'],\n\n  setup(props, { emit }) {\n    const internalInstance = getCurrentInstance();\n    const values = ref<FormValue>({});\n    const configForm = ref<InstanceType<typeof MForm>>();\n    // ts类型应该是FormConfig， 但是打包时会出错，所以暂时用any\n    const curFormConfig = ref<any>([]);\n    const services = inject<Services>('services');\n    const node = computed(() => services?.editorService.get<MNode | null>('node'));\n\n    const init = async () => {\n      if (!node.value) {\n        curFormConfig.value = [];\n        return;\n      }\n\n      values.value = node.value;\n      const type = node.value.type || (node.value.items ? 'container' : 'text');\n      curFormConfig.value = (await services?.propsService.getPropsConfig(type)) || [];\n    };\n\n    watchEffect(init);\n    services?.propsService.on('props-configs-change', init);\n\n    onMounted(() => {\n      emit('mounted', internalInstance);\n    });\n\n    return {\n      values,\n      configForm,\n      curFormConfig,\n\n      async submit() {\n        try {\n          const values = await configForm.value?.submitForm();\n          services?.editorService.update(values);\n        } catch (e: any) {\n          console.error(e);\n          ElMessage.closeAll();\n          ElMessage.error({\n            duration: 10000,\n            showClose: true,\n            message: e.message,\n            dangerouslyUseHTMLString: true,\n          });\n        }\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-scrollbar>\n    <el-collapse class=\"ui-component-panel\" :model-value=\"collapseValue\">\n      <el-input\n        prefix-icon=\"el-icon-search\"\n        placeholder=\"输入关键字进行过滤\"\n        class=\"search-input\"\n        size=\"small\"\n        clearable\n        v-model=\"searchText\"\n      />\n      <template v-for=\"(group, index) in list\">\n        <el-collapse-item v-if=\"group.items && group.items.length\" :key=\"index\" :name=\"index\">\n          <template #title><i class=\"el-icon-s-grid\"></i>{{ group.title }}</template>\n          <div class=\"component-item\" v-for=\"item in group.items\" :key=\"item.type\" @click=\"appendComponent(item)\">\n            <m-icon :icon=\"item.icon\"></m-icon>\n\n            <el-tooltip effect=\"dark\" placement=\"bottom\" :content=\"item.text\">\n              <span>{{ item.text }}</span>\n            </el-tooltip>\n          </div>\n        </el-collapse-item>\n      </template>\n    </el-collapse>\n  </el-scrollbar>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, ref } from 'vue';\n\nimport MIcon from '@editor/components/Icon.vue';\nimport type { ComponentGroup, ComponentItem, Services } from '@editor/type';\n\nexport default defineComponent({\n  name: 'ui-component-panel',\n\n  components: { MIcon },\n\n  setup() {\n    const searchText = ref('');\n    const services = inject<Services>('services');\n    const list = computed(() =>\n      services?.componentListService.getList().map((group: ComponentGroup) => ({\n        ...group,\n        items: group.items.filter((item: ComponentItem) => item.text.includes(searchText.value)),\n      })),\n    );\n    const collapseValue = computed(() =>\n      Array(list.value?.length)\n        .fill(1)\n        .map((x, i) => i),\n    );\n\n    return {\n      searchText,\n      collapseValue,\n      list,\n\n      appendComponent({ text, type, ...config }: ComponentItem): void {\n        services?.editorService.add({\n          name: text,\n          type,\n          ...config,\n        });\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <div v-if=\"node\" class=\"magic-editor-content-menu\">\n    <div\n      v-if=\"node.items\"\n      class=\"magic-editor-content-menu-item\"\n      @mouseenter=\"setSubVisiable(true)\"\n      @mouseleave=\"setSubVisiable(false)\"\n    >\n      新增\n    </div>\n    <div v-if=\"node.type !== 'app'\" class=\"magic-editor-content-menu-item\" @click=\"() => copy(node)\">复制</div>\n    <div\n      v-if=\"node.type !== 'app' && node.type !== 'page'\"\n      class=\"magic-editor-content-menu-item\"\n      @click=\"() => remove()\"\n    >\n      删除\n    </div>\n    <div class=\"subMenu\" v-show=\"subVisible\" @mouseenter=\"setSubVisiable(true)\" @mouseleave=\"setSubVisiable(false)\">\n      <el-scrollbar>\n        <template v-if=\"node.type === 'tabs'\">\n          <div\n            class=\"magic-editor-content-menu-item\"\n            @click=\"\n              () =>\n                append({\n                  type: 'tab-pane',\n                })\n            \"\n          >\n            标签\n          </div>\n        </template>\n\n        <template v-else-if=\"node.type === 'app'\">\n          <div\n            class=\"magic-editor-content-menu-item\"\n            v-for=\"item in menu.app\"\n            :key=\"item.type\"\n            @click=\"() => append(item)\"\n          >\n            {{ item.text }}\n          </div>\n        </template>\n\n        <template v-else-if=\"node.items\">\n          <div v-for=\"list in menu.component\" :key=\"list.title\">\n            <template v-for=\"item in list.items\">\n              <div class=\"magic-editor-content-menu-item\" v-if=\"item\" :key=\"item.type\" @click=\"() => append(item)\">\n                {{ item.text }}\n              </div>\n            </template>\n            <div class=\"separation\"></div>\n          </div>\n        </template>\n      </el-scrollbar>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType, ref } from 'vue';\n\nimport type { ComponentGroup, Services } from '@editor/type';\n\nexport default defineComponent({\n  name: 'magic-editor-content-menu',\n\n  props: {\n    componentGroupList: {\n      type: Array as PropType<ComponentGroup[]>,\n      default: () => [],\n    },\n  },\n\n  setup(props) {\n    const services = inject<Services>('services');\n    const subVisible = ref(false);\n    const node = computed(() => services?.editorService.get('node'));\n\n    return {\n      subVisible,\n\n      node,\n\n      menu: computed(() => ({\n        app: [\n          {\n            type: 'page',\n            text: '页面',\n          },\n        ],\n        component: props.componentGroupList,\n      })),\n\n      append(config: any) {\n        services?.editorService.add({\n          name: config.text,\n          type: config.type,\n        });\n      },\n\n      remove() {\n        node.value && services?.editorService.remove(node.value);\n      },\n\n      copy(node: any) {\n        services?.editorService.copy(node);\n      },\n\n      setSubVisiable(v: any) {\n        subVisible.value = v;\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-scrollbar class=\"magic-editor-layer-panel\">\n    <el-input\n      class=\"filterInput\"\n      size=\"small\"\n      placeholder=\"输入关键字进行过滤\"\n      clearable\n      v-model=\"filterText\"\n      @change=\"filterTextChangeHandler\"\n    ></el-input>\n\n    <el-tree\n      v-if=\"values.length\"\n      ref=\"tree\"\n      node-key=\"id\"\n      draggable\n      :load=\"loadItems\"\n      :data=\"values\"\n      :expand-on-click-node=\"false\"\n      :highlight-current=\"true\"\n      :props=\"{\n        children: 'items',\n      }\"\n      :filter-node-method=\"filterNode\"\n      :allow-drop=\"allowDrop\"\n      @node-click=\"clickHandler\"\n      @node-contextmenu=\"contextmenu\"\n      @node-drag-end=\"handleDragEnd\"\n      empty-text=\"页面空荡荡的\"\n    >\n      <template #default=\"{ node, data }\">\n        <slot name=\"layer-node-content\" :node=\"node\" :data=\"data\">\n          <span>\n            {{ `${data.name} (${data.id})` }}\n          </span>\n        </slot>\n      </template>\n    </el-tree>\n\n    <teleport to=\"body\">\n      <layer-menu :style=\"menuStyle\"></layer-menu>\n    </teleport>\n  </el-scrollbar>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, onMounted, Ref, ref, watchEffect } from 'vue';\nimport type { ElTree } from 'element-plus';\n\nimport type { MNode, MPage } from '@tmagic/schema';\n\nimport type { EditorService } from '@editor/services/editor';\nimport type { Services } from '@editor/type';\n\nimport LayerMenu from './LayerMenu.vue';\n\nconst select = (data: MNode, editorService?: EditorService) => {\n  if (!data.id) {\n    throw new Error('没有id');\n  }\n\n  editorService?.select(data);\n};\n\nconst useDrop = (tree: Ref<InstanceType<typeof ElTree> | undefined>, editorService?: EditorService) => ({\n  allowDrop: (draggingNode: any, dropNode: any, type: string): boolean => {\n    const { data } = dropNode || {};\n    const { data: ingData } = draggingNode;\n\n    const { type: ingType } = ingData;\n\n    if (ingType !== 'page' && data.type === 'page') return false;\n    if (ingType === 'page' && data.type !== 'page') return false;\n    if (!data || !data.type) return false;\n    if (['prev', 'next'].includes(type)) return true;\n    if (data.items || data.type === 'container') return true;\n\n    return false;\n  },\n\n  handleDragEnd() {\n    if (!tree.value) return;\n    const { data } = tree.value;\n    const [page] = data as [MPage];\n    editorService?.update(page);\n  },\n});\n\nconst useStatus = (tree: Ref<InstanceType<typeof ElTree> | undefined>, editorService?: EditorService) => {\n  const page = computed(() => editorService?.get('page'));\n\n  watchEffect(() => {\n    if (!tree.value) return;\n\n    const node = editorService?.get('node');\n    node && tree.value.setCurrentKey(node.id, true);\n\n    const parent = editorService?.get('parent');\n    if (!parent?.id) return;\n\n    const treeNode = tree.value.getNode(parent.id);\n    treeNode?.updateChildren();\n  });\n\n  return {\n    values: computed(() => (page.value ? [page.value] : [])),\n\n    loadItems: (node: any, resolve: Function) => {\n      if (Array.isArray(node.data)) {\n        return resolve(node.data);\n      }\n      if (Array.isArray(node.data?.items)) {\n        return resolve(node.data?.items);\n      }\n      resolve([]);\n    },\n  };\n};\n\nconst useFilter = (tree: Ref<InstanceType<typeof ElTree> | undefined>) => ({\n  filterText: ref(''),\n\n  filterNode: (value: string, data: MNode): boolean => {\n    if (!value) {\n      return true;\n    }\n    let name = '';\n    if (data.name) {\n      name = data.name;\n    } else if (data.type) {\n      name = data.type;\n    } else if (data.items) {\n      name = 'container';\n    }\n    return name.indexOf(value) !== -1;\n  },\n\n  filterTextChangeHandler(val: string) {\n    tree.value?.filter(val);\n  },\n});\n\nconst useContentMenu = (editorService?: EditorService) => {\n  const menuStyle = ref({\n    position: 'absolute',\n    left: '0',\n    top: '0',\n    display: 'none',\n  });\n\n  onMounted(() => {\n    document.addEventListener(\n      'click',\n      () => {\n        menuStyle.value.display = 'none';\n      },\n      true,\n    );\n  });\n\n  return {\n    menuStyle,\n\n    contextmenu(event: MouseEvent, data: MNode) {\n      const bodyHeight = globalThis.document.body.clientHeight;\n\n      const left = `${event.clientX + 20}px`;\n      let top = `${event.clientY - 10}px`;\n\n      if (event.clientY + 300 > bodyHeight) {\n        top = `${bodyHeight - 300}px`;\n      }\n\n      menuStyle.value.left = left;\n      menuStyle.value.top = top;\n      menuStyle.value.display = '';\n\n      select(data, editorService);\n    },\n  };\n};\n\nexport default defineComponent({\n  name: 'magic-editor-layer-panel',\n\n  components: { LayerMenu },\n\n  setup() {\n    const services = inject<Services>('services');\n    const tree = ref<InstanceType<typeof ElTree>>();\n    const editorService = services?.editorService;\n    return {\n      tree,\n      ...useDrop(tree, editorService),\n      ...useStatus(tree, editorService),\n      ...useFilter(tree),\n      ...useContentMenu(editorService),\n\n      clickHandler(data: MNode): void {\n        if (services?.uiService.get<boolean>('uiSelectMode')) {\n          document.dispatchEvent(new CustomEvent('ui-select', { detail: data }));\n          return;\n        }\n        select(data, editorService);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-tabs v-if=\"data.type === 'tabs'\" class=\"m-editor-sidebar\" v-model=\"activeTabName\" type=\"card\" tab-position=\"left\">\n    <el-tab-pane v-for=\"item in items\" :key=\"item.text\" :name=\"item.text\">\n      <template #label>\n        <span>\n          <m-icon v-if=\"item.icon\" :icon=\"item.icon\"></m-icon>\n          <div v-if=\"item.text\" class=\"magic-editor-tab-panel-title\">{{ item.text }}</div>\n        </span>\n      </template>\n\n      <component :is=\"item.component\" v-bind=\"item.props || {}\" v-on=\"item.listeners || {}\">\n        <template #layer-node-content=\"{ data, node }\" v-if=\"item.slots?.layerNodeContent\">\n          <component :is=\"item.slots.layerNodeContent\" :data=\"data\" :node=\"node\" />\n        </template>\n      </component>\n    </el-tab-pane>\n  </el-tabs>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType, ref, watch } from 'vue';\nimport { Coin, Files } from '@element-plus/icons';\n\nimport MIcon from '@editor/components/Icon.vue';\nimport { SideBarData, SideComponent } from '@editor/type';\n\nimport ComponentListPanel from './ComponentListPanel.vue';\nimport LayerPanel from './LayerPanel.vue';\n\nexport default defineComponent({\n  name: 'm-sidebar',\n\n  components: { MIcon },\n\n  props: {\n    data: {\n      type: Object as PropType<SideBarData>,\n      default: () => ({ type: 'tabs', status: '组件', items: ['component-list', 'layer'] }),\n    },\n  },\n\n  setup(props) {\n    const activeTabName = ref(props.data?.status);\n\n    watch(\n      () => props.data?.status,\n      (status) => {\n        activeTabName.value = status || '0';\n      },\n    );\n\n    return {\n      activeTabName,\n\n      items: computed<SideComponent[] | Record<string, any>[]>(() =>\n        props.data?.items.map((item) => {\n          if (typeof item !== 'string') {\n            return item;\n          }\n\n          switch (item) {\n            case 'component-list':\n              return {\n                type: 'component',\n                icon: Coin,\n                text: '组件',\n                component: ComponentListPanel,\n                slots: {},\n              };\n            case 'layer':\n              return {\n                type: 'component',\n                icon: Files,\n                text: '已选组件',\n                component: LayerPanel,\n                slots: {},\n              };\n            default:\n              return {};\n          }\n        }),\n      ),\n    };\n  },\n});\n</script>\n","<template>\n  <div class=\"m-editor-page-bar\">\n    <div class=\"m-editor-page-bar-item\" @click=\"addPage\">\n      <el-icon class=\"m-editor-page-bar-menu-add-icon\"><plus></plus></el-icon>\n    </div>\n    <template v-if=\"root\">\n      <div\n        v-for=\"item in root.items\"\n        :key=\"item.key\"\n        class=\"m-editor-page-bar-item\"\n        :class=\"{ active: page?.id === item.id }\"\n        @click=\"switchPage(item)\"\n      >\n        <slot name=\"page-bar-title\" :page=\"item\">\n          <span>{{ item.name }}</span>\n        </slot>\n\n        <el-popover placement=\"top\" :width=\"160\" trigger=\"hover\">\n          <div>\n            <slot name=\"page-bar-popover\" :page=\"item\">\n              <div class=\"magic-editor-content-menu-item\" @click=\"() => copy(item)\">复制</div>\n              <div class=\"magic-editor-content-menu-item\" @click=\"() => remove(item)\">删除</div>\n            </slot>\n          </div>\n          <template #reference>\n            <el-icon class=\"m-editor-page-bar-menu-icon\">\n              <caret-bottom></caret-bottom>\n            </el-icon>\n          </template>\n        </el-popover>\n      </div>\n    </template>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, toRaw } from 'vue';\nimport { CaretBottom, Plus } from '@element-plus/icons';\n\nimport type { MPage } from '@tmagic/schema';\n\nimport type { Services } from '@editor/type';\nimport { generatePageNameByApp } from '@editor/utils/editor';\n\nexport default defineComponent({\n  components: { CaretBottom, Plus },\n\n  setup() {\n    const services = inject<Services>('services');\n    const editorService = services?.editorService;\n\n    return {\n      root: computed(() => editorService?.get('root')),\n      page: computed(() => editorService?.get('page')),\n\n      switchPage(page: MPage) {\n        editorService?.select(page);\n      },\n\n      addPage() {\n        if (!editorService) return;\n        const pageConfig = {\n          type: 'page',\n          name: generatePageNameByApp(toRaw(editorService.get('root'))),\n        };\n        editorService.add(pageConfig);\n      },\n\n      copy(node: MPage) {\n        node && editorService?.copy(node);\n        editorService?.paste({\n          left: 0,\n          top: 0,\n        });\n      },\n\n      remove(node: MPage) {\n        editorService?.remove(node);\n      },\n    };\n  },\n});\n</script>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n// 流式布局下拖动时需要clone一个镜像节点，镜像节点的id前缀\nexport const GHOST_EL_ID_PREFIX = 'ghost_el_';\n\n// 默认放到缩小倍数\nexport const DEFAULT_ZOOM = 1;\n\nexport enum GuidesType {\n  HORIZONTAL = 'horizontal',\n  VERTICAL = 'vertical',\n}\n\nexport enum ZIndex {\n  MASK = '99999',\n}\n\nexport enum MouseButton {\n  LEFT = 0,\n  MIDDLE = 1,\n  RIGHT = 2,\n}\n\nexport enum Mode {\n  ABSOLUTE = 'absolute',\n  FIXED = 'fixed',\n  SORTABLE = 'sortable',\n}\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Mode } from './const';\nimport type { Offset } from './types';\n\nexport const getOffset = (el: HTMLElement): Offset => {\n  const { transform } = getComputedStyle(el);\n  const { offsetParent } = el;\n\n  let left = el.offsetLeft;\n  let top = el.offsetTop;\n\n  if (transform.indexOf('matrix') > -1) {\n    let a = 1;\n    let b = 1;\n    let c = 1;\n    let d = 1;\n    let e = 0;\n    let f = 0;\n    transform.replace(\n      /matrix\\((.+), (.+), (.+), (.+), (.+), (.+)\\)/,\n      ($0: string, $1: string, $2: string, $3: string, $4: string, $5: string, $6: string): string => {\n        a = +$1;\n        b = +$2;\n        c = +$3;\n        d = +$4;\n        e = +$5;\n        f = +$6;\n        return transform;\n      },\n    );\n\n    left = a * left + c * top + e;\n    top = b * left + d * top + f;\n  }\n\n  if (offsetParent) {\n    const parentOffset = getOffset(offsetParent as HTMLElement);\n    return {\n      left: left + parentOffset.left,\n      top: top + parentOffset.top,\n    };\n  }\n\n  return {\n    left,\n    top,\n  };\n};\n\nexport const getAbsolutePosition = (el: HTMLElement, { top, left }: Offset) => {\n  const { offsetParent } = el;\n\n  if (offsetParent) {\n    const parentOffset = getOffset(offsetParent as HTMLElement);\n    return {\n      left: left - parentOffset.left,\n      top: top - parentOffset.top,\n    };\n  }\n\n  return { left, top };\n};\n\nexport const getHost = (targetUrl: string) => targetUrl.match(/\\/\\/([^/]+)/)?.[1];\n\nexport const isSameDomain = (targetUrl = '', source = globalThis.location.host) => {\n  const isHttpUrl = /^(http[s]?:)?\\/\\//.test(targetUrl);\n\n  if (!isHttpUrl) return true;\n\n  return getHost(targetUrl) === source;\n};\n\nexport const isAbsolute = (el?: HTMLElement): boolean => {\n  if (!el) return false;\n  return getComputedStyle(el).position === 'absolute';\n};\n\nexport const isRelative = (el?: HTMLElement): boolean => {\n  if (!el) return false;\n  return getComputedStyle(el).position === 'relative';\n};\n\nexport const isStatic = (el?: HTMLElement): boolean => {\n  if (!el) return false;\n  return getComputedStyle(el).position === 'static';\n};\n\nexport const isFixed = (el?: HTMLElement): boolean => {\n  if (!el) return false;\n  return getComputedStyle(el).position === 'fixed';\n};\n\nexport const isFixedParent = (el: HTMLElement) => {\n  let fixed = false;\n  let dom = el;\n  while (dom) {\n    fixed = isFixed(dom);\n    if (fixed) {\n      break;\n    }\n    const { parentElement } = dom;\n    if (!parentElement || parentElement.tagName === 'BODY') {\n      break;\n    }\n    dom = parentElement;\n  }\n  return fixed;\n};\n\nexport const getMode = (el: HTMLElement): Mode => {\n  if (isFixedParent(el)) return Mode.FIXED;\n  if (isStatic(el) || isRelative(el)) return Mode.SORTABLE;\n  return Mode.ABSOLUTE;\n};\n\nexport const getScrollParent = (element: HTMLElement, includeHidden = false): HTMLElement | null => {\n  let style = getComputedStyle(element);\n  const overflowRegex = includeHidden ? /(auto|scroll|hidden)/ : /(auto|scroll)/;\n\n  if (isFixed(element)) return null;\n  for (let parent = element; parent.parentElement; ) {\n    parent = parent.parentElement;\n    style = getComputedStyle(parent);\n    if (isAbsolute(element) && isStatic(element)) {\n      continue;\n    }\n    if (overflowRegex.test(style.overflow + style.overflowY + style.overflowX)) return parent;\n  }\n\n  return null;\n};\n\nexport const createDiv = ({ className, cssText }: { className: string; cssText: string }) => {\n  const el = globalThis.document.createElement('div');\n  el.className = className;\n  el.style.cssText = cssText;\n  return el;\n};\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable no-param-reassign */\nimport { EventEmitter } from 'events';\n\nimport type { MoveableOptions } from 'moveable';\nimport Moveable from 'moveable';\n\nimport { GHOST_EL_ID_PREFIX, GuidesType, Mode } from './const';\nimport StageCore from './StageCore';\nimport type { SortEventData, StageDragResizeConfig } from './types';\nimport { getAbsolutePosition, getMode, getOffset } from './util';\n\nenum ActionStatus {\n  START = 'start',\n  ING = 'ing',\n  END = 'end',\n}\n\n/**\n * 选中框\n */\nexport default class StageDragResize extends EventEmitter {\n  public core: StageCore;\n  public container: HTMLElement;\n  public target?: HTMLElement;\n  public dragEl?: HTMLElement;\n  public moveable?: Moveable;\n  public horizontalGuidelines: number[] = [];\n  public verticalGuidelines: number[] = [];\n\n  private moveableOptions: MoveableOptions = {};\n  private dragStatus: ActionStatus = ActionStatus.END;\n  private ghostEl: HTMLElement | undefined;\n  private mode: Mode = Mode.ABSOLUTE;\n\n  constructor(config: StageDragResizeConfig) {\n    super();\n\n    this.core = config.core;\n    this.container = config.container;\n  }\n\n  /**\n   * 将选中框渲染并覆盖到选中的组件Dom节点上方\n   * 当选中的节点是不是absolute时，会创建一个新的节点出来作为拖拽目标\n   * @param el 选中组件的Dom节点元素\n   * @param event 鼠标事件\n   */\n  public async select(el: HTMLElement, event?: MouseEvent): Promise<void> {\n    this.target = el;\n    // 如果有滚动条会导致resize时获取到width，height不准确\n    if (/(auto|scroll)/.test(this.target.style.overflow)) {\n      this.target.style.overflow = 'hidden';\n    }\n    this.mode = getMode(el);\n    this.destroyDragEl();\n    this.destroyGhostEl();\n\n    this.dragEl = this.generateDragEl(el);\n\n    this.moveableOptions = await this.getOptions({\n      target: this.dragEl || this.target,\n    });\n\n    this.initMoveable();\n\n    if (event) {\n      this.moveable?.dragStart(event);\n    }\n  }\n\n  /**\n   * 初始化选中框并渲染出来\n   */\n  public async refresh() {\n    if (!this.moveable) throw new Error('未初始化moveable');\n\n    const options = await this.getOptions();\n    Object.entries(options).forEach(([key, value]) => {\n      (this.moveable as any)[key] = value;\n    });\n    this.moveable.updateTarget();\n  }\n\n  public setGuidelines(type: GuidesType, guidelines: number[]): void {\n    if (type === GuidesType.HORIZONTAL) {\n      this.horizontalGuidelines = guidelines;\n    } else if (type === GuidesType.VERTICAL) {\n      this.verticalGuidelines = guidelines;\n    }\n\n    this.refresh();\n  }\n\n  public clearGuides() {\n    this.verticalGuidelines = [];\n    this.horizontalGuidelines = [];\n    this.refresh();\n  }\n\n  /**\n   * 销毁实例\n   */\n  public destroy(): void {\n    this.moveable?.destroy();\n    this.destroyGhostEl();\n    this.destroyDragEl();\n    this.dragStatus = ActionStatus.END;\n    this.removeAllListeners();\n  }\n\n  private initMoveable() {\n    this.moveable?.destroy();\n\n    this.moveable = new Moveable(this.container, {\n      ...this.moveableOptions,\n    });\n\n    this.bindResizeEvent();\n    this.bindDragEvent();\n  }\n\n  private bindResizeEvent(): void {\n    if (!this.moveable) throw new Error('moveable 为初始化');\n\n    const frame = {\n      translate: [0, 0],\n    };\n\n    this.moveable\n      .on('resizeStart', (e) => {\n        if (e.dragStart) {\n          const rect = this.moveable!.getRect();\n          const offset = getAbsolutePosition(e.target as HTMLElement, rect);\n          e.dragStart.set([offset.left, offset.top]);\n        }\n      })\n      .on('resize', ({ width, height, drag }) => {\n        if (!this.moveable || !this.target || !this.dragEl) return;\n\n        const { beforeTranslate } = drag;\n        frame.translate = beforeTranslate;\n        this.dragStatus = ActionStatus.ING;\n\n        this.target.style.width = `${width}px`;\n        this.target.style.height = `${height}px`;\n        this.dragEl.style.width = `${width}px`;\n        this.dragEl.style.height = `${height}px`;\n\n        // 流式布局\n        if (this.mode === Mode.SORTABLE) {\n          this.dragEl.style.top = `${beforeTranslate[1]}px`;\n          this.target.style.top = `0px`;\n          return;\n        }\n\n        this.dragEl.style.left = `${beforeTranslate[0]}px`;\n        this.dragEl.style.top = `${beforeTranslate[1]}px`;\n\n        const offset = getAbsolutePosition(this.target, { left: beforeTranslate[0], top: beforeTranslate[1] });\n\n        this.target.style.left = `${offset.left}px`;\n        this.target.style.top = `${offset.top}px`;\n      })\n      .on('resizeEnd', () => {\n        this.dragStatus = ActionStatus.END;\n        this.update(true);\n      });\n  }\n\n  private bindDragEvent(): void {\n    if (!this.moveable) throw new Error('moveable 为初始化');\n\n    this.moveable\n      .on('dragStart', () => {\n        if (!this.target) throw new Error('未选中组件');\n\n        this.dragStatus = ActionStatus.START;\n\n        if (this.mode === Mode.SORTABLE) {\n          this.ghostEl = this.generateGhostEl(this.target);\n        }\n      })\n      .on('drag', ({ left, top }) => {\n        if (!this.target || !this.dragEl) return;\n        this.dragStatus = ActionStatus.ING;\n\n        const offset = getAbsolutePosition(this.target, { left, top });\n\n        // 流式布局\n        if (this.ghostEl) {\n          this.dragEl.style.top = `${top}px`;\n          this.ghostEl.style.top = `${offset.top}px`;\n          return;\n        }\n\n        this.dragEl.style.left = `${left}px`;\n        this.dragEl.style.top = `${top}px`;\n\n        this.target.style.left = `${offset.left}px`;\n        this.target.style.top = `${offset.top}px`;\n      })\n      .on('dragEnd', () => {\n        // 点击不拖动时会触发dragStart和dragEnd，但是不会有drag事件\n        if (this.dragStatus === ActionStatus.ING) {\n          switch (this.mode) {\n            case Mode.SORTABLE:\n              this.sort();\n              break;\n            default:\n              this.update();\n          }\n        }\n\n        this.dragStatus = ActionStatus.END;\n        this.destroyGhostEl();\n      });\n  }\n\n  private async getSnapElements(el: HTMLElement): Promise<HTMLElement[]> {\n    const { renderer } = this.core;\n    const getSnapElements =\n      (await renderer.getRuntime())?.getSnapElements ||\n      (() => {\n        const doc = renderer.contentWindow?.document;\n        return doc ? Array.from(doc.querySelectorAll('[id]')) : [];\n      });\n    return (\n      getSnapElements(el)\n        // 排除掉当前组件本身\n        .filter((element) => element !== this.target && !this.target?.contains(element))\n    );\n  }\n\n  private sort(): void {\n    if (!this.target || !this.ghostEl) throw new Error('未知错误');\n    const { top } = this.ghostEl.getBoundingClientRect();\n    const { top: oriTop } = this.target.getBoundingClientRect();\n    const deltaTop = top - oriTop;\n    if (Math.abs(deltaTop) >= this.target.clientHeight / 2) {\n      if (deltaTop > 0) {\n        this.emit('sort', down(deltaTop, this.target));\n      } else {\n        this.emit('sort', up(deltaTop, this.target));\n      }\n    } else {\n      this.emit('sort', {\n        src: this.target.id,\n        dist: this.target.id,\n      });\n    }\n  }\n\n  private update(isResize = false): void {\n    const rect = this.moveable!.getRect();\n    const offset =\n      this.mode === Mode.SORTABLE ? { left: 0, top: 0 } : getAbsolutePosition(this.target as HTMLElement, rect);\n\n    const left = this.calcValueByFontsize(offset.left);\n    const top = this.calcValueByFontsize(offset.top);\n    const width = this.calcValueByFontsize(rect.width);\n    const height = this.calcValueByFontsize(rect.height);\n\n    this.emit('update', {\n      el: this.target,\n      style: isResize ? { left, top, width, height } : { left, top },\n    });\n  }\n\n  private generateGhostEl(el: HTMLElement): HTMLElement {\n    if (this.ghostEl) {\n      this.destroyGhostEl();\n    }\n\n    const ghostEl = el.cloneNode(true) as HTMLElement;\n    const { top, left } = getAbsolutePosition(el, getOffset(el));\n    ghostEl.id = `${GHOST_EL_ID_PREFIX}${ghostEl.id}`;\n    ghostEl.style.zIndex = '5';\n    ghostEl.style.opacity = '.5';\n    ghostEl.style.position = 'absolute';\n    ghostEl.style.left = `${left}px`;\n    ghostEl.style.top = `${top}px`;\n    el.after(ghostEl);\n    return ghostEl;\n  }\n\n  private destroyGhostEl(): void {\n    this.ghostEl?.remove();\n    this.ghostEl = undefined;\n  }\n\n  private generateDragEl(el: HTMLElement): HTMLElement {\n    if (this.dragEl) {\n      this.destroyDragEl();\n    }\n\n    const { width, height } = el.getBoundingClientRect();\n    const offset = getOffset(el);\n    const dragEl = globalThis.document.createElement('div');\n    dragEl.style.cssText = `\n      position: absolute;\n      left: ${offset.left}px;\n      top: ${offset.top}px;\n      width: ${width}px;\n      height: ${height}px;\n    `;\n    this.container.append(dragEl);\n    return dragEl;\n  }\n\n  private destroyDragEl(): void {\n    this.dragEl?.remove();\n    this.dragEl = undefined;\n  }\n\n  private async getOptions(options: MoveableOptions = {}): Promise<MoveableOptions> {\n    if (!this.target) return {};\n\n    const isAbsolute = this.mode === Mode.ABSOLUTE;\n\n    let { moveableOptions = {} } = this.core.config;\n\n    if (typeof moveableOptions === 'function') {\n      moveableOptions = moveableOptions(this.core);\n    }\n\n    return {\n      scrollable: true,\n      origin: true,\n      zoom: 1,\n      dragArea: true,\n      draggable: true,\n      resizable: true,\n      snappable: isAbsolute,\n      snapGap: isAbsolute,\n      snapDirections: { center: isAbsolute, middle: isAbsolute },\n      elementSnapDirections: { center: isAbsolute, middle: isAbsolute },\n\n      elementGuidelines: isAbsolute ? await this.getSnapElements(this.target) : [],\n      horizontalGuidelines: this.horizontalGuidelines,\n      verticalGuidelines: this.verticalGuidelines,\n\n      bounds: {\n        top: 0,\n        left: 0,\n        right: this.container.clientWidth,\n        bottom: this.container.clientHeight,\n        ...(moveableOptions.bounds || {}),\n      },\n      ...options,\n      ...moveableOptions,\n    };\n  }\n\n  private calcValueByFontsize(value: number) {\n    const { contentWindow } = this.core.renderer;\n    const fontSize = contentWindow?.document.documentElement.style.fontSize;\n\n    if (fontSize) {\n      const times = globalThis.parseFloat(fontSize) / 100;\n      return (value / times).toFixed(2);\n    }\n\n    return value;\n  }\n}\n\n/**\n * 下移组件位置\n * @param {number} deltaTop 偏移量\n * @param {Object} detail 当前选中的组件配置\n */\nexport const down = (deltaTop: number, target: HTMLElement | SVGElement): SortEventData | void => {\n  let swapIndex = 0;\n  let addUpH = target.clientHeight;\n  const brothers = Array.from(target.parentNode?.children || []).filter(\n    (node) => !node.id.startsWith(GHOST_EL_ID_PREFIX),\n  );\n  const index = brothers.indexOf(target);\n  // 往下移动\n  const downEls = brothers.slice(index + 1) as HTMLElement[];\n\n  for (let i = 0; i < downEls.length; i++) {\n    const ele = downEls[i];\n    // 是 fixed 不做处理\n    if (ele.style?.position === 'fixed') {\n      continue;\n    }\n    addUpH += ele.clientHeight / 2;\n    if (deltaTop <= addUpH) {\n      break;\n    }\n    addUpH += ele.clientHeight / 2;\n    swapIndex = i;\n  }\n  return {\n    src: target.id,\n    dist: downEls.length && swapIndex > -1 ? downEls[swapIndex].id : target.id,\n  };\n};\n\n/**\n * 上移组件位置\n * @param {Array} brothers 处于同一容器下的所有子组件配置\n * @param {number} index 当前组件所处的位置\n * @param {number} deltaTop 偏移量\n * @param {Object} detail 当前选中的组件配置\n */\nexport const up = (deltaTop: number, target: HTMLElement | SVGElement): SortEventData | void => {\n  const brothers = Array.from(target.parentNode?.children || []).filter(\n    (node) => !node.id.startsWith(GHOST_EL_ID_PREFIX),\n  );\n  const index = brothers.indexOf(target);\n  // 往上移动\n  const upEls = brothers.slice(0, index) as HTMLElement[];\n\n  let addUpH = target.clientHeight;\n  let swapIndex = upEls.length - 1;\n\n  for (let i = upEls.length - 1; i >= 0; i--) {\n    const ele = upEls[i];\n    if (!ele) continue;\n    // 是 fixed 不做处理\n    if (ele.style.position === 'fixed') continue;\n\n    addUpH += ele.clientHeight / 2;\n    if (-deltaTop <= addUpH) break;\n    addUpH += ele.clientHeight / 2;\n\n    swapIndex = i;\n  }\n  return {\n    src: target.id,\n    dist: upEls.length && swapIndex > -1 ? upEls[swapIndex].id : target.id,\n  };\n};\n","import EventEmitter from 'events';\n\nimport Guides, { GuidesEvents } from '@scena/guides';\n\nimport { GuidesType } from './const';\n\nexport default class Rule extends EventEmitter {\n  public hGuides: Guides;\n  public vGuides: Guides;\n  public horizontalGuidelines: number[] = [];\n  public verticalGuidelines: number[] = [];\n\n  private container: HTMLDivElement;\n  private containerResizeObserver: ResizeObserver;\n\n  constructor(container: HTMLDivElement) {\n    super();\n\n    this.container = container;\n    this.hGuides = this.createGuides(GuidesType.HORIZONTAL);\n    this.vGuides = this.createGuides(GuidesType.VERTICAL);\n\n    this.hGuides.on('changeGuides', this.hGuidesChangeGuidesHandler);\n    this.vGuides.on('changeGuides', this.vGuidesChangeGuidesHandler);\n\n    this.containerResizeObserver = new ResizeObserver(() => {\n      this.vGuides.resize();\n      this.hGuides.resize();\n    });\n    this.containerResizeObserver.observe(this.container);\n  }\n\n  /**\n   * 是否显示标尺\n   * @param show 是否显示\n   */\n  public showGuides(show = true) {\n    this.hGuides.setState({\n      showGuides: show,\n    });\n\n    this.vGuides.setState({\n      showGuides: show,\n    });\n  }\n\n  /**\n   * 清空所有参考线\n   */\n  public clearGuides() {\n    this.horizontalGuidelines = [];\n    this.verticalGuidelines = [];\n\n    this.vGuides.setState({\n      defaultGuides: [],\n    });\n\n    this.hGuides.setState({\n      defaultGuides: [],\n    });\n\n    this.emit('changeGuides', {\n      type: GuidesType.VERTICAL,\n      guides: [],\n    });\n\n    this.emit('changeGuides', {\n      type: GuidesType.HORIZONTAL,\n      guides: [],\n    });\n  }\n\n  /**\n   * 是否显示标尺\n   * @param show 是否显示\n   */\n  public showRule(show = true) {\n    // 当尺子隐藏时发现大小变化，显示后会变形，所以这里做重新初始化处理\n    if (show) {\n      this.hGuides.destroy();\n      this.hGuides = this.createGuides(GuidesType.HORIZONTAL, this.horizontalGuidelines);\n\n      this.vGuides.destroy();\n      this.vGuides = this.createGuides(GuidesType.VERTICAL, this.verticalGuidelines);\n    } else {\n      this.hGuides.setState({\n        rulerStyle: {\n          visibility: 'hidden',\n        },\n      });\n\n      this.vGuides.setState({\n        rulerStyle: {\n          visibility: 'hidden',\n        },\n      });\n    }\n  }\n\n  scrollRule(scrollTop: number) {\n    this.hGuides.scrollGuides(scrollTop);\n    this.hGuides.scroll(0);\n\n    this.vGuides.scrollGuides(0);\n    this.vGuides.scroll(scrollTop);\n  }\n\n  public destroy(): void {\n    this.hGuides.off('changeGuides', this.hGuidesChangeGuidesHandler);\n    this.vGuides.off('changeGuides', this.vGuidesChangeGuidesHandler);\n    this.containerResizeObserver.disconnect();\n    this.removeAllListeners();\n  }\n\n  private getGuidesStyle = (type: GuidesType) => ({\n    position: 'fixed',\n    zIndex: 1,\n    left: type === GuidesType.HORIZONTAL ? 0 : '-30px',\n    top: type === GuidesType.HORIZONTAL ? '-30px' : 0,\n    width: type === GuidesType.HORIZONTAL ? '100%' : '30px',\n    height: type === GuidesType.HORIZONTAL ? '30px' : '100%',\n  });\n\n  private createGuides = (type: GuidesType, defaultGuides: number[] = []): Guides =>\n    new Guides(this.container, {\n      type,\n      defaultGuides,\n      displayDragPos: true,\n      backgroundColor: '#fff',\n      lineColor: '#000',\n      textColor: '#000',\n      style: this.getGuidesStyle(type),\n    });\n\n  private hGuidesChangeGuidesHandler = (e: GuidesEvents['changeGuides']) => {\n    this.horizontalGuidelines = e.guides;\n    this.emit('changeGuides', {\n      type: GuidesType.HORIZONTAL,\n      guides: this.horizontalGuidelines,\n    });\n  };\n\n  private vGuidesChangeGuidesHandler = (e: GuidesEvents['changeGuides']) => {\n    this.verticalGuidelines = e.guides;\n    this.emit('changeGuides', {\n      type: GuidesType.VERTICAL,\n      guides: this.verticalGuidelines,\n    });\n  };\n}\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { Mode, MouseButton, ZIndex } from './const';\nimport Rule from './Rule';\nimport type StageCore from './StageCore';\nimport type { StageMaskConfig } from './types';\nimport { createDiv, getScrollParent, isFixedParent } from './util';\n\nconst wrapperClassName = 'editor-mask-wrapper';\n\nconst hideScrollbar = () => {\n  const style = globalThis.document.createElement('style');\n  style.innerHTML = `\n    .${wrapperClassName}::-webkit-scrollbar { width: 0 !important; display: none }\n  `;\n  globalThis.document.head.appendChild(style);\n};\n\nconst createContent = (): HTMLDivElement =>\n  createDiv({\n    className: 'editor-mask',\n    cssText: `\n    position: absolute;\n    top: 0;\n    left: 0;\n    transform: translate3d(0, 0, 0);\n  `,\n  });\n\nconst createWrapper = (): HTMLDivElement => {\n  const el = createDiv({\n    className: wrapperClassName,\n    cssText: `\n      position: absolute;\n      top: 0;\n      left: 0;\n      height: 100%;\n      width: 100%;\n      overflow: hidden;\n      z-index: ${ZIndex.MASK};\n    `,\n  });\n\n  hideScrollbar();\n\n  return el;\n};\n\n/**\n * 蒙层\n * @description 用于拦截页面的点击动作，避免点击时触发组件自身动作；在编辑器中点击组件应当是选中组件；\n */\nexport default class StageMask extends Rule {\n  public content: HTMLDivElement = createContent();\n  public wrapper: HTMLDivElement;\n  public core: StageCore;\n  public page: HTMLElement | null = null;\n  public pageScrollParent: HTMLElement | null = null;\n  public scrollTop = 0;\n  public scrollLeft = 0;\n  public width = 0;\n  public height = 0;\n  public wrapperHeight = 0;\n  public wrapperWidth = 0;\n\n  private mode: Mode = Mode.ABSOLUTE;\n  private pageResizeObserver: ResizeObserver | null = null;\n  private wrapperResizeObserver: ResizeObserver | null = null;\n\n  constructor(config: StageMaskConfig) {\n    const wrapper = createWrapper();\n    super(wrapper);\n\n    this.wrapper = wrapper;\n    this.core = config.core;\n\n    this.content.addEventListener('mousedown', this.mouseDownHandler);\n    this.wrapper.appendChild(this.content);\n    this.content.addEventListener('wheel', this.mouseWheelHandler);\n  }\n\n  public setMode(mode: Mode) {\n    this.mode = mode;\n    this.scroll();\n    if (mode === Mode.FIXED) {\n      this.content.style.width = `${this.wrapperWidth}px`;\n      this.content.style.height = `${this.wrapperHeight}px`;\n    } else {\n      this.content.style.width = `${this.width}px`;\n      this.content.style.height = `${this.height}px`;\n    }\n  }\n\n  /**\n   * 监听页面大小变化\n   * @description 同步页面与mask的大小\n   * @param page 页面Dom节点\n   */\n  public observe(page: HTMLElement): void {\n    if (!page) return;\n\n    this.page = page;\n    this.pageScrollParent = getScrollParent(page) || this.core.renderer.contentWindow?.document.documentElement || null;\n    this.pageResizeObserver?.disconnect();\n\n    if (typeof ResizeObserver !== 'undefined') {\n      this.pageResizeObserver = new ResizeObserver((entries) => {\n        const [entry] = entries;\n        const { clientHeight, clientWidth } = entry.target;\n        this.setHeight(clientHeight);\n        this.setWidth(clientWidth);\n      });\n\n      this.pageResizeObserver.observe(page);\n\n      this.wrapperResizeObserver = new ResizeObserver((entries) => {\n        const [entry] = entries;\n        const { clientHeight, clientWidth } = entry.target;\n        this.wrapperHeight = clientHeight;\n        this.wrapperWidth = clientWidth;\n      });\n      this.wrapperResizeObserver.observe(this.wrapper);\n    }\n  }\n\n  /**\n   * 挂载Dom节点\n   * @param el 将蒙层挂载到该Dom节点上\n   */\n  public mount(el: HTMLDivElement): void {\n    if (!this.content) throw new Error('content 不存在');\n\n    el.appendChild(this.wrapper);\n  }\n\n  public setLayout(el: HTMLElement): void {\n    this.setMode(isFixedParent(el) ? Mode.FIXED : Mode.ABSOLUTE);\n  }\n\n  /**\n   * 销毁实例\n   */\n  public destroy(): void {\n    this.content?.remove();\n    this.page = null;\n    this.pageScrollParent = null;\n    this.pageResizeObserver?.disconnect();\n    this.wrapperResizeObserver?.disconnect();\n    super.destroy();\n  }\n\n  private scroll() {\n    let { scrollLeft, scrollTop } = this;\n\n    if (this.mode === Mode.FIXED) {\n      scrollLeft = 0;\n      scrollTop = 0;\n    }\n\n    this.scrollRule(scrollTop);\n    this.scrollTo(scrollLeft, scrollTop);\n  }\n\n  private scrollTo(scrollLeft: number, scrollTop: number): void {\n    this.content.style.transform = `translate3d(${-scrollLeft}px, ${-scrollTop}px, 0)`;\n  }\n\n  /**\n   * 设置蒙层高度\n   * @param height 高度\n   */\n  private setHeight(height: number): void {\n    this.height = height;\n    this.content.style.height = `${height}px`;\n  }\n\n  /**\n   * 设置蒙层宽度\n   * @param width 宽度\n   */\n  private setWidth(width: number): void {\n    this.width = width;\n    this.content.style.width = `${width}px`;\n  }\n\n  /**\n   * 点击事件处理函数\n   * @param event 事件对象\n   */\n  private mouseDownHandler = async (event: MouseEvent): Promise<void> => {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n\n    if (event.button !== MouseButton.LEFT && event.button !== MouseButton.RIGHT) return;\n\n    // 点击的对象如果是选中框，则不需要再触发选中了，而可能是拖动行为\n    if ((event.target as HTMLDivElement).className.indexOf('moveable-control') !== -1) {\n      return;\n    }\n\n    this.emit('beforeSelect', event);\n\n    // 如果是右键点击，这里的mouseup事件监听没有效果\n    globalThis.document.addEventListener('mouseup', this.mouseUpHandler);\n  };\n\n  private mouseUpHandler = (): void => {\n    globalThis.document.removeEventListener('mouseup', this.mouseUpHandler);\n    this.emit('select');\n  };\n\n  private mouseWheelHandler = (event: WheelEvent) => {\n    if (!this.page) throw new Error('page 未初始化');\n\n    const { deltaY, deltaX } = event;\n    const { height, wrapperHeight, width, wrapperWidth } = this;\n\n    const maxScrollTop = height - wrapperHeight;\n    const maxScrollLeft = width - wrapperWidth;\n\n    if (maxScrollTop > 0) {\n      if (deltaY > 0) {\n        this.scrollTop = this.scrollTop + Math.min(maxScrollTop - this.scrollTop, deltaY);\n      } else {\n        this.scrollTop = Math.max(this.scrollTop + deltaY, 0);\n      }\n    }\n\n    if (width > wrapperWidth) {\n      if (deltaX > 0) {\n        this.scrollLeft = this.scrollLeft + Math.min(maxScrollLeft - this.scrollLeft, deltaX);\n      } else {\n        this.scrollLeft = Math.max(this.scrollLeft + deltaX, 0);\n      }\n    }\n\n    if (this.mode !== Mode.FIXED) {\n      this.scrollTo(this.scrollLeft, this.scrollTop);\n    }\n\n    if (this.pageScrollParent) {\n      this.pageScrollParent.scrollTo({\n        top: this.scrollTop,\n        left: this.scrollLeft,\n      });\n    }\n    this.scroll();\n\n    this.emit('scroll', event);\n  };\n}\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from 'events';\n\nimport StageCore from './StageCore';\nimport type { Runtime, RuntimeWindow, StageRenderConfig } from './types';\nimport { getHost, isSameDomain } from './util';\n\nexport default class StageRender extends EventEmitter {\n  /** 组件的js、css执行的环境，直接渲染为当前window，iframe渲染则为iframe.contentWindow */\n  public contentWindow: RuntimeWindow | null = null;\n\n  public runtime: Runtime | null = null;\n\n  public iframe?: HTMLIFrameElement;\n\n  public runtimeUrl?: string;\n\n  public core: StageCore;\n\n  private render?: (renderer: StageCore) => Promise<HTMLElement> | HTMLElement;\n\n  constructor({ core }: StageRenderConfig) {\n    super();\n\n    this.core = core;\n    this.runtimeUrl = core.config.runtimeUrl || '';\n    this.render = core.config.render;\n\n    this.iframe = globalThis.document.createElement('iframe');\n    // 同源，直接加载\n    this.iframe.src = isSameDomain(this.runtimeUrl) ? this.runtimeUrl : '';\n    this.iframe.style.cssText = `\n      border: 0;\n      width: 100%;\n      height: 100%;\n    `;\n\n    this.iframe.addEventListener('load', this.loadHandler);\n  }\n\n  public getMagicApi = () => ({\n    onPageElUpdate: (el: HTMLElement) => this.emit('page-el-update', el),\n    onRuntimeReady: (runtime: Runtime) => {\n      this.runtime = runtime;\n      // @ts-ignore\n      globalThis.runtime = runtime;\n      this.emit('runtime-ready', runtime);\n    },\n  });\n\n  /**\n   * 挂载Dom节点\n   * @param el 将页面挂载到该Dom节点上\n   */\n  public async mount(el: HTMLDivElement) {\n    if (this.iframe) {\n      if (!isSameDomain(this.runtimeUrl) && this.runtimeUrl) {\n        // 不同域，使用srcdoc发起异步请求，需要目标地址支持跨域\n        let html = await fetch(this.runtimeUrl).then((res) => res.text());\n        // 使用base, 解决相对路径或绝对路径的问题\n        const base = `${location.protocol}//${getHost(this.runtimeUrl)}`;\n        html = html.replace('<head>', `<head>\\n<base href=\"${base}\">`);\n        this.iframe.srcdoc = html;\n      }\n\n      el.appendChild<HTMLIFrameElement>(this.iframe);\n\n      this.contentWindow = this.iframe?.contentWindow as RuntimeWindow;\n\n      this.contentWindow.magic = this.getMagicApi();\n    } else {\n      throw Error('mount 失败');\n    }\n  }\n\n  public getRuntime = (): Promise<Runtime> => {\n    if (this.runtime) return Promise.resolve(this.runtime);\n    return new Promise((resolve) => {\n      const listener = (runtime: Runtime) => {\n        this.off('runtime-ready', listener);\n        resolve(runtime);\n      };\n      this.on('runtime-ready', listener);\n    });\n  };\n\n  /**\n   * 销毁实例\n   */\n  public destroy(): void {\n    this.iframe?.removeEventListener('load', this.loadHandler);\n    this.contentWindow = null;\n    this.iframe?.remove();\n    this.iframe = undefined;\n    this.removeAllListeners();\n  }\n\n  private loadHandler = async () => {\n    this.emit('onload');\n    if (this.render) {\n      const el = await this.render(this.core);\n      if (el) {\n        this.iframe?.contentDocument?.body?.appendChild(el);\n      }\n    }\n  };\n}\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { EventEmitter } from 'events';\n\nimport { Id } from '@tmagic/schema';\n\nimport { DEFAULT_ZOOM, GHOST_EL_ID_PREFIX } from './const';\nimport StageDragResize from './StageDragResize';\nimport StageMask from './StageMask';\nimport StageRender from './StageRender';\nimport {\n  CanSelect,\n  GuidesEventData,\n  RemoveData,\n  Runtime,\n  SortEventData,\n  StageCoreConfig,\n  UpdateData,\n  UpdateEventData,\n} from './types';\n\nexport default class StageCore extends EventEmitter {\n  public selectedDom: Element | undefined;\n\n  public renderer: StageRender;\n  public mask: StageMask;\n  public dr: StageDragResize;\n  public config: StageCoreConfig;\n  public zoom = DEFAULT_ZOOM;\n  private canSelect: CanSelect;\n\n  constructor(config: StageCoreConfig) {\n    super();\n\n    this.config = config;\n\n    this.setZoom(config.zoom);\n    this.canSelect = config.canSelect || ((el: HTMLElement) => !!el.id);\n\n    this.renderer = new StageRender({ core: this });\n    this.mask = new StageMask({ core: this });\n    this.dr = new StageDragResize({ core: this, container: this.mask.content });\n\n    this.renderer.on('runtime-ready', (runtime: Runtime) => this.emit('runtime-ready', runtime));\n    this.renderer.on('page-el-update', (el: HTMLElement) => this.mask?.observe(el));\n\n    this.mask\n      .on('beforeSelect', (event: MouseEvent) => {\n        this.setElementFromPoint(event);\n      })\n      .on('select', () => {\n        this.emit('select', this.selectedDom);\n      })\n      .on('changeGuides', (data: GuidesEventData) => {\n        this.dr.setGuidelines(data.type, data.guides);\n        this.emit('changeGuides', data);\n      });\n\n    // 要先触发select，在触发update\n    this.dr\n      .on('update', (data: UpdateEventData) => {\n        setTimeout(() => this.emit('update', data));\n      })\n      .on('sort', (data: UpdateEventData) => {\n        setTimeout(() => this.emit('sort', data));\n      });\n  }\n\n  public async setElementFromPoint(event: MouseEvent) {\n    const { renderer, zoom } = this;\n\n    const doc = renderer.contentWindow?.document;\n    let x = event.clientX;\n    let y = event.clientY;\n\n    if (renderer.iframe) {\n      const rect = renderer.iframe.getClientRects()[0];\n      if (rect) {\n        x = x - rect.left;\n        y = y - rect.top;\n      }\n    }\n\n    const els = doc?.elementsFromPoint(x / zoom, y / zoom) as HTMLElement[];\n\n    let stopped = false;\n    const stop = () => (stopped = true);\n    for (const el of els) {\n      if (!el.id.startsWith(GHOST_EL_ID_PREFIX) && (await this.canSelect(el, stop))) {\n        if (stopped) break;\n        this.select(el, event);\n        break;\n      }\n    }\n  }\n\n  /**\n   * 选中组件\n   * @param idOrEl 组件Dom节点的id属性，或者Dom节点\n   */\n  public async select(idOrEl: Id | HTMLElement, event?: MouseEvent): Promise<void> {\n    let el;\n    if (typeof idOrEl === 'string' || typeof idOrEl === 'number') {\n      const runtime = await this.renderer?.getRuntime();\n      el = await runtime?.select?.(`${idOrEl}`);\n      if (!el) throw new Error(`不存在ID为${idOrEl}的元素`);\n    } else {\n      el = idOrEl;\n    }\n\n    if (el === this.selectedDom) return;\n\n    const runtime = await this.renderer?.getRuntime();\n    if (runtime?.beforeSelect) {\n      await runtime.beforeSelect(el);\n    }\n\n    this.mask.setLayout(el);\n    this.dr?.select(el, event);\n    this.selectedDom = el;\n  }\n\n  /**\n   * 更新选中的节点\n   * @param data 更新的数据\n   */\n  public update(data: UpdateData): void {\n    const { config } = data;\n\n    this.renderer?.getRuntime().then((runtime) => {\n      runtime?.update?.(data);\n      // 更新配置后，需要等组件渲染更新\n      setTimeout(() => {\n        const el = this.renderer.contentWindow?.document.getElementById(`${config.id}`);\n        if (el) {\n          // 更新了组件的布局，需要重新设置mask是否可以滚动\n          this.mask.setLayout(el);\n          this.dr?.select(el);\n        }\n      }, 0);\n    });\n  }\n\n  public sortNode(data: SortEventData): void {\n    this.renderer?.getRuntime().then((runtime) => runtime?.sortNode?.(data));\n  }\n\n  public add(data: UpdateData): void {\n    this.renderer?.getRuntime().then((runtime) => runtime?.add?.(data));\n  }\n\n  public remove(data: RemoveData): void {\n    this.renderer?.getRuntime().then((runtime) => runtime?.remove?.(data));\n  }\n\n  public setZoom(zoom: number = DEFAULT_ZOOM): void {\n    this.zoom = zoom;\n  }\n\n  /**\n   * 挂载Dom节点\n   * @param el 将stage挂载到该Dom节点上\n   */\n  public mount(el: HTMLDivElement): void {\n    const { mask, renderer } = this;\n\n    renderer.mount(el);\n    mask.mount(el);\n\n    this.emit('mounted');\n  }\n\n  /**\n   * 清空所有参考线\n   */\n  public clearGuides() {\n    this.mask.clearGuides();\n    this.dr.clearGuides();\n  }\n\n  /**\n   * 销毁实例\n   */\n  public destroy(): void {\n    const { mask, renderer, dr } = this;\n\n    renderer.destroy();\n    mask.destroy();\n    dr.destroy();\n\n    this.removeAllListeners();\n  }\n}\n","import { Keys } from '@editor/type';\n\ninterface ScrollViewerOptions {\n  container: HTMLDivElement;\n  target: HTMLDivElement;\n  zoom: number;\n}\n\nexport class ScrollViewer {\n  private enter = false;\n  private targetEnter = false;\n  private keydown = false;\n  private container: HTMLDivElement;\n  private target: HTMLDivElement;\n  private zoom = 1;\n\n  private scrollLeft = 0;\n  private scrollTop = 0;\n\n  private x = 0;\n  private y = 0;\n\n  private resizeObserver = new ResizeObserver((entries) => {\n    for (const { contentRect } of entries) {\n      const { width, height } = contentRect;\n      const targetRect = this.target.getBoundingClientRect();\n      const targetWidth = targetRect.width * this.zoom;\n      const targetMarginTop = Number(this.target.style.marginTop) || 0;\n      const targetHeight = (targetRect.height + targetMarginTop) * this.zoom;\n\n      if (targetWidth < width) {\n        (this.target as any)._left = 0;\n      }\n      if (targetHeight < height) {\n        (this.target as any)._top = 0;\n      }\n\n      this.scroll();\n    }\n  });\n\n  constructor(options: ScrollViewerOptions) {\n    this.container = options.container;\n    this.target = options.target;\n    this.zoom = options.zoom;\n\n    globalThis.addEventListener('keydown', this.keydownHandler);\n    globalThis.addEventListener('keyup', this.keyupHandler);\n\n    this.container.addEventListener('mouseenter', this.mouseEnterHandler);\n    this.container.addEventListener('mouseleave', this.mouseLeaveHandler);\n    this.target.addEventListener('mouseenter', this.targetMouseEnterHandler);\n    this.target.addEventListener('mouseleave', this.targetMouseLeaveHandler);\n\n    this.container.addEventListener('wheel', this.wheelHandler);\n\n    this.resizeObserver.observe(this.container);\n  }\n\n  public destroy() {\n    this.resizeObserver.disconnect();\n\n    this.container.removeEventListener('mouseenter', this.mouseEnterHandler);\n    this.container.removeEventListener('mouseleave', this.mouseLeaveHandler);\n    this.target.removeEventListener('mouseenter', this.targetMouseEnterHandler);\n    this.target.removeEventListener('mouseleave', this.targetMouseLeaveHandler);\n    globalThis.removeEventListener('keydown', this.keydownHandler);\n    globalThis.removeEventListener('keyup', this.keyupHandler);\n  }\n\n  public setZoom(zoom: number) {\n    this.zoom = zoom;\n  }\n\n  private scroll() {\n    const scrollLeft = (this.target as any)._left;\n    const scrollTop = (this.target as any)._top;\n\n    this.target.style.transform = `translate(${scrollLeft}px, ${scrollTop}px)`;\n  }\n\n  private removeHandler() {\n    this.target.style.cursor = '';\n    this.target.removeEventListener('mousedown', this.mousedownHandler);\n    document.removeEventListener('mousemove', this.mousemoveHandler);\n    document.removeEventListener('mouseup', this.mouseupHandler);\n  }\n\n  private wheelHandler = (event: WheelEvent) => {\n    if (this.targetEnter) return;\n\n    const { deltaX, deltaY, currentTarget } = event;\n\n    if (currentTarget !== this.container) return;\n\n    this.setScrollOffset(deltaX, deltaY);\n    this.scroll();\n    this.scrollLeft = (this.target as any)._left;\n    this.scrollTop = (this.target as any)._top;\n  };\n\n  private mouseEnterHandler = () => {\n    this.enter = true;\n  };\n\n  private mouseLeaveHandler = () => {\n    this.enter = false;\n  };\n\n  private targetMouseEnterHandler = () => {\n    this.targetEnter = true;\n  };\n\n  private targetMouseLeaveHandler = () => {\n    this.targetEnter = false;\n  };\n\n  private mousedownHandler = (event: MouseEvent) => {\n    if (!this.keydown) return;\n\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n\n    this.target.style.cursor = 'grabbing';\n\n    this.x = event.clientX;\n    this.y = event.clientY;\n\n    document.addEventListener('mousemove', this.mousemoveHandler);\n    document.addEventListener('mouseup', this.mouseupHandler);\n  };\n\n  private mouseupHandler = () => {\n    this.x = 0;\n    this.y = 0;\n\n    this.scrollLeft = (this.target as any)._left;\n    this.scrollTop = (this.target as any)._top;\n    this.removeHandler();\n  };\n\n  private mousemoveHandler = (event: MouseEvent) => {\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n\n    const deltaX = event.clientX - this.x;\n    const deltaY = event.clientY - this.y;\n\n    this.setScrollOffset(deltaX, deltaY);\n    this.scroll();\n  };\n\n  private keydownHandler = (event: KeyboardEvent) => {\n    if (event.code === Keys.ESCAPE && this.enter) {\n      event.preventDefault();\n      event.stopImmediatePropagation();\n      event.stopPropagation();\n    }\n\n    if (event.code !== Keys.ESCAPE || !this.enter || this.keydown) {\n      return;\n    }\n\n    this.keydown = true;\n\n    this.target.style.cursor = 'grab';\n    this.container.addEventListener('mousedown', this.mousedownHandler);\n  };\n\n  private keyupHandler = (event: KeyboardEvent) => {\n    if (event.code !== Keys.ESCAPE || !this.keydown) {\n      return;\n    }\n\n    event.preventDefault();\n    event.stopImmediatePropagation();\n    event.stopPropagation();\n\n    this.keydown = false;\n\n    event.preventDefault();\n\n    this.removeHandler();\n  };\n\n  private setScrollOffset(deltaX: number, deltaY: number) {\n    const { width, height } = this.container.getBoundingClientRect();\n    const targetRect = this.target.getBoundingClientRect();\n\n    const targetWidth = targetRect.width * this.zoom;\n    const targetHeight = targetRect.height * this.zoom;\n\n    let y = 0;\n\n    if (targetHeight > height) {\n      if (deltaY > 0) {\n        y = this.scrollTop + Math.min(targetHeight - height - this.scrollTop, deltaY);\n      } else {\n        y = this.scrollTop + Math.max(-(targetHeight - height + this.scrollTop), deltaY);\n      }\n    }\n\n    let x = 0;\n\n    if (targetWidth > width) {\n      if (deltaX > 0) {\n        x = this.scrollLeft + Math.min(targetWidth - width - this.scrollLeft, deltaX);\n      } else {\n        x = this.scrollLeft + Math.max(-(targetWidth - width + this.scrollLeft), deltaX);\n      }\n    }\n\n    (this.target as any)._left = x;\n    (this.target as any)._top = y;\n  }\n}\n","<template>\n  <div class=\"m-editor-scroll-viewer-container\" ref=\"container\">\n    <div ref=\"el\" :style=\"style\">\n      <slot></slot>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, onMounted, onUnmounted, ref, watch } from 'vue';\n\nimport { ScrollViewer } from '@editor/utils/scroll-viewer';\n\nexport default defineComponent({\n  name: 'm-editor-scroll-viewer',\n\n  props: {\n    width: Number,\n    height: Number,\n    zoom: {\n      type: Number,\n      default: 1,\n    },\n  },\n\n  setup(props) {\n    const container = ref<HTMLDivElement>();\n    const el = ref<HTMLDivElement>();\n    let scrollViewer: ScrollViewer;\n\n    onMounted(() => {\n      if (!container.value || !el.value) return;\n      scrollViewer = new ScrollViewer({\n        container: container.value,\n        target: el.value,\n        zoom: props.zoom,\n      });\n    });\n\n    onUnmounted(() => {\n      scrollViewer.destroy();\n    });\n\n    watch(\n      () => props.zoom,\n      () => {\n        scrollViewer.setZoom(props.zoom);\n      },\n    );\n\n    return {\n      container,\n      el,\n\n      style: computed(\n        () => `\n        width: ${props.width}px;\n        height: ${props.height}px;\n        position: absolute;\n        margin-top: 30px;\n      `,\n      ),\n    };\n  },\n});\n</script>\n","<template>\n  <div class=\"magic-editor-content-menu\" ref=\"menu\">\n    <div>\n      <div class=\"magic-editor-content-menu-item\" @click=\"() => center()\" v-if=\"canCenter\">水平居中</div>\n      <div class=\"magic-editor-content-menu-item\" @click=\"() => copy()\">复制</div>\n      <div class=\"magic-editor-content-menu-item\" @click=\"paste\" v-if=\"canPaste\">粘贴</div>\n      <template v-if=\"canMoveZPos\">\n        <div class=\"separation\"></div>\n        <div class=\"magic-editor-content-menu-item\" @click=\"topItem\">上移一层</div>\n        <div class=\"magic-editor-content-menu-item\" @click=\"bottomItem\">下移一层</div>\n        <div class=\"magic-editor-content-menu-item\" @click=\"top\">置顶</div>\n        <div class=\"magic-editor-content-menu-item\" @click=\"bottom\">置底</div>\n      </template>\n      <template v-if=\"canDelete\">\n        <div class=\"separation\"></div>\n        <div class=\"magic-editor-content-menu-item\" @click=\"() => remove()\">删除</div>\n      </template>\n      <div class=\"separation\"></div>\n      <div class=\"magic-editor-content-menu-item\" @click=\"clearGuides\">清空参考线</div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, onMounted, ref, watch } from 'vue';\n\nimport type StageCore from '@tmagic/stage';\n\nimport { LayerOffset, Layout, Services } from '@editor/type';\nimport { COPY_STORAGE_KEY } from '@editor/utils/editor';\n\nexport default defineComponent({\n  name: 'magic-editor-ui-viewer-menu',\n\n  setup() {\n    const services = inject<Services>('services');\n    const editorService = services?.editorService;\n    const menu = ref<HTMLDivElement>();\n    const canPaste = ref(false);\n    const canCenter = ref(false);\n\n    const node = computed(() => editorService?.get('node'));\n    const parent = computed(() => editorService?.get('parent'));\n\n    onMounted(() => {\n      const data = globalThis.localStorage.getItem(COPY_STORAGE_KEY);\n      canPaste.value = data !== 'undefined' && !!data;\n    });\n\n    watch(\n      parent,\n      async () => {\n        if (!parent.value || !editorService) return (canCenter.value = false);\n        const layout = await editorService.getLayout(parent.value);\n        canCenter.value =\n          [Layout.ABSOLUTE, Layout.FIXED].includes(layout) && !['app', 'page', 'pop'].includes(`${node.value?.type}`);\n      },\n      { immediate: true },\n    );\n\n    return {\n      menu,\n      canPaste,\n\n      canDelete: computed(() => node.value?.type !== 'page'),\n      canMoveZPos: computed(() => node.value?.type !== 'page'),\n      canCenter,\n\n      center() {\n        node.value && editorService?.alignCenter(node.value);\n      },\n\n      copy() {\n        node.value && editorService?.copy(node.value);\n        canPaste.value = true;\n      },\n\n      paste() {\n        const top = menu.value?.offsetTop || 0;\n        const left = menu.value?.offsetLeft || 0;\n        editorService?.paste({ left, top });\n      },\n\n      remove() {\n        node.value && editorService?.remove(node.value);\n      },\n\n      top() {\n        editorService?.moveLayer(LayerOffset.TOP);\n      },\n\n      bottom() {\n        editorService?.moveLayer(LayerOffset.BOTTOM);\n      },\n\n      topItem() {\n        editorService?.moveLayer(1);\n      },\n\n      bottomItem() {\n        editorService?.moveLayer(-1);\n      },\n\n      clearGuides() {\n        editorService?.get<StageCore>('stage').clearGuides();\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <scroll-viewer\n    class=\"m-editor-stage\"\n    ref=\"stageWrap\"\n    :width=\"stageRect?.width\"\n    :height=\"stageRect?.height\"\n    :zoom=\"zoom\"\n  >\n    <div\n      class=\"m-editor-stage-container\"\n      ref=\"stageContainer\"\n      @contextmenu=\"contextmenuHandler\"\n      :style=\"`transform: scale(${zoom})`\"\n    ></div>\n    <teleport to=\"body\">\n      <viewer-menu ref=\"menu\" :style=\"menuStyle\"></viewer-menu>\n    </teleport>\n  </scroll-viewer>\n</template>\n\n<script lang=\"ts\">\nimport {\n  computed,\n  defineComponent,\n  inject,\n  nextTick,\n  onMounted,\n  onUnmounted,\n  PropType,\n  ref,\n  toRaw,\n  watch,\n  watchEffect,\n} from 'vue';\nimport { cloneDeep } from 'lodash-es';\n\nimport type { MApp, MNode, MPage } from '@tmagic/schema';\nimport type { MoveableOptions, Runtime, SortEventData, UpdateEventData } from '@tmagic/stage';\nimport StageCore from '@tmagic/stage';\n\nimport ScrollViewer from '@editor/components/ScrollViewer.vue';\nimport type { Services, StageRect } from '@editor/type';\n\nimport ViewerMenu from './ViewerMenu.vue';\n\nconst useMenu = () => {\n  const menu = ref<InstanceType<typeof ViewerMenu>>();\n  const menuStyle = ref({\n    display: 'none',\n    left: '0',\n    top: '0',\n  });\n\n  onMounted(() => {\n    document.addEventListener(\n      'click',\n      () => {\n        menuStyle.value.display = 'none';\n      },\n      true,\n    );\n  });\n\n  return {\n    menu,\n    menuStyle,\n\n    contextmenuHandler(e: MouseEvent) {\n      e.preventDefault();\n\n      const menuHeight = menu.value?.$el.clientHeight;\n      let top = e.clientY;\n      if (menuHeight + e.clientY > document.body.clientHeight) {\n        top = document.body.clientHeight - menuHeight;\n      }\n      menuStyle.value = {\n        display: 'block',\n        top: `${top}px`,\n        left: `${e.clientX}px`,\n      };\n    },\n  };\n};\n\nexport default defineComponent({\n  name: 'magic-stage',\n\n  components: {\n    ViewerMenu,\n    ScrollViewer,\n  },\n\n  props: {\n    render: {\n      type: Function as PropType<() => HTMLDivElement>,\n    },\n\n    runtimeUrl: String,\n\n    canSelect: {\n      type: Function as PropType<(el: HTMLElement) => boolean | Promise<boolean>>,\n      default: (el: HTMLElement) => Boolean(el.id),\n    },\n\n    moveableOptions: {\n      type: [Object, Function] as PropType<MoveableOptions | ((core?: StageCore) => MoveableOptions)>,\n      default: () => (core?: StageCore) => ({\n        container: core?.renderer?.contentWindow?.document.getElementById('app'),\n      }),\n    },\n  },\n\n  emits: ['select', 'update', 'sort'],\n\n  setup(props, { emit }) {\n    const services = inject<Services>('services');\n\n    const stageWrap = ref<InstanceType<typeof ScrollViewer>>();\n    const stageContainer = ref<HTMLDivElement>();\n\n    const stageRect = computed(() => services?.uiService.get<StageRect>('stageRect'));\n    const uiSelectMode = computed(() => services?.uiService.get<boolean>('uiSelectMode'));\n    const root = computed(() => services?.editorService.get<MApp>('root'));\n    const page = computed(() => services?.editorService.get<MPage>('page'));\n    const zoom = computed(() => services?.uiService.get<number>('zoom'));\n    const node = computed(() => services?.editorService.get<MNode>('node'));\n\n    let stage: StageCore | null = null;\n    let runtime: Runtime | null = null;\n\n    watchEffect(() => {\n      if (stage) return;\n\n      if (!stageContainer.value) return;\n      if (!(props.runtimeUrl || props.render) || !root.value) return;\n\n      stage = new StageCore({\n        render: props.render,\n        runtimeUrl: props.runtimeUrl,\n        zoom: zoom.value,\n        canSelect: (el, stop) => {\n          const elCanSelect = props.canSelect(el);\n          // 在组件联动过程中不能再往下选择，返回并触发 ui-select\n          if (uiSelectMode.value && elCanSelect) {\n            document.dispatchEvent(new CustomEvent('ui-select', { detail: el }));\n            return stop();\n          }\n\n          return elCanSelect;\n        },\n        moveableOptions: props.moveableOptions,\n      });\n\n      services?.editorService.set('stage', stage);\n\n      stage?.mount(stageContainer.value);\n\n      stage?.on('select', (el: HTMLElement) => emit('select', el));\n\n      stage?.on('update', (ev: UpdateEventData) => {\n        emit('update', { id: ev.el.id, style: ev.style });\n      });\n\n      stage?.on('sort', (ev: SortEventData) => {\n        emit('sort', ev);\n      });\n\n      stage?.on('changeGuides', () => {\n        services?.uiService.set('showGuides', true);\n      });\n\n      if (!node.value?.id) return;\n      stage?.on('runtime-ready', (rt) => {\n        runtime = rt;\n        // toRaw返回的值是一个引用而非快照，需要cloneDeep\n        root.value && runtime?.updateRootConfig(cloneDeep(toRaw(root.value)));\n        page.value?.id && runtime?.updatePageId?.(page.value.id);\n        setTimeout(() => {\n          node.value && stage?.select(toRaw(node.value.id));\n        });\n      });\n    });\n\n    watch(zoom, (zoom) => {\n      if (!stage || !zoom) return;\n      stage.setZoom(zoom);\n    });\n\n    watch(root, (root) => {\n      if (runtime && root) {\n        runtime.updateRootConfig(cloneDeep(toRaw(root)));\n      }\n    });\n\n    watch(\n      () => node.value?.id,\n      (id) => {\n        nextTick(() => {\n          // 等待相关dom变更完成后，再select，适用大多数场景\n          id && stage?.select(id);\n        });\n      },\n    );\n\n    const resizeObserver = new ResizeObserver((entries) => {\n      for (const { contentRect } of entries) {\n        services?.uiService.set('stageContainerRect', {\n          width: contentRect.width,\n          height: contentRect.height,\n        });\n      }\n    });\n\n    onMounted(() => {\n      stageWrap.value?.container && resizeObserver.observe(stageWrap.value.container);\n    });\n\n    onUnmounted(() => {\n      stage?.destroy();\n      resizeObserver.disconnect();\n      services?.editorService.set('stage', null);\n    });\n\n    return {\n      stageWrap,\n      stageContainer,\n      stageRect,\n      zoom,\n      ...useMenu(),\n    };\n  },\n});\n</script>\n","<template>\n  <div class=\"m-editor-workspace\">\n    <magic-stage\n      :key=\"page?.id\"\n      :runtime-url=\"runtimeUrl\"\n      :render=\"render\"\n      :moveable-options=\"moveableOptions\"\n      :can-select=\"canSelect\"\n      @select=\"selectHandler\"\n      @update=\"updateNodeHandler\"\n      @sort=\"sortNodeHandler\"\n    ></magic-stage>\n\n    <slot name=\"workspace-content\"></slot>\n\n    <page-bar>\n      <template #page-bar-title=\"{ page }\"><slot name=\"page-bar-title\" :page=\"page\"></slot></template>\n      <template #page-bar-popover=\"{ page }\"><slot name=\"page-bar-popover\" :page=\"page\"></slot></template>\n    </page-bar>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType } from 'vue';\n\nimport type { MComponent, MContainer, MPage } from '@tmagic/schema';\nimport type { MoveableOptions, SortEventData } from '@tmagic/stage';\nimport StageCore from '@tmagic/stage';\n\nimport type { Services } from '@editor/type';\n\nimport PageBar from './PageBar.vue';\nimport MagicStage from './Stage.vue';\n\nexport default defineComponent({\n  name: 'm-editor-workspace',\n\n  components: {\n    PageBar,\n    MagicStage,\n  },\n\n  props: {\n    runtimeUrl: String,\n\n    render: {\n      type: Function as PropType<() => HTMLDivElement>,\n    },\n\n    moveableOptions: {\n      type: [Object, Function] as PropType<MoveableOptions | ((core?: StageCore) => MoveableOptions)>,\n    },\n\n    canSelect: {\n      type: Function as PropType<(el: HTMLElement) => boolean | Promise<boolean>>,\n    },\n  },\n\n  setup() {\n    const services = inject<Services>('services');\n\n    return {\n      page: computed(() => services?.editorService.get<MPage>('page')),\n\n      selectHandler(el: HTMLElement) {\n        services?.editorService.select(el.id);\n      },\n\n      updateNodeHandler(node: MComponent | MContainer | MPage) {\n        services?.editorService.update(node);\n      },\n\n      sortNodeHandler(ev: SortEventData) {\n        services?.editorService.sort(ev.src, ev.dist);\n      },\n    };\n  },\n});\n</script>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { reactive } from 'vue';\n\nimport type { ComponentGroup, ComponentGroupState } from '@editor/type';\n\nimport BaseService from './BaseService';\n\nclass ComponentList extends BaseService {\n  private state = reactive<ComponentGroupState>({\n    list: [],\n  });\n\n  constructor() {\n    super([]);\n  }\n\n  /**\n   * @param componentGroupList 组件列表配置\n   */\n  public setList(componentGroupList: ComponentGroup[]) {\n    this.state.list = componentGroupList;\n  }\n\n  public getList() {\n    return this.state.list;\n  }\n}\n\nexport type ComponentListService = ComponentList;\n\nexport default new ComponentList();\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { reactive, toRaw } from 'vue';\n\nimport type StageCore from '@tmagic/stage';\n\nimport editorService from '@editor/services/editor';\nimport type { GetColumnWidth, SetColumnWidth, StageRect, UiState } from '@editor/type';\n\nimport BaseService from './BaseService';\n\nconst state = reactive<UiState>({\n  uiSelectMode: false,\n  showSrc: false,\n  zoom: 1,\n  stageContainerRect: {\n    width: 0,\n    height: 0,\n  },\n  stageRect: {\n    width: 375,\n    height: 817,\n  },\n  columnWidth: {\n    left: 310,\n    center: globalThis.document.body.clientWidth - 310 - 400,\n    right: 400,\n  },\n  showGuides: true,\n  showRule: true,\n});\n\nclass Ui extends BaseService {\n  constructor() {\n    super([]);\n    globalThis.addEventListener('resize', () => {\n      this.setColumnWidth({\n        center: 'auto',\n      });\n    });\n  }\n\n  public set<T = any>(name: keyof UiState, value: T) {\n    const mask = editorService.get<StageCore>('stage')?.mask;\n\n    if (name === 'columnWidth') {\n      this.setColumnWidth(value as unknown as SetColumnWidth);\n      return;\n    }\n\n    if (name === 'stageRect') {\n      this.setStageRect(value as unknown as StageRect);\n      return;\n    }\n\n    if (name === 'showGuides') {\n      mask?.showGuides(value as unknown as boolean);\n    }\n\n    if (name === 'showRule') {\n      mask?.showRule(value as unknown as boolean);\n    }\n\n    (state as any)[name] = value;\n\n    if (name === 'stageContainerRect') {\n      state.zoom = this.calcZoom();\n    }\n  }\n\n  public get<T>(name: keyof typeof state): T {\n    return (state as any)[name];\n  }\n\n  private setColumnWidth({ left, center, right }: SetColumnWidth) {\n    const columnWidth = {\n      ...toRaw(this.get<GetColumnWidth>('columnWidth')),\n    };\n\n    if (left) {\n      columnWidth.left = left;\n    }\n\n    if (right) {\n      columnWidth.right = right;\n    }\n\n    if (!center || center === 'auto') {\n      const bodyWidth = globalThis.document.body.clientWidth;\n      columnWidth.center = bodyWidth - (columnWidth?.left || 0) - (columnWidth?.right || 0);\n    } else {\n      columnWidth.center = center;\n    }\n\n    state.columnWidth = columnWidth;\n  }\n\n  private setStageRect(value: StageRect) {\n    state.stageRect = {\n      ...state.stageRect,\n      ...value,\n    };\n    state.zoom = this.calcZoom();\n  }\n\n  private calcZoom() {\n    const { stageRect, stageContainerRect } = state;\n    const { height, width } = stageContainerRect;\n    if (!width || !height) return 1;\n    if (width > stageRect.width && height > stageRect.height) {\n      return 1;\n    }\n    return Math.min((width - 100) / stageRect.width || 1, (height - 100) / stageRect.height || 1);\n  }\n}\n\nexport type UiService = Ui;\n\nexport default new Ui();\n","<template>\n  <framework>\n    <template #nav>\n      <slot name=\"nav\" :editorService=\"editorService\"><nav-menu :data=\"menu\"></nav-menu></slot>\n    </template>\n\n    <template #sidebar>\n      <slot name=\"sidebar\" :editorService=\"editorService\">\n        <sidebar :data=\"sidebar\"></sidebar>\n      </slot>\n    </template>\n\n    <template #workspace :editorService=\"editorService\">\n      <slot name=\"workspace\">\n        <workspace\n          :runtime-url=\"runtimeUrl\"\n          :render=\"render\"\n          :moveable-options=\"moveableOptions\"\n          :can-select=\"canSelect\"\n        >\n          <template #workspace-content><slot name=\"workspace-content\" :editorService=\"editorService\"></slot></template>\n          <template #page-bar-title=\"{ page }\"><slot name=\"page-bar-title\" :page=\"page\"></slot></template>\n          <template #page-bar-popover=\"{ page }\"><slot name=\"page-bar-popover\" :page=\"page\"></slot></template>\n        </workspace>\n      </slot>\n    </template>\n\n    <template #propsPanel>\n      <slot name=\"propsPanel\">\n        <props-panel ref=\"propsPanel\" @mounted=\"(instance) => $emit('props-panel-mounted', instance)\"></props-panel>\n      </slot>\n    </template>\n\n    <template #empty><slot name=\"empty\" :editorService=\"editorService\"></slot></template>\n  </framework>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, onUnmounted, PropType, provide, toRaw, watch } from 'vue';\n\nimport { EventOption } from '@tmagic/core';\nimport type { FormConfig } from '@tmagic/form';\nimport type { MApp, MNode } from '@tmagic/schema';\nimport type StageCore from '@tmagic/stage';\nimport type { MoveableOptions } from '@tmagic/stage';\n\nimport Framework from '@editor/layouts/Framework.vue';\nimport NavMenu from '@editor/layouts/NavMenu.vue';\nimport PropsPanel from '@editor/layouts/PropsPanel.vue';\nimport Sidebar from '@editor/layouts/sidebar/Sidebar.vue';\nimport Workspace from '@editor/layouts/workspace/Workspace.vue';\nimport componentListService from '@editor/services/componentList';\nimport editorService from '@editor/services/editor';\nimport eventsService from '@editor/services/events';\nimport historyService from '@editor/services/history';\nimport propsService from '@editor/services/props';\nimport uiService from '@editor/services/ui';\nimport type { ComponentGroup, MenuBarData, Services, SideBarData, StageRect } from '@editor/type';\n\nexport default defineComponent({\n  name: 'm-editor',\n\n  components: {\n    NavMenu,\n    Sidebar,\n    Workspace,\n    PropsPanel,\n    Framework,\n  },\n\n  props: {\n    /** 页面初始值 */\n    modelValue: {\n      type: Object as PropType<MApp>,\n      default: () => ({}),\n      require: true,\n    },\n\n    /** 左侧面板中的组件列表 */\n    componentGroupList: {\n      type: Array as PropType<ComponentGroup[]>,\n      default: () => [],\n    },\n\n    /** 左侧面板配置 */\n    sidebar: {\n      type: Object as PropType<SideBarData>,\n    },\n\n    /** 顶部工具栏配置 */\n    menu: {\n      type: Object as PropType<MenuBarData>,\n      default: () => ({ left: [], right: [] }),\n    },\n\n    /** 中间工作区域中画布渲染的内容 */\n    render: {\n      type: Function as PropType<() => HTMLDivElement>,\n    },\n\n    /** 中间工作区域中画布通过iframe渲染时的页面url */\n    runtimeUrl: String,\n\n    /** 组件的属性配置表单的dsl */\n    propsConfigs: {\n      type: Object as PropType<Record<string, FormConfig>>,\n      default: () => ({}),\n    },\n\n    /** 添加组件时的默认值 */\n    propsValues: {\n      type: Object as PropType<Record<string, MNode>>,\n      default: () => ({}),\n    },\n\n    /** 组件联动事件选项列表 */\n    eventMethodList: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    /** 画布中组件选中框的移动范围 */\n    moveableOptions: {\n      type: [Object, Function] as PropType<MoveableOptions | ((core?: StageCore) => MoveableOptions)>,\n    },\n\n    /** 编辑器初始化时默认选中的组件ID */\n    defaultSelected: {\n      type: [Number, String],\n    },\n\n    canSelect: {\n      type: Function as PropType<(el: HTMLElement) => boolean | Promise<boolean>>,\n    },\n\n    stageRect: {\n      type: [String, Object] as PropType<StageRect>,\n    },\n  },\n\n  emits: ['props-panel-mounted', 'update:modelValue'],\n\n  setup(props, { emit }) {\n    editorService.on('root-change', () => {\n      const node = editorService.get<MNode | null>('node') || props.defaultSelected;\n      node && editorService.select(node);\n      emit('update:modelValue', toRaw(editorService.get('root')));\n    });\n\n    // 初始值变化，重新设置节点信息\n    watch(\n      () => props.modelValue,\n      (modelValue) => editorService.set('root', modelValue),\n      {\n        immediate: true,\n      },\n    );\n\n    watch(\n      () => props.componentGroupList,\n      (componentGroupList) => componentListService.setList(componentGroupList),\n      {\n        immediate: true,\n      },\n    );\n\n    watch(\n      () => props.propsConfigs,\n      (configs) => propsService.setPropsConfigs(configs),\n      {\n        immediate: true,\n      },\n    );\n\n    watch(\n      () => props.propsValues,\n      (values) => propsService.setPropsValues(values),\n      {\n        immediate: true,\n      },\n    );\n\n    watch(\n      () => props.eventMethodList,\n      (eventMethodList) => {\n        const eventsList: Record<string, EventOption[]> = {};\n        const methodsList: Record<string, EventOption[]> = {};\n\n        Object.keys(eventMethodList).forEach((type: string) => {\n          eventsList[type] = eventMethodList[type].events;\n          methodsList[type] = eventMethodList[type].methods;\n        });\n\n        eventsService.setEvents(eventsList);\n        eventsService.setMethods(methodsList);\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    watch(\n      () => props.defaultSelected,\n      (defaultSelected) => defaultSelected && editorService.select(defaultSelected),\n      {\n        immediate: true,\n      },\n    );\n\n    watch(\n      () => props.stageRect,\n      (stageRect) => stageRect && uiService.set('stageRect', stageRect),\n      {\n        immediate: true,\n      },\n    );\n\n    onUnmounted(() => editorService.destroy());\n\n    const services: Services = {\n      componentListService,\n      eventsService,\n      historyService,\n      propsService,\n      editorService,\n      uiService,\n    };\n\n    provide('services', services);\n\n    return services;\n  },\n});\n</script>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { App } from 'vue';\n\nimport Code from './fields/Code.vue';\nimport CodeLink from './fields/CodeLink.vue';\nimport uiSelect from './fields/UISelect.vue';\nimport CodeEditor from './layouts/CodeEditor.vue';\nimport { setConfig } from './utils/config';\nimport Editor from './Editor.vue';\nimport type { InstallOptions } from './type';\n\nimport './theme/index.scss';\n\nexport type { MoveableOptions } from '@tmagic/stage';\nexport * from './type';\nexport * from './utils';\nexport { default as TMagicEditor } from './Editor.vue';\nexport { default as TMagicCodeEditor } from './layouts/CodeEditor.vue';\nexport { default as editorService } from './services/editor';\nexport { default as propsService } from './services/props';\nexport { default as historyService } from './services/history';\nexport { default as eventsService } from './services/events';\nexport { default as uiService } from './services/ui';\nexport { default as ComponentListPanel } from './layouts/sidebar/ComponentListPanel.vue';\nexport { default as LayerPanel } from './layouts/sidebar/LayerPanel.vue';\nexport { default as PropsPanel } from './layouts/PropsPanel.vue';\n\nconst defaultInstallOpt: InstallOptions = {\n  // @todo, 自定义图片上传方法等编辑器依赖的外部选项\n};\n\nexport default {\n  install: (app: App, opt?: InstallOptions): void => {\n    const option = Object.assign(defaultInstallOpt, opt || {});\n\n    // eslint-disable-next-line no-param-reassign\n    app.config.globalProperties.$TMAGIC_EDITOR = option;\n    setConfig(option);\n\n    app.component(Editor.name, Editor);\n    app.component(uiSelect.name, uiSelect);\n    app.component(CodeLink.name, CodeLink);\n    app.component(Code.name, Code);\n    app.component(CodeEditor.name, CodeEditor);\n  },\n};\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n/* eslint-disable no-param-reassign */\nimport { toRaw } from 'vue';\nimport { cloneDeep } from 'lodash-es';\n\nimport {\n  ChildConfig,\n  ContainerCommonConfig,\n  DaterangeConfig,\n  FormConfig,\n  FormState,\n  FormValue,\n  HtmlField,\n  Rule,\n  TabPaneConfig,\n  TypeFunction,\n} from '../schema';\n\ninterface DefaultItem {\n  defaultValue: any;\n  type: string;\n  filter: string;\n  multiple: boolean;\n}\n\nconst isTableSelect = (type?: string | TypeFunction) =>\n  typeof type === 'string' && ['table-select', 'tableSelect'].includes(type);\n\nconst asyncLoadConfig = (value: FormValue, initValue: FormValue, { asyncLoad, name, type }: HtmlField) => {\n  // 富文本配置了异步加载\n  if (type === 'html' && typeof asyncLoad === 'object' && typeof name !== 'undefined') {\n    asyncLoad.name = name;\n    value.asyncLoad = typeof initValue.asyncLoad === 'object' ? initValue.asyncLoad : asyncLoad;\n  }\n};\n\nconst isMultipleValue = (type?: string | TypeFunction) =>\n  typeof type === 'string' &&\n  [\n    'checkbox-group',\n    'checkboxGroup',\n    'table',\n    'cascader',\n    'group-list',\n    'groupList',\n    'dynamic-tab',\n    'dynamicTab',\n  ].includes(type);\n\nconst initItemsValue = (\n  mForm: FormState | undefined,\n  value: FormValue,\n  initValue: FormValue,\n  { items, name, extensible }: any,\n) => {\n  if (Array.isArray(initValue[name])) {\n    value[name] = initValue[name].map((v: any) => init(mForm, items, v));\n  } else {\n    value[name] = init(mForm, items, initValue[name], value[name]);\n    if (extensible) {\n      value[name] = Object.assign({}, initValue[name], value[name]);\n    }\n  }\n};\n\nconst setValue = (mForm: FormState | undefined, value: FormValue, initValue: FormValue, item: any) => {\n  const { items, name, type, checkbox } = item;\n  // 值是数组， 有可能也有items配置，所以不能放到getDefaultValue里赋值\n  if (isMultipleValue(type)) {\n    value[name] = initValue[name] || [];\n  }\n\n  // 有子项继续递归，没有的话有初始值用初始值，没有初始值用默认值\n  if (items) {\n    initItemsValue(mForm, value, initValue, item);\n  } else {\n    value[name] = getDefaultValue(mForm, item as DefaultItem);\n  }\n\n  // 如果fieldset配置checkbox，checkbox的值保存在value中\n  if (type === 'fieldset' && checkbox) {\n    if (typeof value[name] === 'object') {\n      value[name].value = typeof initValue[name] === 'object' ? initValue[name].value || 0 : 0;\n    }\n  }\n};\n\nconst initValueItem = function (\n  mForm: FormState | undefined,\n  item: ChildConfig | TabPaneConfig,\n  initValue: FormValue,\n  value: FormValue,\n) {\n  const { items } = item as ContainerCommonConfig;\n  const { names } = item as DaterangeConfig;\n  const { type, name } = item as ChildConfig;\n\n  if (isTableSelect(type) && name) {\n    value[name] = initValue[name] || '';\n    return value;\n  }\n\n  asyncLoadConfig(value, initValue, item as HtmlField);\n\n  // 这种情况比较多，提前结束\n  if (name && !items && typeof initValue[name] !== 'undefined') {\n    if (typeof value[name] === 'undefined') {\n      value[name] = typeof initValue[name] === 'object' ? cloneDeep(initValue[name]) : initValue[name];\n    }\n\n    return value;\n  }\n\n  if (names) {\n    return names.forEach((n: string) => (value[n] = initValue[n] || ''));\n  }\n\n  if (!name) {\n    // 没有配置name，直接跳过\n    return init(mForm, items, initValue, value);\n  }\n\n  setValue(mForm, value, initValue, item);\n\n  return value;\n};\n\nconst init = function (\n  mForm: FormState | undefined,\n  config: FormConfig | TabPaneConfig[] = [],\n  initValue: FormValue = {},\n  value: FormValue = {},\n) {\n  if (Array.isArray(config)) {\n    config.forEach((item: ChildConfig | TabPaneConfig) => {\n      initValueItem(mForm, item, initValue, value);\n    });\n  }\n\n  return value;\n};\n\nconst getDefaultValue = function (mForm: FormState | undefined, { defaultValue, type, filter, multiple }: DefaultItem) {\n  if (typeof defaultValue === 'function') {\n    return defaultValue(mForm);\n  }\n\n  // 如果直接设置为undefined，在解析成js对象时会丢失这个配置，所以用'undefined'代替\n  if (defaultValue === 'undefined') {\n    return undefined;\n  }\n\n  if (typeof defaultValue !== 'undefined') {\n    return defaultValue;\n  }\n\n  if (type === 'number' || filter === 'number') {\n    return 0;\n  }\n\n  if (['switch', 'checkbox'].includes(type)) {\n    return false;\n  }\n\n  if (multiple) {\n    return [];\n  }\n\n  return '';\n};\n\nexport const filterFunction = (mForm: FormState | undefined, config: any, props: any) => {\n  if (typeof config !== 'function') {\n    return config;\n  }\n\n  return config(mForm, {\n    values: mForm?.initValues || {},\n    model: props.model,\n    parent: mForm?.parentValues || {},\n    formValue: mForm?.values || props.model,\n    prop: props.prop,\n  });\n};\n\nexport const display = function (mForm: FormState | undefined, config: any, props: any) {\n  if (typeof config === 'function') {\n    return filterFunction(mForm, config, props);\n  }\n\n  if (config === false) {\n    return false;\n  }\n\n  return true;\n};\n\nexport const getRules = function (mForm: FormState | undefined, rules: Rule[] | Rule = [], props: any) {\n  rules = cloneDeep(rules);\n\n  if (typeof rules === 'object' && !Array.isArray(rules)) {\n    rules = [rules];\n  }\n\n  return rules.map((item) => {\n    if (typeof item.validator === 'function') {\n      const fnc = item.validator;\n\n      (item as any).validator = (rule: any, value: any, callback: Function, source: any, options: any) =>\n        fnc(\n          {\n            rule,\n            value,\n            callback,\n            source,\n            options,\n          },\n          {\n            values: mForm?.initValues || {},\n            model: props.model,\n            parent: mForm?.parentValues || {},\n            formValue: mForm?.values || props.model,\n            prop: props.prop,\n          },\n          mForm,\n        );\n    }\n    return item;\n  });\n};\n\nexport const initValue = async (\n  mForm: FormState | undefined,\n  { initValues, config }: { initValues: FormValue; config: FormConfig },\n) => {\n  if (!Array.isArray(config)) throw new Error('config应该为数组');\n\n  let valuesTmp = init(mForm, config, toRaw(initValues), {});\n\n  const [firstForm] = config as [ContainerCommonConfig];\n  if (firstForm && typeof firstForm.onInitValue === 'function') {\n    valuesTmp = await firstForm.onInitValue(mForm, {\n      formValue: valuesTmp,\n      initValue: initValues,\n    });\n  }\n\n  return valuesTmp || {};\n};\n","<template>\n  <div v-if=\"config\" :style=\"config.tip ? 'display: flex' : ''\" :class=\"config.className\" class=\"m-form-container\">\n    <m-fields-hidden\n      v-if=\"type === 'hidden'\"\n      :model=\"model\"\n      :config=\"config\"\n      :name=\"config.name\"\n      :disabled=\"disabled\"\n      :prop=\"itemProp\"\n    ></m-fields-hidden>\n\n    <component\n      v-else-if=\"items && !config.text && type && display\"\n      :key=\"key(config)\"\n      :size=\"size\"\n      :is=\"tagName\"\n      :model=\"model\"\n      :config=\"config\"\n      :name=\"name\"\n      :prop=\"itemProp\"\n      :step-active=\"stepActive\"\n      :expand-more=\"expand\"\n      :label-width=\"config.labelWidth || labelWidth\"\n      @change=\"onChangeHandler\"\n    ></component>\n\n    <template v-else-if=\"type && display\">\n      <el-form-item\n        :style=\"config.tip ? 'flex: 1' : ''\"\n        :prop=\"itemProp\"\n        :label-width=\"config.text ? config.labelWidth || labelWidth : '0'\"\n        :rules=\"rule\"\n      >\n        <template #label><span v-html=\"type === 'checkbox' ? '' : config.text\"></span></template>\n        <el-tooltip v-if=\"tooltip\">\n          <component\n            :key=\"key(config)\"\n            :size=\"size\"\n            :is=\"tagName\"\n            :model=\"model\"\n            :config=\"config\"\n            :name=\"name\"\n            :disabled=\"disabled\"\n            :prop=\"itemProp\"\n            @change=\"onChangeHandler\"\n          ></component>\n          <template #content>\n            <div v-html=\"tooltip\"></div>\n          </template>\n        </el-tooltip>\n\n        <component\n          v-else\n          :key=\"key(config)\"\n          :size=\"size\"\n          :is=\"tagName\"\n          :model=\"model\"\n          :config=\"config\"\n          :name=\"name\"\n          :disabled=\"disabled\"\n          :prop=\"itemProp\"\n          @change=\"onChangeHandler\"\n        ></component>\n\n        <div v-if=\"extra\" v-html=\"extra\" class=\"m-form-tip\"></div>\n      </el-form-item>\n\n      <el-tooltip v-if=\"config.tip\" placement=\"top\" style=\"line-height: 40px; margin-left: 5px\">\n        <i class=\"el-icon-warning\"></i>\n        <template #content>\n          <div v-html=\"config.tip\"></div>\n        </template>\n      </el-tooltip>\n    </template>\n\n    <template v-else-if=\"items && display\">\n      <template v-if=\"name || name === 0 ? model[name] : model\">\n        <m-form-container\n          v-for=\"item in items\"\n          :key=\"key(item)\"\n          :model=\"name || name === 0 ? model[name] : model\"\n          :config=\"item\"\n          :size=\"size\"\n          :step-active=\"stepActive\"\n          :expand-more=\"expand\"\n          :label-width=\"config.labelWidth || labelWidth\"\n          :prop=\"itemProp\"\n          @change=\"onChangeHandler\"\n        ></m-form-container>\n      </template>\n    </template>\n\n    <div style=\"text-align: center\" v-if=\"config.expand && type !== 'fieldset'\">\n      <el-button type=\"text\" @click=\"expandHandler\">{{ expand ? '收起配置' : '展开更多配置' }}</el-button>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType, ref, resolveComponent, watchEffect } from 'vue';\n\nimport { ChildConfig, ContainerCommonConfig, FormState, FormValue } from '../schema';\nimport { display as displayFunction, filterFunction, getRules } from '../utils/form';\n\nexport default defineComponent({\n  name: 'm-form-container',\n\n  props: {\n    labelWidth: String,\n    expandMore: Boolean,\n\n    model: {\n      type: [Object, Array] as PropType<FormValue>,\n      required: true,\n    },\n\n    config: {\n      type: Object as PropType<ChildConfig>,\n      required: true,\n    },\n\n    prop: {\n      type: String,\n      default: () => '',\n    },\n\n    stepActive: {\n      type: [String, Number],\n    },\n\n    size: {\n      type: String,\n      default: 'small',\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    const mForm = inject<FormState | undefined>('mForm');\n\n    const expand = ref(false);\n\n    const name = computed(() => props.config.name || '');\n\n    const items = computed(() => (props.config as ContainerCommonConfig).items);\n\n    const itemProp = computed(() => (name.value ? `${props.prop}${props.prop ? '.' : ''}${name.value}` : props.prop));\n\n    const tagName = computed(() => {\n      const component = resolveComponent(`m-${items.value ? 'form' : 'fields'}-${type.value}`);\n      if (typeof component !== 'string') return component;\n      return 'm-fields-text';\n    });\n\n    const disabled = computed(() => filterFunction(mForm, props.config.disabled, props));\n\n    const tooltip = computed(() => filterFunction(mForm, props.config.tooltip, props));\n\n    const extra = computed(() => filterFunction(mForm, props.config.extra, props));\n\n    const rule = computed(() => getRules(mForm, props.config.rules, props));\n\n    const type = computed((): string => {\n      let { type } = props.config;\n      if (typeof type === 'function') {\n        type = type(mForm, {\n          model: props.model,\n        });\n      }\n      if (type === 'form') return '';\n      return type?.replace(/([A-Z])/g, '-$1').toLowerCase() || (items.value ? '' : 'text');\n    });\n\n    const display = computed((): boolean => {\n      if (props.config.display === 'expand') {\n        return expand.value;\n      }\n\n      return displayFunction(mForm, props.config.display, props);\n    });\n\n    watchEffect(() => {\n      expand.value = props.expandMore;\n    });\n\n    const expandHandler = () => (expand.value = !expand.value);\n\n    const key = (config: any) => config[mForm?.keyProps];\n\n    const filterHandler = (filter: any, value: FormValue | number | string) => {\n      if (typeof filter === 'function') {\n        return filter(mForm, value, {\n          model: props.model,\n          values: mForm?.initValues,\n          formValue: mForm?.values,\n          prop: itemProp.value,\n        });\n      }\n\n      if (filter === 'number') {\n        return +value;\n      }\n\n      return value;\n    };\n\n    const changeHandler = (onChange: any, value: FormValue | number | string) => {\n      if (typeof onChange === 'function') {\n        return onChange(mForm, value, {\n          model: props.model,\n          values: mForm?.initValues,\n          formValue: mForm?.values,\n          prop: itemProp.value,\n        });\n      }\n    };\n\n    const trimHandler = (trim: any, value: FormValue | number | string) => {\n      if (typeof value === 'string' && trim) {\n        return value.replace(/^\\s*/, '').replace(/\\s*$/, '');\n      }\n    };\n\n    const onChangeHandler = async function (v: FormValue, key?: string) {\n      const { filter, onChange, trim, name, dynamicKey } = props.config as any;\n      let value: FormValue | number | string = v;\n\n      try {\n        value = filterHandler(filter, v);\n        value = (await changeHandler(onChange, value)) ?? value;\n        value = trimHandler(trim, value) ?? value;\n      } catch (e) {\n        console.error(e);\n      }\n\n      // field内容下包含field-link时，model===value, 这里避免循环引用\n      if ((name || name === 0) && props.model !== value && (v !== value || props.model[name] !== value)) {\n        // eslint-disable-next-line vue/no-mutating-props\n        props.model[name] = value;\n      }\n      // 动态表单类型，根据value和key参数，直接修改model\n      if (key !== undefined && dynamicKey) {\n        // eslint-disable-next-line vue/no-mutating-props\n        props.model[key] = value;\n      }\n      emit('change', props.model);\n    };\n\n    return {\n      expand,\n      name,\n      type,\n      disabled,\n      itemProp,\n      items,\n      display,\n      tagName,\n      rule,\n      tooltip,\n      extra,\n      key,\n      onChangeHandler,\n      expandHandler,\n    };\n  },\n});\n</script>\n","<template>\n  <fieldset\n    v-if=\"name ? model[name] : model\"\n    class=\"m-fieldset\"\n    :style=\"show ? 'padding: 15px 15px 0 5px;' : 'border: 0'\"\n  >\n    <el-checkbox\n      v-if=\"!show && name\"\n      v-model=\"model[name].value\"\n      :prop=\"`${prop}${prop ? '.' : ''}${config.name}.value`\"\n      :true-label=\"1\"\n      :false-label=\"0\"\n      @change=\"change\"\n      ><span v-html=\"config.legend\"></span><span v-if=\"config.extra\" v-html=\"config.extra\" class=\"m-form-tip\"></span\n    ></el-checkbox>\n    <legend v-else-if=\"config.checkbox && name\">\n      <el-checkbox\n        v-model=\"model[name].value\"\n        :prop=\"`${prop}${prop ? '.' : ''}${config.name}.value`\"\n        :true-label=\"1\"\n        :false-label=\"0\"\n        @change=\"change\"\n        ><span v-html=\"config.legend\"></span><span v-if=\"config.extra\" v-html=\"config.extra\" class=\"m-form-tip\"></span\n      ></el-checkbox>\n    </legend>\n    <legend v-else>\n      <span v-html=\"config.legend\"></span>\n      <span v-if=\"config.extra\" v-html=\"config.extra\" class=\"m-form-tip\"></span>\n    </legend>\n\n    <div v-if=\"config.schematic && show\" style=\"display: flex\">\n      <div style=\"flex: 1\">\n        <m-form-container\n          v-for=\"(item, index) in config.items\"\n          :key=\"key(item, index)\"\n          :model=\"name ? model[name] : model\"\n          :rules=\"name ? rules[name] : []\"\n          :config=\"item\"\n          :prop=\"prop\"\n          :labelWidth=\"lWidth\"\n          :size=\"size\"\n          @change=\"change\"\n        ></m-form-container>\n      </div>\n\n      <img class=\"m-form-schematic\" :src=\"config.schematic\" />\n    </div>\n\n    <template v-else-if=\"show\">\n      <m-form-container\n        v-for=\"(item, index) in config.items\"\n        :key=\"key(item, index)\"\n        :model=\"name ? model[name] : model\"\n        :rules=\"name ? rules[name] : []\"\n        :config=\"item\"\n        :prop=\"prop\"\n        :labelWidth=\"lWidth\"\n        :size=\"size\"\n        @change=\"change\"\n      ></m-form-container>\n    </template>\n  </fieldset>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType } from 'vue';\n\nimport { FieldsetConfig, FormState } from '../schema';\n\nexport default defineComponent({\n  name: 'm-form-fieldset',\n\n  props: {\n    labelWidth: String,\n\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    config: {\n      type: Object as PropType<FieldsetConfig>,\n      default: () => ({}),\n    },\n\n    rules: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    prop: {\n      type: String,\n      default: () => '',\n    },\n\n    size: String,\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    const mForm = inject<FormState | undefined>('mForm');\n\n    const name = computed(() => props.config.name || '');\n\n    const show = computed(() => {\n      if (props.config.expand && name.value) {\n        return props.model[name.value]?.value;\n      }\n      return true;\n    });\n\n    const lWidth = computed(() => {\n      if (props.config.items) {\n        return props.config.labelWidth || props.labelWidth;\n      }\n      return props.config.labelWidth || props.labelWidth || (props.config.text ? null : '0');\n    });\n\n    const change = () => {\n      emit('change', props.model);\n    };\n\n    const key = (item: any, index: number) => item[mForm?.keyProp || '__key'] ?? index;\n\n    return {\n      show,\n      name,\n      mForm,\n      lWidth,\n      key,\n      change,\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\"></style>\n","<template>\n  <div class=\"m-fields-group-list-item\">\n    <div>\n      <el-icon style=\"margin-right: 7px\" @click=\"expandHandler\"\n        ><caret-bottom v-if=\"expand\" /><caret-right v-else\n      /></el-icon>\n\n      <el-button type=\"text\" @click=\"expandHandler\">{{ title }}</el-button>\n\n      <el-button\n        v-show=\"showDelete(parseInt(String(index)))\"\n        type=\"text\"\n        :icon=\"Delete\"\n        style=\"color: #f56c6c\"\n        @click=\"removeHandler\"\n      ></el-button>\n\n      <template v-if=\"movable()\">\n        <el-button v-show=\"index !== 0\" type=\"text\" size=\"small\" @click=\"changeOrder(-1)\"\n          >上移<el-icon><CaretRight /></el-icon\n        ></el-button>\n        <el-button v-show=\"index !== length - 1\" type=\"text\" size=\"small\" @click=\"changeOrder(1)\"\n          >下移<el-icon><CaretBottom /></el-icon\n        ></el-button>\n      </template>\n\n      <span v-if=\"itemExtra\" v-html=\"itemExtra\" class=\"m-form-tip\"></span>\n    </div>\n\n    <m-form-container\n      v-if=\"expand\"\n      :config=\"rowConfig\"\n      :model=\"model\"\n      :labelWidth=\"labelWidth\"\n      :prop=\"`${prop}${prop ? '.' : ''}${String(index)}`\"\n      :size=\"size\"\n      @change=\"changeHandler\"\n    ></m-form-container>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType, ref, watchEffect } from 'vue';\nimport { CaretBottom, CaretRight, Delete } from '@element-plus/icons';\n\nimport { FormState, GroupListConfig } from '../schema';\nimport { filterFunction } from '../utils/form';\n\nexport default defineComponent({\n  name: 'm-form-group-list-item',\n\n  components: { CaretRight, CaretBottom },\n\n  props: {\n    labelWidth: String,\n\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    config: {\n      type: Object as PropType<GroupListConfig>,\n      default: () => ({}),\n    },\n\n    prop: String,\n\n    size: String,\n\n    index: {\n      type: [Number, String, Symbol],\n      default: 0,\n    },\n\n    groupModel: {\n      type: Array,\n      default: () => [],\n    },\n  },\n\n  emits: ['swap-item', 'remove-item', 'change'],\n\n  setup(props, { emit }) {\n    const mForm = inject<FormState | undefined>('mForm');\n    const expand = ref(false);\n\n    watchEffect(() => {\n      expand.value = !props.index;\n    });\n\n    const rowConfig = computed(() => ({\n      type: 'row',\n      span: props.config.span || 24,\n      items: props.config.items,\n      labelWidth: props.config.labelWidth,\n      [mForm?.keyProp || '__key']: `${props.config[mForm?.keyProp || '__key']}${String(props.index)}`,\n    }));\n\n    const title = computed(() => {\n      if (props.config.titleKey && props.model[props.config.titleKey]) {\n        return props.model[props.config.titleKey];\n      }\n\n      return `组 ${String(props.index)}`;\n    });\n\n    const length = computed(() => props.groupModel?.length || 0);\n\n    const itemExtra = computed(() => filterFunction(mForm, props.config.itemExtra, props));\n\n    const removeHandler = () => emit('remove-item', props.index);\n\n    const changeHandler = () => emit('change');\n\n    const expandHandler = () => {\n      expand.value = !expand.value;\n    };\n\n    // 希望支持单行可控制是否显示删除按钮，不会影响现有逻辑\n    const showDelete = (index: number) => {\n      const deleteFunc = props.config.delete;\n      if (deleteFunc && typeof deleteFunc === 'function') {\n        return deleteFunc(props.model, index, mForm?.values);\n      }\n      return true;\n    };\n\n    // 调换顺序\n    const changeOrder = (offset = 0) => emit('swap-item', props.index, `${String(props.index)}${offset}`);\n\n    const movable = () => {\n      const { movable } = props.config;\n\n      // 没有设置时，默认可移动\n      if (movable === undefined) return true;\n      if (typeof movable === 'function') {\n        return movable(mForm, props.index || 0, props.model, props.groupModel);\n      }\n      return movable;\n    };\n\n    return {\n      expand,\n      expandHandler,\n      title,\n      showDelete,\n      removeHandler,\n      movable,\n      changeOrder,\n      itemExtra,\n      rowConfig,\n      changeHandler,\n      length,\n      Delete,\n    };\n  },\n});\n</script>\n","<template>\n  <div class=\"m-fields-group-list\">\n    <div v-if=\"config.extra\" v-html=\"config.extra\" style=\"color: rgba(0, 0, 0, 0.45)\"></div>\n    <div v-if=\"!model[name] || !model[name].length\" class=\"el-table__empty-block\">\n      <span class=\"el-table__empty-text\">暂无数据</span>\n    </div>\n\n    <m-fields-group-list-item\n      v-else\n      v-for=\"(item, index) in model[name]\"\n      :key=\"index\"\n      :model=\"item\"\n      :config=\"config\"\n      :prop=\"prop\"\n      :index=\"index\"\n      :label-width=\"labelWidth\"\n      :size=\"size\"\n      :group-model=\"model[name]\"\n      @remove-item=\"removeHandler\"\n      @swap-item=\"swapHandler\"\n      @change=\"changeHandler\"\n    ></m-fields-group-list-item>\n\n    <el-button @click=\"addHandler\" size=\"small\" v-if=\"addable\">添加组</el-button>\n\n    <el-button icon=\"el-icon-s-grid\" size=\"small\" @click=\"toggleMode\" v-if=\"config.enableToggleMode\"\n      >切换为表格</el-button\n    >\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType } from 'vue';\n\nimport { FormState, GroupListConfig } from '../schema';\nimport { initValue } from '../utils/form';\n\nimport MFieldsGroupListItem from './GroupListItem.vue';\n\nexport default defineComponent({\n  name: 'm-form-group-list',\n\n  components: { MFieldsGroupListItem },\n\n  props: {\n    labelWidth: String,\n\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    config: {\n      type: Object as PropType<GroupListConfig>,\n      default: () => ({}),\n    },\n\n    prop: {\n      type: String,\n      default: '',\n    },\n\n    size: String,\n\n    name: {\n      type: String,\n      default: '',\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    const mForm = inject<FormState | undefined>('mForm');\n\n    const addable = computed(() => {\n      if (!props.name) return false;\n\n      if (typeof props.config.addable === 'function') {\n        return props.config.addable(mForm, {\n          model: props.model[props.name],\n          formValue: mForm?.values,\n        });\n      }\n\n      return typeof props.config.addable === 'undefined' ? true : props.config.addable;\n    });\n\n    const changeHandler = () => {\n      if (!props.name) return false;\n\n      emit('change', props.model[props.name]);\n    };\n\n    const addHandler = async () => {\n      if (!props.name) return false;\n\n      let initValues = {};\n\n      if (typeof props.config.defaultAdd === 'function') {\n        initValues = await props.config.defaultAdd(mForm, {\n          model: props.model[props.name],\n          formValue: mForm?.values,\n        });\n      } else if (props.config.defaultAdd) {\n        initValues = props.config.defaultAdd;\n      }\n\n      const groupValue = await initValue(mForm, {\n        config: props.config.items,\n        initValues,\n      });\n\n      props.model[props.name].push(groupValue);\n    };\n\n    const removeHandler = (index: number) => {\n      if (!props.name) return false;\n\n      props.model[props.name].splice(index, 1);\n      changeHandler();\n    };\n\n    const swapHandler = (idx1: number, idx2: number) => {\n      if (!props.name) return false;\n\n      const [currRow] = props.model[props.name].splice(idx1, 1);\n      props.model[props.name].splice(idx2, 0, currRow);\n      changeHandler();\n    };\n\n    const toggleMode = () => {\n      props.config.type = 'table';\n      props.config.groupItems = props.config.items;\n      props.config.items = (props.config.tableItems ||\n        props.config.items.map((item: any) => ({\n          ...item,\n          label: item.label || item.text,\n          text: null,\n        }))) as any;\n    };\n    return {\n      addable,\n      toggleMode,\n      removeHandler,\n      swapHandler,\n      changeHandler,\n      addHandler,\n    };\n  },\n});\n</script>\n","<template>\n  <el-card\n    v-if=\"items && items.length\"\n    class=\"box-card m-form-panel\"\n    :body-style=\"{ display: expand ? 'block' : 'none' }\"\n  >\n    <template #header>\n      <div class=\"clearfix\">\n        <a href=\"javascript:\" style=\"width: 100%; display: block\" @click=\"expand = !expand\">\n          <el-icon><caret-bottom v-if=\"expand\" /><caret-right v-else /></el-icon> {{ filter(config.title) }}\n          <span v-if=\"config && config.extra\" v-html=\"config.extra\" class=\"m-form-tip\"></span>\n        </a>\n      </div>\n    </template>\n\n    <div>\n      <slot></slot>\n\n      <div v-if=\"config.schematic\" style=\"display: flex\">\n        <div style=\"flex: 1\">\n          <m-form-container\n            v-for=\"(item, index) in items\"\n            :key=\"item[mForm?.keyProp || '__key'] ?? index\"\n            :config=\"item\"\n            :model=\"name ? model[name] : model\"\n            :prop=\"prop\"\n            :size=\"size\"\n            :label-width=\"config.labelWidth || labelWidth\"\n            @change=\"changeHandler\"\n          ></m-form-container>\n        </div>\n\n        <img class=\"m-form-schematic\" :src=\"config.schematic\" />\n      </div>\n\n      <template v-else>\n        <m-form-container\n          v-for=\"(item, index) in items\"\n          :key=\"item[mForm?.keyProp || '__key'] ?? index\"\n          :config=\"item\"\n          :model=\"name ? model[name] : model\"\n          :prop=\"prop\"\n          :size=\"size\"\n          :label-width=\"config.labelWidth || labelWidth\"\n          @change=\"changeHandler\"\n        ></m-form-container>\n      </template>\n    </div>\n  </el-card>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType, ref } from 'vue';\nimport { CaretBottom, CaretRight } from '@element-plus/icons';\n\nimport { FormState, PanelConfig } from '../schema';\nimport { filterFunction } from '../utils/form';\n\nexport default defineComponent({\n  name: 'm-form-panel',\n\n  components: { CaretBottom, CaretRight },\n\n  props: {\n    labelWidth: String,\n\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    config: {\n      type: Object as PropType<PanelConfig>,\n      default: () => ({}),\n    },\n\n    prop: String,\n\n    size: String,\n\n    name: String,\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    const mForm = inject<FormState | undefined>('mForm');\n\n    const expand = ref(props.config.expand !== false);\n\n    const items = computed(() => props.config.items);\n\n    const filter = (config: any) => filterFunction(mForm, config, props);\n\n    const changeHandler = () => emit('change', props.model);\n\n    return {\n      mForm,\n      expand,\n      items,\n      filter,\n      changeHandler,\n    };\n  },\n});\n</script>\n","<template>\n  <el-row :gutter=\"10\">\n    <el-col\n      v-for=\"(col, index) in config.items\"\n      :style=\"!display(col) || col.type === 'hidden' ? 'display: none' : ''\"\n      :key=\"col[mForm?.keyProp || '__key'] ?? index\"\n      :span=\"col.span || config.span || 24 / config.items.length\"\n    >\n      <m-form-container\n        :model=\"name ? model[name] : model\"\n        :config=\"col\"\n        :prop=\"prop\"\n        :label-width=\"config.labelWidth || labelWidth\"\n        :expand-more=\"expandMore\"\n        :size=\"size\"\n        @change=\"changeHandler\"\n      ></m-form-container>\n    </el-col>\n  </el-row>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, inject, PropType } from 'vue';\n\nimport { FormState, RowConfig } from '../schema';\nimport { display as displayFunction } from '../utils/form';\n\nexport default defineComponent({\n  name: 'm-form-row',\n\n  props: {\n    labelWidth: String,\n    expandMore: Boolean,\n\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    config: {\n      type: Object as PropType<RowConfig>,\n      default: () => ({}),\n    },\n\n    prop: String,\n\n    name: String,\n\n    size: String,\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    const mForm = inject<FormState | undefined>('mForm');\n\n    const changeHandler = () => emit('change', props.name ? props.model[props.name] : props.model);\n\n    return {\n      mForm,\n      display(config: any) {\n        return displayFunction(mForm, config.display, props);\n      },\n      changeHandler,\n    };\n  },\n});\n</script>\n","<template>\n  <div>\n    <el-steps :active=\"active\" align-center :space=\"config.space\">\n      <el-step\n        v-for=\"(item, index) in config.items\"\n        :key=\"item.__key\"\n        :title=\"item.title\"\n        :active=\"active\"\n        @click=\"stepClick(index)\"\n      ></el-step>\n    </el-steps>\n\n    <template v-for=\"(step, index) in config.items\">\n      <template v-for=\"item in step.items\">\n        <m-form-container\n          v-if=\"item\"\n          v-show=\"active - 1 === index\"\n          :key=\"item[mForm?.keyProp || '__key']\"\n          :config=\"item\"\n          :model=\"step.name ? model[step.name] : model\"\n          :prop=\"step.name\"\n          :size=\"size\"\n          :label-width=\"config.labelWidth || labelWidth\"\n          @change=\"changeHandler\"\n        ></m-form-container>\n      </template>\n    </template>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, inject, PropType, ref, watchEffect } from 'vue';\n\nimport { FormState, StepConfig } from '../schema';\n\nexport default defineComponent({\n  name: 'm-form-step',\n\n  props: {\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    config: {\n      type: Object as PropType<StepConfig>,\n      default: () => ({}),\n    },\n\n    stepActive: {\n      type: Number,\n      default: () => 1,\n    },\n\n    size: String,\n\n    labelWidth: String,\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    const mForm = inject<FormState | undefined>('mForm');\n    const active = ref(1);\n\n    watchEffect(() => {\n      active.value = props.stepActive;\n    });\n\n    const stepClick = (index: number) => {\n      active.value = index + 1;\n      mForm?.$emit('update:stepActive', active.value);\n    };\n\n    const changeHandler = () => {\n      emit('change', props.model);\n    };\n\n    return { mForm, active, stepClick, changeHandler };\n  },\n});\n</script>\n","<template>\n  <div ref=\"mTable\" class=\"m-fields-table\" :class=\"{ 'm-fields-table-item-extra': config.itemExtra }\">\n    <span v-if=\"config.extra\" style=\"color: rgba(0, 0, 0, 0.45)\" v-html=\"config.extra\"></span>\n    <div class=\"el-form-item__content\">\n      <el-tooltip content=\"拖拽可排序\" placement=\"left-start\" :disabled=\"config.dropSort !== true\">\n        <el-table\n          v-if=\"model[modelName]\"\n          ref=\"elTable\"\n          style=\"width: 100%\"\n          :data=\"model[modelName]\"\n          :border=\"config.border\"\n          :max-height=\"config.maxHeight\"\n          :default-expand-all=\"true\"\n          :key=\"updateKey\"\n          @select=\"selectHandle\"\n          @sort-change=\"sortChange\"\n        >\n          <el-table-column v-if=\"config.itemExtra\" :fixed=\"'left'\" width=\"30\" type=\"expand\">\n            <template v-slot=\"scope\">\n              <span v-html=\"itemExtra(config.itemExtra, scope.$index)\" class=\"m-form-tip\"></span>\n            </template>\n          </el-table-column>\n\n          <el-table-column label=\"操作\" width=\"60\" :fixed=\"config.fixed === false ? undefined : 'left'\">\n            <template v-slot=\"scope\">\n              <el-button\n                v-show=\"showDelete(scope.$index + 1 + pagecontext * pagesize - 1)\"\n                style=\"color: #f56c6c\"\n                type=\"text\"\n                :icon=\"Delete\"\n                @click=\"removeHandler(scope.$index + 1 + pagecontext * pagesize - 1)\"\n              ></el-button>\n            </template>\n          </el-table-column>\n\n          <el-table-column v-if=\"sort && model[modelName] && model[modelName].length > 1\" label=\"排序\" width=\"60\">\n            <template v-slot=\"scope\">\n              <el-tooltip\n                content=\"点击上移，双击置顶\"\n                placement=\"top\"\n                v-if=\"scope.$index + 1 + pagecontext * pagesize - 1 !== 0\"\n              >\n                <el-button\n                  plain\n                  size=\"small\"\n                  :icon=\"ArrowUp\"\n                  type=\"text\"\n                  @click=\"upHandler(scope.$index + 1 + pagecontext * pagesize - 1)\"\n                  @dblclick=\"topHandler(scope.$index + 1 + pagecontext * pagesize - 1)\"\n                ></el-button>\n              </el-tooltip>\n              <el-tooltip\n                content=\"点击下移，双击置底\"\n                placement=\"top\"\n                v-if=\"scope.$index + 1 + pagecontext * pagesize - 1 !== model[modelName].length - 1\"\n              >\n                <el-button\n                  plain\n                  size=\"small\"\n                  :icon=\"ArrowDown\"\n                  type=\"text\"\n                  @click=\"downHandler(scope.$index + 1 + pagecontext * pagesize - 1)\"\n                  @dblclick=\"bottomHandler(scope.$index + 1 + pagecontext * pagesize - 1)\"\n                ></el-button>\n              </el-tooltip>\n            </template>\n          </el-table-column>\n\n          <el-table-column\n            v-if=\"selection\"\n            align=\"center\"\n            header-align=\"center\"\n            type=\"selection\"\n            width=\"45\"\n          ></el-table-column>\n\n          <el-table-column width=\"60\" label=\"序号\">\n            <template v-slot=\"scope\">{{ scope.$index + 1 + pagecontext * pagesize }}</template>\n          </el-table-column>\n\n          <template v-for=\"(column, index) in config.items\">\n            <el-table-column\n              v-if=\"column.type !== 'hidden' && display(column.display)\"\n              :prop=\"column.name\"\n              :width=\"column.width\"\n              :label=\"column.label\"\n              :sortable=\"column.sortable\"\n              :sort-orders=\"['ascending', 'descending']\"\n              :key=\"column[mForm?.keyProp || '__key'] ?? index\"\n              :class-name=\"config.dropSort === true ? 'el-table__column--dropable' : ''\"\n            >\n              <template #default=\"scope\">\n                <m-form-container\n                  v-if=\"scope.$index > -1\"\n                  labelWidth=\"0\"\n                  :prop=\"getProp(scope.$index)\"\n                  :rules=\"column.rules\"\n                  :config=\"makeConfig(column)\"\n                  :model=\"scope.row\"\n                  :size=\"size\"\n                  @change=\"$emit('change', model[modelName])\"\n                ></m-form-container>\n              </template>\n            </el-table-column>\n          </template>\n        </el-table>\n      </el-tooltip>\n      <slot></slot>\n      <el-button v-if=\"addable\" size=\"small\" type=\"primary\" plain @click=\"newHandler()\">添加</el-button> &nbsp;\n      <el-button :icon=\"Grid\" size=\"small\" @click=\"toggleMode\" v-if=\"enableToggleMode && !isFullscreen\"\n        >展开配置</el-button\n      >\n      <el-button :icon=\"FullScreen\" size=\"small\" @click=\"toggleFullscreen\" v-if=\"config.enableFullscreen !== false\">\n        {{ isFullscreen ? '退出全屏' : '全屏编辑' }}\n      </el-button>\n      <el-upload\n        v-if=\"importable\"\n        ref=\"excelBtn\"\n        action=\"/noop\"\n        :on-change=\"excelHandler\"\n        :auto-upload=\"false\"\n        style=\"display: inline-block\"\n      >\n        <el-button size=\"small\" type=\"success\" plain>导入EXCEL</el-button> </el-upload\n      >&nbsp;\n      <el-button v-if=\"importable\" size=\"small\" type=\"warning\" plain @click=\"clearHandler()\">清空</el-button>\n    </div>\n\n    <div class=\"bottom\" style=\"text-align: right\">\n      <el-pagination\n        layout=\"total, sizes, prev, pager, next, jumper\"\n        :hide-on-single-page=\"model[modelName].length < pagesize\"\n        :current-page=\"pagecontext + 1\"\n        :page-sizes=\"[pagesize, 60, 120, 300]\"\n        :page-size=\"pagesize\"\n        :total=\"model[modelName].length\"\n        @size-change=\"handleSizeChange\"\n        @current-change=\"handleCurrentChange\"\n      >\n      </el-pagination>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\n/* eslint-disable no-param-reassign */\nimport { computed, defineComponent, inject, onMounted, PropType, ref, toRefs } from 'vue';\nimport { ArrowDown, ArrowUp, Delete, FullScreen, Grid } from '@element-plus/icons';\nimport { ElMessage, ElTable, ElUpload } from 'element-plus';\nimport { cloneDeep } from 'lodash-es';\nimport Sortable, { SortableEvent } from 'sortablejs';\n\nimport { asyncLoadJs, sleep } from '@tmagic/utils';\n\nimport { ColumnConfig, FormState, SortProp, TableConfig } from '../schema';\nimport { display, initValue } from '../utils/form';\n\nexport type UploadStatus = 'ready' | 'uploading' | 'success' | 'fail';\n\nexport interface ElFile extends File {\n  uid: number;\n}\n\nexport type UploadFile = {\n  name: string;\n  percentage?: number;\n  status: UploadStatus;\n  size: number;\n  response?: unknown;\n  uid: number;\n  url?: string;\n  raw: ElFile;\n};\n\nlet loadedAMapJS = false; // 是否加载完js\nlet firstLoadingAMapJS = true; // 否是第一次请求\n\nexport default defineComponent({\n  name: 'm-form-table',\n\n  props: {\n    name: {\n      type: String,\n      required: true,\n    },\n\n    model: {\n      type: Object,\n      required: true,\n      default: () => ({}),\n    },\n\n    config: {\n      type: Object as PropType<TableConfig>,\n      required: true,\n      default: () => ({}),\n    },\n\n    prop: {\n      type: String,\n    },\n\n    labelWidth: {\n      type: String,\n    },\n\n    sort: {\n      type: Boolean,\n      default: false,\n    },\n\n    sortKey: {\n      type: String,\n      default: '',\n    },\n\n    text: {\n      type: String,\n    },\n\n    size: String,\n\n    enableToggleMode: {\n      type: Boolean,\n      default: true,\n    },\n  },\n\n  emits: ['change', 'select'],\n\n  setup(props, { emit }) {\n    let timer: NodeJS.Timeout | null = null;\n    const mForm = inject<FormState | undefined>('mForm');\n\n    const elTable = ref<InstanceType<typeof ElTable>>();\n    const excelBtn = ref<InstanceType<typeof ElUpload>>();\n    const mTable = ref<HTMLDivElement>();\n\n    const pagesize = ref(10);\n    const pagecontext = ref(0);\n    const updateKey = ref(1);\n    const isFullscreen = ref(false);\n\n    const modelName = computed(() => props.name || props.config.name || '');\n\n    const sortChange = ({ prop, order }: SortProp) => {\n      if (order === 'ascending') {\n        props.model[modelName.value] = props.model[modelName.value].sort((a: any, b: any) => a[prop] - b[prop]);\n      } else if (order === 'descending') {\n        props.model[modelName.value] = props.model[modelName.value].sort((a: any, b: any) => b[prop] - a[prop]);\n      }\n    };\n\n    const foreUpdate = () => {\n      updateKey.value += 1;\n      setTimeout(() => rowDrop());\n    };\n\n    const swapArray = (index1: number, index2: number) => {\n      [props.model[modelName.value][index1]] = props.model[modelName.value].splice(\n        index2,\n        1,\n        props.model[modelName.value][index1],\n      );\n      if (props.sortKey) {\n        for (let i = props.model[modelName.value].length - 1, v = 0; i >= 0; i--, v++) {\n          props.model[modelName.value][v][props.sortKey] = i;\n        }\n      }\n      mForm?.$emit('field-change', props.prop, props.model[modelName.value]);\n    };\n\n    const rowDrop = () => {\n      const tableEl = elTable.value?.$el;\n      if (tableEl?.querySelectorAll('.el-table__body > tbody')) {\n        // eslint-disable-next-line prefer-destructuring\n        const el = tableEl.querySelectorAll('.el-table__body > tbody')[0];\n        const sortable = Sortable.create(el, {\n          onEnd: ({ newIndex, oldIndex }: SortableEvent) => {\n            if (typeof newIndex === 'undefined') return;\n            if (typeof oldIndex === 'undefined') return;\n            swapArray(newIndex, oldIndex);\n            emit('change', props.model[modelName.value]);\n            foreUpdate();\n            sortable.destroy();\n            mForm?.$emit('field-change', props.prop, props.model[modelName.value]);\n            sleep(1000).then(() => {\n              const eltrs = tableEl.querySelectorAll('.el-table__body > tbody > tr');\n              if (eltrs?.[newIndex]) {\n                eltrs[newIndex].style.backgroundColor = 'rgba(243, 89, 59, 0.2)';\n                sleep(1000).then(() => {\n                  eltrs[newIndex].style.backgroundColor = '';\n                });\n              }\n            });\n          },\n        });\n      }\n    };\n\n    const newHandler = async (row?: any) => {\n      if (props.config.max && props.model[modelName.value].length >= props.config.max) {\n        ElMessage.error(`最多新增配置不能超过${props.config.max}条`);\n        return;\n      }\n\n      const columns = props.config.items;\n      const enumValues = props.config.enum || [];\n      let enumV = [];\n      const { length } = props.model[modelName.value];\n      const key = props.config.key || 'id';\n      let inputs: any = {};\n\n      if (enumValues.length) {\n        if (length >= enumValues.length) {\n          return;\n        }\n        enumV = enumValues.filter((item) => {\n          let i = 0;\n          for (; i < length; i++) {\n            if (item[key] === props.model[modelName.value][i][key]) {\n              break;\n            }\n          }\n          return i === length;\n        });\n\n        if (enumV.length > 0) {\n          // eslint-disable-next-line prefer-destructuring\n          inputs = enumV[0];\n        }\n      } else if (Array.isArray(row)) {\n        columns.forEach((column, index) => {\n          column.name && (inputs[column.name] = row[index]);\n        });\n      } else {\n        if (typeof props.config.defaultAdd === 'function') {\n          inputs = await props.config.defaultAdd(mForm, {\n            model: props.model[modelName.value],\n            formValue: mForm?.values,\n          });\n        } else if (props.config.defaultAdd) {\n          inputs = props.config.defaultAdd;\n        }\n\n        inputs = await initValue(mForm, {\n          config: columns,\n          initValues: inputs,\n        });\n      }\n\n      if (props.sortKey && length) {\n        inputs[props.sortKey] = props.model[modelName.value][length - 1][props.sortKey] - 1;\n      }\n\n      props.model[modelName.value].push(inputs);\n      emit('change', props.model[modelName.value]);\n    };\n\n    if (!loadedAMapJS && firstLoadingAMapJS && !(globalThis as any).XLSX) {\n      firstLoadingAMapJS = false; // 马上置为false 只让第一个created组件去请求js\n      asyncLoadJs('https://cdn.bootcdn.net/ajax/libs/xlsx/0.17.0/xlsx.full.min.js')\n        .then(() => {\n          loadedAMapJS = true;\n        })\n        .catch(() => {\n          firstLoadingAMapJS = true; // 出错置为true 下次进来还是能重新请求js\n        });\n    }\n\n    onMounted(() => {\n      if (props.config.defautSort) {\n        sortChange(props.config.defautSort);\n      }\n\n      if (props.sort && props.sortKey) {\n        props.model[modelName.value].sort((a: any, b: any) => b[props.sortKey] - a[props.sortKey]);\n      }\n\n      if (props.config.dropSort) {\n        rowDrop();\n      }\n    });\n\n    return {\n      mForm,\n      pagesize,\n      pagecontext,\n      foreUpdate,\n      isFullscreen,\n      elTable,\n      mTable,\n      excelBtn,\n      modelName,\n      updateKey,\n      ArrowDown,\n      ArrowUp,\n      Delete,\n      FullScreen,\n      Grid,\n\n      data: computed(() =>\n        props.model[modelName.value].filter(\n          (item: any, index: number) =>\n            index >= pagecontext.value * pagesize.value && index + 1 <= (pagecontext.value + 1) * pagesize.value,\n        ),\n      ),\n      addable: computed(() => {\n        if (!props.model[modelName.value].length) {\n          return true;\n        }\n        if (typeof props.config.addable === 'function') {\n          return props.config.addable(mForm, {\n            model: props.model[modelName.value],\n            formValue: mForm?.values,\n            prop: props.prop,\n          });\n        }\n        return typeof props.config.addable === 'undefined' ? true : props.config.addable;\n      }),\n      selection: computed(() => {\n        if (typeof props.config.selection === 'function') {\n          return props.config.selection(mForm, { model: props.model[modelName.value] });\n        }\n        return props.config.selection;\n      }),\n      importable: computed(() => {\n        if (typeof props.config.importable === 'function') {\n          return props.config.importable(mForm, {\n            formValue: mForm?.values,\n            model: props.model[modelName.value],\n          });\n        }\n        return typeof props.config.importable === 'undefined' ? false : props.config.importable;\n      }),\n\n      sortChange,\n\n      display(fuc: any) {\n        return display(mForm, fuc, props);\n      },\n\n      itemExtra(fuc: any, index: number) {\n        if (typeof fuc === 'function') {\n          return fuc(mForm, {\n            values: mForm?.initValues,\n            model: props.model,\n            formValue: mForm ? mForm.values : props.model,\n            prop: props.prop,\n            index,\n          });\n        }\n\n        return fuc;\n      },\n\n      newHandler,\n\n      removeHandler(index: number) {\n        props.model[modelName.value].splice(index, 1);\n        emit('change', props.model[modelName.value]);\n      },\n\n      selectHandle(selection: any, row: any) {\n        if (typeof props.config.selection === 'string' && props.config.selection === 'single') {\n          elTable.value?.clearSelection();\n          elTable.value?.toggleRowSelection(row, true);\n        }\n        emit('select', selection, row);\n        if (typeof props.config.onSelect === 'function') {\n          props.config.onSelect(mForm, { selection, row });\n        }\n      },\n\n      toggleRowSelection(row: any, selected: boolean) {\n        elTable.value?.toggleRowSelection.call(elTable.value, row, selected);\n      },\n\n      makeConfig(config: ColumnConfig) {\n        const newConfig = cloneDeep(config);\n        delete newConfig.display;\n        return newConfig;\n      },\n\n      upHandler(index: number) {\n        if (timer) {\n          clearTimeout(timer);\n        }\n\n        timer = setTimeout(() => {\n          swapArray(index, index - 1);\n        }, 300);\n      },\n\n      topHandler(index: number) {\n        if (timer) {\n          clearTimeout(timer);\n        }\n\n        // 首先判断当前元素需要上移几个位置,置底移动到数组的第一位\n        const moveNum = index;\n\n        // 循环出需要一个一个上移的次数\n        for (let i = 0; i < moveNum; i++) {\n          swapArray(index, index - 1);\n          index -= 1;\n        }\n      },\n\n      downHandler(index: number) {\n        if (timer) {\n          clearTimeout(timer);\n        }\n\n        timer = setTimeout(() => {\n          swapArray(index, index + 1);\n        }, 300);\n      },\n\n      bottomHandler(index: number) {\n        if (timer) {\n          clearTimeout(timer);\n        }\n\n        // 首先判断当前元素需要上移几个位置,置底移动到数组的第一位\n        const moveNum = props.model[modelName.value].length - 1 - index;\n\n        // 循环出需要一个一个上移的次数\n        for (let i = 0; i < moveNum; i++) {\n          swapArray(index, index + 1);\n          index += 1;\n        }\n      },\n\n      // 希望支持单行可控制是否显示删除按钮，不会影响现有逻辑\n      showDelete(index: number) {\n        const deleteFunc = props.config.delete;\n        if (deleteFunc && typeof deleteFunc === 'function') {\n          return deleteFunc(props.model[modelName.value], index, mForm?.values);\n        }\n        return true;\n      },\n\n      clearHandler() {\n        const len = props.model[modelName.value].length;\n        props.model[modelName.value].splice(0, len);\n        mForm?.$emit('field-change', props.prop, props.model[modelName.value]);\n      },\n\n      excelHandler(file: UploadFile) {\n        if (!file || !file.raw) {\n          return false;\n        }\n        const reader = new FileReader();\n        reader.onload = () => {\n          const data = reader.result;\n          const pdata = (globalThis as any).XLSX.read(data, { type: 'array' });\n          pdata.SheetNames.forEach((sheetName: string) => {\n            const arr = (globalThis as any).XLSX.utils.sheet_to_json(pdata.Sheets[sheetName], { header: 1 });\n            if (arr?.[0]) {\n              arr.forEach((row: any) => {\n                newHandler(row);\n              });\n            }\n            setTimeout(() => {\n              excelBtn.value?.clearFiles();\n            }, 300);\n          });\n        };\n        reader.readAsArrayBuffer(file.raw);\n\n        return false;\n      },\n\n      handleSizeChange(val: number) {\n        pagesize.value = val;\n      },\n\n      handleCurrentChange(val: number) {\n        pagecontext.value = val - 1;\n      },\n\n      toggleMode() {\n        const calcLabelWidth = (label: string) => {\n          if (!label) return '0px';\n          const zhLength = label.match(/[^\\x00-\\xff]/g)?.length || 0;\n          const chLength = label.length - zhLength;\n          return `${Math.max(chLength * 8 + zhLength * 20, 80)}px`;\n        };\n\n        // 切换为groupList的形式\n        props.config.type = 'groupList';\n        props.config.enableToggleMode = true;\n        props.config.tableItems = props.config.items;\n        props.config.items =\n          props.config.groupItems ||\n          props.config.items.map((item: any) => {\n            const text = item.text || item.label;\n            const labelWidth = calcLabelWidth(text);\n            return {\n              ...item,\n              text,\n              labelWidth,\n              span: item.span || 12,\n            };\n          });\n      },\n\n      toggleFullscreen() {\n        if (isFullscreen.value) {\n          mTable.value?.classList.remove('fixed');\n          isFullscreen.value = false;\n        } else {\n          mTable.value?.classList.add('fixed');\n          isFullscreen.value = true;\n        }\n      },\n\n      getProp(index: number) {\n        const { prop } = toRefs(props);\n        return `${prop.value}${prop.value ? '.' : ''}${index + 1 + pagecontext.value * pagesize.value - 1}`;\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-tabs\n    v-model=\"activeTabName\"\n    :class=\"config.dynamic ? 'magic-form-dynamic-tab' : 'magic-form-tab'\"\n    :type=\"config.tabType\"\n    :editable=\"config.editable || false\"\n    :tab-position=\"config.tabPosition || 'top'\"\n    @tab-click=\"tabClickHandler\"\n    @tab-add=\"onTabAdd\"\n    @tab-remove=\"onTabRemove\"\n  >\n    <template v-for=\"(tab, tabIndex) in tabs\">\n      <el-tab-pane\n        v-if=\"display(tab.display) && tabItems(tab).length\"\n        :key=\"tab[mForm?.keyProp || '__key'] ?? tabIndex\"\n        :name=\"filter(tab.status) || tabIndex.toString()\"\n        :label=\"filter(tab.title)\"\n        :lazy=\"tab.lazy || false\"\n      >\n        <m-form-container\n          v-for=\"item in tabItems(tab)\"\n          :key=\"item[mForm?.keyProp || '__key']\"\n          :config=\"item\"\n          :model=\"config.dynamic ? model[config.name || ''][tabIndex] : tab.name ? model[tab.name] : model\"\n          :prop=\"config.dynamic ? `${prop}${prop ? '.' : ''}${String(tabIndex)}` : prop\"\n          :size=\"size\"\n          :label-width=\"tab.labelWidth || labelWidth\"\n          :expand-more=\"expandMore\"\n          @change=\"changeHandler\"\n        ></m-form-container>\n      </el-tab-pane>\n    </template>\n  </el-tabs>\n</template>\n\n<script lang=\"ts\">\n/* eslint-disable vue/no-mutating-props */\nimport { computed, defineComponent, inject, PropType, ref, watchEffect } from 'vue';\nimport { cloneDeep } from 'lodash-es';\n\nimport { FormState, FormValue, TabConfig, TabPaneConfig } from '../schema';\nimport { display, filterFunction } from '../utils/form';\n\nconst getActive = (mForm: FormState | undefined, props: any, activeTabName: string) => {\n  const { config, model, prop } = props;\n  const { active } = config;\n\n  if (typeof active === 'function') return active(mForm, { model, formValue: mForm?.values, prop });\n  if (+activeTabName >= props.config.items.length) return '0';\n  if (typeof active !== 'undefined') return active;\n\n  return '0';\n};\n\nconst tabClickHandler = (mForm: FormState | undefined, tab: any, props: any) => {\n  const { config, model, prop } = props;\n\n  // 兼容vue2的element-ui\n  tab.name = tab.paneName;\n\n  if (typeof config.onTabClick === 'function') {\n    config.onTabClick(mForm, tab, { model, formValue: mForm?.values, prop });\n  }\n\n  const tabConfig = config.items.find((item: TabPaneConfig) => tab.name === item.status);\n  if (tabConfig && typeof tabConfig.onTabClick === 'function') {\n    tabConfig.onTabClick(mForm, tab, { model, formValue: mForm?.values, prop });\n  }\n};\n\nconst Tab = defineComponent({\n  name: 'm-form-tab',\n\n  props: {\n    labelWidth: String,\n    expandMore: Boolean,\n\n    model: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    config: {\n      type: Object as PropType<TabConfig>,\n      default: () => ({}),\n    },\n\n    prop: String,\n\n    size: String,\n  },\n\n  emits: {\n    change(values: FormValue) {\n      return values;\n    },\n  },\n\n  setup(props, { emit }) {\n    const mForm = inject<FormState | undefined>('mForm');\n    const activeTabName = ref(getActive(mForm, props, ''));\n\n    const tabs = computed(() => {\n      if (props.config.dynamic) {\n        if (!props.config.name) throw new Error('dynamic tab 必须配置name');\n        return props.model[props.config.name] || [];\n      }\n      return props.config.items;\n    });\n\n    const filter = (config: any) => filterFunction(mForm, config, props);\n\n    watchEffect(() => {\n      if (typeof props.config.activeChange === 'function') {\n        props.config.activeChange(mForm, activeTabName.value, {\n          model: props.model,\n          prop: props.prop,\n        });\n      }\n    });\n\n    return {\n      mForm,\n\n      activeTabName,\n\n      tabs,\n\n      filter,\n\n      tabItems: (tab: TabPaneConfig) => (props.config.dynamic ? props.config.items : tab.items),\n\n      tabClickHandler: (tab: any) => tabClickHandler(mForm, tab, props),\n\n      onTabAdd: () => {\n        if (!props.config.name) throw new Error('dynamic tab 必须配置name');\n\n        if (typeof props.config.onTabAdd === 'function') {\n          props.config.onTabAdd(mForm, { model: props.model });\n        } else if (tabs.value.length > 0) {\n          const newObj = cloneDeep(tabs.value[0]);\n          newObj.title = `标签${tabs.value.length + 1}`;\n          props.model[props.config.name].push(newObj);\n        }\n        emit('change', props.model);\n        mForm?.$emit('field-change', props.prop, props.model[props.config.name]);\n      },\n\n      onTabRemove: (tabName: string) => {\n        if (!props.config.name) throw new Error('dynamic tab 必须配置name');\n\n        if (typeof props.config.onTabRemove === 'function') {\n          props.config.onTabRemove(mForm, tabName, { model: props.model });\n        } else {\n          props.model[props.config.name].splice(+tabName, 1);\n\n          // 防止删除后没有选中的问题\n          if (tabName < activeTabName.value || activeTabName.value >= props.model[props.config.name].length) {\n            activeTabName.value = (+activeTabName.value - 1).toString();\n            tabClickHandler(mForm, { name: activeTabName.value }, props);\n          }\n        }\n        emit('change', props.model);\n        mForm?.$emit('field-change', props.prop, props.model[props.config.name]);\n      },\n\n      display: (displayConfig: any) => display(mForm, displayConfig, props),\n\n      changeHandler: () => {\n        emit('change', props.model);\n        if (typeof props.config.onChange === 'function') {\n          props.config.onChange(mForm, { model: props.model });\n        }\n      },\n    };\n  },\n});\n\nexport default Tab;\n</script>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nlet $MAGIC_FORM = {} as any;\n\nconst setConfig = (option: any): void => {\n  $MAGIC_FORM = option;\n};\n\nconst getConfig = (key: string): unknown => $MAGIC_FORM[key];\n\nexport { getConfig, setConfig };\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { PropType } from 'vue';\n\nexport default {\n  model: {\n    type: Object,\n    required: true,\n    default: () => ({}),\n  },\n  name: {\n    type: String,\n    default: '',\n  },\n  disabled: {\n    type: Boolean,\n    default: false,\n  },\n  size: String as PropType<'mini' | 'small' | 'medium'>,\n  prop: String,\n  initValues: Object,\n  values: Object,\n};\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { ComponentInternalInstance, getCurrentInstance, inject, watch } from 'vue';\n\nimport { FormState } from '../schema';\n\nexport const useAddField = (prop?: string) => {\n  if (!prop) return;\n  const mForm = inject<FormState | null>('mForm');\n  const instance = getCurrentInstance() as ComponentInternalInstance;\n  watch(\n    () => instance?.proxy,\n    (vm) => {\n      if (vm) {\n        mForm?.setField(prop, vm);\n      } else {\n        mForm?.deleteField(prop);\n      }\n    },\n    {\n      immediate: true,\n    },\n  );\n};\n","<template>\n  <div class=\"m-cascader\" style=\"width: 100%\">\n    <el-cascader\n      v-model=\"model[name]\"\n      ref=\"cascader\"\n      style=\"width: 100%\"\n      clearable\n      filterable\n      :size=\"size\"\n      :placeholder=\"config.placeholder\"\n      :disabled=\"disabled\"\n      :options=\"options\"\n      :props=\"{ multiple: config.multiple }\"\n      @change=\"changeHandler\"\n    ></el-cascader>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport {\n  ComponentInternalInstance,\n  computed,\n  defineComponent,\n  getCurrentInstance,\n  inject,\n  PropType,\n  Ref,\n  ref,\n  watchEffect,\n} from 'vue';\nimport { ElCascader, ElDialog } from 'element-plus';\n\nimport { CascaderConfig, FormState } from '../schema';\nimport { getConfig } from '../utils/config';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-cascader',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<CascaderConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    const mForm = inject<FormState | null>('mForm');\n    const vm = getCurrentInstance() as ComponentInternalInstance;\n\n    useAddField(props.prop);\n\n    const requestFunc = getConfig('request') as Function;\n\n    const cascader: Ref<null | typeof ElCascader> = ref(null);\n    const dialog: Ref<null | typeof ElDialog> = ref(null);\n\n    const options = Array.isArray(props.config.options) ? ref(props.config.options) : ref([]);\n    const remoteData: Ref<any> = ref(null);\n\n    const setRemoteOptions = async function () {\n      const { config } = props;\n      const { option } = config;\n      if (!option) return;\n      let { body } = option;\n\n      const postOptions: Record<string, any> = {\n        url: option.url,\n        cache: option.cache,\n        timeout: option.timeout,\n        data: {},\n      };\n\n      if (body && mForm) {\n        if (typeof body === 'function' && props.model && mForm) {\n          body = body(mForm, {\n            model: props.model,\n            formValue: null,\n            formValues: mForm.values,\n          });\n        }\n        postOptions.data = body;\n      }\n\n      const res = await requestFunc(postOptions);\n\n      remoteData.value = res[option.root];\n      if (remoteData.value && typeof option?.item === 'function') {\n        options.value = option.item(res[option.root]);\n      }\n    };\n\n    // 初始化\n    if (typeof props.config.options === 'function' && props.model && mForm) {\n      watchEffect(\n        () =>\n          (options.value = (props.config.options as Function)(vm, { model: props.model, formValues: mForm.values })),\n      );\n    } else if (!props.config.options || !props.config.options.length || props.config.remote) {\n      Promise.resolve(setRemoteOptions());\n    }\n\n    const action = computed(() => {\n      if (props.config.add?.action.method === 'post') {\n        return (options: any) =>\n          requestFunc({\n            ...props.config?.add?.action.body,\n            ...options,\n          });\n      }\n      return null;\n    });\n\n    return {\n      options,\n      remoteData,\n      addButtonStyle: {\n        top: 0,\n        left: 0,\n        width: 'auto',\n      },\n      dialogVisible: false,\n      cascader,\n      dialog,\n      action,\n      setRemoteOptions,\n      changeHandler: (value: any) => {\n        if (!cascader.value) return;\n        cascader.value.query = '';\n        cascader.value.previousQuery = null;\n        emit('change', value);\n      },\n      addHandler: () => {\n        if (!dialog.value) return;\n        dialog.value.dialogVisible = true;\n      },\n      editAfterAction: () => {\n        setRemoteOptions();\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-checkbox\n    v-model=\"model[name]\"\n    :size=\"size\"\n    :trueLabel=\"activeValue\"\n    :falseLabel=\"inactiveValue\"\n    :disabled=\"disabled\"\n    :label=\"config.text\"\n    @change=\"changeHandler\"\n  ></el-checkbox>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from 'vue';\n\nimport { CheckboxConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-checkbox',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<CheckboxConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change', 'input'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    return {\n      activeValue: computed(() => {\n        if (typeof props.config.activeValue === 'undefined') {\n          if (props.config.filter === 'number') {\n            return 1;\n          }\n        } else {\n          return props.config.activeValue;\n        }\n\n        return 'true';\n      }),\n\n      inactiveValue: computed(() => {\n        if (typeof props.config.inactiveValue === 'undefined') {\n          if (props.config.filter === 'number') {\n            return 0;\n          }\n        } else {\n          return props.config.inactiveValue;\n        }\n\n        return 'false';\n      }),\n\n      changeHandler(value: number | boolean) {\n        emit('change', value);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-checkbox-group v-model=\"model[name]\" :size=\"size\" :disabled=\"disabled\" @change=\"changeHandler\">\n    <el-checkbox v-for=\"option in config.options\" :label=\"option.value\" :key=\"option.value\"\n      >{{ option.text }}\n    </el-checkbox>\n  </el-checkbox-group>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\n\nimport { CheckboxGroupConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-checkbox-group',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<CheckboxGroupConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    // 初始化选项\n    if (props.model && !props.model[props.name]) {\n      // eslint-disable-next-line no-param-reassign\n      props.model[props.name] = [];\n    }\n    return {\n      changeHandler: (v: Array<string | number | boolean>) => {\n        emit('change', v);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <div v-if=\"model\">\n    <el-color-picker\n      v-model=\"model[name]\"\n      :size=\"size\"\n      :disabled=\"disabled\"\n      :showAlpha=\"true\"\n      @change=\"changeHandler\"\n    ></el-color-picker>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\n\nimport { ColorPickConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\nexport default defineComponent({\n  name: 'm-fields-color-picker',\n});\n</script>\n\n<script lang=\"ts\" setup>\nconst emit = defineEmits(['change']);\n\nconst props = defineProps({\n  ...fieldProps,\n  config: {\n    type: Object as PropType<ColorPickConfig>,\n    required: true,\n  },\n});\n\nuseAddField(props.prop);\n\nconst changeHandler = (value: string) => emit('change', value);\n</script>\n","<template>\n  <div v-if=\"model\">\n    <el-date-picker\n      v-model=\"model[modelName]\"\n      type=\"date\"\n      :size=\"size\"\n      :placeholder=\"config.placeholder\"\n      :disabled=\"disabled\"\n      :format=\"config.format\"\n      :value-format=\"config.format || 'YYYY-MM-DD HH:mm:ss'\"\n      @change=\"changeHandler\"\n    ></el-date-picker>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from 'vue';\n\nimport { datetimeFormatter } from '@tmagic/utils';\n\nimport { DateConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-date',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<DateConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change', 'input'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    const modelName = computed(() => props.prop || props.config.name || '');\n    props.model[modelName.value] = datetimeFormatter(props.model[modelName.value], '');\n    return {\n      modelName,\n      changeHandler(v: string) {\n        emit('change', v);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <div>\n    <el-date-picker\n      v-model=\"value\"\n      type=\"datetimerange\"\n      range-separator=\"-\"\n      start-placeholder=\"开始日期\"\n      end-placeholder=\"结束日期\"\n      :size=\"size\"\n      :unlink-panels=\"true\"\n      :disabled=\"disabled\"\n      @change=\"changeHandler\"\n    ></el-date-picker>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType, ref } from 'vue';\n\nimport { datetimeFormatter } from '@tmagic/utils';\n\nimport { DaterangeConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-daterange',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<DaterangeConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    // eslint-disable-next-line vue/no-setup-props-destructure\n    const { names } = props.config;\n    const value = ref<(string | number)[]>([]);\n\n    if (props.model !== undefined) {\n      if (names?.length) {\n        value.value = names.map((item) => datetimeFormatter(props.model?.[item], ''));\n      } else if (props.name && props.model[props.name]) {\n        value.value = props.model[props.name].map((item: string) => datetimeFormatter(item, ''));\n      }\n    }\n\n    const setValue = (v: Date[] | Date) => {\n      if (names?.length && v instanceof Array) {\n        names.forEach((item, index) => {\n          if (props.model) {\n            props.model[item] = datetimeFormatter(v[index].toString(), '');\n          }\n        });\n      } else if (props.model && props.name && v instanceof Date) {\n        props.model[props.name] = datetimeFormatter(v.toString(), '');\n      }\n    };\n\n    return {\n      value,\n      changeHandler(v: Date[]) {\n        setValue(v);\n        emit('change', v);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <div v-if=\"model\">\n    <el-date-picker\n      v-model=\"model[name]\"\n      popper-class=\"magic-datetime-picker-popper\"\n      type=\"datetime\"\n      :size=\"size\"\n      :placeholder=\"config.placeholder\"\n      :disabled=\"disabled\"\n      :format=\"config.format || 'YYYY-MM-DD HH:mm:ss'\"\n      :value-format=\"config.valueFormat || 'YYYY-MM-DD HH:mm:ss'\"\n      @change=\"changeHandler\"\n    ></el-date-picker>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\n\nimport { datetimeFormatter } from '@tmagic/utils';\n\nimport { DateTimeConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-datetime',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<DateTimeConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    const value = props.model?.[props.name].toString();\n    if (props.model) {\n      if (value === 'Invalid Date') {\n        props.model[props.name] = '';\n      } else {\n        props.model[props.name] = datetimeFormatter(props.model[props.name], '', props.config.valueFormat);\n      }\n    }\n\n    return {\n      value,\n      changeHandler: (v: Date) => {\n        emit('change', v);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <span v-if=\"model\">{{ model[n] }}</span>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from 'vue';\n\nimport { DisplayConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-display',\n});\n</script>\n\n<script setup lang=\"ts\">\nconst props = defineProps({\n  ...fieldProps,\n  config: {\n    type: Object as PropType<DisplayConfig>,\n    required: true,\n  },\n});\n\nconst n = computed(() => props.name || props.config.name || '');\n\nif (props.config.initValue && n.value && props.model) {\n  // eslint-disable-next-line no-param-reassign,vue/no-setup-props-destructure\n  props.model[n.value] = props.config.initValue;\n}\n\nuseAddField(props.prop);\n</script>\n","<template>\n  <div class=\"m-fields-dynamic-field\">\n    <el-form size=\"small\">\n      <el-form-item v-for=\"key in Object.keys(fieldMap.value)\" :key=\"key\" :label=\"fieldLabelMap.value[key]\">\n        <el-input\n          v-model=\"fieldMap.value[key]\"\n          :placeholder=\"fieldLabelMap.value[key]\"\n          @change=\"inputChangeHandler(key)\"\n        ></el-input>\n      </el-form-item>\n    </el-form>\n  </div>\n</template>\n\n<script lang=\"ts\">\n/**\n * 动态表单，目前只支持input类型字段\n * inputType: 'dynamic-field',\n * text: '动态表单',\n * dynamicKey: 'keyname', 如果model[dynamicKey]变化，表单字段变化\n * returnFields(config,model,request): 函数，返回字段列表[{name:'',label:'',defaultValue:''}]\n *\n * 特别注意！！！field的上一级必须extensible: true，才能保存未声明的字段\n */\n\nimport { defineComponent, onBeforeUnmount, PropType, reactive, watch } from 'vue';\n\nimport { DynamicFieldConfig } from '../schema';\nimport { getConfig } from '../utils/config';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-dynamic-field',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<DynamicFieldConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    const request = getConfig('request') as Function;\n    const fieldMap = reactive<{ [key: string]: any }>({\n      value: {},\n    });\n    const fieldLabelMap = reactive<{ [key: string]: any }>({\n      value: {},\n    });\n\n    const changeFieldMap = async () => {\n      if (typeof props.config.returnFields !== 'function' || !props.model) return;\n      const fields = await props.config.returnFields(props.config, props.model, request);\n      fieldMap.value = {};\n      fieldLabelMap.value = {};\n      fields.forEach((v) => {\n        if (typeof v !== 'object' || v.name === undefined) return;\n        let oldVal = props.model?.[v.name] || '';\n        if (!oldVal && v.defaultValue !== undefined) {\n          oldVal = v.defaultValue;\n          emit('change', oldVal, v.name);\n        }\n        fieldMap.value[v.name] = oldVal;\n        fieldLabelMap.value[v.name] = v.label || '';\n      });\n    };\n\n    const unwatch = watch(\n      () => props.model?.[props.config.dynamicKey],\n      (val) => {\n        if (val !== '') {\n          changeFieldMap();\n        }\n      },\n      {\n        immediate: true,\n      },\n    );\n\n    onBeforeUnmount(() => {\n      if (typeof unwatch === 'function') {\n        unwatch();\n      }\n    });\n\n    return {\n      request,\n      fieldMap,\n      fieldLabelMap,\n      unwatch,\n\n      changeFieldMap,\n      inputChangeHandler: (key: string) => {\n        emit('change', fieldMap.value[key], key);\n      },\n    };\n  },\n\n  methods: {\n    init() {},\n  },\n});\n</script>\n","<template>\n  <input v-if=\"model\" v-model=\"model[n]\" type=\"hidden\" />\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from 'vue';\n\nimport { HiddenConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-hidden',\n});\n</script>\n\n<script setup lang=\"ts\">\nconst props = defineProps({\n  ...fieldProps,\n  config: {\n    type: Object as PropType<HiddenConfig>,\n    required: true,\n  },\n});\n\nconst n = computed(() => props.name || props.config.name || '');\n\nuseAddField(props.prop);\n</script>\n","<template>\n  <a v-if=\"config.href && !disabled\" target=\"_blank\" :href=\"href\" :style=\"config.css || {}\">{{ displayText }}</a>\n  <span v-else-if=\"config.href && disabled\" :style=\"config.disabledCss || {}\">{{ displayText }}</span>\n  <div v-else class=\"m-fields-link\">\n    <el-button type=\"text\" @click=\"editHandler\">点击编辑</el-button>\n    <m-form-dialog\n      ref=\"editor\"\n      :title=\"config.formTitle || '编辑扩展配置'\"\n      :width=\"config.formWidth\"\n      :values=\"formValue\"\n      :config=\"formConfig\"\n      :parentValues=\"values\"\n      :fullscreen=\"config.fullscreen\"\n      @submit=\"action\"\n    ></m-form-dialog>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType, ref } from 'vue';\n\nimport FormDialog from '../FormDialog.vue';\nimport { FormState, LinkConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-link',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<LinkConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    const formValue = ref({});\n    const editor = ref<InstanceType<typeof FormDialog>>();\n    const mForm = inject<FormState | undefined>('mForm');\n\n    const href = computed(() => {\n      if (typeof props.config.href === 'function' && props.model) {\n        return props.config.href(props.model);\n      }\n      return props.config.href || props.model?.[props.name];\n    });\n\n    const init = () => {\n      formValue.value = props.model?.[props.name] || {};\n    };\n\n    return {\n      // ref\n      formValue,\n      editor,\n\n      // computed methods\n      href,\n\n      formConfig: computed(() => {\n        if (typeof props.config.form === 'function') {\n          return props.config.form(mForm, {\n            model: props.model || {},\n            values: props.values || {},\n          });\n        }\n        return props.config.form;\n      }),\n\n      disable: computed(() => {\n        if (typeof props.config.disabled !== 'undefined') {\n          return props.config.disabled;\n        }\n        return !href.value;\n      }),\n\n      displayText: computed(() => {\n        if (typeof props.config.displayText === 'function') {\n          return props.config.displayText(mForm, { model: props.model || {} });\n        }\n        if (props.config.displayText) {\n          return props.config.displayText;\n        }\n        return '跳转';\n      }),\n\n      // methods\n      init,\n\n      editHandler: () => {\n        init();\n        editor.value && (editor.value.dialogVisible = true);\n      },\n\n      action: (data: any) => {\n        if (props.model) {\n          props.model[props.name] = data;\n          formValue.value = data;\n          emit('change', props.model[props.name]);\n        }\n        editor.value && (editor.value.dialogVisible = false);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-input-number\n    v-if=\"model\"\n    v-model=\"model[name]\"\n    clearable\n    controls-position=\"right\"\n    :size=\"size\"\n    :max=\"config.max\"\n    :min=\"config.min\"\n    :step=\"config.step\"\n    :placeholder=\"config.placeholder\"\n    :disabled=\"disabled\"\n    @change=\"changeHandler\"\n    @input=\"inputHandler\"\n  ></el-input-number>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, inject, PropType } from 'vue';\n\nimport { FormState, NumberConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\nexport default defineComponent({\n  name: 'm-fields-number',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<NumberConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change', 'input'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    const mForm = inject<FormState | null>('mForm');\n    return {\n      mForm,\n      changeHandler: (value: number) => {\n        emit('change', value);\n      },\n      inputHandler: (v: string) => {\n        emit('input', v);\n        mForm?.$emit('field-input', props.prop, v);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-radio-group v-if=\"model\" v-model=\"model[name]\" :size=\"size\" :disabled=\"disabled\" @change=\"changeHandler\">\n    <el-radio v-for=\"option in config.options\" :label=\"option.value\" :key=\"option.value\">{{ option.text }}</el-radio>\n  </el-radio-group>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\n\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-radio-group',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object,\n      required: true,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n    return {\n      changeHandler: (v: string | number | boolean) => emit('change', v),\n    };\n  },\n});\n</script>\n","<template>\n  <el-select\n    v-if=\"model\"\n    v-model=\"model[name]\"\n    v-loading=\"loading\"\n    class=\"m-select\"\n    ref=\"select\"\n    clearable\n    filterable\n    :popper-class=\"`m-select-popper ${popperClass}`\"\n    :size=\"size\"\n    :remote=\"remote\"\n    :placeholder=\"config.placeholder\"\n    :multiple=\"config.multiple\"\n    :value-key=\"config.valueKey || 'value'\"\n    :allow-create=\"config.allowCreate\"\n    :disabled=\"disabled\"\n    :remote-method=\"remoteMethod\"\n    @change=\"changeHandler\"\n    @visible-change=\"visibleHandler\"\n  >\n    <template v-if=\"config.group\">\n      <el-option-group\n        v-for=\"(group, index) in options\"\n        :key=\"group.label + index\"\n        :label=\"group.label\"\n        :disabled=\"group.disabled\"\n      >\n        <el-option\n          v-for=\"(item, index) in group.options\"\n          :key=\"item.label + index\"\n          :label=\"item.label\"\n          :value=\"item.value\"\n          :disabled=\"item.disabled\"\n        >\n        </el-option>\n      </el-option-group>\n    </template>\n    <template v-else>\n      <el-option\n        v-for=\"option in options\"\n        :label=\"option.text\"\n        :value=\"option.value\"\n        :key=\"config.valueKey ? option.value[config.valueKey] : option.value\"\n        :disabled=\"option.disabled\"\n      ></el-option>\n    </template>\n    <div v-loading=\"true\" v-if=\"moreLoadingVisible\"></div>\n  </el-select>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, inject, onBeforeMount, onMounted, PropType, ref, watch } from 'vue';\nimport { ElSelect } from 'element-plus';\n\nimport { FormState, SelectConfig, SelectGroupOption, SelectOption } from '../schema';\nimport { getConfig } from '../utils/config';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-select',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<SelectConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    if (!props.model) throw new Error('不能没有model');\n    useAddField(props.prop);\n\n    const select = ref<typeof ElSelect>();\n    const mForm = inject<FormState | undefined>('mForm');\n    const options = ref<SelectOption[] | SelectGroupOption[]>([]);\n    const localOptions = ref<SelectOption[] | SelectGroupOption[]>([]);\n    const loading = ref(false);\n    const moreLoadingVisible = ref(false);\n    const total = ref(0);\n    const pgIndex = ref(0);\n    const pgSize = ref(20);\n    const query = ref('');\n    const remoteData = ref<any[]>([]);\n    const remote = ref(true);\n\n    const equalValue = (value: any, v: any): boolean => {\n      if (typeof v === 'object') {\n        const key = props.config.valueKey || 'value';\n        return v[key] === value[key];\n      }\n\n      return value === v;\n    };\n\n    const mapOptions = (data: any[]) => {\n      const { option } = props.config;\n      const { text } = option;\n      const { value } = option;\n\n      return data.map((item) => ({\n        text: typeof text === 'function' ? text(item) : item[text || 'text'],\n        value: typeof value === 'function' ? value(item) : item[value || 'value'],\n      }));\n    };\n\n    const getOptions = async () => {\n      if (!props.model) return [];\n\n      if (localOptions.value.length) {\n        return localOptions.value;\n      }\n\n      loading.value = true;\n\n      let items: SelectOption[] | SelectGroupOption[] = [];\n\n      const { config } = props;\n      const { option } = config;\n      let { body } = option;\n\n      let postOptions: Record<string, any> = {\n        method: option.method || 'POST',\n        url: option.url,\n        cache: option.cache,\n        timeout: option.timeout,\n        mode: option.mode,\n        headers: option.headers || {},\n        json: option.json || false,\n      };\n\n      if (body) {\n        if (typeof body === 'function') {\n          body = body(mForm, {\n            model: props.model,\n            formValue: mForm?.values,\n            formValues: mForm?.values,\n          }) as Record<string, any>;\n        }\n\n        body.query = query.value;\n        body.pgSize = pgSize.value;\n        body.pgIndex = pgIndex.value;\n        postOptions.data = body;\n      }\n\n      const requestFuc = getConfig('request') as Function;\n\n      if (typeof option.beforeRequest === 'function') {\n        postOptions = option.beforeRequest(mForm, postOptions, {\n          model: props.model,\n          formValue: mForm?.values,\n        });\n      }\n\n      if (option.method?.toLocaleLowerCase() === 'jsonp') {\n        postOptions.jsonpCallback = option.jsonpCallback || 'callback';\n      }\n\n      let res = await requestFuc(postOptions);\n\n      if (typeof option.afterRequest === 'function') {\n        res = option.afterRequest(mForm, res, {\n          model: props.model,\n          formValue: mForm?.values,\n          formValues: mForm?.values,\n        });\n      }\n\n      const optionsData = res[option.root];\n\n      if (res.total > 0) {\n        total.value = res.total;\n      }\n\n      remoteData.value = remoteData.value.concat(optionsData);\n      if (optionsData) {\n        if (typeof option.item === 'function') {\n          items = option.item(optionsData);\n        } else if (optionsData.map) {\n          items = mapOptions(optionsData);\n        }\n      }\n\n      loading.value = false;\n\n      // 多选过滤时会导致已选的选项显示不了，所以要把已选的选项保留不要过滤没了\n      const selectedOptions: SelectOption[] | SelectGroupOption[] = [];\n      if (props.config.multiple && props.model[props.name]) {\n        options.value.forEach((o: any) => {\n          const isInclude = props.model?.[props.name].includes(o.value);\n          if (isInclude && !(items as any[]).find((op: any) => op.value === o.value)) {\n            selectedOptions.push(o);\n          }\n        });\n      }\n\n      return pgIndex.value === 0 ? (selectedOptions as any[]).concat(items) : (options.value as any).concat(items);\n    };\n\n    const getInitLocalOption = async () => {\n      if (!props.model) return [];\n\n      const value = props.model[props.name];\n      const { config } = props;\n      localOptions.value = await getOptions();\n\n      remote.value = false;\n\n      if (config.group) {\n        if (config.multiple && value.findIndex) {\n          return (localOptions.value as SelectGroupOption[]).filter(\n            (group) => group.options.findIndex((item) => value.find((v: any) => equalValue(item.value, v)) > -1) > -1,\n          );\n        }\n\n        return (localOptions.value as SelectGroupOption[]).filter(\n          (group) => group.options.findIndex((item) => equalValue(item.value, value)) > -1,\n        );\n      }\n\n      if (config.multiple && value.findIndex) {\n        return (localOptions.value as any[]).filter(\n          (item) => value.findIndex((v: any) => equalValue(item.value, v)) > -1,\n        );\n      }\n      return (localOptions.value as any[]).filter((item) => equalValue(item.value, value));\n    };\n\n    const getInitOption = async () => {\n      if (!props.model) return [];\n\n      const { config } = props;\n      const { option } = config;\n\n      let options: SelectOption[] | SelectGroupOption[] = [];\n\n      let url = option.initUrl;\n      if (!url) {\n        return getInitLocalOption();\n      }\n\n      if (typeof url === 'function') {\n        url = await url(mForm, { model: props.model, formValue: mForm?.values });\n      }\n\n      const postOptions: Record<string, any> = {\n        method: option.method || 'POST',\n        url,\n        data: {\n          id: props.model[props.name],\n        },\n        mode: option.mode,\n        headers: option.headers || {},\n        json: option.json || false,\n      };\n      if (option.method?.toLocaleLowerCase() === 'jsonp') {\n        postOptions.jsonpCallback = option.jsonpCallback || 'callback';\n      }\n\n      const requestFuc = getConfig('request') as Function;\n      const res = await requestFuc(postOptions);\n\n      let initData = res[option.root];\n      if (initData) {\n        if (!Array.isArray(initData)) {\n          initData = [initData];\n        }\n\n        if (typeof option.item === 'function') {\n          options = option.item(initData);\n        } else if (initData.map) {\n          options = mapOptions(initData);\n        }\n      }\n\n      return options;\n    };\n\n    if (typeof props.config.options === 'function') {\n      watch(\n        () => mForm?.values,\n        () => {\n          typeof props.config.options === 'function' &&\n            Promise.resolve(\n              props.config.options(mForm, {\n                model: props.model,\n                formValues: mForm?.values,\n                formValue: mForm?.values,\n              }),\n            ).then((data) => {\n              options.value = data;\n            });\n        },\n        {\n          deep: true,\n          immediate: true,\n        },\n      );\n    } else if (Array.isArray(props.config.options)) {\n      watch(\n        () => props.config.options,\n        () => {\n          options.value = props.config.options as SelectOption[] | SelectGroupOption[];\n        },\n        { immediate: true },\n      );\n    } else if (props.config.option) {\n      onBeforeMount(() => {\n        if (!props.model) return;\n        const v = props.model[props.name];\n        if (Array.isArray(v) ? v.length : v) {\n          getInitOption().then((data) => {\n            options.value = data;\n          });\n        }\n      });\n    }\n\n    props.config.remote &&\n      onMounted(() => {\n        select.value?.scrollbar.wrap$.addEventListener('scroll', async (e: Event) => {\n          const el = e.currentTarget as HTMLDivElement;\n          if (moreLoadingVisible.value) {\n            return;\n          }\n          if (el.scrollHeight - el.clientHeight - el.scrollTop > 1) {\n            return;\n          }\n          if (total.value <= options.value.length) {\n            return;\n          }\n          moreLoadingVisible.value = true;\n          pgIndex.value += 1;\n          options.value = await getOptions();\n          moreLoadingVisible.value = false;\n        });\n      });\n\n    return {\n      select,\n      loading,\n      remote,\n      options,\n      moreLoadingVisible,\n      popperClass: mForm?.popperClass,\n\n      getRequestFuc() {\n        return getConfig('request');\n      },\n\n      async getInitOption() {},\n\n      changeHandler(value: any) {\n        emit('change', value);\n      },\n\n      async visibleHandler(visible: boolean) {\n        if (!visible) return;\n\n        if (!props.config.remote) return;\n        if (query.value && select.value) {\n          select.value.query = query.value;\n          select.value.previousQuery = query.value;\n          select.value.selectedLabel = query.value;\n        } else if (options.value.length <= (props.config.multiple ? props.model?.[props.name].length : 1)) {\n          options.value = await getOptions();\n        }\n      },\n\n      async editAfterAction() {\n        pgIndex.value = 0;\n        options.value = await getOptions();\n      },\n\n      async remoteMethod(q: string) {\n        if (!localOptions.value.length) {\n          query.value = q;\n          pgIndex.value = 0;\n          options.value = await getOptions();\n          // 多选时如果过滤选项会导致已选好的标签异常，需要重新刷新一下el-select的状态\n          if (props.config.multiple)\n            setTimeout(() => {\n              select.value?.setSelected();\n            }, 0);\n        }\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-switch\n    v-if=\"model\"\n    v-model=\"model[n]\"\n    :size=\"size\"\n    :activeValue=\"activeValue\"\n    :inactiveValue=\"inactiveValue\"\n    :disabled=\"disabled\"\n    @change=\"changeHandler\"\n  ></el-switch>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType } from 'vue';\n\nimport { SwitchConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\nexport default defineComponent({\n  name: 'm-fields-switch',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<SwitchConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    return {\n      n: computed(() => props.name || props.config.name || ''),\n      activeValue: computed(() => {\n        if (typeof props.config.activeValue === 'undefined') {\n          if (props.config.filter === 'number') {\n            return 1;\n          }\n        } else {\n          return props.config.activeValue;\n        }\n\n        return true;\n      }),\n      inactiveValue: computed(() => {\n        if (typeof props.config.inactiveValue === 'undefined') {\n          if (props.config.filter === 'number') {\n            return 0;\n          }\n        } else {\n          return props.config.inactiveValue;\n        }\n\n        return false;\n      }),\n      changeHandler: (v: boolean | number | string) => {\n        emit('change', v);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-input\n    v-model=\"model[modelName]\"\n    clearable\n    :size=\"size\"\n    :placeholder=\"config.placeholder\"\n    :disabled=\"disabled\"\n    @change=\"changeHandler\"\n    @input=\"inputHandler\"\n    @keyup=\"keyUpHandler($event)\"\n  >\n    <template #append v-if=\"config.append\">\n      <span v-if=\"typeof config.append === 'string'\">{{ config.append }}</span>\n      <el-button\n        v-if=\"typeof config.append === 'object' && config.append.type === 'button'\"\n        style=\"color: #409eff\"\n        @click=\"buttonClickHandler\"\n      >\n        {{ config.append.text }}\n      </el-button>\n    </template>\n  </el-input>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, inject, PropType } from 'vue';\n\nimport { FormState, TextConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-text',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<TextConfig>,\n      required: true,\n    },\n  },\n\n  emits: ['change', 'input'],\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    const modelName = computed(() => props.name || props.config.name || '');\n    return {\n      modelName,\n\n      changeHandler(v: string | number) {\n        emit('change', v);\n      },\n\n      inputHandler(v: string | number) {\n        const mForm = inject<FormState | undefined>('mForm');\n        emit('input', v);\n        mForm?.$emit('field-input', props.prop, v);\n      },\n\n      buttonClickHandler() {\n        const mForm = inject<FormState | undefined>('mForm');\n\n        if (typeof props.config.append === 'string') return;\n\n        if (props.config.append?.handler) {\n          props.config.append.handler(mForm, {\n            model: props.model,\n            values: mForm?.values,\n          });\n        }\n      },\n\n      keyUpHandler($event: KeyboardEvent) {\n        if (!props.model) return;\n        if (!modelName.value) return;\n\n        const arrowUp = $event.key === 'ArrowUp';\n        const arrowDown = $event.key === 'ArrowDown';\n\n        if (!arrowUp && !arrowDown) {\n          return;\n        }\n\n        const value = props.model[modelName.value];\n        let num;\n        let unit;\n        if (/^([0-9.]+)$/.test(value)) {\n          num = +value;\n        } else {\n          value.replace(/^([0-9.]+)([a-z%]+)$/, ($0: string, $1: string, $2: string) => {\n            num = +$1;\n            unit = $2;\n          });\n        }\n\n        if (num === undefined) {\n          return;\n        }\n\n        const ctrl = navigator.platform.match('Mac') ? $event.metaKey : $event.ctrlKey;\n        const shif = $event.shiftKey;\n        const alt = $event.altKey;\n\n        if (arrowUp) {\n          if (ctrl) {\n            num += 100;\n          } else if (alt) {\n            num = (num * 10000 + 1000) / 10000;\n          } else if (shif) {\n            num = num + 10;\n          } else {\n            num += 1;\n          }\n        } else if (arrowDown) {\n          if (ctrl) {\n            num -= 100;\n          } else if (alt) {\n            num = (num * 10000 - 1000) / 10000;\n          } else if (shif) {\n            num -= 10;\n          } else {\n            num -= 1;\n          }\n        }\n\n        props.model[modelName.value] = `${num}${unit || ''}`;\n        emit('change', props.model[modelName.value]);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <div v-if=\"model\">\n    <el-input\n      v-model=\"model[name]\"\n      type=\"textarea\"\n      :size=\"size\"\n      clearable\n      :placeholder=\"config.placeholder\"\n      :disabled=\"disabled\"\n      @change=\"changeHandler\"\n      @input=\"inputHandler\"\n    >\n    </el-input>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, inject, PropType } from 'vue';\n\nimport { FormState, TextareaConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\nexport default defineComponent({\n  name: 'm-fields-textarea',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<TextareaConfig>,\n      required: true,\n    },\n  },\n\n  emits: {\n    change(values: string | number) {\n      return values;\n    },\n\n    input(values: string | number) {\n      return values;\n    },\n  },\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    const mForm = inject<FormState | null>('mForm');\n\n    return {\n      mForm,\n      changeHandler: (v: string) => {\n        emit('change', v);\n      },\n\n      inputHandler: (v: string) => {\n        emit('input', v);\n        mForm?.$emit('field-input', props.prop, v);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <div>\n    <el-time-picker\n      v-model=\"model[name]\"\n      :size=\"size\"\n      value-format=\"HH:mm:ss\"\n      :placeholder=\"config.placeholder\"\n      :disabled=\"disabled\"\n      @change=\"changeHandler\"\n    ></el-time-picker>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\n\nimport { TimeConfig } from '../schema';\nimport fieldProps from '../utils/fieldProps';\nimport { useAddField } from '../utils/useAddField';\n\nexport default defineComponent({\n  name: 'm-fields-time',\n\n  props: {\n    ...fieldProps,\n    config: {\n      type: Object as PropType<TimeConfig>,\n      required: true,\n    },\n  },\n\n  emits: {\n    change(values: Date) {\n      return values;\n    },\n  },\n\n  setup(props, { emit }) {\n    useAddField(props.prop);\n\n    return {\n      changeHandler: (v: Date) => {\n        emit('change', v);\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <el-form\n    class=\"m-form\"\n    ref=\"elForm\"\n    :model=\"values\"\n    :label-width=\"labelWidth\"\n    :disabled=\"disabled\"\n    :style=\"`height: ${height}`\"\n    :inline=\"inline\"\n    :label-position=\"labelPosition\"\n  >\n    <template v-if=\"initialized && Array.isArray(config)\">\n      <m-form-container\n        v-for=\"(item, index) in config\"\n        :key=\"item[keyProp] ?? index\"\n        :config=\"item\"\n        :model=\"values\"\n        :label-width=\"item.labelWidth || labelWidth\"\n        :step-active=\"stepActive\"\n        :size=\"size\"\n        @change=\"changeHandler\"\n      ></m-form-container>\n    </template>\n  </el-form>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType, provide, reactive, ref, toRaw, watch } from 'vue';\nimport { ElForm } from 'element-plus';\nimport { cloneDeep, isEqual } from 'lodash-es';\n\nimport { getConfig } from './utils/config';\nimport { initValue } from './utils/form';\nimport { FormConfig, FormState, FormValue } from './schema';\n\nexport interface ValidateError {\n  message: string;\n  field: string;\n}\n\nexport interface FieldErrorList {\n  [field: string]: ValidateError[];\n}\n\nexport default defineComponent({\n  name: 'm-form',\n\n  props: {\n    // 表单初始化值\n    initValues: {\n      type: Object,\n      required: true,\n      default: () => ({}),\n    },\n\n    parentValues: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    // 表单配置\n    config: {\n      type: Array as PropType<FormConfig>,\n      required: true,\n      default: () => [],\n    },\n\n    labelWidth: {\n      type: String,\n      default: () => '200px',\n    },\n\n    disabled: {\n      type: Boolean,\n      default: () => false,\n    },\n\n    height: {\n      type: String,\n      default: () => 'auto',\n    },\n\n    stepActive: {\n      type: [String, Number],\n      default: () => 1,\n    },\n\n    size: {\n      type: String,\n    },\n\n    inline: {\n      type: Boolean,\n      default: false,\n    },\n\n    labelPosition: {\n      type: String,\n      default: 'right',\n    },\n\n    keyProp: {\n      type: String,\n      default: '__key',\n    },\n\n    popperClass: {\n      type: String,\n    },\n  },\n\n  emits: ['change', 'field-input', 'field-change'],\n\n  setup(props, { emit }) {\n    const elForm = ref<InstanceType<typeof ElForm>>();\n    const initialized = ref(false);\n    const values = ref<FormValue>({});\n    const fields = new Map<string, any>();\n\n    const requestFuc = getConfig('request') as Function;\n\n    const formState: FormState = reactive<FormState>({\n      keyProp: props.keyProp,\n      popperClass: props.popperClass,\n      config: props.config,\n      initValues: props.initValues,\n      parentValues: props.parentValues,\n      values,\n      $emit: emit as (event: string, ...args: any[]) => void,\n      fields,\n      setField: (prop: string, field: any) => fields.set(prop, field),\n      getField: (prop: string) => fields.get(prop),\n      deleteField: (prop: string) => fields.delete(prop),\n      post: (options: any) => {\n        if (requestFuc) {\n          return requestFuc({\n            ...options,\n            method: 'POST',\n          });\n        }\n      },\n    });\n\n    provide('mForm', formState);\n\n    watch(\n      [() => props.config, () => props.initValues],\n      ([config], [preConfig]) => {\n        if (!isEqual(toRaw(config), toRaw(preConfig))) {\n          initialized.value = false;\n        }\n\n        initValue(formState, {\n          initValues: props.initValues,\n          config: props.config,\n        }).then((value) => {\n          values.value = value;\n          initialized.value = true;\n        });\n      },\n      { immediate: true },\n    );\n\n    return {\n      initialized,\n      values,\n      elForm,\n\n      formState,\n\n      changeHandler: () => {\n        emit('change', values.value);\n      },\n\n      resetForm: () => elForm.value?.resetFields(),\n\n      submitForm: async (native?: boolean): Promise<any> => {\n        try {\n          await elForm.value?.validate();\n          return native ? values.value : cloneDeep(values.value);\n        } catch (invalidFields: any) {\n          const error: string[] = [];\n\n          Object.entries(invalidFields).forEach(([, ValidateError]) => {\n            (ValidateError as ValidateError[]).forEach(({ field, message }) => {\n              if (field && message) error.push(`${field} -> ${message}`);\n              if (field && !message) error.push(`${field} -> 出现错误`);\n              if (!field && message) error.push(`${message}`);\n            });\n          });\n          throw new Error(error.join('<br>'));\n        }\n      },\n    };\n  },\n});\n</script>\n","<template>\n  <div>\n    <el-dialog\n      v-model=\"dialogVisible\"\n      custom-class=\"m-form-dialog\"\n      top=\"20px\"\n      :title=\"title\"\n      :appendToBody=\"true\"\n      :width=\"width\"\n      :fullscreen=\"fullscreen\"\n      :close-on-click-modal=\"false\"\n      @close=\"closeHandler\"\n    >\n      <div class=\"m-dialog-body\" :style=\"`max-height: ${bodyHeight}; overflow-y: auto; overflow-x: hidden;`\">\n        <m-form\n          v-model=\"stepActive\"\n          ref=\"form\"\n          :size=\"size\"\n          :config=\"config\"\n          :init-values=\"values\"\n          :label-width=\"labelWidth\"\n          @change=\"changeHandler\"\n        ></m-form>\n        <slot></slot>\n      </div>\n\n      <template #footer>\n        <el-row class=\"dialog-footer\">\n          <el-col :span=\"12\" style=\"text-align: left\">\n            <div style=\"min-height: 1px\">\n              <slot name=\"left\"></slot>\n            </div>\n          </el-col>\n          <el-col :span=\"12\">\n            <slot name=\"footer\">\n              <el-button @click=\"cancel\" size=\"small\">取 消</el-button>\n              <el-button v-if=\"hasStep && stepActive > 1\" type=\"info\" size=\"small\" @click=\"preStep\">上一步</el-button>\n              <el-button v-if=\"hasStep && stepCount > stepActive\" type=\"info\" size=\"small\" @click=\"nextStep\"\n                >下一步</el-button\n              >\n              <el-button v-else type=\"primary\" size=\"small\" :loading=\"saveFetch\" @click=\"save\">{{\n                confirmText\n              }}</el-button>\n            </slot>\n          </el-col>\n        </el-row>\n      </template>\n    </el-dialog>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, PropType, ref } from 'vue';\n\nimport Form from './Form.vue';\nimport { FormConfig, StepConfig } from './schema';\n\nexport default defineComponent({\n  name: 'm-form-dialog',\n\n  props: {\n    values: {\n      type: Object,\n      default: () => ({}),\n    },\n\n    width: [Number, String],\n\n    fullscreen: Boolean,\n\n    title: String,\n\n    config: {\n      type: Array as PropType<FormConfig>,\n      required: true,\n      default: () => [],\n    },\n\n    labelWidth: [Number, String],\n\n    size: String as PropType<'mini' | 'small' | 'medium'>,\n\n    confirmText: {\n      type: String,\n      default: '确定',\n    },\n  },\n\n  emits: ['close', 'submit', 'error', 'change'],\n\n  setup(props, { emit }) {\n    const form = ref<InstanceType<typeof Form>>();\n    const dialogVisible = ref(false);\n    const saveFetch = ref(false);\n    const stepActive = ref(1);\n    const bodyHeight = ref(`${document.body.clientHeight - 194}px`);\n\n    const stepCount = computed(() => {\n      const { length } = props.config;\n      for (let index = 0; index < length; index++) {\n        if (props.config[index].type === 'step') {\n          return (props.config[index] as StepConfig).items.length;\n        }\n      }\n      return 0;\n    });\n\n    const hasStep = computed(() => {\n      const { length } = props.config;\n      for (let index = 0; index < length; index++) {\n        if (props.config[index].type === 'step') {\n          return true;\n        }\n      }\n\n      return false;\n    });\n\n    const cancel = () => {\n      dialogVisible.value = false;\n    };\n\n    const closeHandler = () => {\n      stepActive.value = 1;\n      emit('close');\n    };\n\n    const save = async () => {\n      try {\n        const values = await form.value?.submitForm();\n        emit('submit', values);\n      } catch (e) {\n        emit('error', e);\n      }\n    };\n\n    const preStep = () => {\n      stepActive.value -= 1;\n    };\n\n    const nextStep = () => {\n      stepActive.value += 1;\n    };\n\n    const changeHandler = (value: any) => {\n      emit('change', value);\n    };\n\n    return {\n      form,\n      saveFetch,\n      stepActive,\n      dialogVisible,\n      bodyHeight,\n      stepCount,\n      hasStep,\n      cancel,\n      closeHandler,\n      save,\n      preStep,\n      nextStep,\n      changeHandler,\n    };\n  },\n});\n</script>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { App } from 'vue';\n\nimport Container from './containers/Container.vue';\nimport Fieldset from './containers/Fieldset.vue';\nimport GroupList from './containers/GroupList.vue';\nimport Panel from './containers/Panel.vue';\nimport Row from './containers/Row.vue';\nimport MStep from './containers/Step.vue';\nimport Table from './containers/Table.vue';\nimport Tabs from './containers/Tabs.vue';\nimport Cascader from './fields/Cascader.vue';\nimport Checkbox from './fields/Checkbox.vue';\nimport CheckboxGroup from './fields/CheckboxGroup.vue';\nimport ColorPicker from './fields/ColorPicker.vue';\nimport Date from './fields/Date.vue';\nimport Daterange from './fields/Daterange.vue';\nimport DateTime from './fields/DateTime.vue';\nimport Display from './fields/Display.vue';\nimport DynamicField from './fields/DynamicField.vue';\nimport Hidden from './fields/Hidden.vue';\nimport Link from './fields/Link.vue';\nimport Number from './fields/Number.vue';\nimport RadioGroup from './fields/RadioGroup.vue';\nimport Select from './fields/Select.vue';\nimport Switch from './fields/Switch.vue';\nimport Text from './fields/Text.vue';\nimport Textarea from './fields/Textarea.vue';\nimport Time from './fields/Time.vue';\nimport { setConfig } from './utils/config';\nimport Form from './Form.vue';\nimport FormDialog from './FormDialog.vue';\n\nimport './theme/index.scss';\n\nexport * from './schema';\nexport * from './utils/form';\nexport * from './utils/useAddField';\nexport { default as fieldProps } from './utils/fieldProps';\n\nexport { default as MForm } from './Form.vue';\nexport { default as MFormDialog } from './FormDialog.vue';\nexport { default as MContainer } from './containers/Container.vue';\nexport { default as MFieldset } from './containers/Fieldset.vue';\nexport { default as MPanel } from './containers/Panel.vue';\nexport { default as MRow } from './containers/Row.vue';\nexport { default as MTabs } from './containers/Tabs.vue';\nexport { default as MTable } from './containers/Table.vue';\nexport { default as MGroupList } from './containers/GroupList.vue';\nexport { default as MText } from './fields/Text.vue';\nexport { default as MNumber } from './fields/Number.vue';\nexport { default as MTextarea } from './fields/Textarea.vue';\nexport { default as MHidden } from './fields/Hidden.vue';\nexport { default as MDate } from './fields/Date.vue';\nexport { default as MDateTime } from './fields/DateTime.vue';\nexport { default as MTime } from './fields/Time.vue';\nexport { default as MCheckbox } from './fields/Checkbox.vue';\nexport { default as MSwitch } from './fields/Switch.vue';\nexport { default as MDaterange } from './fields/Daterange.vue';\nexport { default as MColorPicker } from './fields/ColorPicker.vue';\nexport { default as MCheckboxGroup } from './fields/CheckboxGroup.vue';\nexport { default as MRadioGroup } from './fields/RadioGroup.vue';\nexport { default as MDisplay } from './fields/Display.vue';\nexport { default as MLink } from './fields/Link.vue';\nexport { default as MSelect } from './fields/Select.vue';\nexport { default as MCascader } from './fields/Cascader.vue';\nexport { default as MDynamicField } from './fields/DynamicField.vue';\n\nconst defaultInstallOpt = {};\n\nconst install = (app: App, opt: any) => {\n  const option = Object.assign(defaultInstallOpt, opt);\n\n  // eslint-disable-next-line no-param-reassign\n  app.config.globalProperties.$MAGIC_FORM = option;\n  setConfig(option);\n\n  app.component(Form.name, Form);\n  app.component(FormDialog.name, FormDialog);\n  app.component(Container.name, Container);\n  app.component(Fieldset.name, Fieldset);\n  app.component(GroupList.name, GroupList);\n  app.component(Panel.name, Panel);\n  app.component(Row.name, Row);\n  app.component(MStep.name, MStep);\n  app.component(Table.name, Table);\n  app.component(Tabs.name, Tabs);\n  app.component(Text.name, Text);\n  app.component(Number.name, Number);\n  app.component(Textarea.name, Textarea);\n  app.component(Hidden.name, Hidden);\n  app.component(Date.name, Date);\n  app.component(DateTime.name, DateTime);\n  app.component(Time.name, Time);\n  app.component(Checkbox.name, Checkbox);\n  app.component(Switch.name, Switch);\n  app.component(Daterange.name, Daterange);\n  app.component(ColorPicker.name, ColorPicker);\n  app.component(CheckboxGroup.name, CheckboxGroup);\n  app.component(RadioGroup.name, RadioGroup);\n  app.component(Display.name, Display);\n  app.component(Link.name, Link);\n  app.component(Select.name, Select);\n  app.component(Cascader.name, Cascader);\n  app.component(DynamicField.name, DynamicField);\n};\n\nexport default {\n  install,\n};\n","<template>\n  <el-table-column :label=\"config.label\" :width=\"config.width\" :fixed=\"config.fixed\">\n    <template v-slot=\"scope\">\n      <el-button\n        v-for=\"(action, actionIndex) in config.actions\"\n        v-show=\"display(action.display, scope.row) && !editState[scope.$index]\"\n        v-html=\"action.text\"\n        class=\"action-btn\"\n        type=\"text\"\n        size=\"small\"\n        :key=\"actionIndex\"\n        @click=\"actionHandler(action, scope.row, scope.$index)\"\n      ></el-button>\n      <el-button\n        class=\"action-btn\"\n        v-show=\"editState[scope.$index]\"\n        type=\"text\"\n        size=\"small\"\n        @click=\"save(scope.$index, config)\"\n        >保存</el-button\n      >\n      <el-button\n        class=\"action-btn\"\n        v-show=\"editState[scope.$index]\"\n        type=\"text\"\n        size=\"small\"\n        @click=\"editState[scope.$index] = undefined\"\n        >取消</el-button\n      >\n    </template>\n  </el-table-column>\n</template>\n\n<script lang=\"ts\">\nimport { PropType } from 'vue';\nimport { ElMessage, ElMessageBox } from 'element-plus';\n\nimport { ColumnActionConfig, ColumnConfig } from './schema';\n</script>\n\n<script lang=\"ts\" setup>\nconst props = defineProps({\n  columns: {\n    type: Array as PropType<any[]>,\n    require: true,\n    default: () => [],\n  },\n\n  config: {\n    type: Object as PropType<ColumnConfig>,\n    require: true,\n    default: () => {},\n  },\n\n  rowkeyName: {\n    type: String,\n    default: 'c_id',\n  },\n\n  editState: {\n    type: Object,\n    default: () => {},\n  },\n});\n\nconst emit = defineEmits(['afterAction']);\n\nconst display = (fuc: boolean | Function | undefined, row: any) => {\n  if (typeof fuc === 'function') {\n    return fuc.call(this, this, row);\n  }\n  return true;\n};\n\nconst success = (msg: string, action: ColumnActionConfig) => {\n  ElMessage.success(msg);\n  action.after?.();\n};\n\nconst error = (msg: string) => ElMessage.error(msg);\n\nconst deleteAction = async (action: ColumnActionConfig, row: any) => {\n  await ElMessageBox.confirm(`确认删除${row[action.name || 'c_name']}(${row[props.rowkeyName]})?`, '提示', {\n    confirmButtonText: '确定',\n    cancelButtonText: '取消',\n    type: 'warning',\n  });\n\n  const res = await action.handler?.(row);\n\n  if (res.ret === 0) {\n    success('删除成功!', action);\n  } else {\n    error(res.msg || '删除失败');\n  }\n};\n\nconst copyHandler = async (action: ColumnActionConfig, row: any) => {\n  await ElMessageBox.confirm(`确定复制${row[action.name || 'c_name']}(${row.c_id})?`, '提示', {\n    confirmButtonText: '确定',\n    cancelButtonText: '取消',\n    type: 'warning',\n  });\n\n  try {\n    const res = await action.handler?.(row);\n\n    if (res.ret === 0) {\n      success('复制成功!', action);\n    } else {\n      error(`复制失败!${res.msg}`);\n    }\n  } catch (e) {\n    error('复制失败!');\n  }\n};\n\nconst actionHandler = async (action: ColumnActionConfig, row: any, index: number) => {\n  if (action.type === 'delete') {\n    await deleteAction(action, row);\n  } else if (action.type === 'copy') {\n    await copyHandler(action, row);\n  } else if (action.type === 'edit') {\n    props.editState[index] = row;\n  } else {\n    await action.handler?.(row);\n    action.after?.();\n  }\n};\n\nconst save = async (index: number, config: ColumnConfig) => {\n  const action = config.actions?.find((item) => item.type === 'edit')?.action;\n  if (!action) return;\n\n  const data: any = {};\n  const row = props.editState[index];\n  props.columns\n    .filter((item) => item.type)\n    .forEach((column) => {\n      data[column.prop] = row[column.prop];\n    });\n\n  const res: any = await action({\n    data,\n  });\n\n  if (res) {\n    if (res.ret === 0) {\n      ElMessage.success('保存成功');\n      props.editState[index] = undefined;\n      emit('afterAction');\n    } else {\n      ElMessage.error({\n        duration: 10000,\n        showClose: true,\n        dangerouslyUseHTMLString: true,\n        message: res.msg || '保存失败',\n      });\n    }\n  } else {\n    props.editState[index] = undefined;\n    emit('afterAction');\n  }\n};\n</script>\n","<template>\n  <el-table-column type=\"expand\">\n    <template #default=\"scope\">\n      <m-table\n        v-if=\"config.table\"\n        :show-header=\"false\"\n        :columns=\"config.table\"\n        :data=\"scope.row[config.prop]\"\n      ></m-table>\n      <m-form\n        v-if=\"config.form\"\n        :config=\"config.form\"\n        :init-values=\"config.values || scope.row[config.prop] || {}\"\n      ></m-form>\n    </template>\n  </el-table-column>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\n\nimport { MForm } from '@tmagic/form';\n\nimport { ColumnConfig } from './schema';\n\nexport default defineComponent({\n  components: { MForm },\n\n  props: {\n    config: {\n      type: Object as PropType<ColumnConfig>,\n      default: () => ({}),\n      required: true,\n    },\n  },\n});\n</script>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { datetimeFormatter } from '@tmagic/utils';\n\nimport { ColumnConfig } from './schema';\n\nexport const formatter = (item: ColumnConfig, row: any) => {\n  if (item.formatter) {\n    if (item.formatter === 'datetime') {\n      // eslint-disable-next-line no-param-reassign\n      item.formatter = (value: string) => datetimeFormatter(value);\n    }\n    try {\n      return item.formatter(row[item.prop], row);\n    } catch (e) {\n      return row[item.prop];\n    }\n  } else {\n    return row[item.prop];\n  }\n};\n","<template>\n  <el-table-column :label=\"config.label\" :width=\"config.width\" :fixed=\"config.fixed\">\n    <template v-slot=\"scope\">\n      <el-popover :placement=\"config.popover.placement\" :width=\"config.popover.width\" :trigger=\"config.popover.trigger\">\n        <m-table\n          v-if=\"config.popover.tableEmbed\"\n          :show-header=\"config.showHeader\"\n          :columns=\"config.table\"\n          :data=\"scope.row[config.prop]\"\n        ></m-table>\n        <template #reference>\n          <el-button type=\"text\"> {{ config.text || formatter(config, scope.row) }}</el-button>\n        </template>\n      </el-popover>\n    </template>\n  </el-table-column>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\n\nimport { ColumnConfig } from './schema';\nimport { formatter } from './utils';\n\nexport default defineComponent({\n  props: {\n    config: {\n      type: Object as PropType<ColumnConfig>,\n      default: () => ({}),\n      required: true,\n    },\n  },\n\n  setup() {\n    return {\n      formatter,\n    };\n  },\n});\n</script>\n","<template>\n  <el-table-column\n    show-overflow-tooltip\n    :label=\"config.label\"\n    :width=\"config.width\"\n    :fixed=\"config.fixed\"\n    :sortable=\"config.sortable\"\n    :prop=\"config.prop\"\n  >\n    <template v-slot=\"scope\">\n      <el-form v-if=\"config.type && editState[scope.$index]\" label-width=\"0\" :model=\"editState[scope.$index]\">\n        <m-form-container\n          :prop=\"config.prop\"\n          :rules=\"config.rules\"\n          :config=\"config\"\n          :name=\"config.prop\"\n          :model=\"editState[scope.$index]\"\n        ></m-form-container>\n      </el-form>\n\n      <el-button v-else-if=\"config.action === 'actionLink'\" type=\"text\" @click=\"config.handler(scope.row)\">\n        {{ formatter(config, scope.row) }}\n      </el-button>\n\n      <a v-else-if=\"config.action === 'img'\" target=\"_blank\" :href=\"scope.row[config.prop]\"\n        ><img :src=\"scope.row[config.prop]\" height=\"50\"\n      /></a>\n\n      <a v-else-if=\"config.action === 'link'\" target=\"_blank\" :href=\"scope.row[config.prop]\" class=\"keep-all\">{{\n        scope.row[config.prop]\n      }}</a>\n\n      <el-tooltip v-else-if=\"config.action === 'tip'\" placement=\"left\">\n        <template #content>\n          <div>{{ formatter(config, scope.row) }}</div>\n        </template>\n        <el-button type=\"text\">扩展配置</el-button>\n      </el-tooltip>\n\n      <el-tag\n        v-else-if=\"config.action === 'tag'\"\n        :type=\"typeof config.type === 'function' ? config.type(scope.row[config.prop], scope.row) : config.type\"\n        close-transition\n        >{{ formatter(config, scope.row) }}</el-tag\n      >\n      <div v-else v-html=\"formatter(config, scope.row)\"></div>\n    </template>\n  </el-table-column>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\n\nimport { ColumnConfig } from './schema';\nimport { formatter } from './utils';\n\nexport default defineComponent({\n  props: {\n    config: {\n      type: Object as PropType<ColumnConfig>,\n      default: () => ({}),\n      required: true,\n    },\n\n    editState: {\n      type: Object,\n      default: () => {},\n    },\n  },\n\n  setup() {\n    return {\n      formatter,\n    };\n  },\n});\n</script>\n","<template>\n  <el-table\n    :data=\"tableData\"\n    :show-header=\"showHeader\"\n    :max-height=\"bodyHeight\"\n    tooltip-effect=\"dark\"\n    class=\"m-table\"\n    ref=\"table\"\n    :default-expand-all=\"defaultExpandAll\"\n    :border=\"hasBorder\"\n    :row-key=\"rowkeyName || 'c_id'\"\n    :tree-props=\"{ children: 'children' }\"\n    :empty-text=\"emptyText || '暂无数据'\"\n    :span-method=\"objectSpanMethod\"\n    @sort-change=\"sortChange\"\n    @select=\"selectHandler\"\n    @select-all=\"selectAllHandler\"\n    @selection-change=\"selectionChangeHandler\"\n  >\n    <template v-for=\"(item, columnIndex) in columns\">\n      <template v-if=\"item.type === 'expand'\">\n        <expand-column :config=\"item\" :key=\"columnIndex\"></expand-column>\n      </template>\n\n      <template v-if=\"item.selection\">\n        <el-table-column type=\"selection\" :key=\"columnIndex\" width=\"40\" :selectable=\"item.selectable\"></el-table-column>\n      </template>\n\n      <template v-else-if=\"item.actions\">\n        <actions-column\n          :columns=\"columns\"\n          :config=\"item\"\n          :rowkey-name=\"rowkeyName\"\n          :edit-state=\"editState\"\n          :key=\"columnIndex\"\n          @afterAction=\"$emit('afterAction')\"\n        ></actions-column>\n      </template>\n\n      <template v-else-if=\"item.type === 'popover'\">\n        <popover-column :key=\"columnIndex\" :config=\"item\"></popover-column>\n      </template>\n\n      <template v-else>\n        <text-column :key=\"columnIndex\" :config=\"item\" :edit-state=\"editState\"></text-column>\n      </template>\n    </template>\n  </el-table>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, PropType } from 'vue';\nimport { ElTable } from 'element-plus';\nimport { cloneDeep } from 'lodash-es';\n\nimport ActionsColumn from './ActionsColumn.vue';\nimport ExpandColumn from './ExpandColumn.vue';\nimport PopoverColumn from './PopoverColumn.vue';\nimport TextColumn from './TextColumn.vue';\n\nexport default defineComponent({\n  name: 'm-table',\n\n  components: { ExpandColumn, ActionsColumn, PopoverColumn, TextColumn },\n\n  props: {\n    data: {\n      type: Array,\n      require: true,\n    },\n\n    columns: {\n      type: Array as PropType<any[]>,\n      require: true,\n      default: () => [],\n    },\n\n    /** 合并行或列的计算方法 */\n    spanMethod: {\n      type: Function as PropType<\n        (data: { row: any; column: any; rowIndex: number; columnIndex: number }) => [number, number]\n      >,\n    },\n\n    fetch: {\n      type: Boolean,\n      default: false,\n    },\n\n    /** Table 的最大高度。合法的值为数字或者单位为 px 的高度 */\n    bodyHeight: {\n      type: [String, Number],\n    },\n\n    /** 是否显示表头 */\n    showHeader: {\n      type: Boolean,\n    },\n\n    /** 空数据时显示的文本内容 */\n    emptyText: {\n      type: String,\n    },\n\n    /** 是否默认展开所有行，当 Table 包含展开行存在或者为树形表格时有效 */\n    defaultExpandAll: {\n      type: Boolean,\n      default: false,\n    },\n\n    rowkeyName: {\n      type: String,\n    },\n\n    /** 是否带有纵向边框 */\n    border: {\n      type: Boolean,\n      default: false,\n    },\n  },\n\n  emits: ['sort-change', 'afterAction', 'select', 'select-all', 'selection-change'],\n\n  data(): {\n    editState: any[];\n  } {\n    return {\n      editState: [],\n    };\n  },\n\n  computed: {\n    tableData() {\n      if (this.selectionColumn) {\n        return this.data || [];\n      }\n\n      return cloneDeep(this.data) || [];\n    },\n\n    selectionColumn() {\n      const column = this.columns.filter((item) => item.selection);\n      return column.length ? column[0] : null;\n    },\n\n    hasBorder() {\n      return typeof this.border !== 'undefined' ? this.border : true;\n    },\n  },\n\n  methods: {\n    sortChange(data: any) {\n      this.$emit('sort-change', data);\n    },\n\n    selectHandler(selection: any, row: any) {\n      const column = this.selectionColumn;\n      if (!column) {\n        return;\n      }\n\n      if (column.selection === 'single') {\n        // this.clearSelection()\n        // this.toggleRowSelection(row, true)\n      }\n      this.$emit('select', selection, row);\n    },\n\n    selectAllHandler(selection: any) {\n      this.$emit('select-all', selection);\n    },\n\n    selectionChangeHandler(selection: any) {\n      this.$emit('selection-change', selection);\n    },\n\n    toggleRowSelection(row: any, selected: boolean) {\n      const table = this.$refs.table as InstanceType<typeof ElTable>;\n      table.toggleRowSelection.bind(table)(row, selected);\n    },\n\n    toggleRowExpansion(row: any, expanded: boolean) {\n      const table = this.$refs.table as InstanceType<typeof ElTable>;\n      table.toggleRowExpansion.bind(table)(row, expanded);\n    },\n\n    clearSelection() {\n      const table = this.$refs.table as InstanceType<typeof ElTable>;\n      table.clearSelection.bind(table)();\n    },\n\n    objectSpanMethod(data: any) {\n      if (typeof this.spanMethod === 'function') {\n        return this.spanMethod(data);\n      }\n      return () => ({\n        rowspan: 0,\n        colspan: 0,\n      });\n    },\n  },\n});\n</script>\n\n<style lang=\"scss\">\n.m-table {\n  .el-button.action-btn {\n    margin-right: 10px;\n  }\n  .el-button.action-btn + .el-button.action-btn {\n    margin-left: 0;\n  }\n  .keep-all {\n    word-break: keep-all;\n  }\n  .el-table .cell > div {\n    display: inline-block;\n    vertical-align: middle;\n  }\n  .el-table__row.el-table__row--level-1 {\n    color: #999;\n  }\n}\n</style>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { App } from 'vue';\n\nimport Table from './Table.vue';\n\nexport { default as MagicTable } from './Table.vue';\n\nconst components = [Table];\n\nexport default {\n  install(app: App) {\n    components.forEach((component) => {\n      app.component(component.name, component);\n    });\n  },\n};\n","<template>\n  <router-view></router-view>\n</template>\n\n<script>\nexport default {\n  name: 'App',\n};\n</script>\n\n<style lang=\"scss\">\nhtml,\nbody,\n#app {\n  padding: 0;\n  margin: 0;\n  width: 100%;\n  height: 100%;\n}\n</style>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nexport default {\n  id: '75f0extui9d7yksklx27hff8xg',\n  name: 'test',\n  type: 'app',\n  items: [\n    {\n      type: 'page',\n      id: 'page_299',\n      name: 'index',\n      title: '',\n      layout: 'absolute',\n      style: {\n        position: 'relative',\n        left: 0,\n        top: 0,\n        right: '',\n        bottom: '',\n        width: '375',\n        height: '1728',\n        backgroundImage: '',\n        backgroundColor: 'rgba(248, 218, 218, 1)',\n        backgroundRepeat: 'no-repeat',\n        backgroundSize: '100% 100%',\n      },\n      events: [],\n      created: '',\n      items: [\n        {\n          id: 'container_3001',\n          style: {\n            left: 0,\n            top: 175,\n            width: 375,\n            height: 100,\n            position: 'absolute',\n          },\n          type: 'container',\n          name: '组',\n          items: [\n            {\n              id: 'button_5137',\n              style: {\n                left: 57,\n                top: 31,\n                width: 270,\n                height: 38,\n                position: 'absolute',\n                border: 0,\n                backgroundColor: '#fb6f00',\n              },\n              type: 'button',\n              name: '按钮',\n              text: '请输入文本内容',\n              multiple: true,\n            },\n          ],\n        },\n      ],\n    },\n  ],\n};\n","<template>\n  <div class=\"editor-app\">\n    <m-editor\n      v-model=\"value\"\n      ref=\"editor\"\n      :menu=\"menu\"\n      :runtime-url=\"runtimeUrl\"\n      :props-configs=\"propsConfigs\"\n      :props-values=\"propsValues\"\n      :event-method-list=\"eventMethodList\"\n      :component-group-list=\"componentGroupList\"\n      :default-selected=\"defaultSelected\"\n      :moveable-options=\"moveableOptions\"\n    ></m-editor>\n\n    <el-dialog v-model=\"previewVisible\" destroy-on-close :width=\"375\" custom-class=\"pre-viewer\" title=\"预览\">\n      <iframe\n        v-if=\"previewVisible\"\n        width=\"100%\"\n        height=\"817\"\n        :src=\"`${RUNTIME_PATH}/page.html?localPreview=1&page=${editor?.editorService.get('page').id}`\"\n      ></iframe>\n    </el-dialog>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, toRaw } from 'vue';\nimport { Coin, Connection, Document, FolderOpened, SwitchButton, Tickets } from '@element-plus/icons';\nimport { ElMessage } from 'element-plus';\nimport serialize from 'serialize-javascript';\n\nimport type { MenuBarData, MoveableOptions, TMagicEditor } from '@tmagic/editor';\nimport StageCore from '@tmagic/stage';\nimport { asyncLoadJs } from '@tmagic/utils';\n\nimport config from '../config';\n\nconst RUNTIME_PATH = '/tmagic-editor/playground/runtime/vue3';\n\nexport default defineComponent({\n  name: 'EditorApp',\n\n  setup() {\n    const editor = ref<InstanceType<typeof TMagicEditor>>();\n    const previewVisible = ref(false);\n    const value = ref(config);\n    const defaultSelected = ref(config.items[0].id);\n    const propsValues = ref<Record<string, any>>({});\n    const propsConfigs = ref<Record<string, any>>({});\n    const eventMethodList = ref<Record<string, any>>({});\n    const menu: MenuBarData = {\n      left: [\n        {\n          type: 'text',\n          text: '魔方',\n        },\n      ],\n      center: ['delete', 'undo', 'redo', 'guides', 'rule', 'zoom'],\n      right: [\n        {\n          type: 'button',\n          text: '预览',\n          icon: Connection,\n          handler: () => {\n            previewVisible.value = true;\n          },\n        },\n        {\n          type: 'button',\n          text: '保存',\n          icon: Coin,\n          handler: (service) => {\n            localStorage.setItem(\n              'magicUiConfig',\n              serialize(toRaw(value.value), {\n                space: 2,\n                unsafe: true,\n              }).replace(/\"(\\w+)\":\\s/g, '$1: '),\n            );\n            service?.editorService.resetModifiedNodeId();\n            ElMessage.success('保存成功');\n          },\n        },\n        '/',\n        {\n          type: 'button',\n          icon: Document,\n          tooltip: '源码',\n          handler: (service) => service?.uiService.set('showSrc', !service?.uiService.get('showSrc')),\n        },\n      ],\n    };\n\n    asyncLoadJs(`${RUNTIME_PATH}/assets/config.js`).then(() => {\n      propsConfigs.value = (globalThis as any).magicPresetConfigs;\n    });\n    asyncLoadJs(`${RUNTIME_PATH}/assets/value.js`).then(() => {\n      propsValues.value = (globalThis as any).magicPresetValues;\n    });\n    asyncLoadJs(`${RUNTIME_PATH}/assets/event.js`).then(() => {\n      eventMethodList.value = (globalThis as any).magicPresetEvents;\n    });\n\n    return {\n      RUNTIME_PATH,\n\n      editor,\n      menu,\n      value,\n      defaultSelected,\n      propsValues,\n      propsConfigs,\n      eventMethodList,\n\n      previewVisible,\n\n      runtimeUrl: `${RUNTIME_PATH}/playground.html`,\n\n      componentGroupList: ref([\n        {\n          title: '示例容器',\n          items: [\n            {\n              icon: FolderOpened,\n              text: '组',\n              type: 'container',\n            },\n          ],\n        },\n        {\n          title: '示例组件',\n          items: [\n            {\n              icon: Tickets,\n              text: '文本',\n              type: 'text',\n            },\n            {\n              icon: SwitchButton,\n              text: '按钮',\n              type: 'button',\n            },\n          ],\n        },\n      ]),\n\n      moveableOptions: (core?: StageCore): MoveableOptions => {\n        const options: MoveableOptions = {};\n        const id = core?.dr?.target?.id;\n\n        if (!id || !editor.value) return options;\n\n        const node = editor.value.editorService.getNodeById(id);\n\n        if (!node) return options;\n\n        const isPage = node.type === 'page';\n\n        options.draggable = !isPage;\n        options.resizable = !isPage;\n\n        return options;\n      },\n    };\n  },\n});\n</script>\n\n<style lang=\"scss\">\n#app {\n  width: 100%;\n  height: 100%;\n  display: flex;\n}\n\n.editor-app {\n  width: 100%;\n  height: 100%;\n\n  .m-editor {\n    flex: 1;\n    height: 100%;\n  }\n\n  .el-overlay-dialog {\n    display: flex;\n  }\n\n  .pre-viewer {\n    margin: auto;\n\n    .el-dialog__body {\n      padding: 0;\n    }\n  }\n}\n</style>\n","<template>\n  <div style=\"padding: 20px\">\n    <m-form ref=\"form\" :config=\"config\" :init-values=\"initValue\" size=\"small\"></m-form>\n    <el-button @click=\"submit\">提交</el-button>\n    <el-dialog v-model=\"resultVisible\" title=\"result\">\n      <pre><code class=\"language-javascript hljs\" v-html=\"result\"></code></pre>\n    </el-dialog>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue';\nimport { ElMessage } from 'element-plus';\n\nimport { MForm } from '@tmagic/form';\n\nexport default defineComponent({\n  name: 'App',\n  data() {\n    return {\n      resultVisible: false,\n      result: '',\n\n      config: [\n        {\n          text: '文本',\n          name: 'text',\n          tooltip: (vm: any, { model }: any) => model.text,\n          extra: (vm: any, { model }: any) => `${model.text}extra`,\n          rules: [{ required: true, message: '请输入活动名称', trigger: 'blur' }],\n        },\n        {\n          type: 'checkbox',\n          text: 'checkbox',\n          name: 'option',\n          activeValue: 1,\n          inactiveValue: 0,\n          defaultValue: 1,\n        },\n        {\n          type: 'link',\n          displayText: '链接',\n          text: 'link',\n          name: 'link',\n          href: '',\n          tooltip: 'element-ui',\n        },\n        {\n          type: 'display',\n          text: '展示',\n          name: 'display',\n          initValue: 'display',\n          tooltip: 'hello',\n        },\n        {\n          type: 'number',\n          text: '计数器',\n          name: 'number',\n        },\n        {\n          type: 'textarea',\n          text: '输入框',\n          name: 'textarea1',\n        },\n        {\n          type: 'datetime',\n          text: '日期',\n          name: 'datetime',\n        },\n        {\n          type: 'switch',\n          text: '开关',\n          name: 'switch',\n          filter: 'number',\n          defaultValue: 1,\n        },\n        {\n          type: 'daterange',\n          text: '日期范围',\n          name: 'daterange',\n          // names: ['one', 'two'],\n        },\n        {\n          type: 'time',\n          text: '日期选择',\n          name: 'time',\n        },\n        {\n          type: 'colorPicker',\n          text: '取色器',\n          name: 'colorPicker',\n        },\n        {\n          type: 'checkbox-group',\n          text: '选项组',\n          name: 'checkGroup',\n          options: [\n            {\n              value: 1,\n              text: 'one',\n            },\n            {\n              value: 2,\n              text: 'two',\n            },\n          ],\n        },\n        {\n          type: 'radio-group',\n          text: '单选框',\n          name: 'radioGroup',\n          options: [\n            {\n              value: 1,\n              text: 'one',\n            },\n            {\n              value: 2,\n              text: 'two',\n            },\n          ],\n        },\n        {\n          type: 'cascader',\n          text: '级联选择',\n          placeholder: 'test',\n          name: 'cascader',\n          options: [\n            {\n              value: 1,\n              label: 'one',\n              children: [\n                {\n                  value: 3,\n                  label: 'three',\n                  children: [\n                    {\n                      value: 8,\n                      label: 'eight',\n                    },\n                  ],\n                },\n                {\n                  value: 4,\n                  label: 'four',\n                },\n                {\n                  value: 6,\n                  label: 'six',\n                },\n              ],\n            },\n            {\n              value: 2,\n              label: 'two',\n              children: [\n                {\n                  value: 5,\n                  label: 'five',\n                },\n                {\n                  value: 7,\n                  label: 'seven',\n                },\n              ],\n            },\n          ],\n        },\n        {\n          type: 'dynamic-field',\n          name: 'dynamic-field',\n          dynamicKey: 'textarea',\n          text: '动态表单',\n          returnFields: () => [{ name: 'one', label: 'number', defaultValue: 'yes' }],\n        },\n        {\n          type: 'row',\n          items: [\n            {\n              type: 'date',\n              text: '日期',\n              name: 'date',\n            },\n            {\n              type: 'checkbox',\n              text: '多选框',\n              name: 'checkbox',\n              tooltip: '分组xxxxxxxxxxxx',\n              extra: 'extra',\n            },\n          ],\n        },\n        {\n          type: 'fieldset',\n          name: 'fieldset',\n          text: '分组',\n          extra: 'extra',\n          checkbox: true,\n          expand: 'checkbox',\n          // schematic: 'https://vfiles.gtimg.cn/vupload/20210329/9712631617027075445.png',\n          items: [\n            {\n              type: 'select',\n              text: '下拉选项',\n              name: 'select',\n              options: [\n                { text: '选项1', value: 1 },\n                { text: '选项2', value: 2 },\n              ],\n            },\n          ],\n        },\n        {\n          type: 'table',\n          name: 'table',\n          defautSort: { prop: 'name', order: 'descending' },\n          extra: 'extra',\n          itemExtra: (vm: any, { model }: any): any => `${model.text}itemExtra`,\n          items: [\n            {\n              label: 'id',\n              name: 'id',\n              sortable: true,\n              tooltip: '分组xxxxxxxxxxxx',\n              rules: [{ required: true, message: '请输入活动名称', trigger: 'blur' }],\n            },\n            {\n              label: '名称',\n              name: 'name',\n            },\n          ],\n        },\n        {\n          type: 'groupList',\n          name: 'groupList',\n          extra: '分组xxxxxxxxxxxx',\n          itemExtra: (vm: any, { model }: any) => `${model.name}extra`,\n          items: [\n            {\n              text: 'id',\n              name: 'id',\n              rules: [{ required: true, message: '请输入活动名称', trigger: 'blur' }],\n            },\n            {\n              text: '名称',\n              name: 'name',\n            },\n          ],\n        },\n\n        {\n          type: 'panel',\n          title: 'panel',\n          extra: 'panel',\n          schematic: 'https://vfiles.gtimg.cn/vupload/20210329/9712631617027075445.png',\n          items: [\n            {\n              text: '名称',\n              name: 'name',\n            },\n          ],\n        },\n\n        {\n          type: 'step',\n          items: [\n            {\n              name: 'step1',\n              title: 'step1',\n              items: [\n                {\n                  text: '名称',\n                  name: 'name',\n                },\n              ],\n            },\n            {\n              name: 'step2',\n              title: 'step2',\n              items: [\n                {\n                  text: '名称2',\n                  name: 'name',\n                },\n              ],\n            },\n          ],\n        },\n      ],\n\n      initValue: {\n        text: '文本',\n        number: 10,\n        fieldset: {\n          select: 1,\n        },\n        table: [\n          { id: 1, name: 'a' },\n          { id: 2, name: 'b' },\n        ],\n      },\n\n      tableConfig: [\n        {\n          label: 'id',\n          prop: 'id',\n        },\n        {\n          label: 'name',\n          prop: 'name',\n        },\n      ],\n      tableData: [\n        { id: 1, name: 'xx' },\n        { id: 2, name: 'xx2' },\n      ],\n    };\n  },\n  methods: {\n    async submit() {\n      try {\n        const values = await (this.$refs.form as InstanceType<typeof MForm>).submitForm();\n        this.resultVisible = true;\n        this.result = JSON.stringify(values, null, 2);\n      } catch (e: any) {\n        console.error(e);\n        ElMessage.error({\n          duration: 10000,\n          showClose: true,\n          message: e.message,\n          dangerouslyUseHTMLString: true,\n        });\n      }\n    },\n\n    spanMethod({ rowIndex, columnIndex }: any) {\n      if (columnIndex === 0) {\n        if (rowIndex % 2 === 0) {\n          return {\n            rowspan: 2,\n            colspan: 1,\n          };\n        }\n        return {\n          rowspan: 0,\n          colspan: 0,\n        };\n      }\n    },\n  },\n});\n</script>\n","<template>\n  <m-table :columns=\"columns\" :data=\"data\" :show-header=\"true\"></m-table>\n</template>\n\n<script lang=\"ts\" setup>\nimport { ref } from 'vue';\n\nconst columns = ref([\n  {\n    type: 'expand',\n    prop: 'b',\n    table: [\n      {\n        prop: 'a',\n        label: '1',\n      },\n    ],\n  },\n  {\n    prop: 'a',\n    label: '1231',\n  },\n]);\n\nconst data = ref([\n  {\n    a: 'a1',\n    b: [\n      {\n        a: 1,\n      },\n    ],\n  },\n]);\n</script>\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport { createRouter, createWebHashHistory } from 'vue-router';\n\nimport Editor from './pages/Editor.vue';\nimport Form from './pages/Form.vue';\nimport Table from './pages/Table.vue';\n\nconst routes = [\n  { path: '/', component: Editor },\n  { path: '/form', component: Form },\n  { path: '/table', component: Table },\n];\n\nexport default createRouter({\n  history: createWebHashHistory(),\n  routes,\n});\n","/*\n * Tencent is pleased to support the open source community by making TMagicEditor available.\n *\n * Copyright (C) 2021 THL A29 Limited, a Tencent company.  All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *   http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nimport './polyfills';\n\nimport { createApp } from 'vue';\nimport ElementPlus from 'element-plus';\nimport zhCn from 'element-plus/es/locale/lang/zh-cn';\nimport * as monaco from 'monaco-editor';\nimport EditorWorker from 'monaco-editor/esm/vs/editor/editor.worker?worker';\nimport CssWorker from 'monaco-editor/esm/vs/language/css/css.worker?worker';\nimport HtmlWorker from 'monaco-editor/esm/vs/language/html/html.worker?worker';\nimport JsonWorker from 'monaco-editor/esm/vs/language/json/json.worker?worker';\nimport TsWorker from 'monaco-editor/esm/vs/language/typescript/ts.worker?worker';\n\nimport MagicEditor from '@tmagic/editor';\nimport MagicForm from '@tmagic/form';\nimport MagicTable from '@tmagic/table';\n\nimport App from './App.vue';\nimport router from './route';\n\nimport 'element-plus/dist/index.css';\nimport '@tmagic/editor/src/theme/index.scss';\n\n// @ts-ignore\nglobalThis.MonacoEnvironment = {\n  getWorker(_: any, label: string) {\n    if (label === 'json') {\n      return new JsonWorker();\n    }\n    if (label === 'css' || label === 'scss' || label === 'less') {\n      return new CssWorker();\n    }\n    if (label === 'html' || label === 'handlebars' || label === 'razor') {\n      return new HtmlWorker();\n    }\n    if (label === 'typescript' || label === 'javascript') {\n      return new TsWorker();\n    }\n    return new EditorWorker();\n  },\n};\n\nmonaco.languages.typescript.typescriptDefaults.setEagerModelSync(true);\n\nconst app = createApp(App);\napp.use(router);\napp.use(ElementPlus, {\n  locale: zhCn,\n});\napp.use(MagicEditor);\napp.use(MagicForm);\napp.use(MagicTable);\napp.mount('#app');\n"],"names":["_sfc_main","_openBlock","serialize","_createBlock","_hoisted_1","_hoisted_2","_hoisted_3","monaco.editor","moment","EventEmitter","isFixed","Editor","_createElementBlock","_withCtx","_Fragment","_createVNode","_createElementVNode","_createTextVNode","_toDisplayString","_normalizeClass","_createCommentVNode","ScrollViewer","_hoisted_4","_renderSlot","defaultInstallOpt","display","displayFunction","_normalizeStyle","_resolveDynamicComponent","_hoisted_7","_hoisted_9","_hoisted_10","CaretBottom","Delete","_hoisted_5","ArrowDown","Grid","_createSlots","Form","Table","Number","Hidden","Date","ColorPicker","Display","ActionsColumn","Coin","JsonWorker","CssWorker","HtmlWorker","TsWorker","EditorWorker","monaco.languages","ElementPlus"],"mappings":"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"}