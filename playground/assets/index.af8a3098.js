var j=Object.defineProperty,W=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var F=(e,t,o)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,w=(e,t)=>{for(var o in t||(t={}))P.call(t,o)&&F(e,o,t[o]);if(M)for(var o of M(t))I.call(t,o)&&F(e,o,t[o]);return e},V=(e,t)=>W(e,U(t));var z=(e,t)=>{var o={};for(var n in e)P.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&M)for(var n of M(e))t.indexOf(n)<0&&I.call(e,n)&&(o[n]=e[n]);return o};var y=(e,t,o)=>(F(e,typeof t!="symbol"?t+"":t,o),o);import{d as defineComponent,c as computed,r as resolveComponent,o as openBlock,a as createBlock,n as normalizeStyle,b as ref,w as watchEffect,s as serializeJavascript,i as inject,e as createElementBlock,f as createBaseVNode,t as toDisplayString,g as withModifiers,h as createCommentVNode,j as watch,k as onMounted,l as onUnmounted,m as editor,p as hooks,q as cloneDeep,u as events,v as reactive,x as random,y as toRaw,z as mergeWith,P as Plus,A as createVNode,B as withCtx,G as Gesto,C as renderSlot,F as Fragment,E as Edit,D as normalizeClass,H as resolveDynamicComponent,I as ArrowDown,J as Grid,S as ScaleToOriginal,Z as ZoomOut,K as ZoomIn,R as Right,L as Back,M as Delete,N as renderList,O as createTextVNode,Q as normalizeProps,T as mergeProps,U as getCurrentInstance,V as ElMessage,W as withDirectives,X as vShow,Y as Teleport,_ as Files,$ as Coin,a0 as toHandlers,a1 as createSlots,a2 as CaretBottom,a3 as Moveable,a4 as EventEmitter,a5 as Guides,a6 as nextTick,a7 as provide,a8 as CaretRight,a9 as CaretBottom$1,aa as Delete$1,ab as ArrowDown$1,ac as ArrowUp,ad as FullScreen,ae as Grid$1,af as toRefs,ag as Sortable,ah as unref,ai as onBeforeUnmount,aj as vModelText,ak as onBeforeMount,al as resolveDirective,am as isEqual,an as ElMessageBox,ao as Connection,ap as Coin$1,aq as Document,ar as FolderOpened,as as Tickets,at as SwitchButton,au as createRouter,av as createWebHashHistory,aw as WorkerWrapper,ax as WorkerWrapper$1,ay as WorkerWrapper$2,az as WorkerWrapper$3,aA as WorkerWrapper$4,aB as languages,aC as createApp,aD as installer,aE as zhCn}from"./vendor.d955f274.js";const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const l of a)if(l.type==="childList")for(const i of l.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function o(a){const l={};return a.integrity&&(l.integrity=a.integrity),a.referrerpolicy&&(l.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?l.credentials="include":a.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(a){if(a.ep)return;a.ep=!0;const l=o(a);fetch(a.href,l)}};p();typeof window.global=="undefined"&&(window.global=window);var _export_sfc=(e,t)=>{const o=e.__vccOpts||e;for(const[n,a]of t)o[n]=a;return o};const _sfc_main$W=defineComponent({name:"m-fields-vs-code",props:["model","name","config","prop"],emits:["change"],setup(e,{emit:t}){const o=computed(()=>e.config.language||"javascript");return{height:computed(()=>`${document.body.clientHeight-168}px`),language:o,save(a){e.model[e.name]=a,t("change",a)}}}});function _sfc_render$R(e,t,o,n,a,l){const i=resolveComponent("magic-code-editor");return openBlock(),createBlock(i,{style:normalizeStyle(`height: ${e.height}`),"init-values":e.model[e.name],language:e.language,onSave:e.save},null,8,["style","init-values","language","onSave"])}var Code=_export_sfc(_sfc_main$W,[["render",_sfc_render$R]]);const _sfc_main$V=defineComponent({name:"m-fields-code-link",props:{config:{type:Object},model:{type:Object},name:{type:String},prop:{type:String}},emits:["change"],setup(props,{emit}){const modelValue=ref({form:{}});return watchEffect(()=>{!props.model||!props.name||(modelValue.value.form[props.name]=serializeJavascript(props.model[props.name],{space:2,unsafe:!0}).replace(/"(\w+)":\s/g,"$1: "))}),{modelValue,formConfig:computed(()=>V(w({},props.config),{text:"",type:"link",form:[{name:props.name,type:"vs-code"}]})),changeHandler(v){if(!(!props.name||!props.model))try{props.model[props.name]=eval(`${v[props.name]}`),emit("change",props.model[props.name])}catch(e){console.error(e)}}}}});function _sfc_render$Q(e,t,o,n,a,l){const i=resolveComponent("m-fields-link");return openBlock(),createBlock(i,{config:e.formConfig,model:e.modelValue,name:"form",onChange:e.changeHandler},null,8,["config","model","onChange"])}var CodeLink=_export_sfc(_sfc_main$V,[["render",_sfc_render$Q]]),UISelect_vue_vue_type_style_index_0_lang="";const _sfc_main$U=defineComponent({name:"m-fields-ui-select",props:{labelWidth:String,config:Object,model:Object,prop:{type:String,default(){return""}},name:String},emits:["change"],setup(e,{emit:t}){const o=inject("services"),n=inject("mForm"),a=computed(()=>e.model[e.name]),l=ref(!1),i=()=>{!(o==null?void 0:o.uiService)||(o.uiService.set("uiSelectMode",!1),l.value=!1,globalThis.document.removeEventListener("ui-select",r))},r=({detail:s})=>{s.id&&(e.model[e.name]=s.id,t("change",s.id),n==null||n.$emit("field-change",e.prop,s.id)),i&&i()};return{val:a,uiSelectMode:l,toName:computed(()=>{const s=o==null?void 0:o.editorService.getNodeById(a.value);return(s==null?void 0:s.name)||""}),startSelect(){!(o==null?void 0:o.uiService)||(o.uiService.set("uiSelectMode",!0),l.value=!0,globalThis.document.addEventListener("ui-select",r))},cancelHandler:i,deleteHandler(){e.model&&(e.model[e.name]="",t("change",""),n==null||n.$emit("field-change",e.prop,""))}}}}),_hoisted_1$y=createBaseVNode("i",{class:"el-icon-delete",style:{color:"rgb(221, 75, 57)"}},"\u53D6\u6D88",-1),_hoisted_2$j=[_hoisted_1$y],_hoisted_3$f=createBaseVNode("i",{class:"el-icon-thumb"},null,-1);function _sfc_render$P(e,t,o,n,a,l){return e.uiSelectMode?(openBlock(),createElementBlock("div",{key:0,class:"m-fields-ui-select",onClick:t[0]||(t[0]=(...i)=>e.cancelHandler&&e.cancelHandler(...i))},_hoisted_2$j)):(openBlock(),createElementBlock("div",{key:1,class:"m-fields-ui-select",onClick:t[2]||(t[2]=(...i)=>e.startSelect&&e.startSelect(...i))},[_hoisted_3$f,createBaseVNode("span",null,toDisplayString(e.val?e.toName+"_"+e.val:"\u70B9\u51FB\u6B64\u5904\u9009\u62E9"),1),e.val?(openBlock(),createElementBlock("i",{key:0,class:"el-icon-delete",onClick:t[1]||(t[1]=withModifiers((...i)=>e.deleteHandler&&e.deleteHandler(...i),["stop"]))})):createCommentVNode("",!0)]))}var uiSelect=_export_sfc(_sfc_main$U,[["render",_sfc_render$P]]);const toString=(e,t)=>{let o="";return typeof e!="string"?o=serializeJavascript(e,{space:2,unsafe:!0}).replace(/"(\w+)":\s/g,"$1: "):o=e,t==="javascript"&&o.startsWith("{")&&o.endsWith("}")&&(o=`(${o})`),o},_sfc_main$T=defineComponent({name:"magic-code-editor",props:{initValues:{type:[String,Object]},modifiedValues:{type:[String,Object]},type:{type:[String],default:()=>""},language:{type:[String],default:()=>"javascript"}},emits:["initd","save"],setup(e,{emit:t}){let o=null,n=null;const a=ref(""),l=ref(!1),i=ref(),r=(u,m)=>{if(a.value=toString(u,e.language),e.type==="diff"){const h=editor.createModel(a.value,"text/javascript"),f=editor.createModel(toString(m,e.language),"text/javascript");return n==null?void 0:n.setModel({original:h,modified:f})}return o==null?void 0:o.setValue(a.value)},s=()=>{o==null||o.layout(),n==null||n.layout()},d=()=>e.type==="diff"?n==null?void 0:n.getModifiedEditor().getValue():o==null?void 0:o.getValue(),c=async()=>{if(!i.value)return;const u={value:a.value,language:e.language,tabSize:2,theme:"vs-dark",fontFamily:'dm, Menlo, Monaco, "Courier New", monospace',fontSize:15,formatOnPaste:!0};e.type==="diff"?n=editor.createDiffEditor(i.value,u):o=editor.create(i.value,u),r(e.initValues,e.modifiedValues),l.value=!1,t("initd",o),i.value.addEventListener("keydown",m=>{m.keyCode===83&&(navigator.platform.match("Mac")?m.metaKey:m.ctrlKey)&&(m.preventDefault(),t("save",d()))}),e.type!=="diff"&&(o==null||o.onDidBlurEditorWidget(()=>{t("save",d())})),globalThis.addEventListener("resize",s)};return watch(()=>e.initValues,(u,m)=>{u!==m&&r(e.initValues,e.modifiedValues)},{deep:!0,immediate:!0}),onMounted(async()=>{l.value=!0,c()}),onUnmounted(()=>{globalThis.removeEventListener("resize",s)}),{values:a,loading:l,codeEditor:i,getEditor(){return o||n},setEditorValue:r,focus(){o==null||o.focus(),n==null||n.focus()}}}}),_hoisted_1$x={ref:"codeEditor",class:"magic-code-editor"};function _sfc_render$O(e,t,o,n,a,l){return openBlock(),createElementBlock("div",_hoisted_1$x,null,512)}var CodeEditor=_export_sfc(_sfc_main$T,[["render",_sfc_render$O]]);const sleep=e=>new Promise(t=>{const o=setTimeout(()=>{clearTimeout(o),t()},e)}),datetimeFormatter=(e,t="-",o="YYYY-MM-DD HH:mm:ss")=>{let n=o;if(n==="timestamp"&&(n="x"),e){let a=null;return typeof e=="string"&&e.includes("Z")||e.constructor===Date?a=hooks(e).utcOffset("+08:00").format(n):a=hooks(e).format(n),n==="x"?+a:a!=="Invalid date"?a:t}return t},asyncLoadJs=(()=>{const e=new Map;return(t,o,n=globalThis.document)=>{let a=e.get(n);if(a||(a=new Map,e.set(n,a)),a.get(t))return a.get(t);const l=new Promise((i,r)=>{const s=n.createElement("script");s.type="text/javascript",o&&(s.crossOrigin=o),s.src=t,n.body.appendChild(s),s.onload=()=>{i()},s.onerror=()=>{r(new Error("\u52A0\u8F7D\u5931\u8D25"))},setTimeout(()=>{r(new Error("timeout"))},60*1e3)}).catch(i=>{throw a.delete(t),i});return a.set(t,l),a.get(t)}})(),toLine=(e="")=>e.replace(/\B([A-Z])/g,"-$1").toLowerCase(),getNodePath=(e,t=[])=>{const o=[],n=function(a,l){if(!Array.isArray(l))return null;for(let i=0,r=l.length;i<r;i++){const s=l[i];if(o.push(s),`${s.id}`==`${a}`)return s;if(s.items){const d=n(a,s.items);if(d)return d}o.pop()}return null};return n(e,t),o},isPop=e=>e.type.toLowerCase().endsWith("pop");class UndoRedo{constructor(t=200){y(this,"elementList");y(this,"listCursor");y(this,"listMaxSize");this.elementList=[],this.listCursor=0,this.listMaxSize=t>2?t:2}pushElement(t){this.elementList.splice(this.listCursor,this.elementList.length-this.listCursor,cloneDeep(t)),this.listCursor+=1,this.elementList.length>this.listMaxSize&&(this.elementList.shift(),this.listCursor-=1)}canUndo(){return this.listCursor>1}undo(){return this.canUndo()?(this.listCursor-=1,this.getCurrentElement()):null}canRedo(){return this.elementList.length>this.listCursor}redo(){return this.canRedo()?(this.listCursor+=1,this.getCurrentElement()):null}getCurrentElement(){return this.listCursor<1?null:cloneDeep(this.elementList[this.listCursor-1])}}const compose=e=>{if(!Array.isArray(e))throw new TypeError("Middleware \u5FC5\u987B\u662F\u4E00\u4E2A\u6570\u7EC4!");for(const t of e)if(typeof t!="function")throw new TypeError("Middleware \u5FC5\u987B\u7531\u51FD\u6570\u7EC4\u6210!");return(t,o)=>{let n=-1;return a(0);function a(l){if(l<=n)return Promise.reject(new Error("next() \u88AB\u591A\u6B21\u8C03\u7528"));n=l;let i=e[l];if(l===e.length&&o&&(i=o),!i)return Promise.resolve();try{return Promise.resolve(i(...t,a.bind(null,l+1)))}catch(r){return Promise.reject(r)}}}},methodName=(e,t)=>`${e}${t[0].toUpperCase()}${t.substring(1)}`,isError=e=>Object.prototype.toString.call(e)==="[object Error]";class BaseService extends events.exports.EventEmitter{constructor(t){super();y(this,"pluginOptionsList",{});y(this,"middleware",{});t.forEach(o=>{const n=this,a=n[o],l=methodName("before",o),i=methodName("after",o);this.pluginOptionsList[l]=[],this.pluginOptionsList[i]=[],this.middleware[o]=[];const r=compose(this.middleware[o]);Object.defineProperty(n,o,{value:async(...s)=>{let d=s;for(const u of this.pluginOptionsList[l]){let m=await u(...d)||[];if(isError(m))throw m;Array.isArray(m)||(m=[m]),d=d.map((h,f)=>typeof m[f]=="undefined"?h:m[f])}let c=await r(d,a.bind(n));for(const u of this.pluginOptionsList[i])if(c=await u(...d,c),isError(c))throw c;return c}})})}use(t){Object.entries(t).forEach(([o,n])=>{typeof n=="function"&&this.middleware[o].push(n)})}usePlugin(t){Object.entries(t).forEach(([o,n])=>{typeof n=="function"&&this.pluginOptionsList[o].push(n)})}}class History extends BaseService{constructor(){super([]);y(this,"state",reactive({pageSteps:{},pageId:void 0,canRedo:!1,canUndo:!1}));this.on("change",this.setCanUndoRedo)}changePage(t){if(!!t){if(this.state.pageId=t.id,!this.state.pageSteps[this.state.pageId]){const o=new UndoRedo;o.pushElement({data:t,modifiedNodeIds:new Map,nodeId:t.id}),this.state.pageSteps[this.state.pageId]=o}this.setCanUndoRedo()}}empty(){this.state.pageId=void 0,this.state.pageSteps={},this.state.canRedo=!1,this.state.canUndo=!1}push(t){const o=this.getUndoRedo();return o?(o.pushElement(t),this.emit("change",t),t):null}undo(){const t=this.getUndoRedo();if(!t)return null;const o=t.undo();return this.emit("change",o),o}redo(){const t=this.getUndoRedo();if(!t)return null;const o=t.redo();return this.emit("change",o),o}destroy(){this.empty(),this.removeAllListeners()}getUndoRedo(){return this.state.pageId?this.state.pageSteps[this.state.pageId]:null}setCanUndoRedo(){const t=this.getUndoRedo();this.state.canRedo=(t==null?void 0:t.canRedo())||!1,this.state.canUndo=(t==null?void 0:t.canUndo())||!1}}var historyService=new History;class Props extends BaseService{constructor(){super(["setPropsConfig","getPropsConfig","setPropsValue","getPropsValue"]);y(this,"state",reactive({propsConfigMap:{},propsValueMap:{}}))}setPropsConfigs(t){Object.keys(t).forEach(o=>{this.setPropsConfig(toLine(o),t[o])}),this.emit("props-configs-change")}setPropsConfig(t,o){this.state.propsConfigMap[t]=fillConfig(Array.isArray(o)?o:[o])}async getPropsConfig(t){return t==="area"?await this.getPropsConfig("button"):cloneDeep(this.state.propsConfigMap[t]||DEFAULT_CONFIG)}setPropsValues(t){Object.keys(t).forEach(o=>{this.setPropsValue(toLine(o),t[o])})}setPropsValue(t,o){this.state.propsValueMap[t]=o}async getPropsValue(t){if(t==="area"){const o=await this.getPropsValue("button");return o.className="action-area",o.text="",o.style&&(o.style.backgroundColor="rgba(255, 255, 255, 0)"),o}return cloneDeep(w(w({},getDefaultPropsValue(t)),this.state.propsValueMap[t]||{}))}}var propsService=new Props,LayerOffset=(e=>(e.TOP="top",e.BOTTOM="bottom",e))(LayerOffset||{}),Layout=(e=>(e.FLEX="flex",e.FIXED="fixed",e.RELATIVE="relative",e.ABSOLUTE="absolute",e))(Layout||{}),Keys=(e=>(e.ESCAPE="Space",e))(Keys||{});const COPY_STORAGE_KEY="$MagicEditorCopyData",generateId=e=>`${e}_${random(1e4,!1)}`,getPageList=e=>e.items&&Array.isArray(e.items)?e.items.filter(t=>t.type==="page"):[],getPageNameList=e=>e.map(t=>t.name||"index"),generatePageName=e=>{let t=e.length;if(!t)return"index";let o=`page_${t}`;for(;e.includes(o);)t+=1,o=`page_${t}`;return o},generatePageNameByApp=e=>generatePageName(getPageNameList(getPageList(e))),updatePopId=(e,t,o)=>{var n;(n=o.items)==null||n.forEach(a=>{if(a.pop===e){a.pop=t;return}if(a.popId===e){a.popId=t;return}Array.isArray(a.items)&&updatePopId(e,t,a)})},setNewItemId=(e,t)=>{var n;const o=e.id;e.id=generateId(e.type),e.name=`${(n=e.name)==null?void 0:n.replace(/_(\d+)$/,"")}_${e.id}`,isPop(e)&&(t==null?void 0:t.type)==="page"&&updatePopId(o,e.id,t),e.items&&Array.isArray(e.items)&&e.items.forEach(a=>setNewItemId(a,e))},isFixed$1=e=>{var t;return((t=e.style)==null?void 0:t.position)==="fixed"},getNodeIndex=(e,t)=>((t==null?void 0:t.items)||[]).findIndex(n=>`${n.id}`==`${e.id}`),toRelative=e=>(e.style=V(w({},e.style||{}),{position:"relative",top:0,left:0}),e),initPosition=(e,t)=>t===Layout.ABSOLUTE?(e.style=w({position:"absolute"},e.style||{}),e):t===Layout.RELATIVE?toRelative(e):e,setLayout=(e,t)=>{var o;return(o=e.items)==null||o.forEach(n=>{isPop(n)||(n.style=n.style||{},n.style.position!=="fixed"&&(t!==Layout.RELATIVE?n.style.position="absolute":(toRelative(n),n.style.right="auto",n.style.bottom="auto")))}),e},change2Fixed=(e,t)=>{const o=getNodePath(e.id,t.items),n={left:0,top:0};return o.forEach(a=>{var l,i;n.left=n.left+globalThis.parseFloat(((l=a.style)==null?void 0:l.left)||0),n.top=n.top+globalThis.parseFloat(((i=a.style)==null?void 0:i.top)||0)}),e.style=w(w({},e.style||{}),n),e},Fixed2Other=async(e,t,o)=>{var s,d;const n=getNodePath(e.id,t.items),a=n.pop(),l={left:((s=a==null?void 0:a.style)==null?void 0:s.left)||0,top:((d=a==null?void 0:a.style)==null?void 0:d.top)||0};n.forEach(c=>{var u,m;l.left=l.left-globalThis.parseFloat(((u=c.style)==null?void 0:u.left)||0),l.top=l.top-globalThis.parseFloat(((m=c.style)==null?void 0:m.top)||0)});const i=n.pop();return i&&await o(i)!==Layout.RELATIVE?(e.style=V(w(w({},e.style||{}),l),{position:"absolute"}),e):toRelative(e)};class Editor$2 extends BaseService{constructor(){super(["getLayout","select","add","remove","update","sort","copy","paste","alignCenter","moveLayer","undo","redo"]);y(this,"isHistoryStateChange",!1);y(this,"state",reactive({root:null,page:null,parent:null,node:null,stage:null,modifiedNodeIds:new Map}))}set(e,t){this.state[e]=t,e==="root"&&this.emit("root-change",t)}get(e){return this.state[e]}getNodeInfo(e){const t=this.get("root");if(!t)return{};if(e===t.id)return{node:t};const o=getNodePath(e,t.items);if(!o.length)return{};o.unshift(t);const n={};return n.node=o[o.length-1],n.parent=o[o.length-2],o.forEach(a=>{if(a.type==="page"){n.page=a;return}}),n}getNodeById(e){const{node:t}=this.getNodeInfo(e);return t}getParentById(e){if(!this.get("root"))return;const{parent:t}=this.getNodeInfo(e);return t}async getLayout(e){var t;return e.layout?e.layout:((t=e.style)==null?void 0:t.position)?Layout.ABSOLUTE:Layout.RELATIVE}async select(e){var l;let t;if(typeof e=="string"||typeof e=="number"?t=e:t=e.id,!t)throw new Error("\u6CA1\u6709ID\uFF0C\u65E0\u6CD5\u9009\u4E2D");const{node:o,parent:n,page:a}=this.getNodeInfo(t);if(!o)throw new Error("\u83B7\u53D6\u4E0D\u5230\u7EC4\u4EF6\u4FE1\u606F");if(o.id===((l=this.state.root)==null?void 0:l.id))throw new Error("\u4E0D\u80FD\u9009\u6839\u8282\u70B9");return this.set("node",o),this.set("page",a||null),this.set("parent",n||null),a?historyService.changePage(toRaw(a)):historyService.empty(),o}async add(n,o){var a=n,{type:e}=a,t=z(a,["type"]);var d,c;const l=this.get("node");let i;if(e==="page"?i=this.get("root"):o&&typeof o!="function"?i=o:l.items?i=l:i=this.getParentById(l.id),!i)throw new Error("\u672A\u627E\u5230\u7236\u5143\u7D20");const r=await this.getLayout(i),s=initPosition(w(w({},toRaw(await propsService.getPropsValue(e))),t),r);if(((i==null?void 0:i.type)==="app"||l.type==="app")&&s.type!=="page")throw new Error("app\u4E0B\u4E0D\u80FD\u6DFB\u52A0\u7EC4\u4EF6");return(d=i==null?void 0:i.items)==null||d.push(s),await((c=this.get("stage"))==null?void 0:c.add({config:cloneDeep(s),root:cloneDeep(this.get("root"))})),await this.select(s),this.addModifiedNodeId(s.id),this.pushHistoryState(),s}async remove(e){var l,i;if(!(e==null?void 0:e.id))return;const t=this.get("root");if(!t)throw new Error("\u6CA1\u6709root");const{parent:o,node:n}=this.getNodeInfo(e.id);if(!o||!n)throw new Error("\u627E\u4E0D\u8981\u5220\u9664\u7684\u8282\u70B9");const a=getNodeIndex(n,o);if(typeof a!="number"||a===-1)throw new Error("\u627E\u4E0D\u8981\u5220\u9664\u7684\u8282\u70B9");return(l=o.items)==null||l.splice(a,1),(i=this.get("stage"))==null||i.remove({id:e.id,root:this.get("root")}),e.type==="page"?await this.select(t.items[0]||t):await this.select(o),this.addModifiedNodeId(o.id),this.pushHistoryState(),e}async update(e){var d;if(!(e==null?void 0:e.id))throw new Error("\u6CA1\u6709\u914D\u7F6E\u6216\u8005\u914D\u7F6E\u7F3A\u5C11id\u503C");const t=this.getNodeInfo(e.id);if(!t.node)throw new Error(`\u83B7\u53D6\u4E0D\u5230id\u4E3A${e.id}\u7684\u8282\u70B9`);const o=cloneDeep(toRaw(t.node));let n=await this.toggleFixedPosition(toRaw(e),o,this.get("root"));if(n=mergeWith(cloneDeep(o),n,(c,u)=>{if(Array.isArray(u))return u}),!n.type)throw new Error("\u914D\u7F6E\u7F3A\u5C11type\u503C");if(n.type==="app")return this.set("root",n),n;const{parent:a}=t;if(!a)throw new Error("\u83B7\u53D6\u4E0D\u5230\u7236\u7EA7\u8282\u70B9");const l=a.items,i=getNodeIndex(n,a);if(!l||typeof i=="undefined"||i===-1)throw new Error("\u66F4\u65B0\u7684\u8282\u70B9\u672A\u627E\u5230");const r=await this.getLayout(n),s=await this.getLayout(o);return r!==s&&(n=setLayout(n,r)),l[i]=n,n.id===this.get("node").id&&this.set("node",n),(d=this.get("stage"))==null||d.update({config:cloneDeep(n),root:this.get("root")}),n.type==="page"&&this.set("page",n),this.addModifiedNodeId(n.id),this.pushHistoryState(),n}async sort(e,t){var i;const o=this.get("node"),n=cloneDeep(toRaw(this.get("parent"))),a=n.items.findIndex(r=>`${r.id}`==`${t}`);if(a<0)return;const l=n.items.findIndex(r=>`${r.id}`==`${e}`);n.items.splice(a,0,...n.items.splice(l,1)),await this.update(n),await this.select(o),(i=this.get("stage"))==null||i.update({config:cloneDeep(o),root:this.get("root")}),this.addModifiedNodeId(n.id),this.pushHistoryState()}async copy(e){globalThis.localStorage.setItem(COPY_STORAGE_KEY,serializeJavascript(e))}async paste(position={}){const configStr=globalThis.localStorage.getItem(COPY_STORAGE_KEY);let config={};if(!!configStr){try{eval(`config = ${configStr}`)}catch(e){console.error(e);return}return setNewItemId(config,this.get("root")),config.style&&(config.style=w(w({},config.style),position)),await this.add(config)}}async alignCenter(e){var a,l,i;const t=this.get("parent"),o=this.get("node");if(await this.getLayout(t)!==Layout.RELATIVE)return((a=t.style)==null?void 0:a.width)&&((l=o.style)==null?void 0:l.width)&&(o.style.left=(t.style.width-o.style.width)/2),await this.update(o),(i=this.get("stage"))==null||i.update({config:cloneDeep(toRaw(o)),root:this.get("root")}),this.addModifiedNodeId(e.id),this.pushHistoryState(),e}async moveLayer(e){var l;const t=this.get("parent"),o=this.get("node"),n=(t==null?void 0:t.items)||[],a=n.findIndex(i=>`${i.id}`==`${o==null?void 0:o.id}`);e===LayerOffset.BOTTOM?n.splice(n.length-1,0,n.splice(a,1)[0]):e===LayerOffset.TOP?n.splice(0,0,n.splice(a,1)[0]):n.splice(a+parseInt(`${e}`,10),0,n.splice(a,1)[0]),(l=this.get("stage"))==null||l.update({config:cloneDeep(toRaw(t)),root:this.get("root")})}async undo(){const e=historyService.undo();return await this.changeHistoryState(e),e}async redo(){const e=historyService.redo();return await this.changeHistoryState(e),e}destroy(){this.removeAllListeners(),this.set("root",null),this.set("node",null),this.set("page",null),this.set("parent",null)}resetModifiedNodeId(){this.get("modifiedNodeIds").clear()}addModifiedNodeId(e){this.isHistoryStateChange||this.get("modifiedNodeIds").set(e,e)}pushHistoryState(){const e=cloneDeep(toRaw(this.get("node")));this.isHistoryStateChange||historyService.push({data:cloneDeep(toRaw(this.get("page"))),modifiedNodeIds:this.get("modifiedNodeIds"),nodeId:e.id}),this.isHistoryStateChange=!1}async changeHistoryState(e){!e||(this.isHistoryStateChange=!0,await this.update(e.data),this.set("modifiedNodeIds",e.modifiedNodeIds),setTimeout(()=>e.nodeId&&this.select(e.nodeId),0))}async toggleFixedPosition(e,t,o){var a;let n=cloneDeep(e);return!isPop(t)&&((a=n.style)==null?void 0:a.position)&&(isFixed$1(n)&&!isFixed$1(t)?n=change2Fixed(n,o):!isFixed$1(n)&&isFixed$1(t)&&(n=await Fixed2Other(n,o,this.getLayout))),n}}var editorService=new Editor$2;const COMMON_EVENT_PREFIX="magic:common:events:",COMMON_METHOD_PREFIX="magic:common:actions:",CommonMethod={SHOW:"show",HIDE:"hide",SCROLL_TO_VIEW:"scrollIntoView",SCROLL_TO_TOP:"scrollToTop"},DEFAULT_EVENTS=[{label:"\u70B9\u51FB",value:`${COMMON_EVENT_PREFIX}click`}],DEFAULT_METHODS=[{label:"\u663E\u793A",value:`${COMMON_METHOD_PREFIX}${CommonMethod.SHOW}`},{label:"\u9690\u85CF",value:`${COMMON_METHOD_PREFIX}${CommonMethod.HIDE}`},{label:"\u6EDA\u52A8\u5230\u8BE5\u7EC4\u4EF6",value:`${COMMON_METHOD_PREFIX}${CommonMethod.SCROLL_TO_VIEW}`},{label:"\u56DE\u5230\u9876\u90E8",value:`${COMMON_METHOD_PREFIX}${CommonMethod.SCROLL_TO_TOP}`}];var resetcss="";const eventMap=reactive({}),methodMap=reactive({});class Events extends BaseService{constructor(){super([])}init(t){t.forEach(o=>{o.items.forEach(n=>{const a=toLine(n.type);this.getEvent(a)||this.setEvent(a,DEFAULT_EVENTS),this.getMethod(a)||this.setMethod(a,DEFAULT_METHODS)})})}setEvents(t){Object.keys(t).forEach(o=>{this.setEvent(toLine(o),t[o]||[])})}setEvent(t,o){eventMap[t]=[...DEFAULT_EVENTS,...o]}getEvent(t){return cloneDeep(eventMap[t]||DEFAULT_EVENTS)}setMethods(t){Object.keys(t).forEach(o=>{this.setMethod(toLine(o),t[o]||[])})}setMethod(t,o){methodMap[t]=[...DEFAULT_METHODS,...o]}getMethod(t){return cloneDeep(methodMap[t]||DEFAULT_METHODS)}}var eventsService=new Events;const fillConfig=(e=[])=>[{type:"tab",items:[{title:"\u5C5E\u6027",labelWidth:"80px",items:[{text:"type",name:"type",type:"hidden"},{name:"id",type:"display",text:"id"},{name:"name",text:"\u7EC4\u4EF6\u540D\u79F0"},...e]},{title:"\u6837\u5F0F",labelWidth:"80px",items:[{name:"style",items:[{type:"fieldset",legend:"\u4F4D\u7F6E",items:[{name:"position",type:"checkbox",activeValue:"fixed",inactiveValue:"absolute",defaultValue:"absolute",text:"\u56FA\u5B9A\u5B9A\u4F4D"},{name:"left",text:"left"},{name:"top",text:"top",disabled:(t,{model:o})=>o.position==="fixed"&&o._magic_position==="fixedBottom"},{name:"right",text:"right"},{name:"bottom",text:"bottom",disabled:(t,{model:o})=>o.position==="fixed"&&o._magic_position==="fixedTop"}]},{type:"fieldset",legend:"\u76D2\u5B50",items:[{name:"width",text:"\u5BBD\u5EA6"},{name:"height",text:"\u9AD8\u5EA6"}]},{type:"fieldset",legend:"\u80CC\u666F",items:[{name:"backgroundImage",text:"\u80CC\u666F\u56FE"},{name:"backgroundColor",text:"\u80CC\u666F\u989C\u8272",type:"colorPicker"},{name:"backgroundRepeat",text:"\u80CC\u666F\u56FE\u91CD\u590D",type:"select",defaultValue:"no-repeat",options:[{text:"repeat",value:"repeat"},{text:"repeat-x",value:"repeat-x"},{text:"repeat-y",value:"repeat-y"},{text:"no-repeat",value:"no-repeat"},{text:"inherit",value:"inherit"}]},{name:"backgroundSize",text:"\u80CC\u666F\u56FE\u5927\u5C0F",defaultValue:"100% 100%"}]}]}]},{title:"\u4E8B\u4EF6",items:[{type:"table",name:"events",items:[{name:"name",label:"\u4E8B\u4EF6\u540D",type:"select",options:(t,{formValue:o})=>eventsService.getEvent(o.type).map(n=>({text:n.label,value:n.value}))},{name:"to",label:"\u8054\u52A8\u7EC4\u4EF6",type:"ui-select"},{name:"method",label:"\u52A8\u4F5C",type:"select",options:(t,{model:o})=>{const n=editorService.getNodeById(o.to);return n?eventsService.getMethod(n.type).map(a=>({text:a.label,value:a.value})):[]}}]}]},{title:"\u9AD8\u7EA7",labelWidth:"80px",items:[{type:"code-link",name:"created",text:"created",formTitle:"created"}]}]}],DEFAULT_CONFIG=fillConfig([]),getDefaultPropsValue=e=>({type:e,id:generateId(e),style:{},name:e}),_sfc_main$S=defineComponent({components:{Plus},setup(){const e=inject("services");return{clickHandler(){const{editorService:t}=e||{};!t||t.add({type:"page",name:generatePageNameByApp(toRaw(t.get("root")))})}}}}),_hoisted_1$w={class:"m-editor-empty-panel"},_hoisted_2$i={class:"m-editor-empty-content"},_hoisted_3$e=createBaseVNode("p",null,"\u65B0\u589E\u9875\u9762",-1);function _sfc_render$N(e,t,o,n,a,l){const i=resolveComponent("plus"),r=resolveComponent("el-icon");return openBlock(),createElementBlock("div",_hoisted_1$w,[createBaseVNode("div",_hoisted_2$i,[createBaseVNode("div",{class:"m-editor-empty-button",onClick:t[0]||(t[0]=(...s)=>e.clickHandler&&e.clickHandler(...s))},[createBaseVNode("div",null,[createVNode(r,null,{default:withCtx(()=>[createVNode(i)]),_:1})]),_hoisted_3$e])])])}var AddPageBox=_export_sfc(_sfc_main$S,[["render",_sfc_render$N]]);const _sfc_main$R=defineComponent({name:"m-editor-resize",props:{type:{type:String}},setup(e){const t=inject("services"),o=ref();let n;return onMounted(()=>{!o.value||(n=new Gesto(o.value,{container:window,pinchOutside:!0}).on("drag",a=>{if(!o.value||!t)return;let{left:l,right:i}=w({},toRaw(t.uiService.get("columnWidth")));e.type==="left"?l+=a.deltaX:e.type==="right"&&(i-=a.deltaX),t.uiService.set("columnWidth",{left:l,right:i})}))}),onUnmounted(()=>{n==null||n.unset()}),{target:o}}}),_hoisted_1$v={ref:"target",class:"m-editor-resizer"};function _sfc_render$M(e,t,o,n,a,l){return openBlock(),createElementBlock("span",_hoisted_1$v,[renderSlot(e.$slots,"default")],512)}var Resizer=_export_sfc(_sfc_main$R,[["render",_sfc_render$M]]);const _sfc_main$Q=defineComponent({components:{AddPageBox,Resizer},setup(){const services=inject("services"),root=computed(()=>services==null?void 0:services.editorService.get("root"));return{root,pageLength:computed(()=>{var e,t;return((t=(e=root.value)==null?void 0:e.items)==null?void 0:t.length)||0}),showSrc:computed(()=>services==null?void 0:services.uiService.get("showSrc")),columnWidth:computed(()=>services==null?void 0:services.uiService.get("columnWidth")),saveCode(value){try{services==null||services.editorService.set("root",eval(value))}catch(e){console.error(e)}}}}}),_hoisted_1$u={class:"m-editor"},_hoisted_2$h={key:1,class:"m-editor-content"};function _sfc_render$L(e,t,o,n,a,l){var c,u,m;const i=resolveComponent("magic-code-editor"),r=resolveComponent("resizer"),s=resolveComponent("el-scrollbar"),d=resolveComponent("add-page-box");return openBlock(),createElementBlock("div",_hoisted_1$u,[renderSlot(e.$slots,"nav",{class:"m-editor-nav-menu"}),e.showSrc?(openBlock(),createBlock(i,{key:0,class:"m-editor-content","init-values":e.root,onSave:e.saveCode},null,8,["init-values","onSave"])):(openBlock(),createElementBlock("div",_hoisted_2$h,[createBaseVNode("div",{class:"m-editor-framework-left",style:normalizeStyle(`width: ${(c=e.columnWidth)==null?void 0:c.left}px`)},[renderSlot(e.$slots,"sidebar")],4),createVNode(r,{type:"left"}),e.pageLength>0?(openBlock(),createElementBlock(Fragment,{key:0},[createBaseVNode("div",{class:"m-editor-framework-center",style:normalizeStyle(`width: ${(u=e.columnWidth)==null?void 0:u.center}px`)},[renderSlot(e.$slots,"workspace")],4),createVNode(r,{type:"right"}),createBaseVNode("div",{class:"m-editor-framework-right",style:normalizeStyle(`width: ${(m=e.columnWidth)==null?void 0:m.right}px`)},[createVNode(s,null,{default:withCtx(()=>[renderSlot(e.$slots,"propsPanel")]),_:3})],4)],64)):renderSlot(e.$slots,"empty",{key:1},()=>[createVNode(d)])]))])}var Framework=_export_sfc(_sfc_main$Q,[["render",_sfc_render$L]]);const _sfc_main$P=defineComponent({name:"m-icon",components:{Edit},props:{icon:{type:[String,Object]}},setup(){return{toRaw}}}),_hoisted_1$t=["src"];function _sfc_render$K(e,t,o,n,a,l){const i=resolveComponent("edit"),r=resolveComponent("el-icon");return e.icon?typeof e.icon=="string"&&e.icon.startsWith("http")?(openBlock(),createElementBlock("img",{key:1,src:e.icon},null,8,_hoisted_1$t)):typeof e.icon=="string"?(openBlock(),createElementBlock("i",{key:2,class:normalizeClass(e.icon)},null,2)):(openBlock(),createBlock(r,{key:3},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(e.toRaw(e.icon))))]),_:1})):(openBlock(),createBlock(r,{key:0},{default:withCtx(()=>[createVNode(i)]),_:1}))}var MIcon=_export_sfc(_sfc_main$P,[["render",_sfc_render$K]]);const _sfc_main$O=defineComponent({components:{MIcon,ArrowDown},props:{data:{type:[Object,String],require:!0,default:()=>({type:"text",display:!1})}},setup(e){const t=inject("services"),o=t==null?void 0:t.uiService,n=()=>o==null?void 0:o.set("zoom",l.value+.1),a=()=>o==null?void 0:o.set("zoom",l.value-.1),l=computed(()=>{var c;return(c=o==null?void 0:o.get("zoom"))!=null?c:1}),i=computed(()=>{var c;return(c=o==null?void 0:o.get("showGuides"))!=null?c:!0}),r=computed(()=>{var c;return(c=o==null?void 0:o.get("showRule"))!=null?c:!0}),s=computed(()=>{if(typeof e.data!="string")return e.data;switch(e.data){case"/":return{type:"divider"};case"zoom":return{type:"zoom"};case"delete":return{type:"button",icon:Delete,tooltip:"\u522A\u9664",disabled:()=>{var c;return((c=t==null?void 0:t.editorService.get("node"))==null?void 0:c.type)==="page"},handler:()=>t==null?void 0:t.editorService.remove(t==null?void 0:t.editorService.get("node"))};case"undo":return{type:"button",icon:Back,tooltip:"\u540E\u9000",disabled:()=>!(t==null?void 0:t.historyService.state.canUndo),handler:()=>t==null?void 0:t.editorService.undo()};case"redo":return{type:"button",icon:Right,tooltip:"\u524D\u8FDB",disabled:()=>!(t==null?void 0:t.historyService.state.canRedo),handler:()=>t==null?void 0:t.editorService.redo()};case"zoom-in":return{type:"button",icon:ZoomIn,tooltip:"\u653E\u5927",handler:n};case"zoom-out":return{type:"button",icon:ZoomOut,tooltip:"\u7E2E\u5C0F",handler:a};case"rule":return{type:"button",icon:ScaleToOriginal,tooltip:r.value?"\u9690\u85CF\u6807\u5C3A":"\u663E\u793A\u6807\u5C3A",handler:()=>o==null?void 0:o.set("showRule",!r.value)};case"guides":return{type:"button",icon:Grid,tooltip:i.value?"\u9690\u85CF\u53C2\u8003\u7EBF":"\u663E\u793A\u53C2\u8003\u7EBF",handler:()=>o==null?void 0:o.set("showGuides",!i.value)};default:return{type:"text",text:e.data}}}),d=computed(()=>typeof s.value=="string"||s.value.type==="component"?!1:typeof s.value.disabled=="function"?s.value.disabled(t):s.value.disabled);return{ZoomIn,ZoomOut,item:s,zoom:l,disabled:d,display:computed(()=>{var c;return s.value?typeof s.value=="string"?!0:typeof s.value.display=="function"?s.value.display(t):(c=s.value.display)!=null?c:!0:!1}),zoomInHandler:n,zoomOutHandler:a,dropdownHandler(c){c.item.handler&&c.item.handler(t)},buttonHandler(c){var u;d.value||typeof c.handler=="function"&&((u=c.handler)==null||u.call(c,t))}}}}),_hoisted_1$s={key:0,class:"menu-item"},_hoisted_2$g={key:1,class:"menu-item-text"},_hoisted_3$d={class:"menu-item-text",style:{margin:"0 5px"}},_hoisted_4$b={class:"el-dropdown-link menubar-menu-button"};function _sfc_render$J(e,t,o,n,a,l){const i=resolveComponent("el-divider"),r=resolveComponent("m-icon"),s=resolveComponent("el-button"),d=resolveComponent("el-tooltip"),c=resolveComponent("arrow-down"),u=resolveComponent("el-icon"),m=resolveComponent("el-dropdown-item"),h=resolveComponent("el-dropdown-menu"),f=resolveComponent("el-dropdown");return e.display?(openBlock(),createElementBlock("div",_hoisted_1$s,[e.item.type==="divider"?(openBlock(),createBlock(i,{key:0,direction:"vertical"})):e.item.type==="text"?(openBlock(),createElementBlock("div",_hoisted_2$g,toDisplayString(e.item.text),1)):e.item.type==="zoom"?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(r,{icon:e.ZoomIn,onClick:e.zoomInHandler},null,8,["icon","onClick"]),createBaseVNode("span",_hoisted_3$d,toDisplayString(parseInt(`${e.zoom*100}`,10))+"%",1),createVNode(r,{icon:e.ZoomOut,onClick:e.zoomOutHandler},null,8,["icon","onClick"])],64)):e.item.type==="button"?(openBlock(),createBlock(d,{key:3,effect:"dark",placement:"bottom-start",content:e.item.tooltip||e.item.text},{default:withCtx(()=>[createVNode(s,{size:"small",type:"text",disabled:e.disabled,onClick:t[0]||(t[0]=_=>e.buttonHandler(e.item))},{default:withCtx(()=>[createVNode(r,{icon:e.item.icon},null,8,["icon"]),createBaseVNode("span",null,toDisplayString(e.item.text),1)]),_:1},8,["disabled"])]),_:1},8,["content"])):e.item.type==="dropdown"?(openBlock(),createBlock(f,{key:4,trigger:"click",disabled:e.disabled,onCommand:e.dropdownHandler},{dropdown:withCtx(()=>[e.item.items&&e.item.items.length?(openBlock(),createBlock(h,{key:0},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.item.items,(_,B)=>(openBlock(),createBlock(m,{key:B,command:{item:e.item,subItem:_}},{default:withCtx(()=>[createTextVNode(toDisplayString(_.text),1)]),_:2},1032,["command"]))),128))]),_:1})):createCommentVNode("",!0)]),default:withCtx(()=>[createBaseVNode("span",_hoisted_4$b,[createTextVNode(toDisplayString(e.item.text),1),createVNode(u,{class:"el-icon--right"},{default:withCtx(()=>[createVNode(c)]),_:1})])]),_:1},8,["disabled","onCommand"])):e.item.type==="component"?(openBlock(),createBlock(resolveDynamicComponent(e.item.component),normalizeProps(mergeProps({key:5},e.item.props||{})),null,16)):createCommentVNode("",!0)])):createCommentVNode("",!0)}var ToolButton=_export_sfc(_sfc_main$O,[["render",_sfc_render$J]]);const _sfc_main$N=defineComponent({name:"nav-menu",components:{ToolButton},props:{data:{type:Object,default:()=>({})},height:{type:Number}},setup(e){const t=inject("services");return{keys:computed(()=>Object.keys(e.data)),columnWidth:computed(()=>t==null?void 0:t.uiService.get("columnWidth"))}}});function _sfc_render$I(e,t,o,n,a,l){const i=resolveComponent("tool-button");return openBlock(),createElementBlock("div",{class:"m-editor-nav-menu",style:normalizeStyle({height:`${e.height}px`})},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.keys,r=>{var s;return openBlock(),createElementBlock("div",{class:normalizeClass(`menu-${r}`),key:r,style:normalizeStyle(`width: ${(s=e.columnWidth)==null?void 0:s[r]}px`)},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.data[r],(d,c)=>(openBlock(),createBlock(i,{data:d,key:c},null,8,["data"]))),128))],6)}),128))],4)}var NavMenu=_export_sfc(_sfc_main$N,[["render",_sfc_render$I]]);const _sfc_main$M=defineComponent({name:"m-editor-props-panel",emits:["mounted"],setup(e,{emit:t}){const o=getCurrentInstance(),n=ref({}),a=ref(),l=ref([]),i=inject("services"),r=computed(()=>i==null?void 0:i.editorService.get("node")),s=async()=>{if(!r.value){l.value=[];return}n.value=r.value;const d=r.value.type||(r.value.items?"container":"text");l.value=await(i==null?void 0:i.propsService.getPropsConfig(d))||[]};return watchEffect(s),i==null||i.propsService.on("props-configs-change",s),onMounted(()=>{t("mounted",o)}),{values:n,configForm:a,curFormConfig:l,async submit(){var d;try{const c=await((d=a.value)==null?void 0:d.submitForm());i==null||i.editorService.update(c)}catch(c){console.error(c),ElMessage.closeAll(),ElMessage.error({duration:1e4,showClose:!0,message:c.message,dangerouslyUseHTMLString:!0})}}}}});function _sfc_render$H(e,t,o,n,a,l){const i=resolveComponent("m-form");return openBlock(),createBlock(i,{class:"m-editor-props-panel","popper-class":"m-editor-props-panel-popper",ref:"configForm",size:"small","init-values":e.values,config:e.curFormConfig,onChange:e.submit},null,8,["init-values","config","onChange"])}var PropsPanel=_export_sfc(_sfc_main$M,[["render",_sfc_render$H]]);const _sfc_main$L=defineComponent({name:"ui-component-panel",components:{MIcon},setup(){const e=ref(""),t=inject("services"),o=computed(()=>t==null?void 0:t.componentListService.getList().map(a=>V(w({},a),{items:a.items.filter(l=>l.text.includes(e.value))}))),n=computed(()=>{var a;return Array((a=o.value)==null?void 0:a.length).fill(1).map((l,i)=>i)});return{searchText:e,collapseValue:n,list:o,appendComponent(r){var s=r,{text:a,type:l}=s,i=z(s,["text","type"]);t==null||t.editorService.add(w({name:a,type:l},i))}}}}),_hoisted_1$r=createBaseVNode("i",{class:"el-icon-s-grid"},null,-1),_hoisted_2$f=["onClick"];function _sfc_render$G(e,t,o,n,a,l){const i=resolveComponent("el-input"),r=resolveComponent("m-icon"),s=resolveComponent("el-tooltip"),d=resolveComponent("el-collapse-item"),c=resolveComponent("el-collapse"),u=resolveComponent("el-scrollbar");return openBlock(),createBlock(u,null,{default:withCtx(()=>[createVNode(c,{class:"ui-component-panel","model-value":e.collapseValue},{default:withCtx(()=>[createVNode(i,{"prefix-icon":"el-icon-search",placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4",class:"search-input",size:"small",clearable:"",modelValue:e.searchText,"onUpdate:modelValue":t[0]||(t[0]=m=>e.searchText=m)},null,8,["modelValue"]),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.list,(m,h)=>(openBlock(),createElementBlock(Fragment,null,[m.items&&m.items.length?(openBlock(),createBlock(d,{key:h,name:h},{title:withCtx(()=>[_hoisted_1$r,createTextVNode(toDisplayString(m.title),1)]),default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(m.items,f=>(openBlock(),createElementBlock("div",{class:"component-item",key:f.type,onClick:_=>e.appendComponent(f)},[createVNode(r,{icon:f.icon},null,8,["icon"]),createVNode(s,{effect:"dark",placement:"bottom",content:f.text},{default:withCtx(()=>[createBaseVNode("span",null,toDisplayString(f.text),1)]),_:2},1032,["content"])],8,_hoisted_2$f))),128))]),_:2},1032,["name"])):createCommentVNode("",!0)],64))),256))]),_:1},8,["model-value"])]),_:1})}var ComponentListPanel=_export_sfc(_sfc_main$L,[["render",_sfc_render$G]]);const _sfc_main$K=defineComponent({name:"magic-editor-content-menu",props:{componentGroupList:{type:Array,default:()=>[]}},setup(e){const t=inject("services"),o=ref(!1),n=computed(()=>t==null?void 0:t.editorService.get("node"));return{subVisible:o,node:n,menu:computed(()=>({app:[{type:"page",text:"\u9875\u9762"}],component:e.componentGroupList})),append(a){t==null||t.editorService.add({name:a.text,type:a.type})},remove(){n.value&&(t==null||t.editorService.remove(n.value))},copy(a){t==null||t.editorService.copy(a)},setSubVisiable(a){o.value=a}}}}),_hoisted_1$q={key:0,class:"magic-editor-content-menu"},_hoisted_2$e=["onClick"],_hoisted_3$c=["onClick"],_hoisted_4$a=createBaseVNode("div",{class:"separation"},null,-1);function _sfc_render$F(e,t,o,n,a,l){const i=resolveComponent("el-scrollbar");return e.node?(openBlock(),createElementBlock("div",_hoisted_1$q,[e.node.items?(openBlock(),createElementBlock("div",{key:0,class:"magic-editor-content-menu-item",onMouseenter:t[0]||(t[0]=r=>e.setSubVisiable(!0)),onMouseleave:t[1]||(t[1]=r=>e.setSubVisiable(!1))}," \u65B0\u589E ",32)):createCommentVNode("",!0),e.node.type!=="app"?(openBlock(),createElementBlock("div",{key:1,class:"magic-editor-content-menu-item",onClick:t[2]||(t[2]=()=>e.copy(e.node))},"\u590D\u5236")):createCommentVNode("",!0),e.node.type!=="app"&&e.node.type!=="page"?(openBlock(),createElementBlock("div",{key:2,class:"magic-editor-content-menu-item",onClick:t[3]||(t[3]=()=>e.remove())}," \u5220\u9664 ")):createCommentVNode("",!0),withDirectives(createBaseVNode("div",{class:"subMenu",onMouseenter:t[5]||(t[5]=r=>e.setSubVisiable(!0)),onMouseleave:t[6]||(t[6]=r=>e.setSubVisiable(!1))},[createVNode(i,null,{default:withCtx(()=>[e.node.type==="tabs"?(openBlock(),createElementBlock("div",{key:0,class:"magic-editor-content-menu-item",onClick:t[4]||(t[4]=()=>e.append({type:"tab-pane"}))}," \u6807\u7B7E ")):e.node.type==="app"?(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(e.menu.app,r=>(openBlock(),createElementBlock("div",{class:"magic-editor-content-menu-item",key:r.type,onClick:()=>e.append(r)},toDisplayString(r.text),9,_hoisted_2$e))),128)):e.node.items?(openBlock(!0),createElementBlock(Fragment,{key:2},renderList(e.menu.component,r=>(openBlock(),createElementBlock("div",{key:r.title},[(openBlock(!0),createElementBlock(Fragment,null,renderList(r.items,s=>(openBlock(),createElementBlock(Fragment,null,[s?(openBlock(),createElementBlock("div",{class:"magic-editor-content-menu-item",key:s.type,onClick:()=>e.append(s)},toDisplayString(s.text),9,_hoisted_3$c)):createCommentVNode("",!0)],64))),256)),_hoisted_4$a]))),128)):createCommentVNode("",!0)]),_:1})],544),[[vShow,e.subVisible]])])):createCommentVNode("",!0)}var LayerMenu=_export_sfc(_sfc_main$K,[["render",_sfc_render$F]]);const select=(e,t)=>{if(!e.id)throw new Error("\u6CA1\u6709id");t==null||t.select(e)},useDrop=(e,t)=>({allowDrop:(o,n,a)=>{const{data:l}=n||{},{data:i}=o,{type:r}=i;return r!=="page"&&l.type==="page"||r==="page"&&l.type!=="page"||!l||!l.type?!1:!!(["prev","next"].includes(a)||l.items||l.type==="container")},handleDragEnd(){if(!e.value)return;const{data:o}=e.value,[n]=o;t==null||t.update(n)}}),useStatus=(e,t)=>{const o=computed(()=>t==null?void 0:t.get("page"));return watchEffect(()=>{if(!e.value)return;const n=t==null?void 0:t.get("node");n&&e.value.setCurrentKey(n.id,!0);const a=t==null?void 0:t.get("parent");if(!(a==null?void 0:a.id))return;const l=e.value.getNode(a.id);l==null||l.updateChildren()}),{values:computed(()=>o.value?[o.value]:[]),loadItems:(n,a)=>{var l,i;if(Array.isArray(n.data))return a(n.data);if(Array.isArray((l=n.data)==null?void 0:l.items))return a((i=n.data)==null?void 0:i.items);a([])}}},useFilter=e=>({filterText:ref(""),filterNode:(t,o)=>{if(!t)return!0;let n="";return o.name?n=o.name:o.type?n=o.type:o.items&&(n="container"),n.indexOf(t)!==-1},filterTextChangeHandler(t){var o;(o=e.value)==null||o.filter(t)}}),useContentMenu=e=>{const t=ref({position:"absolute",left:"0",top:"0",display:"none"});return onMounted(()=>{document.addEventListener("click",()=>{t.value.display="none"},!0)}),{menuStyle:t,contextmenu(o,n){const a=globalThis.document.body.clientHeight,l=`${o.clientX+20}px`;let i=`${o.clientY-10}px`;o.clientY+300>a&&(i=`${a-300}px`),t.value.left=l,t.value.top=i,t.value.display="",select(n,e)}}},_sfc_main$J=defineComponent({name:"magic-editor-layer-panel",components:{LayerMenu},setup(){const e=inject("services"),t=ref(),o=e==null?void 0:e.editorService;return V(w(w(w(w({tree:t},useDrop(t,o)),useStatus(t,o)),useFilter(t)),useContentMenu(o)),{clickHandler(n){if(e==null?void 0:e.uiService.get("uiSelectMode")){document.dispatchEvent(new CustomEvent("ui-select",{detail:n}));return}select(n,o)}})}});function _sfc_render$E(e,t,o,n,a,l){const i=resolveComponent("el-input"),r=resolveComponent("el-tree"),s=resolveComponent("layer-menu"),d=resolveComponent("el-scrollbar");return openBlock(),createBlock(d,{class:"magic-editor-layer-panel"},{default:withCtx(()=>[createVNode(i,{class:"filterInput",size:"small",placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4",clearable:"",modelValue:e.filterText,"onUpdate:modelValue":t[0]||(t[0]=c=>e.filterText=c),onChange:e.filterTextChangeHandler},null,8,["modelValue","onChange"]),e.values.length?(openBlock(),createBlock(r,{key:0,ref:"tree","node-key":"id",draggable:"",load:e.loadItems,data:e.values,"expand-on-click-node":!1,"highlight-current":!0,props:{children:"items"},"filter-node-method":e.filterNode,"allow-drop":e.allowDrop,onNodeClick:e.clickHandler,onNodeContextmenu:e.contextmenu,onNodeDragEnd:e.handleDragEnd,"empty-text":"\u9875\u9762\u7A7A\u8361\u8361\u7684"},{default:withCtx(({node:c,data:u})=>[renderSlot(e.$slots,"layer-node-content",{node:c,data:u},()=>[createBaseVNode("span",null,toDisplayString(`${u.name} (${u.id})`),1)])]),_:3},8,["load","data","filter-node-method","allow-drop","onNodeClick","onNodeContextmenu","onNodeDragEnd"])):createCommentVNode("",!0),(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(s,{style:normalizeStyle(e.menuStyle)},null,8,["style"])]))]),_:3})}var LayerPanel=_export_sfc(_sfc_main$J,[["render",_sfc_render$E]]);const _sfc_main$I=defineComponent({name:"m-sidebar",components:{MIcon},props:{data:{type:Object,default:()=>({type:"tabs",status:"\u7EC4\u4EF6",items:["component-list","layer"]})}},setup(e){var o;const t=ref((o=e.data)==null?void 0:o.status);return watch(()=>{var n;return(n=e.data)==null?void 0:n.status},n=>{t.value=n||"0"}),{activeTabName:t,items:computed(()=>{var n;return(n=e.data)==null?void 0:n.items.map(a=>{if(typeof a!="string")return a;switch(a){case"component-list":return{type:"component",icon:Coin,text:"\u7EC4\u4EF6",component:ComponentListPanel,slots:{}};case"layer":return{type:"component",icon:Files,text:"\u5DF2\u9009\u7EC4\u4EF6",component:LayerPanel,slots:{}};default:return{}}})})}}}),_hoisted_1$p={key:1,class:"magic-editor-tab-panel-title"};function _sfc_render$D(e,t,o,n,a,l){const i=resolveComponent("m-icon"),r=resolveComponent("el-tab-pane"),s=resolveComponent("el-tabs");return e.data.type==="tabs"?(openBlock(),createBlock(s,{key:0,class:"m-editor-sidebar",modelValue:e.activeTabName,"onUpdate:modelValue":t[0]||(t[0]=d=>e.activeTabName=d),type:"card","tab-position":"left"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.items,d=>(openBlock(),createBlock(r,{key:d.text,name:d.text},{label:withCtx(()=>[createBaseVNode("span",null,[d.icon?(openBlock(),createBlock(i,{key:0,icon:d.icon},null,8,["icon"])):createCommentVNode("",!0),d.text?(openBlock(),createElementBlock("div",_hoisted_1$p,toDisplayString(d.text),1)):createCommentVNode("",!0)])]),default:withCtx(()=>{var c;return[(openBlock(),createBlock(resolveDynamicComponent(d.component),mergeProps(d.props||{},toHandlers(d.listeners||{})),createSlots({_:2},[((c=d.slots)==null?void 0:c.layerNodeContent)?{name:"layer-node-content",fn:withCtx(({data:u,node:m})=>[(openBlock(),createBlock(resolveDynamicComponent(d.slots.layerNodeContent),{data:u,node:m},null,8,["data","node"]))])}:void 0]),1040))]}),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])):createCommentVNode("",!0)}var Sidebar=_export_sfc(_sfc_main$I,[["render",_sfc_render$D]]);const _sfc_main$H=defineComponent({components:{CaretBottom,Plus},setup(){const e=inject("services"),t=e==null?void 0:e.editorService;return{root:computed(()=>t==null?void 0:t.get("root")),page:computed(()=>t==null?void 0:t.get("page")),switchPage(o){t==null||t.select(o)},addPage(){if(!t)return;const o={type:"page",name:generatePageNameByApp(toRaw(t.get("root")))};t.add(o)},copy(o){o&&(t==null||t.copy(o)),t==null||t.paste({left:0,top:0})},remove(o){t==null||t.remove(o)}}}}),_hoisted_1$o={class:"m-editor-page-bar"},_hoisted_2$d=["onClick"],_hoisted_3$b=["onClick"],_hoisted_4$9=["onClick"];function _sfc_render$C(e,t,o,n,a,l){const i=resolveComponent("plus"),r=resolveComponent("el-icon"),s=resolveComponent("caret-bottom"),d=resolveComponent("el-popover");return openBlock(),createElementBlock("div",_hoisted_1$o,[createBaseVNode("div",{class:"m-editor-page-bar-item",onClick:t[0]||(t[0]=(...c)=>e.addPage&&e.addPage(...c))},[createVNode(r,{class:"m-editor-page-bar-menu-add-icon"},{default:withCtx(()=>[createVNode(i)]),_:1})]),e.root?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.root.items,c=>{var u;return openBlock(),createElementBlock("div",{key:c.key,class:normalizeClass(["m-editor-page-bar-item",{active:((u=e.page)==null?void 0:u.id)===c.id}]),onClick:m=>e.switchPage(c)},[renderSlot(e.$slots,"page-bar-title",{page:c},()=>[createBaseVNode("span",null,toDisplayString(c.name),1)]),createVNode(d,{placement:"top",width:160,trigger:"hover"},{reference:withCtx(()=>[createVNode(r,{class:"m-editor-page-bar-menu-icon"},{default:withCtx(()=>[createVNode(s)]),_:1})]),default:withCtx(()=>[createBaseVNode("div",null,[renderSlot(e.$slots,"page-bar-popover",{page:c},()=>[createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:()=>e.copy(c)},"\u590D\u5236",8,_hoisted_3$b),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:()=>e.remove(c)},"\u5220\u9664",8,_hoisted_4$9)])])]),_:2},1024)],10,_hoisted_2$d)}),128)):createCommentVNode("",!0)])}var PageBar=_export_sfc(_sfc_main$H,[["render",_sfc_render$C]]);const GHOST_EL_ID_PREFIX="ghost_el_",DEFAULT_ZOOM=1;var GuidesType=(e=>(e.HORIZONTAL="horizontal",e.VERTICAL="vertical",e))(GuidesType||{}),ZIndex=(e=>(e.MASK="99999",e))(ZIndex||{}),MouseButton=(e=>(e[e.LEFT=0]="LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.RIGHT=2]="RIGHT",e))(MouseButton||{}),Mode=(e=>(e.ABSOLUTE="absolute",e.FIXED="fixed",e.SORTABLE="sortable",e))(Mode||{});const getOffset=e=>{const{transform:t}=getComputedStyle(e),{offsetParent:o}=e;let n=e.offsetLeft,a=e.offsetTop;if(t.indexOf("matrix")>-1){let l=1,i=1,r=1,s=1,d=0,c=0;t.replace(/matrix\((.+), (.+), (.+), (.+), (.+), (.+)\)/,(u,m,h,f,_,B,g)=>(l=+m,i=+h,r=+f,s=+_,d=+B,c=+g,t)),n=l*n+r*a+d,a=i*n+s*a+c}if(o){const l=getOffset(o);return{left:n+l.left,top:a+l.top}}return{left:n,top:a}},getAbsolutePosition=(e,{top:t,left:o})=>{const{offsetParent:n}=e;if(n){const a=getOffset(n);return{left:o-a.left,top:t-a.top}}return{left:o,top:t}},getHost=e=>{var t;return(t=e.match(/\/\/([^/]+)/))==null?void 0:t[1]},isSameDomain=(e="",t=globalThis.location.host)=>/^(http[s]?:)?\/\//.test(e)?getHost(e)===t:!0,isAbsolute=e=>e?getComputedStyle(e).position==="absolute":!1,isRelative=e=>e?getComputedStyle(e).position==="relative":!1,isStatic=e=>e?getComputedStyle(e).position==="static":!1,isFixed=e=>e?getComputedStyle(e).position==="fixed":!1,isFixedParent=e=>{let t=!1,o=e;for(;o&&(t=isFixed(o),!t);){const{parentElement:n}=o;if(!n||n.tagName==="BODY")break;o=n}return t},getMode=e=>isFixedParent(e)?Mode.FIXED:isStatic(e)||isRelative(e)?Mode.SORTABLE:Mode.ABSOLUTE,getScrollParent=(e,t=!1)=>{let o=getComputedStyle(e);const n=t?/(auto|scroll|hidden)/:/(auto|scroll)/;if(isFixed(e))return null;for(let a=e;a.parentElement;)if(a=a.parentElement,o=getComputedStyle(a),!(isAbsolute(e)&&isStatic(e))&&n.test(o.overflow+o.overflowY+o.overflowX))return a;return null},createDiv=({className:e,cssText:t})=>{const o=globalThis.document.createElement("div");return o.className=e,o.style.cssText=t,o};class StageDragResize extends events.exports.EventEmitter{constructor(t){super();y(this,"core");y(this,"container");y(this,"target");y(this,"dragEl");y(this,"moveable");y(this,"horizontalGuidelines",[]);y(this,"verticalGuidelines",[]);y(this,"moveableOptions",{});y(this,"dragStatus","end");y(this,"ghostEl");y(this,"mode",Mode.ABSOLUTE);this.core=t.core,this.container=t.container}async select(t,o){var n;this.target=t,/(auto|scroll)/.test(this.target.style.overflow)&&(this.target.style.overflow="hidden"),this.mode=getMode(t),this.destroyDragEl(),this.destroyGhostEl(),this.dragEl=this.generateDragEl(t),this.moveableOptions=await this.getOptions({target:this.dragEl||this.target}),this.initMoveable(),o&&((n=this.moveable)==null||n.dragStart(o))}async refresh(){if(!this.moveable)throw new Error("\u672A\u521D\u59CB\u5316moveable");const t=await this.getOptions();Object.entries(t).forEach(([o,n])=>{this.moveable[o]=n}),this.moveable.updateTarget()}setGuidelines(t,o){t===GuidesType.HORIZONTAL?this.horizontalGuidelines=o:t===GuidesType.VERTICAL&&(this.verticalGuidelines=o),this.refresh()}clearGuides(){this.verticalGuidelines=[],this.horizontalGuidelines=[],this.refresh()}destroy(){var t;(t=this.moveable)==null||t.destroy(),this.destroyGhostEl(),this.destroyDragEl(),this.dragStatus="end",this.removeAllListeners()}initMoveable(){var t;(t=this.moveable)==null||t.destroy(),this.moveable=new Moveable(this.container,w({},this.moveableOptions)),this.bindResizeEvent(),this.bindDragEvent()}bindResizeEvent(){if(!this.moveable)throw new Error("moveable \u4E3A\u521D\u59CB\u5316");this.moveable.on("resizeStart",t=>{if(t.dragStart){const o=this.moveable.getRect(),n=getAbsolutePosition(t.target,o);t.dragStart.set([n.left,n.top])}}).on("resize",({width:t,height:o,drag:n})=>{if(!this.moveable||!this.target||!this.dragEl)return;const{beforeTranslate:a}=n;if(this.dragStatus="ing",this.target.style.width=`${t}px`,this.target.style.height=`${o}px`,this.dragEl.style.width=`${t}px`,this.dragEl.style.height=`${o}px`,this.mode===Mode.SORTABLE){this.dragEl.style.top=`${a[1]}px`,this.target.style.top="0px";return}this.dragEl.style.left=`${a[0]}px`,this.dragEl.style.top=`${a[1]}px`;const l=getAbsolutePosition(this.target,{left:a[0],top:a[1]});this.target.style.left=`${l.left}px`,this.target.style.top=`${l.top}px`}).on("resizeEnd",()=>{this.dragStatus="end",this.update(!0)})}bindDragEvent(){if(!this.moveable)throw new Error("moveable \u4E3A\u521D\u59CB\u5316");this.moveable.on("dragStart",()=>{if(!this.target)throw new Error("\u672A\u9009\u4E2D\u7EC4\u4EF6");this.dragStatus="start",this.mode===Mode.SORTABLE&&(this.ghostEl=this.generateGhostEl(this.target))}).on("drag",({left:t,top:o})=>{if(!this.target||!this.dragEl)return;this.dragStatus="ing";const n=getAbsolutePosition(this.target,{left:t,top:o});if(this.ghostEl){this.dragEl.style.top=`${o}px`,this.ghostEl.style.top=`${n.top}px`;return}this.dragEl.style.left=`${t}px`,this.dragEl.style.top=`${o}px`,this.target.style.left=`${n.left}px`,this.target.style.top=`${n.top}px`}).on("dragEnd",()=>{if(this.dragStatus==="ing")switch(this.mode){case Mode.SORTABLE:this.sort();break;default:this.update()}this.dragStatus="end",this.destroyGhostEl()})}async getSnapElements(t){var a;const{renderer:o}=this.core;return(((a=await o.getRuntime())==null?void 0:a.getSnapElements)||(()=>{var i;const l=(i=o.contentWindow)==null?void 0:i.document;return l?Array.from(l.querySelectorAll("[id]")):[]}))(t).filter(l=>{var i;return l!==this.target&&!((i=this.target)==null?void 0:i.contains(l))})}sort(){if(!this.target||!this.ghostEl)throw new Error("\u672A\u77E5\u9519\u8BEF");const{top:t}=this.ghostEl.getBoundingClientRect(),{top:o}=this.target.getBoundingClientRect(),n=t-o;Math.abs(n)>=this.target.clientHeight/2?n>0?this.emit("sort",down(n,this.target)):this.emit("sort",up(n,this.target)):this.emit("sort",{src:this.target.id,dist:this.target.id})}update(t=!1){const o=this.moveable.getRect(),n=this.mode===Mode.SORTABLE?{left:0,top:0}:getAbsolutePosition(this.target,o),a=this.calcValueByFontsize(n.left),l=this.calcValueByFontsize(n.top),i=this.calcValueByFontsize(o.width),r=this.calcValueByFontsize(o.height);this.emit("update",{el:this.target,style:t?{left:a,top:l,width:i,height:r}:{left:a,top:l}})}generateGhostEl(t){this.ghostEl&&this.destroyGhostEl();const o=t.cloneNode(!0),{top:n,left:a}=getAbsolutePosition(t,getOffset(t));return o.id=`${GHOST_EL_ID_PREFIX}${o.id}`,o.style.zIndex="5",o.style.opacity=".5",o.style.position="absolute",o.style.left=`${a}px`,o.style.top=`${n}px`,t.after(o),o}destroyGhostEl(){var t;(t=this.ghostEl)==null||t.remove(),this.ghostEl=void 0}generateDragEl(t){this.dragEl&&this.destroyDragEl();const{width:o,height:n}=t.getBoundingClientRect(),a=getOffset(t),l=globalThis.document.createElement("div");return l.style.cssText=`
      position: absolute;
      left: ${a.left}px;
      top: ${a.top}px;
      width: ${o}px;
      height: ${n}px;
    `,this.container.append(l),l}destroyDragEl(){var t;(t=this.dragEl)==null||t.remove(),this.dragEl=void 0}async getOptions(t={}){if(!this.target)return{};const o=this.mode===Mode.ABSOLUTE;let{moveableOptions:n={}}=this.core.config;return typeof n=="function"&&(n=n(this.core)),w(w({scrollable:!0,origin:!0,zoom:1,dragArea:!0,draggable:!0,resizable:!0,snappable:o,snapGap:o,snapDirections:{center:o,middle:o},elementSnapDirections:{center:o,middle:o},elementGuidelines:o?await this.getSnapElements(this.target):[],horizontalGuidelines:this.horizontalGuidelines,verticalGuidelines:this.verticalGuidelines,bounds:w({top:0,left:0,right:this.container.clientWidth,bottom:this.container.clientHeight},n.bounds||{})},t),n)}calcValueByFontsize(t){const{contentWindow:o}=this.core.renderer,n=o==null?void 0:o.document.documentElement.style.fontSize;if(n){const a=globalThis.parseFloat(n)/100;return(t/a).toFixed(2)}return t}}const down=(e,t)=>{var r,s;let o=0,n=t.clientHeight;const a=Array.from(((r=t.parentNode)==null?void 0:r.children)||[]).filter(d=>!d.id.startsWith(GHOST_EL_ID_PREFIX)),l=a.indexOf(t),i=a.slice(l+1);for(let d=0;d<i.length;d++){const c=i[d];if(((s=c.style)==null?void 0:s.position)!=="fixed"){if(n+=c.clientHeight/2,e<=n)break;n+=c.clientHeight/2,o=d}}return{src:t.id,dist:i.length&&o>-1?i[o].id:t.id}},up=(e,t)=>{var r;const o=Array.from(((r=t.parentNode)==null?void 0:r.children)||[]).filter(s=>!s.id.startsWith(GHOST_EL_ID_PREFIX)),n=o.indexOf(t),a=o.slice(0,n);let l=t.clientHeight,i=a.length-1;for(let s=a.length-1;s>=0;s--){const d=a[s];if(!!d&&d.style.position!=="fixed"){if(l+=d.clientHeight/2,-e<=l)break;l+=d.clientHeight/2,i=s}}return{src:t.id,dist:a.length&&i>-1?a[i].id:t.id}};class Rule extends EventEmitter{constructor(t){super();y(this,"hGuides");y(this,"vGuides");y(this,"horizontalGuidelines",[]);y(this,"verticalGuidelines",[]);y(this,"container");y(this,"containerResizeObserver");y(this,"getGuidesStyle",t=>({position:"fixed",zIndex:1,left:t===GuidesType.HORIZONTAL?0:"-30px",top:t===GuidesType.HORIZONTAL?"-30px":0,width:t===GuidesType.HORIZONTAL?"100%":"30px",height:t===GuidesType.HORIZONTAL?"30px":"100%"}));y(this,"createGuides",(t,o=[])=>new Guides(this.container,{type:t,defaultGuides:o,displayDragPos:!0,backgroundColor:"#fff",lineColor:"#000",textColor:"#000",style:this.getGuidesStyle(t)}));y(this,"hGuidesChangeGuidesHandler",t=>{this.horizontalGuidelines=t.guides,this.emit("changeGuides",{type:GuidesType.HORIZONTAL,guides:this.horizontalGuidelines})});y(this,"vGuidesChangeGuidesHandler",t=>{this.verticalGuidelines=t.guides,this.emit("changeGuides",{type:GuidesType.VERTICAL,guides:this.verticalGuidelines})});this.container=t,this.hGuides=this.createGuides(GuidesType.HORIZONTAL),this.vGuides=this.createGuides(GuidesType.VERTICAL),this.hGuides.on("changeGuides",this.hGuidesChangeGuidesHandler),this.vGuides.on("changeGuides",this.vGuidesChangeGuidesHandler),this.containerResizeObserver=new ResizeObserver(()=>{this.vGuides.resize(),this.hGuides.resize()}),this.containerResizeObserver.observe(this.container)}showGuides(t=!0){this.hGuides.setState({showGuides:t}),this.vGuides.setState({showGuides:t})}clearGuides(){this.horizontalGuidelines=[],this.verticalGuidelines=[],this.vGuides.setState({defaultGuides:[]}),this.hGuides.setState({defaultGuides:[]}),this.emit("changeGuides",{type:GuidesType.VERTICAL,guides:[]}),this.emit("changeGuides",{type:GuidesType.HORIZONTAL,guides:[]})}showRule(t=!0){t?(this.hGuides.destroy(),this.hGuides=this.createGuides(GuidesType.HORIZONTAL,this.horizontalGuidelines),this.vGuides.destroy(),this.vGuides=this.createGuides(GuidesType.VERTICAL,this.verticalGuidelines)):(this.hGuides.setState({rulerStyle:{visibility:"hidden"}}),this.vGuides.setState({rulerStyle:{visibility:"hidden"}}))}scrollRule(t){this.hGuides.scrollGuides(t),this.hGuides.scroll(0),this.vGuides.scrollGuides(0),this.vGuides.scroll(t)}destroy(){this.hGuides.off("changeGuides",this.hGuidesChangeGuidesHandler),this.vGuides.off("changeGuides",this.vGuidesChangeGuidesHandler),this.containerResizeObserver.disconnect(),this.removeAllListeners()}}const wrapperClassName="editor-mask-wrapper",hideScrollbar=()=>{const e=globalThis.document.createElement("style");e.innerHTML=`
    .${wrapperClassName}::-webkit-scrollbar { width: 0 !important; display: none }
  `,globalThis.document.head.appendChild(e)},createContent=()=>createDiv({className:"editor-mask",cssText:`
    position: absolute;
    top: 0;
    left: 0;
    transform: translate3d(0, 0, 0);
  `}),createWrapper=()=>{const e=createDiv({className:wrapperClassName,cssText:`
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      z-index: ${ZIndex.MASK};
    `});return hideScrollbar(),e};class StageMask extends Rule{constructor(t){const o=createWrapper();super(o);y(this,"content",createContent());y(this,"wrapper");y(this,"core");y(this,"page",null);y(this,"pageScrollParent",null);y(this,"scrollTop",0);y(this,"scrollLeft",0);y(this,"width",0);y(this,"height",0);y(this,"wrapperHeight",0);y(this,"wrapperWidth",0);y(this,"mode",Mode.ABSOLUTE);y(this,"pageResizeObserver",null);y(this,"wrapperResizeObserver",null);y(this,"mouseDownHandler",async t=>{t.stopImmediatePropagation(),t.stopPropagation(),!(t.button!==MouseButton.LEFT&&t.button!==MouseButton.RIGHT)&&t.target.className.indexOf("moveable-control")===-1&&(this.emit("beforeSelect",t),globalThis.document.addEventListener("mouseup",this.mouseUpHandler))});y(this,"mouseUpHandler",()=>{globalThis.document.removeEventListener("mouseup",this.mouseUpHandler),this.emit("select")});y(this,"mouseWheelHandler",t=>{if(!this.page)throw new Error("page \u672A\u521D\u59CB\u5316");const{deltaY:o,deltaX:n}=t,{height:a,wrapperHeight:l,width:i,wrapperWidth:r}=this,s=a-l,d=i-r;s>0&&(o>0?this.scrollTop=this.scrollTop+Math.min(s-this.scrollTop,o):this.scrollTop=Math.max(this.scrollTop+o,0)),i>r&&(n>0?this.scrollLeft=this.scrollLeft+Math.min(d-this.scrollLeft,n):this.scrollLeft=Math.max(this.scrollLeft+n,0)),this.mode!==Mode.FIXED&&this.scrollTo(this.scrollLeft,this.scrollTop),this.pageScrollParent&&this.pageScrollParent.scrollTo({top:this.scrollTop,left:this.scrollLeft}),this.scroll(),this.emit("scroll",t)});this.wrapper=o,this.core=t.core,this.content.addEventListener("mousedown",this.mouseDownHandler),this.wrapper.appendChild(this.content),this.content.addEventListener("wheel",this.mouseWheelHandler)}setMode(t){this.mode=t,this.scroll(),t===Mode.FIXED?(this.content.style.width=`${this.wrapperWidth}px`,this.content.style.height=`${this.wrapperHeight}px`):(this.content.style.width=`${this.width}px`,this.content.style.height=`${this.height}px`)}observe(t){var o,n;!t||(this.page=t,this.pageScrollParent=getScrollParent(t)||((o=this.core.renderer.contentWindow)==null?void 0:o.document.documentElement)||null,(n=this.pageResizeObserver)==null||n.disconnect(),typeof ResizeObserver!="undefined"&&(this.pageResizeObserver=new ResizeObserver(a=>{const[l]=a,{clientHeight:i,clientWidth:r}=l.target;this.setHeight(i),this.setWidth(r)}),this.pageResizeObserver.observe(t),this.wrapperResizeObserver=new ResizeObserver(a=>{const[l]=a,{clientHeight:i,clientWidth:r}=l.target;this.wrapperHeight=i,this.wrapperWidth=r}),this.wrapperResizeObserver.observe(this.wrapper)))}mount(t){if(!this.content)throw new Error("content \u4E0D\u5B58\u5728");t.appendChild(this.wrapper)}setLayout(t){this.setMode(isFixedParent(t)?Mode.FIXED:Mode.ABSOLUTE)}destroy(){var t,o,n;(t=this.content)==null||t.remove(),this.page=null,this.pageScrollParent=null,(o=this.pageResizeObserver)==null||o.disconnect(),(n=this.wrapperResizeObserver)==null||n.disconnect(),super.destroy()}scroll(){let{scrollLeft:t,scrollTop:o}=this;this.mode===Mode.FIXED&&(t=0,o=0),this.scrollRule(o),this.scrollTo(t,o)}scrollTo(t,o){this.content.style.transform=`translate3d(${-t}px, ${-o}px, 0)`}setHeight(t){this.height=t,this.content.style.height=`${t}px`}setWidth(t){this.width=t,this.content.style.width=`${t}px`}}class StageRender extends events.exports.EventEmitter{constructor({core:t}){super();y(this,"contentWindow",null);y(this,"runtime",null);y(this,"iframe");y(this,"runtimeUrl");y(this,"core");y(this,"render");y(this,"getMagicApi",()=>({onPageElUpdate:t=>this.emit("page-el-update",t),onRuntimeReady:t=>{this.runtime=t,globalThis.runtime=t,this.emit("runtime-ready",t)}}));y(this,"getRuntime",()=>this.runtime?Promise.resolve(this.runtime):new Promise(t=>{const o=n=>{this.off("runtime-ready",o),t(n)};this.on("runtime-ready",o)}));y(this,"loadHandler",async()=>{var t,o,n;if(this.emit("onload"),this.render){const a=await this.render(this.core);a&&((n=(o=(t=this.iframe)==null?void 0:t.contentDocument)==null?void 0:o.body)==null||n.appendChild(a))}});this.core=t,this.runtimeUrl=t.config.runtimeUrl||"",this.render=t.config.render,this.iframe=globalThis.document.createElement("iframe"),this.iframe.src=isSameDomain(this.runtimeUrl)?this.runtimeUrl:"",this.iframe.style.cssText=`
      border: 0;
      width: 100%;
      height: 100%;
    `,this.iframe.addEventListener("load",this.loadHandler)}async mount(t){var o;if(this.iframe){if(!isSameDomain(this.runtimeUrl)&&this.runtimeUrl){let n=await fetch(this.runtimeUrl).then(l=>l.text());const a=`${location.protocol}//${getHost(this.runtimeUrl)}`;n=n.replace("<head>",`<head>
<base href="${a}">`),this.iframe.srcdoc=n}t.appendChild(this.iframe),this.contentWindow=(o=this.iframe)==null?void 0:o.contentWindow,this.contentWindow.magic=this.getMagicApi()}else throw Error("mount \u5931\u8D25")}destroy(){var t,o;(t=this.iframe)==null||t.removeEventListener("load",this.loadHandler),this.contentWindow=null,(o=this.iframe)==null||o.remove(),this.iframe=void 0,this.removeAllListeners()}}class StageCore extends events.exports.EventEmitter{constructor(t){super();y(this,"selectedDom");y(this,"renderer");y(this,"mask");y(this,"dr");y(this,"config");y(this,"zoom",DEFAULT_ZOOM);y(this,"canSelect");this.config=t,this.setZoom(t.zoom),this.canSelect=t.canSelect||(o=>!!o.id),this.renderer=new StageRender({core:this}),this.mask=new StageMask({core:this}),this.dr=new StageDragResize({core:this,container:this.mask.content}),this.renderer.on("runtime-ready",o=>this.emit("runtime-ready",o)),this.renderer.on("page-el-update",o=>{var n;return(n=this.mask)==null?void 0:n.observe(o)}),this.mask.on("beforeSelect",o=>{this.setElementFromPoint(o)}).on("select",()=>{this.emit("select",this.selectedDom)}).on("changeGuides",o=>{this.dr.setGuidelines(o.type,o.guides),this.emit("changeGuides",o)}),this.dr.on("update",o=>{setTimeout(()=>this.emit("update",o))}).on("sort",o=>{setTimeout(()=>this.emit("sort",o))})}async setElementFromPoint(t){var c;const{renderer:o,zoom:n}=this,a=(c=o.contentWindow)==null?void 0:c.document;let l=t.clientX,i=t.clientY;if(o.iframe){const u=o.iframe.getClientRects()[0];u&&(l=l-u.left,i=i-u.top)}const r=a==null?void 0:a.elementsFromPoint(l/n,i/n);let s=!1;const d=()=>s=!0;for(const u of r)if(!u.id.startsWith(GHOST_EL_ID_PREFIX)&&await this.canSelect(u,d)){if(s)break;this.select(u,t);break}}async select(t,o){var l,i,r,s;let n;if(typeof t=="string"||typeof t=="number"){const d=await((l=this.renderer)==null?void 0:l.getRuntime());if(n=await((i=d==null?void 0:d.select)==null?void 0:i.call(d,`${t}`)),!n)throw new Error(`\u4E0D\u5B58\u5728ID\u4E3A${t}\u7684\u5143\u7D20`)}else n=t;if(n===this.selectedDom)return;const a=await((r=this.renderer)==null?void 0:r.getRuntime());(a==null?void 0:a.beforeSelect)&&await a.beforeSelect(n),this.mask.setLayout(n),(s=this.dr)==null||s.select(n,o),this.selectedDom=n}update(t){var n;const{config:o}=t;(n=this.renderer)==null||n.getRuntime().then(a=>{var l;(l=a==null?void 0:a.update)==null||l.call(a,t),setTimeout(()=>{var r,s;const i=(r=this.renderer.contentWindow)==null?void 0:r.document.getElementById(`${o.id}`);i&&(this.mask.setLayout(i),(s=this.dr)==null||s.select(i))},0)})}sortNode(t){var o;(o=this.renderer)==null||o.getRuntime().then(n=>{var a;return(a=n==null?void 0:n.sortNode)==null?void 0:a.call(n,t)})}add(t){var o;(o=this.renderer)==null||o.getRuntime().then(n=>{var a;return(a=n==null?void 0:n.add)==null?void 0:a.call(n,t)})}remove(t){var o;(o=this.renderer)==null||o.getRuntime().then(n=>{var a;return(a=n==null?void 0:n.remove)==null?void 0:a.call(n,t)})}setZoom(t=DEFAULT_ZOOM){this.zoom=t}mount(t){const{mask:o,renderer:n}=this;n.mount(t),o.mount(t),this.emit("mounted")}clearGuides(){this.mask.clearGuides(),this.dr.clearGuides()}destroy(){const{mask:t,renderer:o,dr:n}=this;o.destroy(),t.destroy(),n.destroy(),this.removeAllListeners()}}class ScrollViewer$1{constructor(t){y(this,"enter",!1);y(this,"targetEnter",!1);y(this,"keydown",!1);y(this,"container");y(this,"target");y(this,"zoom",1);y(this,"scrollLeft",0);y(this,"scrollTop",0);y(this,"x",0);y(this,"y",0);y(this,"resizeObserver",new ResizeObserver(t=>{for(const{contentRect:o}of t){const{width:n,height:a}=o,l=this.target.getBoundingClientRect(),i=l.width*this.zoom,r=Number(this.target.style.marginTop)||0,s=(l.height+r)*this.zoom;i<n&&(this.target._left=0),s<a&&(this.target._top=0),this.scroll()}}));y(this,"wheelHandler",t=>{if(this.targetEnter)return;const{deltaX:o,deltaY:n,currentTarget:a}=t;a===this.container&&(this.setScrollOffset(o,n),this.scroll(),this.scrollLeft=this.target._left,this.scrollTop=this.target._top)});y(this,"mouseEnterHandler",()=>{this.enter=!0});y(this,"mouseLeaveHandler",()=>{this.enter=!1});y(this,"targetMouseEnterHandler",()=>{this.targetEnter=!0});y(this,"targetMouseLeaveHandler",()=>{this.targetEnter=!1});y(this,"mousedownHandler",t=>{!this.keydown||(t.stopImmediatePropagation(),t.stopPropagation(),this.target.style.cursor="grabbing",this.x=t.clientX,this.y=t.clientY,document.addEventListener("mousemove",this.mousemoveHandler),document.addEventListener("mouseup",this.mouseupHandler))});y(this,"mouseupHandler",()=>{this.x=0,this.y=0,this.scrollLeft=this.target._left,this.scrollTop=this.target._top,this.removeHandler()});y(this,"mousemoveHandler",t=>{t.stopImmediatePropagation(),t.stopPropagation();const o=t.clientX-this.x,n=t.clientY-this.y;this.setScrollOffset(o,n),this.scroll()});y(this,"keydownHandler",t=>{t.code===Keys.ESCAPE&&this.enter&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()),!(t.code!==Keys.ESCAPE||!this.enter||this.keydown)&&(this.keydown=!0,this.target.style.cursor="grab",this.container.addEventListener("mousedown",this.mousedownHandler))});y(this,"keyupHandler",t=>{t.code!==Keys.ESCAPE||!this.keydown||(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),this.keydown=!1,t.preventDefault(),this.removeHandler())});this.container=t.container,this.target=t.target,this.zoom=t.zoom,globalThis.addEventListener("keydown",this.keydownHandler),globalThis.addEventListener("keyup",this.keyupHandler),this.container.addEventListener("mouseenter",this.mouseEnterHandler),this.container.addEventListener("mouseleave",this.mouseLeaveHandler),this.target.addEventListener("mouseenter",this.targetMouseEnterHandler),this.target.addEventListener("mouseleave",this.targetMouseLeaveHandler),this.container.addEventListener("wheel",this.wheelHandler),this.resizeObserver.observe(this.container)}destroy(){this.resizeObserver.disconnect(),this.container.removeEventListener("mouseenter",this.mouseEnterHandler),this.container.removeEventListener("mouseleave",this.mouseLeaveHandler),this.target.removeEventListener("mouseenter",this.targetMouseEnterHandler),this.target.removeEventListener("mouseleave",this.targetMouseLeaveHandler),globalThis.removeEventListener("keydown",this.keydownHandler),globalThis.removeEventListener("keyup",this.keyupHandler)}setZoom(t){this.zoom=t}scroll(){const t=this.target._left,o=this.target._top;this.target.style.transform=`translate(${t}px, ${o}px)`}removeHandler(){this.target.style.cursor="",this.target.removeEventListener("mousedown",this.mousedownHandler),document.removeEventListener("mousemove",this.mousemoveHandler),document.removeEventListener("mouseup",this.mouseupHandler)}setScrollOffset(t,o){const{width:n,height:a}=this.container.getBoundingClientRect(),l=this.target.getBoundingClientRect(),i=l.width*this.zoom,r=l.height*this.zoom;let s=0;r>a&&(o>0?s=this.scrollTop+Math.min(r-a-this.scrollTop,o):s=this.scrollTop+Math.max(-(r-a+this.scrollTop),o));let d=0;i>n&&(t>0?d=this.scrollLeft+Math.min(i-n-this.scrollLeft,t):d=this.scrollLeft+Math.max(-(i-n+this.scrollLeft),t)),this.target._left=d,this.target._top=s}}const _sfc_main$G=defineComponent({name:"m-editor-scroll-viewer",props:{width:Number,height:Number,zoom:{type:Number,default:1}},setup(e){const t=ref(),o=ref();let n;return onMounted(()=>{!t.value||!o.value||(n=new ScrollViewer$1({container:t.value,target:o.value,zoom:e.zoom}))}),onUnmounted(()=>{n.destroy()}),watch(()=>e.zoom,()=>{n.setZoom(e.zoom)}),{container:t,el:o,style:computed(()=>`
        width: ${e.width}px;
        height: ${e.height}px;
        position: absolute;
        margin-top: 30px;
      `)}}}),_hoisted_1$n={class:"m-editor-scroll-viewer-container",ref:"container"};function _sfc_render$B(e,t,o,n,a,l){return openBlock(),createElementBlock("div",_hoisted_1$n,[createBaseVNode("div",{ref:"el",style:normalizeStyle(e.style)},[renderSlot(e.$slots,"default")],4)],512)}var ScrollViewer=_export_sfc(_sfc_main$G,[["render",_sfc_render$B]]);const _sfc_main$F=defineComponent({name:"magic-editor-ui-viewer-menu",setup(){const e=inject("services"),t=e==null?void 0:e.editorService,o=ref(),n=ref(!1),a=ref(!1),l=computed(()=>t==null?void 0:t.get("node")),i=computed(()=>t==null?void 0:t.get("parent"));return onMounted(()=>{const r=globalThis.localStorage.getItem(COPY_STORAGE_KEY);n.value=r!=="undefined"&&!!r}),watch(i,async()=>{var s;if(!i.value||!t)return a.value=!1;const r=await t.getLayout(i.value);a.value=[Layout.ABSOLUTE,Layout.FIXED].includes(r)&&!["app","page","pop"].includes(`${(s=l.value)==null?void 0:s.type}`)},{immediate:!0}),{menu:o,canPaste:n,canDelete:computed(()=>{var r;return((r=l.value)==null?void 0:r.type)!=="page"}),canMoveZPos:computed(()=>{var r;return((r=l.value)==null?void 0:r.type)!=="page"}),canCenter:a,center(){l.value&&(t==null||t.alignCenter(l.value))},copy(){l.value&&(t==null||t.copy(l.value)),n.value=!0},paste(){var d,c;const r=((d=o.value)==null?void 0:d.offsetTop)||0,s=((c=o.value)==null?void 0:c.offsetLeft)||0;t==null||t.paste({left:s,top:r})},remove(){l.value&&(t==null||t.remove(l.value))},top(){t==null||t.moveLayer(LayerOffset.TOP)},bottom(){t==null||t.moveLayer(LayerOffset.BOTTOM)},topItem(){t==null||t.moveLayer(1)},bottomItem(){t==null||t.moveLayer(-1)},clearGuides(){t==null||t.get("stage").clearGuides()}}}}),_hoisted_1$m={class:"magic-editor-content-menu",ref:"menu"},_hoisted_2$c=createBaseVNode("div",{class:"separation"},null,-1),_hoisted_3$a=createBaseVNode("div",{class:"separation"},null,-1),_hoisted_4$8=createBaseVNode("div",{class:"separation"},null,-1);function _sfc_render$A(e,t,o,n,a,l){return openBlock(),createElementBlock("div",_hoisted_1$m,[createBaseVNode("div",null,[e.canCenter?(openBlock(),createElementBlock("div",{key:0,class:"magic-editor-content-menu-item",onClick:t[0]||(t[0]=()=>e.center())},"\u6C34\u5E73\u5C45\u4E2D")):createCommentVNode("",!0),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[1]||(t[1]=()=>e.copy())},"\u590D\u5236"),e.canPaste?(openBlock(),createElementBlock("div",{key:1,class:"magic-editor-content-menu-item",onClick:t[2]||(t[2]=(...i)=>e.paste&&e.paste(...i))},"\u7C98\u8D34")):createCommentVNode("",!0),e.canMoveZPos?(openBlock(),createElementBlock(Fragment,{key:2},[_hoisted_2$c,createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[3]||(t[3]=(...i)=>e.topItem&&e.topItem(...i))},"\u4E0A\u79FB\u4E00\u5C42"),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[4]||(t[4]=(...i)=>e.bottomItem&&e.bottomItem(...i))},"\u4E0B\u79FB\u4E00\u5C42"),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[5]||(t[5]=(...i)=>e.top&&e.top(...i))},"\u7F6E\u9876"),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[6]||(t[6]=(...i)=>e.bottom&&e.bottom(...i))},"\u7F6E\u5E95")],64)):createCommentVNode("",!0),e.canDelete?(openBlock(),createElementBlock(Fragment,{key:3},[_hoisted_3$a,createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[7]||(t[7]=()=>e.remove())},"\u5220\u9664")],64)):createCommentVNode("",!0),_hoisted_4$8,createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[8]||(t[8]=(...i)=>e.clearGuides&&e.clearGuides(...i))},"\u6E05\u7A7A\u53C2\u8003\u7EBF")])],512)}var ViewerMenu=_export_sfc(_sfc_main$F,[["render",_sfc_render$A]]);const useMenu=()=>{const e=ref(),t=ref({display:"none",left:"0",top:"0"});return onMounted(()=>{document.addEventListener("click",()=>{t.value.display="none"},!0)}),{menu:e,menuStyle:t,contextmenuHandler(o){var l;o.preventDefault();const n=(l=e.value)==null?void 0:l.$el.clientHeight;let a=o.clientY;n+o.clientY>document.body.clientHeight&&(a=document.body.clientHeight-n),t.value={display:"block",top:`${a}px`,left:`${o.clientX}px`}}}},_sfc_main$E=defineComponent({name:"magic-stage",components:{ViewerMenu,ScrollViewer},props:{render:{type:Function},runtimeUrl:String,canSelect:{type:Function,default:e=>Boolean(e.id)},moveableOptions:{type:[Object,Function],default:()=>e=>{var t,o;return{container:(o=(t=e==null?void 0:e.renderer)==null?void 0:t.contentWindow)==null?void 0:o.document.getElementById("app")}}}},emits:["select","update","sort"],setup(e,{emit:t}){const o=inject("services"),n=ref(),a=ref(),l=computed(()=>o==null?void 0:o.uiService.get("stageRect")),i=computed(()=>o==null?void 0:o.uiService.get("uiSelectMode")),r=computed(()=>o==null?void 0:o.editorService.get("root")),s=computed(()=>o==null?void 0:o.editorService.get("page")),d=computed(()=>o==null?void 0:o.uiService.get("zoom")),c=computed(()=>o==null?void 0:o.editorService.get("node"));let u=null,m=null;watchEffect(()=>{var f;u||!a.value||!(e.runtimeUrl||e.render)||!r.value||(u=new StageCore({render:e.render,runtimeUrl:e.runtimeUrl,zoom:d.value,canSelect:(_,B)=>{const g=e.canSelect(_);return i.value&&g?(document.dispatchEvent(new CustomEvent("ui-select",{detail:_})),B()):g},moveableOptions:e.moveableOptions}),o==null||o.editorService.set("stage",u),u==null||u.mount(a.value),u==null||u.on("select",_=>t("select",_)),u==null||u.on("update",_=>{t("update",{id:_.el.id,style:_.style})}),u==null||u.on("sort",_=>{t("sort",_)}),u==null||u.on("changeGuides",()=>{o==null||o.uiService.set("showGuides",!0)}),!!((f=c.value)==null?void 0:f.id)&&(u==null||u.on("runtime-ready",_=>{var B,g;m=_,r.value&&(m==null||m.updateRootConfig(cloneDeep(toRaw(r.value)))),((B=s.value)==null?void 0:B.id)&&((g=m==null?void 0:m.updatePageId)==null||g.call(m,s.value.id)),setTimeout(()=>{c.value&&(u==null||u.select(toRaw(c.value.id)))})})))}),watch(d,f=>{!u||!f||u.setZoom(f)}),watch(r,f=>{m&&f&&m.updateRootConfig(cloneDeep(toRaw(f)))}),watch(()=>{var f;return(f=c.value)==null?void 0:f.id},f=>{nextTick(()=>{f&&(u==null||u.select(f))})});const h=new ResizeObserver(f=>{for(const{contentRect:_}of f)o==null||o.uiService.set("stageContainerRect",{width:_.width,height:_.height})});return onMounted(()=>{var f;((f=n.value)==null?void 0:f.container)&&h.observe(n.value.container)}),onUnmounted(()=>{u==null||u.destroy(),h.disconnect(),o==null||o.editorService.set("stage",null)}),w({stageWrap:n,stageContainer:a,stageRect:l,zoom:d},useMenu())}});function _sfc_render$z(e,t,o,n,a,l){var s,d;const i=resolveComponent("viewer-menu"),r=resolveComponent("scroll-viewer");return openBlock(),createBlock(r,{class:"m-editor-stage",ref:"stageWrap",width:(s=e.stageRect)==null?void 0:s.width,height:(d=e.stageRect)==null?void 0:d.height,zoom:e.zoom},{default:withCtx(()=>[createBaseVNode("div",{class:"m-editor-stage-container",ref:"stageContainer",onContextmenu:t[0]||(t[0]=(...c)=>e.contextmenuHandler&&e.contextmenuHandler(...c)),style:normalizeStyle(`transform: scale(${e.zoom})`)},null,36),(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(i,{ref:"menu",style:normalizeStyle(e.menuStyle)},null,8,["style"])]))]),_:1},8,["width","height","zoom"])}var MagicStage=_export_sfc(_sfc_main$E,[["render",_sfc_render$z]]);const _sfc_main$D=defineComponent({name:"m-editor-workspace",components:{PageBar,MagicStage},props:{runtimeUrl:String,render:{type:Function},moveableOptions:{type:[Object,Function]},canSelect:{type:Function}},setup(){const e=inject("services");return{page:computed(()=>e==null?void 0:e.editorService.get("page")),selectHandler(t){e==null||e.editorService.select(t.id)},updateNodeHandler(t){e==null||e.editorService.update(t)},sortNodeHandler(t){e==null||e.editorService.sort(t.src,t.dist)}}}}),_hoisted_1$l={class:"m-editor-workspace"};function _sfc_render$y(e,t,o,n,a,l){var s;const i=resolveComponent("magic-stage"),r=resolveComponent("page-bar");return openBlock(),createElementBlock("div",_hoisted_1$l,[(openBlock(),createBlock(i,{key:(s=e.page)==null?void 0:s.id,"runtime-url":e.runtimeUrl,render:e.render,"moveable-options":e.moveableOptions,"can-select":e.canSelect,onSelect:e.selectHandler,onUpdate:e.updateNodeHandler,onSort:e.sortNodeHandler},null,8,["runtime-url","render","moveable-options","can-select","onSelect","onUpdate","onSort"])),renderSlot(e.$slots,"workspace-content"),createVNode(r,null,{"page-bar-title":withCtx(({page:d})=>[renderSlot(e.$slots,"page-bar-title",{page:d})]),"page-bar-popover":withCtx(({page:d})=>[renderSlot(e.$slots,"page-bar-popover",{page:d})]),_:3})])}var Workspace=_export_sfc(_sfc_main$D,[["render",_sfc_render$y]]);class ComponentList extends BaseService{constructor(){super([]);y(this,"state",reactive({list:[]}))}setList(t){this.state.list=t}getList(){return this.state.list}}var componentListService=new ComponentList;const state=reactive({uiSelectMode:!1,showSrc:!1,zoom:1,stageContainerRect:{width:0,height:0},stageRect:{width:375,height:817},columnWidth:{left:310,center:globalThis.document.body.clientWidth-310-400,right:400},showGuides:!0,showRule:!0});class Ui extends BaseService{constructor(){super([]);globalThis.addEventListener("resize",()=>{this.setColumnWidth({center:"auto"})})}set(t,o){var a;const n=(a=editorService.get("stage"))==null?void 0:a.mask;if(t==="columnWidth"){this.setColumnWidth(o);return}if(t==="stageRect"){this.setStageRect(o);return}t==="showGuides"&&(n==null||n.showGuides(o)),t==="showRule"&&(n==null||n.showRule(o)),state[t]=o,t==="stageContainerRect"&&(state.zoom=this.calcZoom())}get(t){return state[t]}setColumnWidth({left:t,center:o,right:n}){const a=w({},toRaw(this.get("columnWidth")));if(t&&(a.left=t),n&&(a.right=n),!o||o==="auto"){const l=globalThis.document.body.clientWidth;a.center=l-((a==null?void 0:a.left)||0)-((a==null?void 0:a.right)||0)}else a.center=o;state.columnWidth=a}setStageRect(t){state.stageRect=w(w({},state.stageRect),t),state.zoom=this.calcZoom()}calcZoom(){const{stageRect:t,stageContainerRect:o}=state,{height:n,width:a}=o;return!a||!n||a>t.width&&n>t.height?1:Math.min((a-100)/t.width||1,(n-100)/t.height||1)}}var uiService=new Ui;const _sfc_main$C=defineComponent({name:"m-editor",components:{NavMenu,Sidebar,Workspace,PropsPanel,Framework},props:{modelValue:{type:Object,default:()=>({}),require:!0},componentGroupList:{type:Array,default:()=>[]},sidebar:{type:Object},menu:{type:Object,default:()=>({left:[],right:[]})},render:{type:Function},runtimeUrl:String,propsConfigs:{type:Object,default:()=>({})},propsValues:{type:Object,default:()=>({})},eventMethodList:{type:Object,default:()=>({})},moveableOptions:{type:[Object,Function]},defaultSelected:{type:[Number,String]},canSelect:{type:Function},stageRect:{type:[String,Object]}},emits:["props-panel-mounted","update:modelValue"],setup(e,{emit:t}){editorService.on("root-change",()=>{const n=editorService.get("node")||e.defaultSelected;n&&editorService.select(n),t("update:modelValue",toRaw(editorService.get("root")))}),watch(()=>e.modelValue,n=>editorService.set("root",n),{immediate:!0}),watch(()=>e.componentGroupList,n=>componentListService.setList(n),{immediate:!0}),watch(()=>e.propsConfigs,n=>propsService.setPropsConfigs(n),{immediate:!0}),watch(()=>e.propsValues,n=>propsService.setPropsValues(n),{immediate:!0}),watch(()=>e.eventMethodList,n=>{const a={},l={};Object.keys(n).forEach(i=>{a[i]=n[i].events,l[i]=n[i].methods}),eventsService.setEvents(a),eventsService.setMethods(l)},{immediate:!0}),watch(()=>e.defaultSelected,n=>n&&editorService.select(n),{immediate:!0}),watch(()=>e.stageRect,n=>n&&uiService.set("stageRect",n),{immediate:!0}),onUnmounted(()=>editorService.destroy());const o={componentListService,eventsService,historyService,propsService,editorService,uiService};return provide("services",o),o}});function _sfc_render$x(e,t,o,n,a,l){const i=resolveComponent("nav-menu"),r=resolveComponent("sidebar"),s=resolveComponent("workspace"),d=resolveComponent("props-panel"),c=resolveComponent("framework");return openBlock(),createBlock(c,null,{nav:withCtx(()=>[renderSlot(e.$slots,"nav",{editorService:e.editorService},()=>[createVNode(i,{data:e.menu},null,8,["data"])])]),sidebar:withCtx(()=>[renderSlot(e.$slots,"sidebar",{editorService:e.editorService},()=>[createVNode(r,{data:e.sidebar},null,8,["data"])])]),workspace:withCtx(()=>[renderSlot(e.$slots,"workspace",{},()=>[createVNode(s,{"runtime-url":e.runtimeUrl,render:e.render,"moveable-options":e.moveableOptions,"can-select":e.canSelect},{"workspace-content":withCtx(()=>[renderSlot(e.$slots,"workspace-content",{editorService:e.editorService})]),"page-bar-title":withCtx(({page:u})=>[renderSlot(e.$slots,"page-bar-title",{page:u})]),"page-bar-popover":withCtx(({page:u})=>[renderSlot(e.$slots,"page-bar-popover",{page:u})]),_:3},8,["runtime-url","render","moveable-options","can-select"])])]),propsPanel:withCtx(()=>[renderSlot(e.$slots,"propsPanel",{},()=>[createVNode(d,{ref:"propsPanel",onMounted:t[0]||(t[0]=u=>e.$emit("props-panel-mounted",u))},null,512)])]),empty:withCtx(()=>[renderSlot(e.$slots,"empty",{editorService:e.editorService})]),_:3})}var Editor$1=_export_sfc(_sfc_main$C,[["render",_sfc_render$x]]),index$2="";const defaultInstallOpt$1={};var MagicEditor={install:(e,t)=>{const o=Object.assign(defaultInstallOpt$1,t||{});e.config.globalProperties.$TMAGIC_EDITOR=o,e.component(Editor$1.name,Editor$1),e.component(uiSelect.name,uiSelect),e.component(CodeLink.name,CodeLink),e.component(Code.name,Code),e.component(CodeEditor.name,CodeEditor)}};const isTableSelect=e=>typeof e=="string"&&["table-select","tableSelect"].includes(e),asyncLoadConfig=(e,t,{asyncLoad:o,name:n,type:a})=>{a==="html"&&typeof o=="object"&&typeof n!="undefined"&&(o.name=n,e.asyncLoad=typeof t.asyncLoad=="object"?t.asyncLoad:o)},isMultipleValue=e=>typeof e=="string"&&["checkbox-group","checkboxGroup","table","cascader","group-list","groupList","dynamic-tab","dynamicTab"].includes(e),initItemsValue=(e,t,o,{items:n,name:a,extensible:l})=>{Array.isArray(o[a])?t[a]=o[a].map(i=>init(e,n,i)):(t[a]=init(e,n,o[a],t[a]),l&&(t[a]=Object.assign({},o[a],t[a])))},setValue=(e,t,o,n)=>{const{items:a,name:l,type:i,checkbox:r}=n;isMultipleValue(i)&&(t[l]=o[l]||[]),a?initItemsValue(e,t,o,n):t[l]=getDefaultValue(e,n),i==="fieldset"&&r&&typeof t[l]=="object"&&(t[l].value=typeof o[l]=="object"&&o[l].value||0)},initValueItem=function(e,t,o,n){const{items:a}=t,{names:l}=t,{type:i,name:r}=t;return isTableSelect(i)&&r?(n[r]=o[r]||"",n):(asyncLoadConfig(n,o,t),r&&!a&&typeof o[r]!="undefined"?(typeof n[r]=="undefined"&&(n[r]=typeof o[r]=="object"?cloneDeep(o[r]):o[r]),n):l?l.forEach(s=>n[s]=o[s]||""):r?(setValue(e,n,o,t),n):init(e,a,o,n))},init=function(e,t=[],o={},n={}){return Array.isArray(t)&&t.forEach(a=>{initValueItem(e,a,o,n)}),n},getDefaultValue=function(e,{defaultValue:t,type:o,filter:n,multiple:a}){if(typeof t=="function")return t(e);if(t!=="undefined")return typeof t!="undefined"?t:o==="number"||n==="number"?0:["switch","checkbox"].includes(o)?!1:a?[]:""},filterFunction=(e,t,o)=>typeof t!="function"?t:t(e,{values:(e==null?void 0:e.initValues)||{},model:o.model,parent:(e==null?void 0:e.parentValues)||{},formValue:(e==null?void 0:e.values)||o.model,prop:o.prop}),display=function(e,t,o){return typeof t=="function"?filterFunction(e,t,o):t!==!1},getRules=function(e,t=[],o){return t=cloneDeep(t),typeof t=="object"&&!Array.isArray(t)&&(t=[t]),t.map(n=>{if(typeof n.validator=="function"){const a=n.validator;n.validator=(l,i,r,s,d)=>a({rule:l,value:i,callback:r,source:s,options:d},{values:(e==null?void 0:e.initValues)||{},model:o.model,parent:(e==null?void 0:e.parentValues)||{},formValue:(e==null?void 0:e.values)||o.model,prop:o.prop},e)}return n})},initValue=async(e,{initValues:t,config:o})=>{if(!Array.isArray(o))throw new Error("config\u5E94\u8BE5\u4E3A\u6570\u7EC4");let n=init(e,o,toRaw(t),{});const[a]=o;return a&&typeof a.onInitValue=="function"&&(n=await a.onInitValue(e,{formValue:n,initValue:t})),n||{}},_sfc_main$B=defineComponent({name:"m-form-container",props:{labelWidth:String,expandMore:Boolean,model:{type:[Object,Array],required:!0},config:{type:Object,required:!0},prop:{type:String,default:()=>""},stepActive:{type:[String,Number]},size:{type:String,default:"small"}},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(!1),a=computed(()=>e.config.name||""),l=computed(()=>e.config.items),i=computed(()=>a.value?`${e.prop}${e.prop?".":""}${a.value}`:e.prop),r=computed(()=>{const b=resolveComponent(`m-${l.value?"form":"fields"}-${m.value}`);return typeof b!="string"?b:"m-fields-text"}),s=computed(()=>filterFunction(o,e.config.disabled,e)),d=computed(()=>filterFunction(o,e.config.tooltip,e)),c=computed(()=>filterFunction(o,e.config.extra,e)),u=computed(()=>getRules(o,e.config.rules,e)),m=computed(()=>{let{type:b}=e.config;return typeof b=="function"&&(b=b(o,{model:e.model})),b==="form"?"":(b==null?void 0:b.replace(/([A-Z])/g,"-$1").toLowerCase())||(l.value?"":"text")}),h=computed(()=>e.config.display==="expand"?n.value:display(o,e.config.display,e));watchEffect(()=>{n.value=e.expandMore});const f=()=>n.value=!n.value,_=b=>b[o==null?void 0:o.keyProps],B=(b,k)=>typeof b=="function"?b(o,k,{model:e.model,values:o==null?void 0:o.initValues,formValue:o==null?void 0:o.values,prop:i.value}):b==="number"?+k:k,g=(b,k)=>{if(typeof b=="function")return b(o,k,{model:e.model,values:o==null?void 0:o.initValues,formValue:o==null?void 0:o.values,prop:i.value})},$=(b,k)=>{if(typeof k=="string"&&b)return k.replace(/^\s*/,"").replace(/\s*$/,"")};return{expand:n,name:a,type:m,disabled:s,itemProp:i,items:l,display:h,tagName:r,rule:u,tooltip:d,extra:c,key:_,onChangeHandler:async function(b,k){var A,D;const{filter:E,onChange:S,trim:L,name:N,dynamicKey:H}=e.config;let T=b;try{T=B(E,b),T=(A=await g(S,T))!=null?A:T,T=(D=$(L,T))!=null?D:T}catch(O){console.error(O)}(N||N===0)&&e.model!==T&&(b!==T||e.model[N]!==T)&&(e.model[N]=T),k!==void 0&&H&&(e.model[k]=T),t("change",e.model)},expandHandler:f}}}),_hoisted_1$k=["innerHTML"],_hoisted_2$b=["innerHTML"],_hoisted_3$9=["innerHTML"],_hoisted_4$7=createBaseVNode("i",{class:"el-icon-warning"},null,-1),_hoisted_5$5=["innerHTML"],_hoisted_6$3={key:4,style:{"text-align":"center"}};function _sfc_render$w(e,t,o,n,a,l){const i=resolveComponent("m-fields-hidden"),r=resolveComponent("el-tooltip"),s=resolveComponent("el-form-item"),d=resolveComponent("m-form-container"),c=resolveComponent("el-button");return e.config?(openBlock(),createElementBlock("div",{key:0,style:normalizeStyle(e.config.tip?"display: flex":""),class:normalizeClass([e.config.className,"m-form-container"])},[e.type==="hidden"?(openBlock(),createBlock(i,{key:0,model:e.model,config:e.config,name:e.config.name,disabled:e.disabled,prop:e.itemProp},null,8,["model","config","name","disabled","prop"])):e.items&&!e.config.text&&e.type&&e.display?(openBlock(),createBlock(resolveDynamicComponent(e.tagName),{key:e.key(e.config),size:e.size,model:e.model,config:e.config,name:e.name,prop:e.itemProp,"step-active":e.stepActive,"expand-more":e.expand,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.onChangeHandler},null,8,["size","model","config","name","prop","step-active","expand-more","label-width","onChange"])):e.type&&e.display?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(s,{style:normalizeStyle(e.config.tip?"flex: 1":""),prop:e.itemProp,"label-width":e.config.text?e.config.labelWidth||e.labelWidth:"0",rules:e.rule},{label:withCtx(()=>[createBaseVNode("span",{innerHTML:e.type==="checkbox"?"":e.config.text},null,8,_hoisted_1$k)]),default:withCtx(()=>[e.tooltip?(openBlock(),createBlock(r,{key:0},{content:withCtx(()=>[createBaseVNode("div",{innerHTML:e.tooltip},null,8,_hoisted_2$b)]),default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(e.tagName),{key:e.key(e.config),size:e.size,model:e.model,config:e.config,name:e.name,disabled:e.disabled,prop:e.itemProp,onChange:e.onChangeHandler},null,8,["size","model","config","name","disabled","prop","onChange"]))]),_:1})):(openBlock(),createBlock(resolveDynamicComponent(e.tagName),{key:e.key(e.config),size:e.size,model:e.model,config:e.config,name:e.name,disabled:e.disabled,prop:e.itemProp,onChange:e.onChangeHandler},null,8,["size","model","config","name","disabled","prop","onChange"])),e.extra?(openBlock(),createElementBlock("div",{key:2,innerHTML:e.extra,class:"m-form-tip"},null,8,_hoisted_3$9)):createCommentVNode("",!0)]),_:1},8,["style","prop","label-width","rules"]),e.config.tip?(openBlock(),createBlock(r,{key:0,placement:"top",style:{"line-height":"40px","margin-left":"5px"}},{content:withCtx(()=>[createBaseVNode("div",{innerHTML:e.config.tip},null,8,_hoisted_5$5)]),default:withCtx(()=>[_hoisted_4$7]),_:1})):createCommentVNode("",!0)],64)):e.items&&e.display?(openBlock(),createElementBlock(Fragment,{key:3},[(e.name||e.name===0?e.model[e.name]:e.model)?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.items,u=>(openBlock(),createBlock(d,{key:e.key(u),model:e.name||e.name===0?e.model[e.name]:e.model,config:u,size:e.size,"step-active":e.stepActive,"expand-more":e.expand,"label-width":e.config.labelWidth||e.labelWidth,prop:e.itemProp,onChange:e.onChangeHandler},null,8,["model","config","size","step-active","expand-more","label-width","prop","onChange"]))),128)):createCommentVNode("",!0)],64)):createCommentVNode("",!0),e.config.expand&&e.type!=="fieldset"?(openBlock(),createElementBlock("div",_hoisted_6$3,[createVNode(c,{type:"text",onClick:e.expandHandler},{default:withCtx(()=>[createTextVNode(toDisplayString(e.expand?"\u6536\u8D77\u914D\u7F6E":"\u5C55\u5F00\u66F4\u591A\u914D\u7F6E"),1)]),_:1},8,["onClick"])])):createCommentVNode("",!0)],6)):createCommentVNode("",!0)}var Container=_export_sfc(_sfc_main$B,[["render",_sfc_render$w]]);const _sfc_main$A=defineComponent({name:"m-form-fieldset",props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},rules:{type:Object,default:()=>({})},prop:{type:String,default:()=>""},size:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=computed(()=>e.config.name||""),a=computed(()=>{var s;return e.config.expand&&n.value?(s=e.model[n.value])==null?void 0:s.value:!0}),l=computed(()=>e.config.items?e.config.labelWidth||e.labelWidth:e.config.labelWidth||e.labelWidth||(e.config.text?null:"0"));return{show:a,name:n,mForm:o,lWidth:l,key:(s,d)=>{var c;return(c=s[(o==null?void 0:o.keyProp)||"__key"])!=null?c:d},change:()=>{t("change",e.model)}}}}),_hoisted_1$j=["innerHTML"],_hoisted_2$a=["innerHTML"],_hoisted_3$8={key:1},_hoisted_4$6=["innerHTML"],_hoisted_5$4=["innerHTML"],_hoisted_6$2={key:2},_hoisted_7$2=["innerHTML"],_hoisted_8$1=["innerHTML"],_hoisted_9$1={key:3,style:{display:"flex"}},_hoisted_10$1={style:{flex:"1"}},_hoisted_11=["src"];function _sfc_render$v(e,t,o,n,a,l){const i=resolveComponent("el-checkbox"),r=resolveComponent("m-form-container");return(e.name?e.model[e.name]:e.model)?(openBlock(),createElementBlock("fieldset",{key:0,class:"m-fieldset",style:normalizeStyle(e.show?"padding: 15px 15px 0 5px;":"border: 0")},[!e.show&&e.name?(openBlock(),createBlock(i,{key:0,modelValue:e.model[e.name].value,"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name].value=s),prop:`${e.prop}${e.prop?".":""}${e.config.name}.value`,"true-label":1,"false-label":0,onChange:e.change},{default:withCtx(()=>[createBaseVNode("span",{innerHTML:e.config.legend},null,8,_hoisted_1$j),e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_2$a)):createCommentVNode("",!0)]),_:1},8,["modelValue","prop","onChange"])):e.config.checkbox&&e.name?(openBlock(),createElementBlock("legend",_hoisted_3$8,[createVNode(i,{modelValue:e.model[e.name].value,"onUpdate:modelValue":t[1]||(t[1]=s=>e.model[e.name].value=s),prop:`${e.prop}${e.prop?".":""}${e.config.name}.value`,"true-label":1,"false-label":0,onChange:e.change},{default:withCtx(()=>[createBaseVNode("span",{innerHTML:e.config.legend},null,8,_hoisted_4$6),e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_5$4)):createCommentVNode("",!0)]),_:1},8,["modelValue","prop","onChange"])])):(openBlock(),createElementBlock("legend",_hoisted_6$2,[createBaseVNode("span",{innerHTML:e.config.legend},null,8,_hoisted_7$2),e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_8$1)):createCommentVNode("",!0)])),e.config.schematic&&e.show?(openBlock(),createElementBlock("div",_hoisted_9$1,[createBaseVNode("div",_hoisted_10$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(s,d)=>(openBlock(),createBlock(r,{key:e.key(s,d),model:e.name?e.model[e.name]:e.model,rules:e.name?e.rules[e.name]:[],config:s,prop:e.prop,labelWidth:e.lWidth,size:e.size,onChange:e.change},null,8,["model","rules","config","prop","labelWidth","size","onChange"]))),128))]),createBaseVNode("img",{class:"m-form-schematic",src:e.config.schematic},null,8,_hoisted_11)])):e.show?(openBlock(!0),createElementBlock(Fragment,{key:4},renderList(e.config.items,(s,d)=>(openBlock(),createBlock(r,{key:e.key(s,d),model:e.name?e.model[e.name]:e.model,rules:e.name?e.rules[e.name]:[],config:s,prop:e.prop,labelWidth:e.lWidth,size:e.size,onChange:e.change},null,8,["model","rules","config","prop","labelWidth","size","onChange"]))),128)):createCommentVNode("",!0)],4)):createCommentVNode("",!0)}var Fieldset=_export_sfc(_sfc_main$A,[["render",_sfc_render$v]]);const _sfc_main$z=defineComponent({name:"m-form-group-list-item",components:{CaretRight,CaretBottom:CaretBottom$1},props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,size:String,index:{type:[Number,String,Symbol],default:0},groupModel:{type:Array,default:()=>[]}},emits:["swap-item","remove-item","change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(!1);watchEffect(()=>{n.value=!e.index});const a=computed(()=>({type:"row",span:e.config.span||24,items:e.config.items,labelWidth:e.config.labelWidth,[(o==null?void 0:o.keyProp)||"__key"]:`${e.config[(o==null?void 0:o.keyProp)||"__key"]}${String(e.index)}`})),l=computed(()=>e.config.titleKey&&e.model[e.config.titleKey]?e.model[e.config.titleKey]:`\u7EC4 ${String(e.index)}`),i=computed(()=>{var f;return((f=e.groupModel)==null?void 0:f.length)||0}),r=computed(()=>filterFunction(o,e.config.itemExtra,e));return{expand:n,expandHandler:()=>{n.value=!n.value},title:l,showDelete:f=>{const _=e.config.delete;return _&&typeof _=="function"?_(e.model,f,o==null?void 0:o.values):!0},removeHandler:()=>t("remove-item",e.index),movable:()=>{const{movable:f}=e.config;return f===void 0?!0:typeof f=="function"?f(o,e.index||0,e.model,e.groupModel):f},changeOrder:(f=0)=>t("swap-item",e.index,`${String(e.index)}${f}`),itemExtra:r,rowConfig:a,changeHandler:()=>t("change"),length:i,Delete:Delete$1}}}),_hoisted_1$i={class:"m-fields-group-list-item"},_hoisted_2$9=createTextVNode("\u4E0A\u79FB"),_hoisted_3$7=createTextVNode("\u4E0B\u79FB"),_hoisted_4$5=["innerHTML"];function _sfc_render$u(e,t,o,n,a,l){const i=resolveComponent("caret-bottom"),r=resolveComponent("caret-right"),s=resolveComponent("el-icon"),d=resolveComponent("el-button"),c=resolveComponent("CaretRight"),u=resolveComponent("CaretBottom"),m=resolveComponent("m-form-container");return openBlock(),createElementBlock("div",_hoisted_1$i,[createBaseVNode("div",null,[createVNode(s,{style:{"margin-right":"7px"},onClick:e.expandHandler},{default:withCtx(()=>[e.expand?(openBlock(),createBlock(i,{key:0})):(openBlock(),createBlock(r,{key:1}))]),_:1},8,["onClick"]),createVNode(d,{type:"text",onClick:e.expandHandler},{default:withCtx(()=>[createTextVNode(toDisplayString(e.title),1)]),_:1},8,["onClick"]),withDirectives(createVNode(d,{type:"text",icon:e.Delete,style:{color:"#f56c6c"},onClick:e.removeHandler},null,8,["icon","onClick"]),[[vShow,e.showDelete(parseInt(String(e.index)))]]),e.movable()?(openBlock(),createElementBlock(Fragment,{key:0},[withDirectives(createVNode(d,{type:"text",size:"small",onClick:t[0]||(t[0]=h=>e.changeOrder(-1))},{default:withCtx(()=>[_hoisted_2$9,createVNode(s,null,{default:withCtx(()=>[createVNode(c)]),_:1})]),_:1},512),[[vShow,e.index!==0]]),withDirectives(createVNode(d,{type:"text",size:"small",onClick:t[1]||(t[1]=h=>e.changeOrder(1))},{default:withCtx(()=>[_hoisted_3$7,createVNode(s,null,{default:withCtx(()=>[createVNode(u)]),_:1})]),_:1},512),[[vShow,e.index!==e.length-1]])],64)):createCommentVNode("",!0),e.itemExtra?(openBlock(),createElementBlock("span",{key:1,innerHTML:e.itemExtra,class:"m-form-tip"},null,8,_hoisted_4$5)):createCommentVNode("",!0)]),e.expand?(openBlock(),createBlock(m,{key:0,config:e.rowConfig,model:e.model,labelWidth:e.labelWidth,prop:`${e.prop}${e.prop?".":""}${String(e.index)}`,size:e.size,onChange:e.changeHandler},null,8,["config","model","labelWidth","prop","size","onChange"])):createCommentVNode("",!0)])}var MFieldsGroupListItem=_export_sfc(_sfc_main$z,[["render",_sfc_render$u]]);const _sfc_main$y=defineComponent({name:"m-form-group-list",components:{MFieldsGroupListItem},props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:{type:String,default:""},size:String,name:{type:String,default:""}},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=computed(()=>e.name?typeof e.config.addable=="function"?e.config.addable(o,{model:e.model[e.name],formValue:o==null?void 0:o.values}):typeof e.config.addable=="undefined"?!0:e.config.addable:!1),a=()=>{if(!e.name)return!1;t("change",e.model[e.name])};return{addable:n,toggleMode:()=>{e.config.type="table",e.config.groupItems=e.config.items,e.config.items=e.config.tableItems||e.config.items.map(d=>V(w({},d),{label:d.label||d.text,text:null}))},removeHandler:d=>{if(!e.name)return!1;e.model[e.name].splice(d,1),a()},swapHandler:(d,c)=>{if(!e.name)return!1;const[u]=e.model[e.name].splice(d,1);e.model[e.name].splice(c,0,u),a()},changeHandler:a,addHandler:async()=>{if(!e.name)return!1;let d={};typeof e.config.defaultAdd=="function"?d=await e.config.defaultAdd(o,{model:e.model[e.name],formValue:o==null?void 0:o.values}):e.config.defaultAdd&&(d=e.config.defaultAdd);const c=await initValue(o,{config:e.config.items,initValues:d});e.model[e.name].push(c)}}}}),_hoisted_1$h={class:"m-fields-group-list"},_hoisted_2$8=["innerHTML"],_hoisted_3$6={key:1,class:"el-table__empty-block"},_hoisted_4$4=createBaseVNode("span",{class:"el-table__empty-text"},"\u6682\u65E0\u6570\u636E",-1),_hoisted_5$3=[_hoisted_4$4],_hoisted_6$1=createTextVNode("\u6DFB\u52A0\u7EC4"),_hoisted_7$1=createTextVNode("\u5207\u6362\u4E3A\u8868\u683C");function _sfc_render$t(e,t,o,n,a,l){const i=resolveComponent("m-fields-group-list-item"),r=resolveComponent("el-button");return openBlock(),createElementBlock("div",_hoisted_1$h,[e.config.extra?(openBlock(),createElementBlock("div",{key:0,innerHTML:e.config.extra,style:{color:"rgba(0, 0, 0, 0.45)"}},null,8,_hoisted_2$8)):createCommentVNode("",!0),!e.model[e.name]||!e.model[e.name].length?(openBlock(),createElementBlock("div",_hoisted_3$6,_hoisted_5$3)):(openBlock(!0),createElementBlock(Fragment,{key:2},renderList(e.model[e.name],(s,d)=>(openBlock(),createBlock(i,{key:d,model:s,config:e.config,prop:e.prop,index:d,"label-width":e.labelWidth,size:e.size,"group-model":e.model[e.name],onRemoveItem:e.removeHandler,onSwapItem:e.swapHandler,onChange:e.changeHandler},null,8,["model","config","prop","index","label-width","size","group-model","onRemoveItem","onSwapItem","onChange"]))),128)),e.addable?(openBlock(),createBlock(r,{key:3,onClick:e.addHandler,size:"small"},{default:withCtx(()=>[_hoisted_6$1]),_:1},8,["onClick"])):createCommentVNode("",!0),e.config.enableToggleMode?(openBlock(),createBlock(r,{key:4,icon:"el-icon-s-grid",size:"small",onClick:e.toggleMode},{default:withCtx(()=>[_hoisted_7$1]),_:1},8,["onClick"])):createCommentVNode("",!0)])}var GroupList=_export_sfc(_sfc_main$y,[["render",_sfc_render$t]]);const _sfc_main$x=defineComponent({name:"m-form-panel",components:{CaretBottom:CaretBottom$1,CaretRight},props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,size:String,name:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(e.config.expand!==!1),a=computed(()=>e.config.items);return{mForm:o,expand:n,items:a,filter:r=>filterFunction(o,r,e),changeHandler:()=>t("change",e.model)}}}),_hoisted_1$g={class:"clearfix"},_hoisted_2$7=["innerHTML"],_hoisted_3$5={key:0,style:{display:"flex"}},_hoisted_4$3={style:{flex:"1"}},_hoisted_5$2=["src"];function _sfc_render$s(e,t,o,n,a,l){const i=resolveComponent("caret-bottom"),r=resolveComponent("caret-right"),s=resolveComponent("el-icon"),d=resolveComponent("m-form-container"),c=resolveComponent("el-card");return e.items&&e.items.length?(openBlock(),createBlock(c,{key:0,class:"box-card m-form-panel","body-style":{display:e.expand?"block":"none"}},{header:withCtx(()=>[createBaseVNode("div",_hoisted_1$g,[createBaseVNode("a",{href:"javascript:",style:{width:"100%",display:"block"},onClick:t[0]||(t[0]=u=>e.expand=!e.expand)},[createVNode(s,null,{default:withCtx(()=>[e.expand?(openBlock(),createBlock(i,{key:0})):(openBlock(),createBlock(r,{key:1}))]),_:1}),createTextVNode(" "+toDisplayString(e.filter(e.config.title))+" ",1),e.config&&e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_2$7)):createCommentVNode("",!0)])])]),default:withCtx(()=>[createBaseVNode("div",null,[renderSlot(e.$slots,"default"),e.config.schematic?(openBlock(),createElementBlock("div",_hoisted_3$5,[createBaseVNode("div",_hoisted_4$3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.items,(u,m)=>{var h,f;return openBlock(),createBlock(d,{key:(f=u[((h=e.mForm)==null?void 0:h.keyProp)||"__key"])!=null?f:m,config:u,model:e.name?e.model[e.name]:e.model,prop:e.prop,size:e.size,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","onChange"])}),128))]),createBaseVNode("img",{class:"m-form-schematic",src:e.config.schematic},null,8,_hoisted_5$2)])):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(e.items,(u,m)=>{var h,f;return openBlock(),createBlock(d,{key:(f=u[((h=e.mForm)==null?void 0:h.keyProp)||"__key"])!=null?f:m,config:u,model:e.name?e.model[e.name]:e.model,prop:e.prop,size:e.size,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","onChange"])}),128))])]),_:3},8,["body-style"])):createCommentVNode("",!0)}var Panel=_export_sfc(_sfc_main$x,[["render",_sfc_render$s]]);const _sfc_main$w=defineComponent({name:"m-form-row",props:{labelWidth:String,expandMore:Boolean,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,name:String,size:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm");return{mForm:o,display(a){return display(o,a.display,e)},changeHandler:()=>t("change",e.name?e.model[e.name]:e.model)}}});function _sfc_render$r(e,t,o,n,a,l){const i=resolveComponent("m-form-container"),r=resolveComponent("el-col"),s=resolveComponent("el-row");return openBlock(),createBlock(s,{gutter:10},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(d,c)=>{var u,m;return openBlock(),createBlock(r,{style:normalizeStyle(!e.display(d)||d.type==="hidden"?"display: none":""),key:(m=d[((u=e.mForm)==null?void 0:u.keyProp)||"__key"])!=null?m:c,span:d.span||e.config.span||24/e.config.items.length},{default:withCtx(()=>[createVNode(i,{model:e.name?e.model[e.name]:e.model,config:d,prop:e.prop,"label-width":e.config.labelWidth||e.labelWidth,"expand-more":e.expandMore,size:e.size,onChange:e.changeHandler},null,8,["model","config","prop","label-width","expand-more","size","onChange"])]),_:2},1032,["style","span"])}),128))]),_:1})}var Row=_export_sfc(_sfc_main$w,[["render",_sfc_render$r]]);const _sfc_main$v=defineComponent({name:"m-form-step",props:{model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},stepActive:{type:Number,default:()=>1},size:String,labelWidth:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(1);return watchEffect(()=>{n.value=e.stepActive}),{mForm:o,active:n,stepClick:i=>{n.value=i+1,o==null||o.$emit("update:stepActive",n.value)},changeHandler:()=>{t("change",e.model)}}}});function _sfc_render$q(e,t,o,n,a,l){const i=resolveComponent("el-step"),r=resolveComponent("el-steps"),s=resolveComponent("m-form-container");return openBlock(),createElementBlock("div",null,[createVNode(r,{active:e.active,"align-center":"",space:e.config.space},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(d,c)=>(openBlock(),createBlock(i,{key:d.__key,title:d.title,active:e.active,onClick:u=>e.stepClick(c)},null,8,["title","active","onClick"]))),128))]),_:1},8,["active","space"]),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(d,c)=>(openBlock(),createElementBlock(Fragment,null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(d.items,u=>{var m;return openBlock(),createElementBlock(Fragment,null,[u?withDirectives((openBlock(),createBlock(s,{key:u[((m=e.mForm)==null?void 0:m.keyProp)||"__key"],config:u,model:d.name?e.model[d.name]:e.model,prop:d.name,size:e.size,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","onChange"])),[[vShow,e.active-1===c]]):createCommentVNode("",!0)],64)}),256))],64))),256))])}var MStep=_export_sfc(_sfc_main$v,[["render",_sfc_render$q]]);let loadedAMapJS=!1,firstLoadingAMapJS=!0;const _sfc_main$u=defineComponent({name:"m-form-table",props:{name:{type:String,required:!0},model:{type:Object,required:!0,default:()=>({})},config:{type:Object,required:!0,default:()=>({})},prop:{type:String},labelWidth:{type:String},sort:{type:Boolean,default:!1},sortKey:{type:String,default:""},text:{type:String},size:String,enableToggleMode:{type:Boolean,default:!0}},emits:["change","select"],setup(e,{emit:t}){let o=null;const n=inject("mForm"),a=ref(),l=ref(),i=ref(),r=ref(10),s=ref(0),d=ref(1),c=ref(!1),u=computed(()=>e.name||e.config.name||""),m=({prop:g,order:$})=>{$==="ascending"?e.model[u.value]=e.model[u.value].sort((C,b)=>C[g]-b[g]):$==="descending"&&(e.model[u.value]=e.model[u.value].sort((C,b)=>b[g]-C[g]))},h=()=>{d.value+=1,setTimeout(()=>_())},f=(g,$)=>{if([e.model[u.value][g]]=e.model[u.value].splice($,1,e.model[u.value][g]),e.sortKey)for(let C=e.model[u.value].length-1,b=0;C>=0;C--,b++)e.model[u.value][b][e.sortKey]=C;n==null||n.$emit("field-change",e.prop,e.model[u.value])},_=()=>{var $;const g=($=a.value)==null?void 0:$.$el;if(g==null?void 0:g.querySelectorAll(".el-table__body > tbody")){const C=g.querySelectorAll(".el-table__body > tbody")[0],b=Sortable.create(C,{onEnd:({newIndex:k,oldIndex:E})=>{typeof k!="undefined"&&typeof E!="undefined"&&(f(k,E),t("change",e.model[u.value]),h(),b.destroy(),n==null||n.$emit("field-change",e.prop,e.model[u.value]),sleep(1e3).then(()=>{const S=g.querySelectorAll(".el-table__body > tbody > tr");(S==null?void 0:S[k])&&(S[k].style.backgroundColor="rgba(243, 89, 59, 0.2)",sleep(1e3).then(()=>{S[k].style.backgroundColor=""}))}))}})}},B=async g=>{if(e.config.max&&e.model[u.value].length>=e.config.max){ElMessage.error(`\u6700\u591A\u65B0\u589E\u914D\u7F6E\u4E0D\u80FD\u8D85\u8FC7${e.config.max}\u6761`);return}const $=e.config.items,C=e.config.enum||[];let b=[];const{length:k}=e.model[u.value],E=e.config.key||"id";let S={};if(C.length){if(k>=C.length)return;b=C.filter(L=>{let N=0;for(;N<k&&L[E]!==e.model[u.value][N][E];N++);return N===k}),b.length>0&&(S=b[0])}else Array.isArray(g)?$.forEach((L,N)=>{L.name&&(S[L.name]=g[N])}):(typeof e.config.defaultAdd=="function"?S=await e.config.defaultAdd(n,{model:e.model[u.value],formValue:n==null?void 0:n.values}):e.config.defaultAdd&&(S=e.config.defaultAdd),S=await initValue(n,{config:$,initValues:S}));e.sortKey&&k&&(S[e.sortKey]=e.model[u.value][k-1][e.sortKey]-1),e.model[u.value].push(S),t("change",e.model[u.value])};return!loadedAMapJS&&firstLoadingAMapJS&&!globalThis.XLSX&&(firstLoadingAMapJS=!1,asyncLoadJs("https://cdn.bootcdn.net/ajax/libs/xlsx/0.17.0/xlsx.full.min.js").then(()=>{loadedAMapJS=!0}).catch(()=>{firstLoadingAMapJS=!0})),onMounted(()=>{e.config.defautSort&&m(e.config.defautSort),e.sort&&e.sortKey&&e.model[u.value].sort((g,$)=>$[e.sortKey]-g[e.sortKey]),e.config.dropSort&&_()}),{mForm:n,pagesize:r,pagecontext:s,foreUpdate:h,isFullscreen:c,elTable:a,mTable:i,excelBtn:l,modelName:u,updateKey:d,ArrowDown:ArrowDown$1,ArrowUp,Delete:Delete$1,FullScreen,Grid:Grid$1,data:computed(()=>e.model[u.value].filter((g,$)=>$>=s.value*r.value&&$+1<=(s.value+1)*r.value)),addable:computed(()=>e.model[u.value].length?typeof e.config.addable=="function"?e.config.addable(n,{model:e.model[u.value],formValue:n==null?void 0:n.values,prop:e.prop}):typeof e.config.addable=="undefined"?!0:e.config.addable:!0),selection:computed(()=>typeof e.config.selection=="function"?e.config.selection(n,{model:e.model[u.value]}):e.config.selection),importable:computed(()=>typeof e.config.importable=="function"?e.config.importable(n,{formValue:n==null?void 0:n.values,model:e.model[u.value]}):typeof e.config.importable=="undefined"?!1:e.config.importable),sortChange:m,display(g){return display(n,g,e)},itemExtra(g,$){return typeof g=="function"?g(n,{values:n==null?void 0:n.initValues,model:e.model,formValue:n?n.values:e.model,prop:e.prop,index:$}):g},newHandler:B,removeHandler(g){e.model[u.value].splice(g,1),t("change",e.model[u.value])},selectHandle(g,$){var C,b;typeof e.config.selection=="string"&&e.config.selection==="single"&&((C=a.value)==null||C.clearSelection(),(b=a.value)==null||b.toggleRowSelection($,!0)),t("select",g,$),typeof e.config.onSelect=="function"&&e.config.onSelect(n,{selection:g,row:$})},toggleRowSelection(g,$){var C;(C=a.value)==null||C.toggleRowSelection.call(a.value,g,$)},makeConfig(g){const $=cloneDeep(g);return delete $.display,$},upHandler(g){o&&clearTimeout(o),o=setTimeout(()=>{f(g,g-1)},300)},topHandler(g){o&&clearTimeout(o);const $=g;for(let C=0;C<$;C++)f(g,g-1),g-=1},downHandler(g){o&&clearTimeout(o),o=setTimeout(()=>{f(g,g+1)},300)},bottomHandler(g){o&&clearTimeout(o);const $=e.model[u.value].length-1-g;for(let C=0;C<$;C++)f(g,g+1),g+=1},showDelete(g){const $=e.config.delete;return $&&typeof $=="function"?$(e.model[u.value],g,n==null?void 0:n.values):!0},clearHandler(){const g=e.model[u.value].length;e.model[u.value].splice(0,g),n==null||n.$emit("field-change",e.prop,e.model[u.value])},excelHandler(g){if(!g||!g.raw)return!1;const $=new FileReader;return $.onload=()=>{const C=$.result,b=globalThis.XLSX.read(C,{type:"array"});b.SheetNames.forEach(k=>{const E=globalThis.XLSX.utils.sheet_to_json(b.Sheets[k],{header:1});(E==null?void 0:E[0])&&E.forEach(S=>{B(S)}),setTimeout(()=>{var S;(S=l.value)==null||S.clearFiles()},300)})},$.readAsArrayBuffer(g.raw),!1},handleSizeChange(g){r.value=g},handleCurrentChange(g){s.value=g-1},toggleMode(){const g=$=>{var k;if(!$)return"0px";const C=((k=$.match(/[^\x00-\xff]/g))==null?void 0:k.length)||0,b=$.length-C;return`${Math.max(b*8+C*20,80)}px`};e.config.type="groupList",e.config.enableToggleMode=!0,e.config.tableItems=e.config.items,e.config.items=e.config.groupItems||e.config.items.map($=>{const C=$.text||$.label,b=g(C);return V(w({},$),{text:C,labelWidth:b,span:$.span||12})})},toggleFullscreen(){var g,$;c.value?((g=i.value)==null||g.classList.remove("fixed"),c.value=!1):(($=i.value)==null||$.classList.add("fixed"),c.value=!0)},getProp(g){const{prop:$}=toRefs(e);return`${$.value}${$.value?".":""}${g+1+s.value*r.value-1}`}}}}),_hoisted_1$f=["innerHTML"],_hoisted_2$6={class:"el-form-item__content"},_hoisted_3$4=["innerHTML"],_hoisted_4$2=createTextVNode("\u6DFB\u52A0"),_hoisted_5$1=createTextVNode(" \xA0 "),_hoisted_6=createTextVNode("\u5C55\u5F00\u914D\u7F6E"),_hoisted_7=createTextVNode("\u5BFC\u5165EXCEL"),_hoisted_8=createTextVNode("\xA0 "),_hoisted_9=createTextVNode("\u6E05\u7A7A"),_hoisted_10={class:"bottom",style:{"text-align":"right"}};function _sfc_render$p(e,t,o,n,a,l){const i=resolveComponent("el-table-column"),r=resolveComponent("el-button"),s=resolveComponent("el-tooltip"),d=resolveComponent("m-form-container"),c=resolveComponent("el-table"),u=resolveComponent("el-upload"),m=resolveComponent("el-pagination");return openBlock(),createElementBlock("div",{ref:"mTable",class:normalizeClass(["m-fields-table",{"m-fields-table-item-extra":e.config.itemExtra}])},[e.config.extra?(openBlock(),createElementBlock("span",{key:0,style:{color:"rgba(0, 0, 0, 0.45)"},innerHTML:e.config.extra},null,8,_hoisted_1$f)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_2$6,[createVNode(s,{content:"\u62D6\u62FD\u53EF\u6392\u5E8F",placement:"left-start",disabled:e.config.dropSort!==!0},{default:withCtx(()=>[e.model[e.modelName]?(openBlock(),createBlock(c,{ref:"elTable",style:{width:"100%"},data:e.model[e.modelName],border:e.config.border,"max-height":e.config.maxHeight,"default-expand-all":!0,key:e.updateKey,onSelect:e.selectHandle,onSortChange:e.sortChange},{default:withCtx(()=>[e.config.itemExtra?(openBlock(),createBlock(i,{key:0,fixed:"left",width:"30",type:"expand"},{default:withCtx(h=>[createBaseVNode("span",{innerHTML:e.itemExtra(e.config.itemExtra,h.$index),class:"m-form-tip"},null,8,_hoisted_3$4)]),_:1})):createCommentVNode("",!0),createVNode(i,{label:"\u64CD\u4F5C",width:"60",fixed:e.config.fixed===!1?void 0:"left"},{default:withCtx(h=>[withDirectives(createVNode(r,{style:{color:"#f56c6c"},type:"text",icon:e.Delete,onClick:f=>e.removeHandler(h.$index+1+e.pagecontext*e.pagesize-1)},null,8,["icon","onClick"]),[[vShow,e.showDelete(h.$index+1+e.pagecontext*e.pagesize-1)]])]),_:1},8,["fixed"]),e.sort&&e.model[e.modelName]&&e.model[e.modelName].length>1?(openBlock(),createBlock(i,{key:1,label:"\u6392\u5E8F",width:"60"},{default:withCtx(h=>[h.$index+1+e.pagecontext*e.pagesize-1!==0?(openBlock(),createBlock(s,{key:0,content:"\u70B9\u51FB\u4E0A\u79FB\uFF0C\u53CC\u51FB\u7F6E\u9876",placement:"top"},{default:withCtx(()=>[createVNode(r,{plain:"",size:"small",icon:e.ArrowUp,type:"text",onClick:f=>e.upHandler(h.$index+1+e.pagecontext*e.pagesize-1),onDblclick:f=>e.topHandler(h.$index+1+e.pagecontext*e.pagesize-1)},null,8,["icon","onClick","onDblclick"])]),_:2},1024)):createCommentVNode("",!0),h.$index+1+e.pagecontext*e.pagesize-1!==e.model[e.modelName].length-1?(openBlock(),createBlock(s,{key:1,content:"\u70B9\u51FB\u4E0B\u79FB\uFF0C\u53CC\u51FB\u7F6E\u5E95",placement:"top"},{default:withCtx(()=>[createVNode(r,{plain:"",size:"small",icon:e.ArrowDown,type:"text",onClick:f=>e.downHandler(h.$index+1+e.pagecontext*e.pagesize-1),onDblclick:f=>e.bottomHandler(h.$index+1+e.pagecontext*e.pagesize-1)},null,8,["icon","onClick","onDblclick"])]),_:2},1024)):createCommentVNode("",!0)]),_:1})):createCommentVNode("",!0),e.selection?(openBlock(),createBlock(i,{key:2,align:"center","header-align":"center",type:"selection",width:"45"})):createCommentVNode("",!0),createVNode(i,{width:"60",label:"\u5E8F\u53F7"},{default:withCtx(h=>[createTextVNode(toDisplayString(h.$index+1+e.pagecontext*e.pagesize),1)]),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(h,f)=>{var _,B;return openBlock(),createElementBlock(Fragment,null,[h.type!=="hidden"&&e.display(h.display)?(openBlock(),createBlock(i,{prop:h.name,width:h.width,label:h.label,sortable:h.sortable,"sort-orders":["ascending","descending"],key:(B=h[((_=e.mForm)==null?void 0:_.keyProp)||"__key"])!=null?B:f,"class-name":e.config.dropSort===!0?"el-table__column--dropable":""},{default:withCtx(g=>[g.$index>-1?(openBlock(),createBlock(d,{key:0,labelWidth:"0",prop:e.getProp(g.$index),rules:h.rules,config:e.makeConfig(h),model:g.row,size:e.size,onChange:t[0]||(t[0]=$=>e.$emit("change",e.model[e.modelName]))},null,8,["prop","rules","config","model","size"])):createCommentVNode("",!0)]),_:2},1032,["prop","width","label","sortable","class-name"])):createCommentVNode("",!0)],64)}),256))]),_:1},8,["data","border","max-height","onSelect","onSortChange"])):createCommentVNode("",!0)]),_:1},8,["disabled"]),renderSlot(e.$slots,"default"),e.addable?(openBlock(),createBlock(r,{key:0,size:"small",type:"primary",plain:"",onClick:t[1]||(t[1]=h=>e.newHandler())},{default:withCtx(()=>[_hoisted_4$2]),_:1})):createCommentVNode("",!0),_hoisted_5$1,e.enableToggleMode&&!e.isFullscreen?(openBlock(),createBlock(r,{key:1,icon:e.Grid,size:"small",onClick:e.toggleMode},{default:withCtx(()=>[_hoisted_6]),_:1},8,["icon","onClick"])):createCommentVNode("",!0),e.config.enableFullscreen!==!1?(openBlock(),createBlock(r,{key:2,icon:e.FullScreen,size:"small",onClick:e.toggleFullscreen},{default:withCtx(()=>[createTextVNode(toDisplayString(e.isFullscreen?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F\u7F16\u8F91"),1)]),_:1},8,["icon","onClick"])):createCommentVNode("",!0),e.importable?(openBlock(),createBlock(u,{key:3,ref:"excelBtn",action:"/noop","on-change":e.excelHandler,"auto-upload":!1,style:{display:"inline-block"}},{default:withCtx(()=>[createVNode(r,{size:"small",type:"success",plain:""},{default:withCtx(()=>[_hoisted_7]),_:1})]),_:1},8,["on-change"])):createCommentVNode("",!0),_hoisted_8,e.importable?(openBlock(),createBlock(r,{key:4,size:"small",type:"warning",plain:"",onClick:t[2]||(t[2]=h=>e.clearHandler())},{default:withCtx(()=>[_hoisted_9]),_:1})):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_10,[createVNode(m,{layout:"total, sizes, prev, pager, next, jumper","hide-on-single-page":e.model[e.modelName].length<e.pagesize,"current-page":e.pagecontext+1,"page-sizes":[e.pagesize,60,120,300],"page-size":e.pagesize,total:e.model[e.modelName].length,onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["hide-on-single-page","current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"])])],2)}var Table$1=_export_sfc(_sfc_main$u,[["render",_sfc_render$p]]);const getActive=(e,t,o)=>{const{config:n,model:a,prop:l}=t,{active:i}=n;return typeof i=="function"?i(e,{model:a,formValue:e==null?void 0:e.values,prop:l}):+o>=t.config.items.length?"0":typeof i!="undefined"?i:"0"},tabClickHandler=(e,t,o)=>{const{config:n,model:a,prop:l}=o;t.name=t.paneName,typeof n.onTabClick=="function"&&n.onTabClick(e,t,{model:a,formValue:e==null?void 0:e.values,prop:l});const i=n.items.find(r=>t.name===r.status);i&&typeof i.onTabClick=="function"&&i.onTabClick(e,t,{model:a,formValue:e==null?void 0:e.values,prop:l})},Tab=defineComponent({name:"m-form-tab",props:{labelWidth:String,expandMore:Boolean,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,size:String},emits:{change(e){return e}},setup(e,{emit:t}){const o=inject("mForm"),n=ref(getActive(o,e,"")),a=computed(()=>{if(e.config.dynamic){if(!e.config.name)throw new Error("dynamic tab \u5FC5\u987B\u914D\u7F6Ename");return e.model[e.config.name]||[]}return e.config.items}),l=i=>filterFunction(o,i,e);return watchEffect(()=>{typeof e.config.activeChange=="function"&&e.config.activeChange(o,n.value,{model:e.model,prop:e.prop})}),{mForm:o,activeTabName:n,tabs:a,filter:l,tabItems:i=>e.config.dynamic?e.config.items:i.items,tabClickHandler:i=>tabClickHandler(o,i,e),onTabAdd:()=>{if(!e.config.name)throw new Error("dynamic tab \u5FC5\u987B\u914D\u7F6Ename");if(typeof e.config.onTabAdd=="function")e.config.onTabAdd(o,{model:e.model});else if(a.value.length>0){const i=cloneDeep(a.value[0]);i.title=`\u6807\u7B7E${a.value.length+1}`,e.model[e.config.name].push(i)}t("change",e.model),o==null||o.$emit("field-change",e.prop,e.model[e.config.name])},onTabRemove:i=>{if(!e.config.name)throw new Error("dynamic tab \u5FC5\u987B\u914D\u7F6Ename");typeof e.config.onTabRemove=="function"?e.config.onTabRemove(o,i,{model:e.model}):(e.model[e.config.name].splice(+i,1),(i<n.value||n.value>=e.model[e.config.name].length)&&(n.value=(+n.value-1).toString(),tabClickHandler(o,{name:n.value},e))),t("change",e.model),o==null||o.$emit("field-change",e.prop,e.model[e.config.name])},display:i=>display(o,i,e),changeHandler:()=>{t("change",e.model),typeof e.config.onChange=="function"&&e.config.onChange(o,{model:e.model})}}}}),_sfc_main$t=Tab;function _sfc_render$o(e,t,o,n,a,l){const i=resolveComponent("m-form-container"),r=resolveComponent("el-tab-pane"),s=resolveComponent("el-tabs");return openBlock(),createBlock(s,{modelValue:e.activeTabName,"onUpdate:modelValue":t[0]||(t[0]=d=>e.activeTabName=d),class:normalizeClass(e.config.dynamic?"magic-form-dynamic-tab":"magic-form-tab"),type:e.config.tabType,editable:e.config.editable||!1,"tab-position":e.config.tabPosition||"top",onTabClick:e.tabClickHandler,onTabAdd:e.onTabAdd,onTabRemove:e.onTabRemove},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tabs,(d,c)=>{var u,m;return openBlock(),createElementBlock(Fragment,null,[e.display(d.display)&&e.tabItems(d).length?(openBlock(),createBlock(r,{key:(m=d[((u=e.mForm)==null?void 0:u.keyProp)||"__key"])!=null?m:c,name:e.filter(d.status)||c.toString(),label:e.filter(d.title),lazy:d.lazy||!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tabItems(d),h=>{var f;return openBlock(),createBlock(i,{key:h[((f=e.mForm)==null?void 0:f.keyProp)||"__key"],config:h,model:e.config.dynamic?e.model[e.config.name||""][c]:d.name?e.model[d.name]:e.model,prop:e.config.dynamic?`${e.prop}${e.prop?".":""}${String(c)}`:e.prop,size:e.size,"label-width":d.labelWidth||e.labelWidth,"expand-more":e.expandMore,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","expand-more","onChange"])}),128))]),_:2},1032,["name","label","lazy"])):createCommentVNode("",!0)],64)}),256))]),_:1},8,["modelValue","class","type","editable","tab-position","onTabClick","onTabAdd","onTabRemove"])}var Tabs=_export_sfc(_sfc_main$t,[["render",_sfc_render$o]]);let $MAGIC_FORM={};const setConfig=e=>{$MAGIC_FORM=e},getConfig=e=>$MAGIC_FORM[e];var fieldProps={model:{type:Object,required:!0,default:()=>({})},name:{type:String,default:""},disabled:{type:Boolean,default:!1},size:String,prop:String,initValues:Object,values:Object};const useAddField=e=>{if(!e)return;const t=inject("mForm"),o=getCurrentInstance();watch(()=>o==null?void 0:o.proxy,n=>{n?t==null||t.setField(e,n):t==null||t.deleteField(e)},{immediate:!0})},_sfc_main$s=defineComponent({name:"m-fields-cascader",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=getCurrentInstance();useAddField(e.prop);const a=getConfig("request"),l=ref(null),i=ref(null),r=Array.isArray(e.config.options)?ref(e.config.options):ref([]),s=ref(null),d=async function(){const{config:u}=e,{option:m}=u;if(!m)return;let{body:h}=m;const f={url:m.url,cache:m.cache,timeout:m.timeout,data:{}};h&&o&&(typeof h=="function"&&e.model&&o&&(h=h(o,{model:e.model,formValue:null,formValues:o.values})),f.data=h);const _=await a(f);s.value=_[m.root],s.value&&typeof(m==null?void 0:m.item)=="function"&&(r.value=m.item(_[m.root]))};typeof e.config.options=="function"&&e.model&&o?watchEffect(()=>r.value=e.config.options(n,{model:e.model,formValues:o.values})):(!e.config.options||!e.config.options.length||e.config.remote)&&Promise.resolve(d());const c=computed(()=>{var u;return((u=e.config.add)==null?void 0:u.action.method)==="post"?m=>{var h,f;return a(w(w({},(f=(h=e.config)==null?void 0:h.add)==null?void 0:f.action.body),m))}:null});return{options:r,remoteData:s,addButtonStyle:{top:0,left:0,width:"auto"},dialogVisible:!1,cascader:l,dialog:i,action:c,setRemoteOptions:d,changeHandler:u=>{!l.value||(l.value.query="",l.value.previousQuery=null,t("change",u))},addHandler:()=>{!i.value||(i.value.dialogVisible=!0)},editAfterAction:()=>{d()}}}}),_hoisted_1$e={class:"m-cascader",style:{width:"100%"}};function _sfc_render$n(e,t,o,n,a,l){const i=resolveComponent("el-cascader");return openBlock(),createElementBlock("div",_hoisted_1$e,[createVNode(i,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),ref:"cascader",style:{width:"100%"},clearable:"",filterable:"",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,options:e.options,props:{multiple:e.config.multiple},onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","options","props","onChange"])])}var Cascader=_export_sfc(_sfc_main$s,[["render",_sfc_render$n]]);const _sfc_main$r=defineComponent({name:"m-fields-checkbox",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){return useAddField(e.prop),{activeValue:computed(()=>{if(typeof e.config.activeValue=="undefined"){if(e.config.filter==="number")return 1}else return e.config.activeValue;return"true"}),inactiveValue:computed(()=>{if(typeof e.config.inactiveValue=="undefined"){if(e.config.filter==="number")return 0}else return e.config.inactiveValue;return"false"}),changeHandler(o){t("change",o)}}}});function _sfc_render$m(e,t,o,n,a,l){const i=resolveComponent("el-checkbox");return openBlock(),createBlock(i,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),size:e.size,trueLabel:e.activeValue,falseLabel:e.inactiveValue,disabled:e.disabled,label:e.config.text,onChange:e.changeHandler},null,8,["modelValue","size","trueLabel","falseLabel","disabled","label","onChange"])}var Checkbox=_export_sfc(_sfc_main$r,[["render",_sfc_render$m]]);const _sfc_main$q=defineComponent({name:"m-fields-checkbox-group",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){return useAddField(e.prop),e.model&&!e.model[e.name]&&(e.model[e.name]=[]),{changeHandler:o=>{t("change",o)}}}});function _sfc_render$l(e,t,o,n,a,l){const i=resolveComponent("el-checkbox"),r=resolveComponent("el-checkbox-group");return openBlock(),createBlock(r,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),size:e.size,disabled:e.disabled,onChange:e.changeHandler},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.options,s=>(openBlock(),createBlock(i,{label:s.value,key:s.value},{default:withCtx(()=>[createTextVNode(toDisplayString(s.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","size","disabled","onChange"])}var CheckboxGroup=_export_sfc(_sfc_main$q,[["render",_sfc_render$l]]);const _hoisted_1$d={key:0},__default__$2=defineComponent({name:"m-fields-color-picker"}),_sfc_main$p=defineComponent(V(w({},__default__$2),{props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const n=a=>t("change",a);return(a,l)=>{const i=resolveComponent("el-color-picker");return a.model?(openBlock(),createElementBlock("div",_hoisted_1$d,[createVNode(i,{modelValue:a.model[a.name],"onUpdate:modelValue":l[0]||(l[0]=r=>a.model[a.name]=r),size:a.size,disabled:a.disabled,showAlpha:!0,onChange:n},null,8,["modelValue","size","disabled"])])):createCommentVNode("",!0)}}})),_sfc_main$o=defineComponent({name:"m-fields-date",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){useAddField(e.prop);const o=computed(()=>e.prop||e.config.name||"");return e.model[o.value]=datetimeFormatter(e.model[o.value],""),{modelName:o,changeHandler(n){t("change",n)}}}}),_hoisted_1$c={key:0};function _sfc_render$k(e,t,o,n,a,l){const i=resolveComponent("el-date-picker");return e.model?(openBlock(),createElementBlock("div",_hoisted_1$c,[createVNode(i,{modelValue:e.model[e.modelName],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.modelName]=r),type:"date",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,format:e.config.format,"value-format":e.config.format||"YYYY-MM-DD HH:mm:ss",onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","format","value-format","onChange"])])):createCommentVNode("",!0)}var Date$1=_export_sfc(_sfc_main$o,[["render",_sfc_render$k]]);const _sfc_main$n=defineComponent({name:"m-fields-daterange",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const{names:o}=e.config,n=ref([]);e.model!==void 0&&((o==null?void 0:o.length)?n.value=o.map(l=>{var i;return datetimeFormatter((i=e.model)==null?void 0:i[l],"")}):e.name&&e.model[e.name]&&(n.value=e.model[e.name].map(l=>datetimeFormatter(l,""))));const a=l=>{(o==null?void 0:o.length)&&l instanceof Array?o.forEach((i,r)=>{e.model&&(e.model[i]=datetimeFormatter(l[r].toString(),""))}):e.model&&e.name&&l instanceof Date&&(e.model[e.name]=datetimeFormatter(l.toString(),""))};return{value:n,changeHandler(l){a(l),t("change",l)}}}});function _sfc_render$j(e,t,o,n,a,l){const i=resolveComponent("el-date-picker");return openBlock(),createElementBlock("div",null,[createVNode(i,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=r=>e.value=r),type:"datetimerange","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",size:e.size,"unlink-panels":!0,disabled:e.disabled,onChange:e.changeHandler},null,8,["modelValue","size","disabled","onChange"])])}var Daterange=_export_sfc(_sfc_main$n,[["render",_sfc_render$j]]);const _sfc_main$m=defineComponent({name:"m-fields-datetime",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){var n;useAddField(e.prop);const o=(n=e.model)==null?void 0:n[e.name].toString();return e.model&&(o==="Invalid Date"?e.model[e.name]="":e.model[e.name]=datetimeFormatter(e.model[e.name],"",e.config.valueFormat)),{value:o,changeHandler:a=>{t("change",a)}}}}),_hoisted_1$b={key:0};function _sfc_render$i(e,t,o,n,a,l){const i=resolveComponent("el-date-picker");return e.model?(openBlock(),createElementBlock("div",_hoisted_1$b,[createVNode(i,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),"popper-class":"magic-datetime-picker-popper",type:"datetime",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,format:e.config.format||"YYYY-MM-DD HH:mm:ss","value-format":e.config.valueFormat||"YYYY-MM-DD HH:mm:ss",onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","format","value-format","onChange"])])):createCommentVNode("",!0)}var DateTime=_export_sfc(_sfc_main$m,[["render",_sfc_render$i]]);const _hoisted_1$a={key:0},__default__$1=defineComponent({name:"m-fields-display"}),_sfc_main$l=defineComponent(V(w({},__default__$1),{props:V(w({},fieldProps),{config:{type:Object,required:!0}}),setup(e){const t=e,o=computed(()=>t.name||t.config.name||"");return t.config.initValue&&o.value&&t.model&&(t.model[o.value]=t.config.initValue),useAddField(t.prop),(n,a)=>n.model?(openBlock(),createElementBlock("span",_hoisted_1$a,toDisplayString(n.model[unref(o)]),1)):createCommentVNode("",!0)}})),_sfc_main$k=defineComponent({name:"m-fields-dynamic-field",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const o=getConfig("request"),n=reactive({value:{}}),a=reactive({value:{}}),l=async()=>{if(typeof e.config.returnFields!="function"||!e.model)return;const r=await e.config.returnFields(e.config,e.model,o);n.value={},a.value={},r.forEach(s=>{var c;if(typeof s!="object"||s.name===void 0)return;let d=((c=e.model)==null?void 0:c[s.name])||"";!d&&s.defaultValue!==void 0&&(d=s.defaultValue,t("change",d,s.name)),n.value[s.name]=d,a.value[s.name]=s.label||""})},i=watch(()=>{var r;return(r=e.model)==null?void 0:r[e.config.dynamicKey]},r=>{r!==""&&l()},{immediate:!0});return onBeforeUnmount(()=>{typeof i=="function"&&i()}),{request:o,fieldMap:n,fieldLabelMap:a,unwatch:i,changeFieldMap:l,inputChangeHandler:r=>{t("change",n.value[r],r)}}},methods:{init(){}}}),_hoisted_1$9={class:"m-fields-dynamic-field"};function _sfc_render$h(e,t,o,n,a,l){const i=resolveComponent("el-input"),r=resolveComponent("el-form-item"),s=resolveComponent("el-form");return openBlock(),createElementBlock("div",_hoisted_1$9,[createVNode(s,{size:"small"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(Object.keys(e.fieldMap.value),d=>(openBlock(),createBlock(r,{key:d,label:e.fieldLabelMap.value[d]},{default:withCtx(()=>[createVNode(i,{modelValue:e.fieldMap.value[d],"onUpdate:modelValue":c=>e.fieldMap.value[d]=c,placeholder:e.fieldLabelMap.value[d],onChange:c=>e.inputChangeHandler(d)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["label"]))),128))]),_:1})])}var DynamicField=_export_sfc(_sfc_main$k,[["render",_sfc_render$h]]);const __default__=defineComponent({name:"m-fields-hidden"}),_sfc_main$j=defineComponent(V(w({},__default__),{props:V(w({},fieldProps),{config:{type:Object,required:!0}}),setup(e){const t=e,o=computed(()=>t.name||t.config.name||"");return useAddField(t.prop),(n,a)=>n.model?withDirectives((openBlock(),createElementBlock("input",{key:0,"onUpdate:modelValue":a[0]||(a[0]=l=>n.model[unref(o)]=l),type:"hidden"},null,512)),[[vModelText,n.model[unref(o)]]]):createCommentVNode("",!0)}})),_sfc_main$i=defineComponent({name:"m-fields-link",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const o=ref({}),n=ref(),a=inject("mForm"),l=computed(()=>{var r;return typeof e.config.href=="function"&&e.model?e.config.href(e.model):e.config.href||((r=e.model)==null?void 0:r[e.name])}),i=()=>{var r;o.value=((r=e.model)==null?void 0:r[e.name])||{}};return{formValue:o,editor:n,href:l,formConfig:computed(()=>typeof e.config.form=="function"?e.config.form(a,{model:e.model||{},values:e.values||{}}):e.config.form),disable:computed(()=>typeof e.config.disabled!="undefined"?e.config.disabled:!l.value),displayText:computed(()=>typeof e.config.displayText=="function"?e.config.displayText(a,{model:e.model||{}}):e.config.displayText?e.config.displayText:"\u8DF3\u8F6C"),init:i,editHandler:()=>{i(),n.value&&(n.value.dialogVisible=!0)},action:r=>{e.model&&(e.model[e.name]=r,o.value=r,t("change",e.model[e.name])),n.value&&(n.value.dialogVisible=!1)}}}}),_hoisted_1$8=["href"],_hoisted_2$5={key:2,class:"m-fields-link"},_hoisted_3$3=createTextVNode("\u70B9\u51FB\u7F16\u8F91");function _sfc_render$g(e,t,o,n,a,l){const i=resolveComponent("el-button"),r=resolveComponent("m-form-dialog");return e.config.href&&!e.disabled?(openBlock(),createElementBlock("a",{key:0,target:"_blank",href:e.href,style:normalizeStyle(e.config.css||{})},toDisplayString(e.displayText),13,_hoisted_1$8)):e.config.href&&e.disabled?(openBlock(),createElementBlock("span",{key:1,style:normalizeStyle(e.config.disabledCss||{})},toDisplayString(e.displayText),5)):(openBlock(),createElementBlock("div",_hoisted_2$5,[createVNode(i,{type:"text",onClick:e.editHandler},{default:withCtx(()=>[_hoisted_3$3]),_:1},8,["onClick"]),createVNode(r,{ref:"editor",title:e.config.formTitle||"\u7F16\u8F91\u6269\u5C55\u914D\u7F6E",width:e.config.formWidth,values:e.formValue,config:e.formConfig,parentValues:e.values,fullscreen:e.config.fullscreen,onSubmit:e.action},null,8,["title","width","values","config","parentValues","fullscreen","onSubmit"])]))}var Link=_export_sfc(_sfc_main$i,[["render",_sfc_render$g]]);const _sfc_main$h=defineComponent({name:"m-fields-number",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){useAddField(e.prop);const o=inject("mForm");return{mForm:o,changeHandler:n=>{t("change",n)},inputHandler:n=>{t("input",n),o==null||o.$emit("field-input",e.prop,n)}}}});function _sfc_render$f(e,t,o,n,a,l){const i=resolveComponent("el-input-number");return e.model?(openBlock(),createBlock(i,{key:0,modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),clearable:"","controls-position":"right",size:e.size,max:e.config.max,min:e.config.min,step:e.config.step,placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler,onInput:e.inputHandler},null,8,["modelValue","size","max","min","step","placeholder","disabled","onChange","onInput"])):createCommentVNode("",!0)}var Number$1=_export_sfc(_sfc_main$h,[["render",_sfc_render$f]]);const _sfc_main$g=defineComponent({name:"m-fields-radio-group",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){return useAddField(e.prop),{changeHandler:o=>t("change",o)}}});function _sfc_render$e(e,t,o,n,a,l){const i=resolveComponent("el-radio"),r=resolveComponent("el-radio-group");return e.model?(openBlock(),createBlock(r,{key:0,modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),size:e.size,disabled:e.disabled,onChange:e.changeHandler},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.options,s=>(openBlock(),createBlock(i,{label:s.value,key:s.value},{default:withCtx(()=>[createTextVNode(toDisplayString(s.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","size","disabled","onChange"])):createCommentVNode("",!0)}var RadioGroup=_export_sfc(_sfc_main$g,[["render",_sfc_render$e]]);const _sfc_main$f=defineComponent({name:"m-fields-select",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){if(!e.model)throw new Error("\u4E0D\u80FD\u6CA1\u6709model");useAddField(e.prop);const o=ref(),n=inject("mForm"),a=ref([]),l=ref([]),i=ref(!1),r=ref(!1),s=ref(0),d=ref(0),c=ref(20),u=ref(""),m=ref([]),h=ref(!0),f=(C,b)=>{if(typeof b=="object"){const k=e.config.valueKey||"value";return b[k]===C[k]}return C===b},_=C=>{const{option:b}=e.config,{text:k}=b,{value:E}=b;return C.map(S=>({text:typeof k=="function"?k(S):S[k||"text"],value:typeof E=="function"?E(S):S[E||"value"]}))},B=async()=>{var A;if(!e.model)return[];if(l.value.length)return l.value;i.value=!0;let C=[];const{config:b}=e,{option:k}=b;let{body:E}=k,S={method:k.method||"POST",url:k.url,cache:k.cache,timeout:k.timeout,mode:k.mode,headers:k.headers||{},json:k.json||!1};E&&(typeof E=="function"&&(E=E(n,{model:e.model,formValue:n==null?void 0:n.values,formValues:n==null?void 0:n.values})),E.query=u.value,E.pgSize=c.value,E.pgIndex=d.value,S.data=E);const L=getConfig("request");typeof k.beforeRequest=="function"&&(S=k.beforeRequest(n,S,{model:e.model,formValue:n==null?void 0:n.values})),((A=k.method)==null?void 0:A.toLocaleLowerCase())==="jsonp"&&(S.jsonpCallback=k.jsonpCallback||"callback");let N=await L(S);typeof k.afterRequest=="function"&&(N=k.afterRequest(n,N,{model:e.model,formValue:n==null?void 0:n.values,formValues:n==null?void 0:n.values}));const H=N[k.root];N.total>0&&(s.value=N.total),m.value=m.value.concat(H),H&&(typeof k.item=="function"?C=k.item(H):H.map&&(C=_(H))),i.value=!1;const T=[];return e.config.multiple&&e.model[e.name]&&a.value.forEach(D=>{var R;((R=e.model)==null?void 0:R[e.name].includes(D.value))&&!C.find(G=>G.value===D.value)&&T.push(D)}),d.value===0?T.concat(C):a.value.concat(C)},g=async()=>{if(!e.model)return[];const C=e.model[e.name],{config:b}=e;return l.value=await B(),h.value=!1,b.group?b.multiple&&C.findIndex?l.value.filter(k=>k.options.findIndex(E=>C.find(S=>f(E.value,S))>-1)>-1):l.value.filter(k=>k.options.findIndex(E=>f(E.value,C))>-1):b.multiple&&C.findIndex?l.value.filter(k=>C.findIndex(E=>f(k.value,E))>-1):l.value.filter(k=>f(k.value,C))},$=async()=>{var T;if(!e.model)return[];const{config:C}=e,{option:b}=C;let k=[],E=b.initUrl;if(!E)return g();typeof E=="function"&&(E=await E(n,{model:e.model,formValue:n==null?void 0:n.values}));const S={method:b.method||"POST",url:E,data:{id:e.model[e.name]},mode:b.mode,headers:b.headers||{},json:b.json||!1};((T=b.method)==null?void 0:T.toLocaleLowerCase())==="jsonp"&&(S.jsonpCallback=b.jsonpCallback||"callback");let H=(await getConfig("request")(S))[b.root];return H&&(Array.isArray(H)||(H=[H]),typeof b.item=="function"?k=b.item(H):H.map&&(k=_(H))),k};return typeof e.config.options=="function"?watch(()=>n==null?void 0:n.values,()=>{typeof e.config.options=="function"&&Promise.resolve(e.config.options(n,{model:e.model,formValues:n==null?void 0:n.values,formValue:n==null?void 0:n.values})).then(C=>{a.value=C})},{deep:!0,immediate:!0}):Array.isArray(e.config.options)?watch(()=>e.config.options,()=>{a.value=e.config.options},{immediate:!0}):e.config.option&&onBeforeMount(()=>{if(!e.model)return;const C=e.model[e.name];(Array.isArray(C)?C.length:C)&&$().then(b=>{a.value=b})}),e.config.remote&&onMounted(()=>{var C;(C=o.value)==null||C.scrollbar.wrap$.addEventListener("scroll",async b=>{const k=b.currentTarget;r.value||k.scrollHeight-k.clientHeight-k.scrollTop>1||s.value<=a.value.length||(r.value=!0,d.value+=1,a.value=await B(),r.value=!1)})}),{select:o,loading:i,remote:h,options:a,moreLoadingVisible:r,popperClass:n==null?void 0:n.popperClass,getRequestFuc(){return getConfig("request")},async getInitOption(){},changeHandler(C){t("change",C)},async visibleHandler(C){var b;!C||!e.config.remote||(u.value&&o.value?(o.value.query=u.value,o.value.previousQuery=u.value,o.value.selectedLabel=u.value):a.value.length<=(e.config.multiple?(b=e.model)==null?void 0:b[e.name].length:1)&&(a.value=await B()))},async editAfterAction(){d.value=0,a.value=await B()},async remoteMethod(C){l.value.length||(u.value=C,d.value=0,a.value=await B(),e.config.multiple&&setTimeout(()=>{var b;(b=o.value)==null||b.setSelected()},0))}}}}),_hoisted_1$7={key:2};function _sfc_render$d(e,t,o,n,a,l){const i=resolveComponent("el-option"),r=resolveComponent("el-option-group"),s=resolveComponent("el-select"),d=resolveDirective("loading");return e.model?withDirectives((openBlock(),createBlock(s,{key:0,modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=c=>e.model[e.name]=c),class:"m-select",ref:"select",clearable:"",filterable:"","popper-class":`m-select-popper ${e.popperClass}`,size:e.size,remote:e.remote,placeholder:e.config.placeholder,multiple:e.config.multiple,"value-key":e.config.valueKey||"value","allow-create":e.config.allowCreate,disabled:e.disabled,"remote-method":e.remoteMethod,onChange:e.changeHandler,onVisibleChange:e.visibleHandler},{default:withCtx(()=>[e.config.group?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.options,(c,u)=>(openBlock(),createBlock(r,{key:c.label+u,label:c.label,disabled:c.disabled},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.options,(m,h)=>(openBlock(),createBlock(i,{key:m.label+h,label:m.label,value:m.value,disabled:m.disabled},null,8,["label","value","disabled"]))),128))]),_:2},1032,["label","disabled"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(e.options,c=>(openBlock(),createBlock(i,{label:c.text,value:c.value,key:e.config.valueKey?c.value[e.config.valueKey]:c.value,disabled:c.disabled},null,8,["label","value","disabled"]))),128)),e.moreLoadingVisible?withDirectives((openBlock(),createElementBlock("div",_hoisted_1$7,null,512)),[[d,!0]]):createCommentVNode("",!0)]),_:1},8,["modelValue","popper-class","size","remote","placeholder","multiple","value-key","allow-create","disabled","remote-method","onChange","onVisibleChange"])),[[d,e.loading]]):createCommentVNode("",!0)}var Select=_export_sfc(_sfc_main$f,[["render",_sfc_render$d]]);const _sfc_main$e=defineComponent({name:"m-fields-switch",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){return useAddField(e.prop),{n:computed(()=>e.name||e.config.name||""),activeValue:computed(()=>{if(typeof e.config.activeValue=="undefined"){if(e.config.filter==="number")return 1}else return e.config.activeValue;return!0}),inactiveValue:computed(()=>{if(typeof e.config.inactiveValue=="undefined"){if(e.config.filter==="number")return 0}else return e.config.inactiveValue;return!1}),changeHandler:o=>{t("change",o)}}}});function _sfc_render$c(e,t,o,n,a,l){const i=resolveComponent("el-switch");return e.model?(openBlock(),createBlock(i,{key:0,modelValue:e.model[e.n],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.n]=r),size:e.size,activeValue:e.activeValue,inactiveValue:e.inactiveValue,disabled:e.disabled,onChange:e.changeHandler},null,8,["modelValue","size","activeValue","inactiveValue","disabled","onChange"])):createCommentVNode("",!0)}var Switch=_export_sfc(_sfc_main$e,[["render",_sfc_render$c]]);const _sfc_main$d=defineComponent({name:"m-fields-text",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){useAddField(e.prop);const o=computed(()=>e.name||e.config.name||"");return{modelName:o,changeHandler(n){t("change",n)},inputHandler(n){const a=inject("mForm");t("input",n),a==null||a.$emit("field-input",e.prop,n)},buttonClickHandler(){var a;const n=inject("mForm");typeof e.config.append!="string"&&((a=e.config.append)==null?void 0:a.handler)&&e.config.append.handler(n,{model:e.model,values:n==null?void 0:n.values})},keyUpHandler(n){if(!e.model||!o.value)return;const a=n.key==="ArrowUp",l=n.key==="ArrowDown";if(!a&&!l)return;const i=e.model[o.value];let r,s;if(/^([0-9.]+)$/.test(i)?r=+i:i.replace(/^([0-9.]+)([a-z%]+)$/,(m,h,f)=>{r=+h,s=f}),r===void 0)return;const d=navigator.platform.match("Mac")?n.metaKey:n.ctrlKey,c=n.shiftKey,u=n.altKey;a?d?r+=100:u?r=(r*1e4+1e3)/1e4:c?r=r+10:r+=1:l&&(d?r-=100:u?r=(r*1e4-1e3)/1e4:c?r-=10:r-=1),e.model[o.value]=`${r}${s||""}`,t("change",e.model[o.value])}}}}),_hoisted_1$6={key:0};function _sfc_render$b(e,t,o,n,a,l){const i=resolveComponent("el-button"),r=resolveComponent("el-input");return openBlock(),createBlock(r,{modelValue:e.model[e.modelName],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.modelName]=s),clearable:"",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler,onInput:e.inputHandler,onKeyup:t[1]||(t[1]=s=>e.keyUpHandler(s))},createSlots({_:2},[e.config.append?{name:"append",fn:withCtx(()=>[typeof e.config.append=="string"?(openBlock(),createElementBlock("span",_hoisted_1$6,toDisplayString(e.config.append),1)):createCommentVNode("",!0),typeof e.config.append=="object"&&e.config.append.type==="button"?(openBlock(),createBlock(i,{key:1,style:{color:"#409eff"},onClick:e.buttonClickHandler},{default:withCtx(()=>[createTextVNode(toDisplayString(e.config.append.text),1)]),_:1},8,["onClick"])):createCommentVNode("",!0)])}:void 0]),1032,["modelValue","size","placeholder","disabled","onChange","onInput"])}var Text=_export_sfc(_sfc_main$d,[["render",_sfc_render$b]]);const _sfc_main$c=defineComponent({name:"m-fields-textarea",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:{change(e){return e},input(e){return e}},setup(e,{emit:t}){useAddField(e.prop);const o=inject("mForm");return{mForm:o,changeHandler:n=>{t("change",n)},inputHandler:n=>{t("input",n),o==null||o.$emit("field-input",e.prop,n)}}}}),_hoisted_1$5={key:0};function _sfc_render$a(e,t,o,n,a,l){const i=resolveComponent("el-input");return e.model?(openBlock(),createElementBlock("div",_hoisted_1$5,[createVNode(i,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),type:"textarea",size:e.size,clearable:"",placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler,onInput:e.inputHandler},null,8,["modelValue","size","placeholder","disabled","onChange","onInput"])])):createCommentVNode("",!0)}var Textarea=_export_sfc(_sfc_main$c,[["render",_sfc_render$a]]);const _sfc_main$b=defineComponent({name:"m-fields-time",props:V(w({},fieldProps),{config:{type:Object,required:!0}}),emits:{change(e){return e}},setup(e,{emit:t}){return useAddField(e.prop),{changeHandler:o=>{t("change",o)}}}});function _sfc_render$9(e,t,o,n,a,l){const i=resolveComponent("el-time-picker");return openBlock(),createElementBlock("div",null,[createVNode(i,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),size:e.size,"value-format":"HH:mm:ss",placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","onChange"])])}var Time=_export_sfc(_sfc_main$b,[["render",_sfc_render$9]]);const _sfc_main$a=defineComponent({name:"m-form",props:{initValues:{type:Object,required:!0,default:()=>({})},parentValues:{type:Object,default:()=>({})},config:{type:Array,required:!0,default:()=>[]},labelWidth:{type:String,default:()=>"200px"},disabled:{type:Boolean,default:()=>!1},height:{type:String,default:()=>"auto"},stepActive:{type:[String,Number],default:()=>1},size:{type:String},inline:{type:Boolean,default:!1},labelPosition:{type:String,default:"right"},keyProp:{type:String,default:"__key"},popperClass:{type:String}},emits:["change","field-input","field-change"],setup(e,{emit:t}){const o=ref(),n=ref(!1),a=ref({}),l=new Map,i=getConfig("request"),r=reactive({keyProp:e.keyProp,popperClass:e.popperClass,config:e.config,initValues:e.initValues,parentValues:e.parentValues,values:a,$emit:t,fields:l,setField:(s,d)=>l.set(s,d),getField:s=>l.get(s),deleteField:s=>l.delete(s),post:s=>{if(i)return i(V(w({},s),{method:"POST"}))}});return provide("mForm",r),watch([()=>e.config,()=>e.initValues],([s],[d])=>{isEqual(toRaw(s),toRaw(d))||(n.value=!1),initValue(r,{initValues:e.initValues,config:e.config}).then(c=>{a.value=c,n.value=!0})},{immediate:!0}),{initialized:n,values:a,elForm:o,formState:r,changeHandler:()=>{t("change",a.value)},resetForm:()=>{var s;return(s=o.value)==null?void 0:s.resetFields()},submitForm:async s=>{var d;try{return await((d=o.value)==null?void 0:d.validate()),s?a.value:cloneDeep(a.value)}catch(c){const u=[];throw Object.entries(c).forEach(([,m])=>{m.forEach(({field:h,message:f})=>{h&&f&&u.push(`${h} -> ${f}`),h&&!f&&u.push(`${h} -> \u51FA\u73B0\u9519\u8BEF`),!h&&f&&u.push(`${f}`)})}),new Error(u.join("<br>"))}}}}});function _sfc_render$8(e,t,o,n,a,l){const i=resolveComponent("m-form-container"),r=resolveComponent("el-form");return openBlock(),createBlock(r,{class:"m-form",ref:"elForm",model:e.values,"label-width":e.labelWidth,disabled:e.disabled,style:normalizeStyle(`height: ${e.height}`),inline:e.inline,"label-position":e.labelPosition},{default:withCtx(()=>[e.initialized&&Array.isArray(e.config)?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.config,(s,d)=>{var c;return openBlock(),createBlock(i,{key:(c=s[e.keyProp])!=null?c:d,config:s,model:e.values,"label-width":s.labelWidth||e.labelWidth,"step-active":e.stepActive,size:e.size,onChange:e.changeHandler},null,8,["config","model","label-width","step-active","size","onChange"])}),128)):createCommentVNode("",!0)]),_:1},8,["model","label-width","disabled","style","inline","label-position"])}var MForm=_export_sfc(_sfc_main$a,[["render",_sfc_render$8]]);const _sfc_main$9=defineComponent({name:"m-form-dialog",props:{values:{type:Object,default:()=>({})},width:[Number,String],fullscreen:Boolean,title:String,config:{type:Array,required:!0,default:()=>[]},labelWidth:[Number,String],size:String,confirmText:{type:String,default:"\u786E\u5B9A"}},emits:["close","submit","error","change"],setup(e,{emit:t}){const o=ref(),n=ref(!1),a=ref(!1),l=ref(1),i=ref(`${document.body.clientHeight-194}px`),r=computed(()=>{const{length:_}=e.config;for(let B=0;B<_;B++)if(e.config[B].type==="step")return e.config[B].items.length;return 0}),s=computed(()=>{const{length:_}=e.config;for(let B=0;B<_;B++)if(e.config[B].type==="step")return!0;return!1});return{form:o,saveFetch:a,stepActive:l,dialogVisible:n,bodyHeight:i,stepCount:r,hasStep:s,cancel:()=>{n.value=!1},closeHandler:()=>{l.value=1,t("close")},save:async()=>{var _;try{const B=await((_=o.value)==null?void 0:_.submitForm());t("submit",B)}catch(B){t("error",B)}},preStep:()=>{l.value-=1},nextStep:()=>{l.value+=1},changeHandler:_=>{t("change",_)}}}}),_hoisted_1$4={style:{"min-height":"1px"}},_hoisted_2$4=createTextVNode("\u53D6 \u6D88"),_hoisted_3$2=createTextVNode("\u4E0A\u4E00\u6B65"),_hoisted_4$1=createTextVNode("\u4E0B\u4E00\u6B65");function _sfc_render$7(e,t,o,n,a,l){const i=resolveComponent("m-form"),r=resolveComponent("el-col"),s=resolveComponent("el-button"),d=resolveComponent("el-row"),c=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",null,[createVNode(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=u=>e.dialogVisible=u),"custom-class":"m-form-dialog",top:"20px",title:e.title,appendToBody:!0,width:e.width,fullscreen:e.fullscreen,"close-on-click-modal":!1,onClose:e.closeHandler},{footer:withCtx(()=>[createVNode(d,{class:"dialog-footer"},{default:withCtx(()=>[createVNode(r,{span:12,style:{"text-align":"left"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$4,[renderSlot(e.$slots,"left")])]),_:3}),createVNode(r,{span:12},{default:withCtx(()=>[renderSlot(e.$slots,"footer",{},()=>[createVNode(s,{onClick:e.cancel,size:"small"},{default:withCtx(()=>[_hoisted_2$4]),_:1},8,["onClick"]),e.hasStep&&e.stepActive>1?(openBlock(),createBlock(s,{key:0,type:"info",size:"small",onClick:e.preStep},{default:withCtx(()=>[_hoisted_3$2]),_:1},8,["onClick"])):createCommentVNode("",!0),e.hasStep&&e.stepCount>e.stepActive?(openBlock(),createBlock(s,{key:1,type:"info",size:"small",onClick:e.nextStep},{default:withCtx(()=>[_hoisted_4$1]),_:1},8,["onClick"])):(openBlock(),createBlock(s,{key:2,type:"primary",size:"small",loading:e.saveFetch,onClick:e.save},{default:withCtx(()=>[createTextVNode(toDisplayString(e.confirmText),1)]),_:1},8,["loading","onClick"]))])]),_:3})]),_:3})]),default:withCtx(()=>[createBaseVNode("div",{class:"m-dialog-body",style:normalizeStyle(`max-height: ${e.bodyHeight}; overflow-y: auto; overflow-x: hidden;`)},[createVNode(i,{modelValue:e.stepActive,"onUpdate:modelValue":t[0]||(t[0]=u=>e.stepActive=u),ref:"form",size:e.size,config:e.config,"init-values":e.values,"label-width":e.labelWidth,onChange:e.changeHandler},null,8,["modelValue","size","config","init-values","label-width","onChange"]),renderSlot(e.$slots,"default")],4)]),_:3},8,["modelValue","title","width","fullscreen","onClose"])])}var FormDialog=_export_sfc(_sfc_main$9,[["render",_sfc_render$7]]),index$1="";const defaultInstallOpt={},install=(e,t)=>{const o=Object.assign(defaultInstallOpt,t);e.config.globalProperties.$MAGIC_FORM=o,setConfig(o),e.component(MForm.name,MForm),e.component(FormDialog.name,FormDialog),e.component(Container.name,Container),e.component(Fieldset.name,Fieldset),e.component(GroupList.name,GroupList),e.component(Panel.name,Panel),e.component(Row.name,Row),e.component(MStep.name,MStep),e.component(Table$1.name,Table$1),e.component(Tabs.name,Tabs),e.component(Text.name,Text),e.component(Number$1.name,Number$1),e.component(Textarea.name,Textarea),e.component(_sfc_main$j.name,_sfc_main$j),e.component(Date$1.name,Date$1),e.component(DateTime.name,DateTime),e.component(Time.name,Time),e.component(Checkbox.name,Checkbox),e.component(Switch.name,Switch),e.component(Daterange.name,Daterange),e.component(_sfc_main$p.name,_sfc_main$p),e.component(CheckboxGroup.name,CheckboxGroup),e.component(RadioGroup.name,RadioGroup),e.component(_sfc_main$l.name,_sfc_main$l),e.component(Link.name,Link),e.component(Select.name,Select),e.component(Cascader.name,Cascader),e.component(DynamicField.name,DynamicField)};var MagicForm={install};const _hoisted_1$3=createTextVNode("\u4FDD\u5B58"),_hoisted_2$3=createTextVNode("\u53D6\u6D88"),_sfc_main$8=defineComponent({props:{columns:{type:Array,require:!0,default:()=>[]},config:{type:Object,require:!0,default:()=>{}},rowkeyName:{type:String,default:"c_id"},editState:{type:Object,default:()=>{}}},emits:["afterAction"],setup(e,{emit:t}){const o=e,n=(c,u)=>typeof c=="function"?c.call(this,this,u):!0,a=(c,u)=>{var m;ElMessage.success(c),(m=u.after)==null||m.call(u)},l=c=>ElMessage.error(c),i=async(c,u)=>{var h;await ElMessageBox.confirm(`\u786E\u8BA4\u5220\u9664${u[c.name||"c_name"]}(${u[o.rowkeyName]})?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"});const m=await((h=c.handler)==null?void 0:h.call(c,u));m.ret===0?a("\u5220\u9664\u6210\u529F!",c):l(m.msg||"\u5220\u9664\u5931\u8D25")},r=async(c,u)=>{var m;await ElMessageBox.confirm(`\u786E\u5B9A\u590D\u5236${u[c.name||"c_name"]}(${u.c_id})?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"});try{const h=await((m=c.handler)==null?void 0:m.call(c,u));h.ret===0?a("\u590D\u5236\u6210\u529F!",c):l(`\u590D\u5236\u5931\u8D25!${h.msg}`)}catch{l("\u590D\u5236\u5931\u8D25!")}},s=async(c,u,m)=>{var h,f;c.type==="delete"?await i(c,u):c.type==="copy"?await r(c,u):c.type==="edit"?o.editState[m]=u:(await((h=c.handler)==null?void 0:h.call(c,u)),(f=c.after)==null||f.call(c))},d=async(c,u)=>{var B,g;const m=(g=(B=u.actions)==null?void 0:B.find($=>$.type==="edit"))==null?void 0:g.action;if(!m)return;const h={},f=o.editState[c];o.columns.filter($=>$.type).forEach($=>{h[$.prop]=f[$.prop]});const _=await m({data:h});_?_.ret===0?(ElMessage.success("\u4FDD\u5B58\u6210\u529F"),o.editState[c]=void 0,t("afterAction")):ElMessage.error({duration:1e4,showClose:!0,dangerouslyUseHTMLString:!0,message:_.msg||"\u4FDD\u5B58\u5931\u8D25"}):(o.editState[c]=void 0,t("afterAction"))};return(c,u)=>{const m=resolveComponent("el-button"),h=resolveComponent("el-table-column");return openBlock(),createBlock(h,{label:e.config.label,width:e.config.width,fixed:e.config.fixed},{default:withCtx(f=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.actions,(_,B)=>withDirectives((openBlock(),createBlock(m,{innerHTML:_.text,class:"action-btn",type:"text",size:"small",key:B,onClick:g=>s(_,f.row,f.$index)},null,8,["innerHTML","onClick"])),[[vShow,n(_.display,f.row)&&!e.editState[f.$index]]])),128)),withDirectives(createVNode(m,{class:"action-btn",type:"text",size:"small",onClick:_=>d(f.$index,e.config)},{default:withCtx(()=>[_hoisted_1$3]),_:2},1032,["onClick"]),[[vShow,e.editState[f.$index]]]),withDirectives(createVNode(m,{class:"action-btn",type:"text",size:"small",onClick:_=>e.editState[f.$index]=void 0},{default:withCtx(()=>[_hoisted_2$3]),_:2},1032,["onClick"]),[[vShow,e.editState[f.$index]]])]),_:1},8,["label","width","fixed"])}}}),_sfc_main$7=defineComponent({components:{MForm},props:{config:{type:Object,default:()=>({}),required:!0}}});function _sfc_render$6(e,t,o,n,a,l){const i=resolveComponent("m-table"),r=resolveComponent("m-form"),s=resolveComponent("el-table-column");return openBlock(),createBlock(s,{type:"expand"},{default:withCtx(d=>[e.config.table?(openBlock(),createBlock(i,{key:0,"show-header":!1,columns:e.config.table,data:d.row[e.config.prop]},null,8,["columns","data"])):createCommentVNode("",!0),e.config.form?(openBlock(),createBlock(r,{key:1,config:e.config.form,"init-values":e.config.values||d.row[e.config.prop]||{}},null,8,["config","init-values"])):createCommentVNode("",!0)]),_:1})}var ExpandColumn=_export_sfc(_sfc_main$7,[["render",_sfc_render$6]]);const formatter=(e,t)=>{if(e.formatter){e.formatter==="datetime"&&(e.formatter=o=>datetimeFormatter(o));try{return e.formatter(t[e.prop],t)}catch{return t[e.prop]}}else return t[e.prop]},_sfc_main$6=defineComponent({props:{config:{type:Object,default:()=>({}),required:!0}},setup(){return{formatter}}});function _sfc_render$5(e,t,o,n,a,l){const i=resolveComponent("m-table"),r=resolveComponent("el-button"),s=resolveComponent("el-popover"),d=resolveComponent("el-table-column");return openBlock(),createBlock(d,{label:e.config.label,width:e.config.width,fixed:e.config.fixed},{default:withCtx(c=>[createVNode(s,{placement:e.config.popover.placement,width:e.config.popover.width,trigger:e.config.popover.trigger},{reference:withCtx(()=>[createVNode(r,{type:"text"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.config.text||e.formatter(e.config,c.row)),1)]),_:2},1024)]),default:withCtx(()=>[e.config.popover.tableEmbed?(openBlock(),createBlock(i,{key:0,"show-header":e.config.showHeader,columns:e.config.table,data:c.row[e.config.prop]},null,8,["show-header","columns","data"])):createCommentVNode("",!0)]),_:2},1032,["placement","width","trigger"])]),_:1},8,["label","width","fixed"])}var PopoverColumn=_export_sfc(_sfc_main$6,[["render",_sfc_render$5]]);const _sfc_main$5=defineComponent({props:{config:{type:Object,default:()=>({}),required:!0},editState:{type:Object,default:()=>{}}},setup(){return{formatter}}}),_hoisted_1$2=["href"],_hoisted_2$2=["src"],_hoisted_3$1=["href"],_hoisted_4=createTextVNode("\u6269\u5C55\u914D\u7F6E"),_hoisted_5=["innerHTML"];function _sfc_render$4(e,t,o,n,a,l){const i=resolveComponent("m-form-container"),r=resolveComponent("el-form"),s=resolveComponent("el-button"),d=resolveComponent("el-tooltip"),c=resolveComponent("el-tag"),u=resolveComponent("el-table-column");return openBlock(),createBlock(u,{"show-overflow-tooltip":"",label:e.config.label,width:e.config.width,fixed:e.config.fixed,sortable:e.config.sortable,prop:e.config.prop},{default:withCtx(m=>[e.config.type&&e.editState[m.$index]?(openBlock(),createBlock(r,{key:0,"label-width":"0",model:e.editState[m.$index]},{default:withCtx(()=>[createVNode(i,{prop:e.config.prop,rules:e.config.rules,config:e.config,name:e.config.prop,model:e.editState[m.$index]},null,8,["prop","rules","config","name","model"])]),_:2},1032,["model"])):e.config.action==="actionLink"?(openBlock(),createBlock(s,{key:1,type:"text",onClick:h=>e.config.handler(m.row)},{default:withCtx(()=>[createTextVNode(toDisplayString(e.formatter(e.config,m.row)),1)]),_:2},1032,["onClick"])):e.config.action==="img"?(openBlock(),createElementBlock("a",{key:2,target:"_blank",href:m.row[e.config.prop]},[createBaseVNode("img",{src:m.row[e.config.prop],height:"50"},null,8,_hoisted_2$2)],8,_hoisted_1$2)):e.config.action==="link"?(openBlock(),createElementBlock("a",{key:3,target:"_blank",href:m.row[e.config.prop],class:"keep-all"},toDisplayString(m.row[e.config.prop]),9,_hoisted_3$1)):e.config.action==="tip"?(openBlock(),createBlock(d,{key:4,placement:"left"},{content:withCtx(()=>[createBaseVNode("div",null,toDisplayString(e.formatter(e.config,m.row)),1)]),default:withCtx(()=>[createVNode(s,{type:"text"},{default:withCtx(()=>[_hoisted_4]),_:1})]),_:2},1024)):e.config.action==="tag"?(openBlock(),createBlock(c,{key:5,type:typeof e.config.type=="function"?e.config.type(m.row[e.config.prop],m.row):e.config.type,"close-transition":""},{default:withCtx(()=>[createTextVNode(toDisplayString(e.formatter(e.config,m.row)),1)]),_:2},1032,["type"])):(openBlock(),createElementBlock("div",{key:6,innerHTML:e.formatter(e.config,m.row)},null,8,_hoisted_5))]),_:1},8,["label","width","fixed","sortable","prop"])}var TextColumn=_export_sfc(_sfc_main$5,[["render",_sfc_render$4]]),Table_vue_vue_type_style_index_0_lang="";const _sfc_main$4=defineComponent({name:"m-table",components:{ExpandColumn,ActionsColumn:_sfc_main$8,PopoverColumn,TextColumn},props:{data:{type:Array,require:!0},columns:{type:Array,require:!0,default:()=>[]},spanMethod:{type:Function},fetch:{type:Boolean,default:!1},bodyHeight:{type:[String,Number]},showHeader:{type:Boolean},emptyText:{type:String},defaultExpandAll:{type:Boolean,default:!1},rowkeyName:{type:String},border:{type:Boolean,default:!1}},emits:["sort-change","afterAction","select","select-all","selection-change"],data(){return{editState:[]}},computed:{tableData(){return this.selectionColumn?this.data||[]:cloneDeep(this.data)||[]},selectionColumn(){const e=this.columns.filter(t=>t.selection);return e.length?e[0]:null},hasBorder(){return typeof this.border!="undefined"?this.border:!0}},methods:{sortChange(e){this.$emit("sort-change",e)},selectHandler(e,t){const o=this.selectionColumn;!o||(o.selection==="single",this.$emit("select",e,t))},selectAllHandler(e){this.$emit("select-all",e)},selectionChangeHandler(e){this.$emit("selection-change",e)},toggleRowSelection(e,t){const o=this.$refs.table;o.toggleRowSelection.bind(o)(e,t)},toggleRowExpansion(e,t){const o=this.$refs.table;o.toggleRowExpansion.bind(o)(e,t)},clearSelection(){const e=this.$refs.table;e.clearSelection.bind(e)()},objectSpanMethod(e){return typeof this.spanMethod=="function"?this.spanMethod(e):()=>({rowspan:0,colspan:0})}}});function _sfc_render$3(e,t,o,n,a,l){const i=resolveComponent("expand-column"),r=resolveComponent("el-table-column"),s=resolveComponent("actions-column"),d=resolveComponent("popover-column"),c=resolveComponent("text-column"),u=resolveComponent("el-table");return openBlock(),createBlock(u,{data:e.tableData,"show-header":e.showHeader,"max-height":e.bodyHeight,"tooltip-effect":"dark",class:"m-table",ref:"table","default-expand-all":e.defaultExpandAll,border:e.hasBorder,"row-key":e.rowkeyName||"c_id","tree-props":{children:"children"},"empty-text":e.emptyText||"\u6682\u65E0\u6570\u636E","span-method":e.objectSpanMethod,onSortChange:e.sortChange,onSelect:e.selectHandler,onSelectAll:e.selectAllHandler,onSelectionChange:e.selectionChangeHandler},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.columns,(m,h)=>(openBlock(),createElementBlock(Fragment,null,[m.type==="expand"?(openBlock(),createBlock(i,{config:m,key:h},null,8,["config"])):createCommentVNode("",!0),m.selection?(openBlock(),createBlock(r,{type:"selection",key:h,width:"40",selectable:m.selectable},null,8,["selectable"])):m.actions?(openBlock(),createBlock(s,{columns:e.columns,config:m,"rowkey-name":e.rowkeyName,"edit-state":e.editState,key:h,onAfterAction:t[0]||(t[0]=f=>e.$emit("afterAction"))},null,8,["columns","config","rowkey-name","edit-state"])):m.type==="popover"?(openBlock(),createBlock(d,{key:h,config:m},null,8,["config"])):(openBlock(),createBlock(c,{key:h,config:m,"edit-state":e.editState},null,8,["config","edit-state"]))],64))),256))]),_:1},8,["data","show-header","max-height","default-expand-all","border","row-key","empty-text","span-method","onSortChange","onSelect","onSelectAll","onSelectionChange"])}var Table=_export_sfc(_sfc_main$4,[["render",_sfc_render$3]]);const components=[Table];var MagicTable={install(e){components.forEach(t=>{e.component(t.name,t)})}},App_vue_vue_type_style_index_0_lang="";const _sfc_main$3={name:"App"};function _sfc_render$2(e,t,o,n,a,l){const i=resolveComponent("router-view");return openBlock(),createBlock(i)}var App=_export_sfc(_sfc_main$3,[["render",_sfc_render$2]]),config={id:"75f0extui9d7yksklx27hff8xg",name:"test",type:"app",items:[{type:"page",id:"page_299",name:"index",title:"",layout:"absolute",style:{position:"relative",left:0,top:0,right:"",bottom:"",width:"375",height:"1728",backgroundImage:"",backgroundColor:"rgba(248, 218, 218, 1)",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"},events:[],created:"",items:[{id:"container_3001",style:{left:0,top:175,width:375,height:100,position:"absolute"},type:"container",name:"\u7EC4",items:[{id:"button_5137",style:{left:57,top:31,width:270,height:38,position:"absolute",border:0,backgroundColor:"#fb6f00"},type:"button",name:"\u6309\u94AE",text:"\u8BF7\u8F93\u5165\u6587\u672C\u5185\u5BB9",multiple:!0}]}]}]},Editor_vue_vue_type_style_index_0_lang="";const RUNTIME_PATH="/tmagic-editor/playground/runtime/vue3",_sfc_main$2=defineComponent({name:"EditorApp",setup(){const e=ref(),t=ref(!1),o=ref(config),n=ref(config.items[0].id),a=ref({}),l=ref({}),i=ref({}),r={left:[{type:"text",text:"\u9B54\u65B9"}],center:["delete","undo","redo","guides","rule","zoom"],right:[{type:"button",text:"\u9884\u89C8",icon:Connection,handler:()=>{t.value=!0}},{type:"button",text:"\u4FDD\u5B58",icon:Coin$1,handler:s=>{localStorage.setItem("magicUiConfig",serializeJavascript(toRaw(o.value),{space:2,unsafe:!0}).replace(/"(\w+)":\s/g,"$1: ")),s==null||s.editorService.resetModifiedNodeId(),ElMessage.success("\u4FDD\u5B58\u6210\u529F")}},"/",{type:"button",icon:Document,tooltip:"\u6E90\u7801",handler:s=>s==null?void 0:s.uiService.set("showSrc",!(s==null?void 0:s.uiService.get("showSrc")))}]};return asyncLoadJs(`${RUNTIME_PATH}/assets/config.js`).then(()=>{l.value=globalThis.magicPresetConfigs}),asyncLoadJs(`${RUNTIME_PATH}/assets/value.js`).then(()=>{a.value=globalThis.magicPresetValues}),asyncLoadJs(`${RUNTIME_PATH}/assets/event.js`).then(()=>{i.value=globalThis.magicPresetEvents}),{RUNTIME_PATH,editor:e,menu:r,value:o,defaultSelected:n,propsValues:a,propsConfigs:l,eventMethodList:i,previewVisible:t,runtimeUrl:`${RUNTIME_PATH}/playground.html`,componentGroupList:ref([{title:"\u793A\u4F8B\u5BB9\u5668",items:[{icon:FolderOpened,text:"\u7EC4",type:"container"}]},{title:"\u793A\u4F8B\u7EC4\u4EF6",items:[{icon:Tickets,text:"\u6587\u672C",type:"text"},{icon:SwitchButton,text:"\u6309\u94AE",type:"button"}]}]),moveableOptions:s=>{var h,f;const d={},c=(f=(h=s==null?void 0:s.dr)==null?void 0:h.target)==null?void 0:f.id;if(!c||!e.value)return d;const u=e.value.editorService.getNodeById(c);if(!u)return d;const m=u.type==="page";return d.draggable=!m,d.resizable=!m,d}}}}),_hoisted_1$1={class:"editor-app"},_hoisted_2$1=["src"];function _sfc_render$1(e,t,o,n,a,l){const i=resolveComponent("m-editor"),r=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",_hoisted_1$1,[createVNode(i,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value=s),ref:"editor",menu:e.menu,"runtime-url":e.runtimeUrl,"props-configs":e.propsConfigs,"props-values":e.propsValues,"event-method-list":e.eventMethodList,"component-group-list":e.componentGroupList,"default-selected":e.defaultSelected,"moveable-options":e.moveableOptions},null,8,["modelValue","menu","runtime-url","props-configs","props-values","event-method-list","component-group-list","default-selected","moveable-options"]),createVNode(r,{modelValue:e.previewVisible,"onUpdate:modelValue":t[1]||(t[1]=s=>e.previewVisible=s),"destroy-on-close":"",width:375,"custom-class":"pre-viewer",title:"\u9884\u89C8"},{default:withCtx(()=>{var s;return[e.previewVisible?(openBlock(),createElementBlock("iframe",{key:0,width:"100%",height:"817",src:`${e.RUNTIME_PATH}/page.html?localPreview=1&page=${(s=e.editor)==null?void 0:s.editorService.get("page").id}`},null,8,_hoisted_2$1)):createCommentVNode("",!0)]}),_:1},8,["modelValue"])])}var Editor=_export_sfc(_sfc_main$2,[["render",_sfc_render$1]]);const _sfc_main$1=defineComponent({name:"App",data(){return{resultVisible:!1,result:"",config:[{text:"\u6587\u672C",name:"text",tooltip:(e,{model:t})=>t.text,extra:(e,{model:t})=>`${t.text}extra`,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}]},{type:"checkbox",text:"checkbox",name:"option",activeValue:1,inactiveValue:0,defaultValue:1},{type:"link",displayText:"\u94FE\u63A5",text:"link",name:"link",href:"",tooltip:"element-ui"},{type:"display",text:"\u5C55\u793A",name:"display",initValue:"display",tooltip:"hello"},{type:"number",text:"\u8BA1\u6570\u5668",name:"number"},{type:"textarea",text:"\u8F93\u5165\u6846",name:"textarea1"},{type:"datetime",text:"\u65E5\u671F",name:"datetime"},{type:"switch",text:"\u5F00\u5173",name:"switch",filter:"number",defaultValue:1},{type:"daterange",text:"\u65E5\u671F\u8303\u56F4",name:"daterange"},{type:"time",text:"\u65E5\u671F\u9009\u62E9",name:"time"},{type:"colorPicker",text:"\u53D6\u8272\u5668",name:"colorPicker"},{type:"checkbox-group",text:"\u9009\u9879\u7EC4",name:"checkGroup",options:[{value:1,text:"one"},{value:2,text:"two"}]},{type:"radio-group",text:"\u5355\u9009\u6846",name:"radioGroup",options:[{value:1,text:"one"},{value:2,text:"two"}]},{type:"cascader",text:"\u7EA7\u8054\u9009\u62E9",placeholder:"test",name:"cascader",options:[{value:1,label:"one",children:[{value:3,label:"three",children:[{value:8,label:"eight"}]},{value:4,label:"four"},{value:6,label:"six"}]},{value:2,label:"two",children:[{value:5,label:"five"},{value:7,label:"seven"}]}]},{type:"dynamic-field",name:"dynamic-field",dynamicKey:"textarea",text:"\u52A8\u6001\u8868\u5355",returnFields:()=>[{name:"one",label:"number",defaultValue:"yes"}]},{type:"row",items:[{type:"date",text:"\u65E5\u671F",name:"date"},{type:"checkbox",text:"\u591A\u9009\u6846",name:"checkbox",tooltip:"\u5206\u7EC4xxxxxxxxxxxx",extra:"extra"}]},{type:"fieldset",name:"fieldset",text:"\u5206\u7EC4",extra:"extra",checkbox:!0,expand:"checkbox",items:[{type:"select",text:"\u4E0B\u62C9\u9009\u9879",name:"select",options:[{text:"\u9009\u98791",value:1},{text:"\u9009\u98792",value:2}]}]},{type:"table",name:"table",defautSort:{prop:"name",order:"descending"},extra:"extra",itemExtra:(e,{model:t})=>`${t.text}itemExtra`,items:[{label:"id",name:"id",sortable:!0,tooltip:"\u5206\u7EC4xxxxxxxxxxxx",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}]},{label:"\u540D\u79F0",name:"name"}]},{type:"groupList",name:"groupList",extra:"\u5206\u7EC4xxxxxxxxxxxx",itemExtra:(e,{model:t})=>`${t.name}extra`,items:[{text:"id",name:"id",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}]},{text:"\u540D\u79F0",name:"name"}]},{type:"panel",title:"panel",extra:"panel",schematic:"https://vfiles.gtimg.cn/vupload/20210329/9712631617027075445.png",items:[{text:"\u540D\u79F0",name:"name"}]},{type:"step",items:[{name:"step1",title:"step1",items:[{text:"\u540D\u79F0",name:"name"}]},{name:"step2",title:"step2",items:[{text:"\u540D\u79F02",name:"name"}]}]}],initValue:{text:"\u6587\u672C",number:10,fieldset:{select:1},table:[{id:1,name:"a"},{id:2,name:"b"}]},tableConfig:[{label:"id",prop:"id"},{label:"name",prop:"name"}],tableData:[{id:1,name:"xx"},{id:2,name:"xx2"}]}},methods:{async submit(){try{const e=await this.$refs.form.submitForm();this.resultVisible=!0,this.result=JSON.stringify(e,null,2)}catch(e){console.error(e),ElMessage.error({duration:1e4,showClose:!0,message:e.message,dangerouslyUseHTMLString:!0})}},spanMethod({rowIndex:e,columnIndex:t}){if(t===0)return e%2===0?{rowspan:2,colspan:1}:{rowspan:0,colspan:0}}}}),_hoisted_1={style:{padding:"20px"}},_hoisted_2=createTextVNode("\u63D0\u4EA4"),_hoisted_3=["innerHTML"];function _sfc_render(e,t,o,n,a,l){const i=resolveComponent("m-form"),r=resolveComponent("el-button"),s=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(i,{ref:"form",config:e.config,"init-values":e.initValue,size:"small"},null,8,["config","init-values"]),createVNode(r,{onClick:e.submit},{default:withCtx(()=>[_hoisted_2]),_:1},8,["onClick"]),createVNode(s,{modelValue:e.resultVisible,"onUpdate:modelValue":t[0]||(t[0]=d=>e.resultVisible=d),title:"result"},{default:withCtx(()=>[createBaseVNode("pre",null,[createBaseVNode("code",{class:"language-javascript hljs",innerHTML:e.result},null,8,_hoisted_3)])]),_:1},8,["modelValue"])])}var Form=_export_sfc(_sfc_main$1,[["render",_sfc_render]]);const _sfc_main=defineComponent({setup(e){const t=ref([{type:"expand",prop:"b",table:[{prop:"a",label:"1"}]},{prop:"a",label:"1231"}]),o=ref([{a:"a1",b:[{a:1}]}]);return(n,a)=>{const l=resolveComponent("m-table");return openBlock(),createBlock(l,{columns:t.value,data:o.value,"show-header":!0},null,8,["columns","data"])}}}),routes=[{path:"/",component:Editor},{path:"/form",component:Form},{path:"/table",component:_sfc_main}];var router=createRouter({history:createWebHashHistory(),routes}),index="";globalThis.MonacoEnvironment={getWorker(e,t){return t==="json"?new WorkerWrapper:t==="css"||t==="scss"||t==="less"?new WorkerWrapper$1:t==="html"||t==="handlebars"||t==="razor"?new WorkerWrapper$2:t==="typescript"||t==="javascript"?new WorkerWrapper$3:new WorkerWrapper$4}};languages.typescript.typescriptDefaults.setEagerModelSync(!0);const app=createApp(App);app.use(router);app.use(installer,{locale:zhCn});app.use(MagicEditor);app.use(MagicForm);app.use(MagicTable);app.mount("#app");
//# sourceMappingURL=index.af8a3098.js.map
