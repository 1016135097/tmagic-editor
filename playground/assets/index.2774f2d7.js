var j=Object.defineProperty,G=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var A=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var L=(e,t,o)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,$=(e,t)=>{for(var o in t||(t={}))P.call(t,o)&&L(e,o,t[o]);if(A)for(var o of A(t))I.call(t,o)&&L(e,o,t[o]);return e},V=(e,t)=>G(e,U(t));var z=(e,t)=>{var o={};for(var n in e)P.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&A)for(var n of A(e))t.indexOf(n)<0&&I.call(e,n)&&(o[n]=e[n]);return o};var _=(e,t,o)=>(L(e,typeof t!="symbol"?t+"":t,o),o);import{d as defineComponent,c as computed,r as resolveComponent,o as openBlock,a as createBlock,n as normalizeStyle,b as ref,w as watchEffect,s as serializeJavascript,i as inject,e as createElementBlock,f as createBaseVNode,t as toDisplayString,g as withModifiers,h as createCommentVNode,j as hooks,k as watch,l as onMounted,m as onUnmounted,p as cloneDeep,q as events,u as reactive,v as random,x as toRaw,P as Plus,y as createVNode,z as withCtx,G as Gesto,A as renderSlot,F as Fragment,E as Edit,B as normalizeClass,C as resolveDynamicComponent,D as ArrowDown,H as Grid,S as ScaleToOriginal,Z as ZoomOut,I as ZoomIn,R as Right,J as Back,K as Delete,L as renderList,M as createTextVNode,N as normalizeProps,O as mergeProps,Q as getCurrentInstance,T as ElMessage,U as withDirectives,V as vShow,W as Teleport,X as Files,Y as Coin,_ as toHandlers,$ as createSlots,a0 as CaretBottom,a1 as Moveable,a2 as lodash,a3 as Guides,a4 as nextTick,a5 as provide,a6 as CaretRight,a7 as CaretBottom$1,a8 as Delete$1,a9 as ArrowDown$1,aa as ArrowUp,ab as toRefs,ac as Sortable,ad as unref,ae as onBeforeUnmount,af as vModelText,ag as onBeforeMount,ah as resolveDirective,ai as ElForm,aj as ElMessageBox,ak as Connection,al as Coin$1,am as Document,an as FolderOpened,ao as Tickets,ap as SwitchButton,aq as createRouter,ar as createWebHashHistory,as as createApp,at as installer,au as zhCn}from"./vendor.8ed6f6dc.js";const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const l of i.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function o(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerpolicy&&(i.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?i.credentials="include":a.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=o(a);fetch(a.href,i)}};p();typeof window.global=="undefined"&&(window.global=window);var _export_sfc=(e,t)=>{const o=e.__vccOpts||e;for(const[n,a]of t)o[n]=a;return o};const _sfc_main$V=defineComponent({name:"m-fields-vs-code",props:["model","name","config","prop"],emits:["change"],setup(e,{emit:t}){const o=computed(()=>e.config.language||"javascript");return{height:computed(()=>`${document.body.clientHeight-168}px`),language:o,save(a){e.model[e.name]=a,t("change",a)}}}});function _sfc_render$Q(e,t,o,n,a,i){const l=resolveComponent("magic-code-editor");return openBlock(),createBlock(l,{style:normalizeStyle(`height: ${e.height}`),"init-values":e.model[e.name],language:e.language,onSave:e.save},null,8,["style","init-values","language","onSave"])}var Code=_export_sfc(_sfc_main$V,[["render",_sfc_render$Q]]);const _sfc_main$U=defineComponent({name:"m-fields-code-link",props:{config:{type:Object},model:{type:Object},name:{type:String},prop:{type:String}},emits:["change"],setup(props,{emit}){const modelValue=ref({form:{}});return watchEffect(()=>{!props.model||!props.name||(modelValue.value.form[props.name]=serializeJavascript(props.model[props.name],{space:2,unsafe:!0}).replace(/"(\w+)":\s/g,"$1: "))}),{modelValue,formConfig:computed(()=>V($({},props.config),{text:"",type:"link",form:[{name:props.name,type:"vs-code"}]})),changeHandler(v){if(!(!props.name||!props.model))try{props.model[props.name]=eval(`${v[props.name]}`),emit("change",props.model[props.name])}catch(e){console.error(e)}}}}});function _sfc_render$P(e,t,o,n,a,i){const l=resolveComponent("m-fields-link");return openBlock(),createBlock(l,{config:e.formConfig,model:e.modelValue,name:"form",onChange:e.changeHandler},null,8,["config","model","onChange"])}var CodeLink=_export_sfc(_sfc_main$U,[["render",_sfc_render$P]]),UISelect_vue_vue_type_style_index_0_lang="";const _sfc_main$T=defineComponent({name:"m-fields-ui-select",props:{labelWidth:String,config:Object,model:Object,prop:{type:String,default(){return""}},name:String},emits:["change"],setup(e,{emit:t}){const o=inject("services"),n=inject("mForm"),a=computed(()=>e.model[e.name]),i=ref(!1),l=()=>{!(o==null?void 0:o.uiService)||(o.uiService.set("uiSelectMode",!1),i.value=!1,globalThis.document.removeEventListener("ui-select",s))},s=({detail:r})=>{r.id&&(e.model[e.name]=r.id,t("change",r.id),n==null||n.$emit("field-change",e.prop,r.id)),l&&l()};return{val:a,uiSelectMode:i,toName:computed(()=>{const r=o==null?void 0:o.editorService.getNodeById(a.value);return(r==null?void 0:r.name)||""}),startSelect(){!(o==null?void 0:o.uiService)||(o.uiService.set("uiSelectMode",!0),i.value=!0,globalThis.document.addEventListener("ui-select",s))},cancelHandler:l,deleteHandler(){e.model&&(e.model[e.name]="",t("change",""),n==null||n.$emit("field-change",e.prop,""))}}}}),_hoisted_1$y=createBaseVNode("i",{class:"el-icon-delete",style:{color:"rgb(221, 75, 57)"}},"\u53D6\u6D88",-1),_hoisted_2$j=[_hoisted_1$y],_hoisted_3$f=createBaseVNode("i",{class:"el-icon-thumb"},null,-1);function _sfc_render$O(e,t,o,n,a,i){return e.uiSelectMode?(openBlock(),createElementBlock("div",{key:0,class:"m-fields-ui-select",onClick:t[0]||(t[0]=(...l)=>e.cancelHandler&&e.cancelHandler(...l))},_hoisted_2$j)):(openBlock(),createElementBlock("div",{key:1,class:"m-fields-ui-select",onClick:t[2]||(t[2]=(...l)=>e.startSelect&&e.startSelect(...l))},[_hoisted_3$f,createBaseVNode("span",null,toDisplayString(e.val?e.toName+"_"+e.val:"\u70B9\u51FB\u6B64\u5904\u9009\u62E9"),1),e.val?(openBlock(),createElementBlock("i",{key:0,class:"el-icon-delete",onClick:t[1]||(t[1]=withModifiers((...l)=>e.deleteHandler&&e.deleteHandler(...l),["stop"]))})):createCommentVNode("",!0)]))}var uiSelect=_export_sfc(_sfc_main$T,[["render",_sfc_render$O]]);const sleep=e=>new Promise(t=>{const o=setTimeout(()=>{clearTimeout(o),t()},e)}),datetimeFormatter=(e,t="-",o="YYYY-MM-DD HH:mm:ss")=>{let n=o;if(n==="timestamp"&&(n="x"),e){let a=null;return typeof e=="string"&&e.includes("Z")||e.constructor===Date?a=hooks(e).utcOffset("+08:00").format(n):a=hooks(e).format(n),n==="x"?+a:a!=="Invalid date"?a:t}return t},asyncLoadJs=(()=>{const e=new Map;return(t,o,n=globalThis.document)=>{let a=e.get(n);if(a||(a=new Map,e.set(n,a)),a.get(t))return a.get(t);const i=new Promise((l,s)=>{const r=n.createElement("script");r.type="text/javascript",o&&(r.crossOrigin=o),r.src=t,n.body.appendChild(r),r.onload=()=>{l()},r.onerror=()=>{s(new Error("\u52A0\u8F7D\u5931\u8D25"))},setTimeout(()=>{s(new Error("timeout"))},60*1e3)}).catch(l=>{throw a.delete(t),l});return a.set(t,i),a.get(t)}})(),toLine=(e="")=>e.replace(/\B([A-Z])/g,"-$1").toLowerCase(),getNodePath=(e,t=[])=>{const o=[],n=function(a,i){if(!Array.isArray(i))return null;for(let l=0,s=i.length;l<s;l++){const r=i[l];if(o.push(r),`${r.id}`==`${a}`)return r;if(r.items){const d=n(a,r.items);if(d)return d}o.pop()}return null};return n(e,t),o},isPop=e=>e.type.toLowerCase().endsWith("pop"),initEditor=()=>(globalThis.monaco&&Promise.resolve(globalThis.monaco),asyncLoadJs("https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs/loader.min.js").then(()=>(globalThis.require.config({paths:{vs:"https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.26.1/min/vs"}}),new Promise(e=>{globalThis.require(["vs/editor/editor.main"],()=>{e(globalThis.monaco)})})))),toString=(e,t)=>{let o="";return typeof e!="string"?o=serializeJavascript(e,{space:2,unsafe:!0}).replace(/"(\w+)":\s/g,"$1: "):o=e,t==="javascript"&&o.startsWith("{")&&o.endsWith("}")&&(o=`(${o})`),o},_sfc_main$S=defineComponent({name:"magic-code-editor",props:{initValues:{type:[String,Object]},modifiedValues:{type:[String,Object]},type:{type:[String],default:()=>""},language:{type:[String],default:()=>"javascript"}},emits:["inited","save"],setup(e,{emit:t}){let o=null;const n=ref(""),a=ref(!1),i=ref(),l=(c,u)=>{var m;if(n.value=toString(c,e.language),e.type==="diff"){const f=globalThis.monaco.editor.createModel(n.value,"text/javascript"),g=globalThis.monaco.editor.createModel(toString(u,e.language),"text/javascript");return o.setModel({original:f,modified:g})}return(m=o.setValue)==null?void 0:m.call(o,n.value)},s=()=>{o==null||o.layout()},r=()=>{var c;return((c=o.getValue)==null?void 0:c.call(o))||""},d=async()=>{!i.value||(o=globalThis.monaco.editor[e.type==="diff"?"createDiffEditor":"create"](i.value,{value:n.value,language:e.language,tabSize:2,theme:"vs-dark",fontFamily:'dm, Menlo, Monaco, "Courier New", monospace',fontSize:15,formatOnPaste:!0}),l(e.initValues,e.modifiedValues),a.value=!1,t("inited",o),i.value.addEventListener("keydown",c=>{c.keyCode===83&&(navigator.platform.match("Mac")?c.metaKey:c.ctrlKey)&&(c.preventDefault(),t("save",r()))}),e.type!=="diff"&&o.onDidBlurEditorWidget(()=>{t("save",r())}),globalThis.addEventListener("resize",s))};return watch(()=>e.initValues,(c,u)=>{o&&c!==u&&l(e.initValues,e.modifiedValues)},{deep:!0,immediate:!0}),onMounted(async()=>{if(a.value=!0,await initEditor(),globalThis.monaco)d();else{const c=setInterval(()=>{globalThis.monaco&&(clearInterval(c),d())},300)}}),onUnmounted(()=>{globalThis.removeEventListener("resize",s)}),{values:n,loading:a,codeEditor:i,getEditor(){return o},setEditorValue:l,focus(){o.focus()}}}}),_hoisted_1$x={ref:"codeEditor",class:"magic-code-editor"};function _sfc_render$N(e,t,o,n,a,i){return openBlock(),createElementBlock("div",_hoisted_1$x,null,512)}var CodeEditor=_export_sfc(_sfc_main$S,[["render",_sfc_render$N]]);class UndoRedo{constructor(t=200){_(this,"elementList");_(this,"listCursor");_(this,"listMaxSize");this.elementList=[],this.listCursor=0,this.listMaxSize=t>2?t:2}pushElement(t){this.elementList.splice(this.listCursor,this.elementList.length-this.listCursor,cloneDeep(t)),this.listCursor+=1,this.elementList.length>this.listMaxSize&&(this.elementList.shift(),this.listCursor-=1)}canUndo(){return this.listCursor>1}undo(){return this.canUndo()?(this.listCursor-=1,this.getCurrentElement()):null}canRedo(){return this.elementList.length>this.listCursor}redo(){return this.canRedo()?(this.listCursor+=1,this.getCurrentElement()):null}getCurrentElement(){return this.listCursor<1?null:cloneDeep(this.elementList[this.listCursor-1])}}const compose=e=>{if(!Array.isArray(e))throw new TypeError("Middleware \u5FC5\u987B\u662F\u4E00\u4E2A\u6570\u7EC4!");for(const t of e)if(typeof t!="function")throw new TypeError("Middleware \u5FC5\u987B\u7531\u51FD\u6570\u7EC4\u6210!");return(t,o)=>{let n=-1;return a(0);function a(i){if(i<=n)return Promise.reject(new Error("next() \u88AB\u591A\u6B21\u8C03\u7528"));n=i;let l=e[i];if(i===e.length&&o&&(l=o),!l)return Promise.resolve();try{return Promise.resolve(l(...t,a.bind(null,i+1)))}catch(s){return Promise.reject(s)}}}},methodName=(e,t)=>`${e}${t[0].toUpperCase()}${t.substring(1)}`,isError=e=>Object.prototype.toString.call(e)==="[object Error]";class BaseService extends events.exports.EventEmitter{constructor(t){super();_(this,"pluginOptionsList",{});_(this,"middleware",{});t.forEach(o=>{const n=this,a=n[o],i=methodName("before",o),l=methodName("after",o);this.pluginOptionsList[i]=[],this.pluginOptionsList[l]=[],this.middleware[o]=[];const s=compose(this.middleware[o]);Object.defineProperty(n,o,{value:async(...r)=>{let d=r;for(const u of this.pluginOptionsList[i]){let m=await u(...d)||[];if(isError(m))throw m;Array.isArray(m)||(m=[m]),d=d.map((f,g)=>typeof m[g]=="undefined"?f:m[g])}let c=await s(d,a.bind(n));for(const u of this.pluginOptionsList[l])if(c=await u(...d,c),isError(c))throw c;return c}})})}use(t){Object.entries(t).forEach(([o,n])=>{typeof n=="function"&&this.middleware[o].push(n)})}usePlugin(t){Object.entries(t).forEach(([o,n])=>{typeof n=="function"&&this.pluginOptionsList[o].push(n)})}}class History extends BaseService{constructor(){super([]);_(this,"state",reactive({pageSteps:{},pageId:void 0,canRedo:!1,canUndo:!1}));this.on("change",this.setCanUndoRedo)}changePage(t){if(!!t){if(this.state.pageId=t.id,!this.state.pageSteps[this.state.pageId]){const o=new UndoRedo;o.pushElement({data:t,modifiedNodeIds:new Map,nodeId:t.id}),this.state.pageSteps[this.state.pageId]=o}this.setCanUndoRedo()}}empty(){this.state.pageId=void 0,this.state.pageSteps={},this.state.canRedo=!1,this.state.canUndo=!1}push(t){const o=this.getUndoRedo();return o?(o.pushElement(t),this.emit("change",t),t):null}undo(){const t=this.getUndoRedo();if(!t)return null;const o=t.undo();return this.emit("change",o),o}redo(){const t=this.getUndoRedo();if(!t)return null;const o=t.redo();return this.emit("change",o),o}destroy(){this.empty(),this.removeAllListeners()}getUndoRedo(){return this.state.pageId?this.state.pageSteps[this.state.pageId]:null}setCanUndoRedo(){const t=this.getUndoRedo();this.state.canRedo=(t==null?void 0:t.canRedo())||!1,this.state.canUndo=(t==null?void 0:t.canUndo())||!1}}var historyService=new History;class Props extends BaseService{constructor(){super(["setPropsConfig","getPropsConfig","setPropsValue","getPropsValue"]);_(this,"state",reactive({propsConfigMap:{},propsValueMap:{}}))}setPropsConfigs(t){Object.keys(t).forEach(o=>{this.setPropsConfig(toLine(o),t[o])}),this.emit("props-configs-change")}setPropsConfig(t,o){this.state.propsConfigMap[t]=fillConfig(Array.isArray(o)?o:[o])}async getPropsConfig(t){return t==="area"?await this.getPropsConfig("button"):cloneDeep(this.state.propsConfigMap[t]||DEFAULT_CONFIG)}setPropsValues(t){Object.keys(t).forEach(o=>{this.setPropsValue(toLine(o),t[o])})}setPropsValue(t,o){this.state.propsValueMap[t]=o}async getPropsValue(t){if(t==="area"){const o=await this.getPropsValue("button");return o.className="action-area",o.text="",o.style&&(o.style.backgroundColor="rgba(255, 255, 255, 0)"),o}return cloneDeep($($({},getDefaultPropsValue(t)),this.state.propsValueMap[t]||{}))}}var propsService=new Props,LayerOffset=(e=>(e.TOP="top",e.BOTTOM="bottom",e))(LayerOffset||{}),Layout=(e=>(e.FLEX="flex",e.FIXED="fixed",e.RELATIVE="relative",e.ABSOLUTE="absolute",e))(Layout||{});const COPY_STORAGE_KEY="$MagicEditorCopyData",generateId=e=>`${e}_${random(1e4,!1)}`,getPageList=e=>e.items&&Array.isArray(e.items)?e.items.filter(t=>t.type==="page"):[],getPageNameList=e=>e.map(t=>t.name||"index"),generatePageName=e=>{let t=e.length;if(!t)return"index";let o=`page_${t}`;for(;e.includes(o);)t+=1,o=`page_${t}`;return o},generatePageNameByApp=e=>generatePageName(getPageNameList(getPageList(e))),updatePopId=(e,t,o)=>{var n;(n=o.items)==null||n.forEach(a=>{if(a.pop===e){a.pop=t;return}if(a.popId===e){a.popId=t;return}Array.isArray(a.items)&&updatePopId(e,t,a)})},setNewItemId=(e,t)=>{var n;const o=e.id;e.id=generateId(e.type),e.name=`${(n=e.name)==null?void 0:n.replace(/_(\d+)$/,"")}_${e.id}`,isPop(e)&&(t==null?void 0:t.type)==="page"&&updatePopId(o,e.id,t),e.items&&Array.isArray(e.items)&&e.items.forEach(a=>setNewItemId(a,e))},isFixed$1=e=>{var t;return((t=e.style)==null?void 0:t.position)==="fixed"},getNodeIndex=(e,t)=>((t==null?void 0:t.items)||[]).findIndex(n=>`${n.id}`==`${e.id}`),toRelative=e=>(e.style=V($({},e.style||{}),{position:"relative",top:0,left:0}),e),initPosition=(e,t)=>t===Layout.ABSOLUTE?(e.style=$({position:"absolute"},e.style||{}),e):t===Layout.RELATIVE?toRelative(e):e,setLayout=(e,t)=>{var o;return(o=e.items)==null||o.forEach(n=>{isPop(n)||(n.style=n.style||{},n.style.position!=="fixed"&&(t!==Layout.RELATIVE?n.style.position="absolute":(toRelative(n),n.style.right="auto",n.style.bottom="auto")))}),e},change2Fixed=(e,t)=>{const o=getNodePath(e.id,t.items),n={left:0,top:0};return o.forEach(a=>{var i,l;n.left=n.left+globalThis.parseFloat(((i=a.style)==null?void 0:i.left)||0),n.top=n.top+globalThis.parseFloat(((l=a.style)==null?void 0:l.top)||0)}),e.style=$($({},e.style||{}),n),e},Fixed2Other=async(e,t,o)=>{var r,d;const n=getNodePath(e.id,t.items),a=n.pop(),i={left:((r=a==null?void 0:a.style)==null?void 0:r.left)||0,top:((d=a==null?void 0:a.style)==null?void 0:d.top)||0};n.forEach(c=>{var u,m;i.left=i.left-globalThis.parseFloat(((u=c.style)==null?void 0:u.left)||0),i.top=i.top-globalThis.parseFloat(((m=c.style)==null?void 0:m.top)||0)});const l=n.pop();return l&&await o(l)!==Layout.RELATIVE?(e.style=V($($({},e.style||{}),i),{position:"absolute"}),e):toRelative(e)},defaults=(e,t)=>{let o=t;return Array.isArray(e)&&(o=e),Object.entries(o).forEach(([n,a])=>{if(typeof e[n]=="undefined"){e[n]=a;return}a&&typeof a!="string"&&Object.keys(a).length&&(e[n]=defaults(cloneDeep(e[n]),a))}),e};class Editor$2 extends BaseService{constructor(){super(["getLayout","select","add","remove","update","sort","copy","paste","alignCenter","moveLayer","undo","redo"]);_(this,"isHistoryStateChange",!1);_(this,"state",reactive({root:null,page:null,parent:null,node:null,stage:null,modifiedNodeIds:new Map}))}set(e,t){this.state[e]=t,e==="root"&&this.emit("root-change",t)}get(e){return this.state[e]}getNodeInfo(e){const t=this.get("root");if(!t)return{};if(e===t.id)return{node:t};const o=getNodePath(e,t.items);if(!o.length)return{};o.unshift(t);const n={};return n.node=o[o.length-1],n.parent=o[o.length-2],o.forEach(a=>{if(a.type==="page"){n.page=a;return}}),n}getNodeById(e){const{node:t}=this.getNodeInfo(e);return t}getParentById(e){if(!this.get("root"))return;const{parent:t}=this.getNodeInfo(e);return t}async getLayout(e){var t;return e.layout?e.layout:((t=e.style)==null?void 0:t.position)?Layout.ABSOLUTE:Layout.RELATIVE}async select(e){let t;if(typeof e=="string"||typeof e=="number"?t=e:t=e.id,!t)throw new Error("\u6CA1\u6709ID\uFF0C\u65E0\u6CD5\u9009\u4E2D");const{node:o,parent:n,page:a}=this.getNodeInfo(t);if(!o)throw new Error("\u83B7\u53D6\u4E0D\u5230\u7EC4\u4EF6\u4FE1\u606F");return this.set("node",o),this.set("page",a||null),this.set("parent",n||null),a?historyService.changePage(toRaw(a)):historyService.empty(),o}async add(n,o){var a=n,{type:e}=a,t=z(a,["type"]);var d,c;const i=this.get("node");let l;if(e==="page"?l=this.get("root"):o&&typeof o!="function"?l=o:i.items?l=i:l=this.getParentById(i.id),!l)throw new Error("\u672A\u627E\u5230\u7236\u5143\u7D20");const s=await this.getLayout(l),r=initPosition($($({},toRaw(await propsService.getPropsValue(e))),t),s);if(((l==null?void 0:l.type)==="app"||i.type==="app")&&r.type!=="page")throw new Error("app\u4E0B\u4E0D\u80FD\u6DFB\u52A0\u7EC4\u4EF6");return(d=l==null?void 0:l.items)==null||d.push(r),await((c=this.get("stage"))==null?void 0:c.add({config:cloneDeep(r),root:cloneDeep(this.get("root"))})),await this.select(r),this.addModifiedNodeId(r.id),this.pushHistoryState(),r}async remove(e){var i,l;if(!(e==null?void 0:e.id))return;const t=this.get("root");if(!t)throw new Error("\u6CA1\u6709root");const{parent:o,node:n}=this.getNodeInfo(e.id);if(!o||!n)throw new Error("\u627E\u4E0D\u8981\u5220\u9664\u7684\u8282\u70B9");const a=getNodeIndex(n,o);if(typeof a!="number"||a===-1)throw new Error("\u627E\u4E0D\u8981\u5220\u9664\u7684\u8282\u70B9");return(i=o.items)==null||i.splice(a,1),(l=this.get("stage"))==null||l.remove({id:e.id,root:this.get("root")}),e.type==="page"?await this.select(t.items[0]||t):await this.select(o),this.addModifiedNodeId(o.id),this.pushHistoryState(),e}async update(e){var d;if(!(e==null?void 0:e.id))throw new Error("\u6CA1\u6709\u914D\u7F6E\u6216\u8005\u914D\u7F6E\u7F3A\u5C11id\u503C");const t=this.getNodeInfo(e.id);if(!t.node)throw new Error(`\u83B7\u53D6\u4E0D\u5230id\u4E3A${e.id}\u7684\u8282\u70B9`);const o=cloneDeep(toRaw(t.node)),{parent:n}=t;if(!n)throw new Error("\u83B7\u53D6\u4E0D\u5230\u7236\u7EA7\u8282\u70B9");let a=await this.toggleFixedPosition(toRaw(e),o,this.get("root"));if(defaults(a,o),!a.type)throw new Error("\u914D\u7F6E\u7F3A\u5C11type\u503C");if(a.type==="app")return this.set("root",a),a;const i=n.items,l=getNodeIndex(a,n);if(!i||typeof l=="undefined"||l===-1)throw new Error("\u66F4\u65B0\u7684\u8282\u70B9\u672A\u627E\u5230");const s=await this.getLayout(a),r=await this.getLayout(o);return s!==r&&(a=setLayout(a,s)),i[l]=a,a.id===this.get("node").id&&this.set("node",a),(d=this.get("stage"))==null||d.update({config:cloneDeep(a),root:this.get("root")}),a.type==="page"&&this.set("page",a),this.addModifiedNodeId(a.id),this.pushHistoryState(),a}async sort(e,t){const o=this.get("node"),n=cloneDeep(toRaw(this.get("parent"))),a=n.items.findIndex(l=>`${l.id}`==`${t}`);if(a<0)return;const i=n.items.findIndex(l=>`${l.id}`==`${e}`);n.items.splice(a,0,...n.items.splice(i,1)),await this.update(n),await this.select(o),this.addModifiedNodeId(n.id),this.pushHistoryState()}async copy(e){globalThis.localStorage.setItem(COPY_STORAGE_KEY,serializeJavascript(e))}async paste(position={}){const configStr=globalThis.localStorage.getItem(COPY_STORAGE_KEY);let config={};if(!!configStr){try{eval(`config = ${configStr}`)}catch(e){console.error(e);return}return setNewItemId(config,this.get("root")),config.style&&(config.style=$($({},config.style),position)),await this.add(config)}}async alignCenter(e){var a,i,l;const t=this.get("parent"),o=this.get("node");if(await this.getLayout(t)!==Layout.RELATIVE)return((a=t.style)==null?void 0:a.width)&&((i=o.style)==null?void 0:i.width)&&(o.style.left=(t.style.width-o.style.width)/2),await this.update(o),(l=this.get("stage"))==null||l.update({config:cloneDeep(toRaw(o)),root:this.get("root")}),this.addModifiedNodeId(e.id),this.pushHistoryState(),e}async moveLayer(e){var i;const t=this.get("parent"),o=this.get("node"),n=(t==null?void 0:t.items)||[],a=n.findIndex(l=>`${l.id}`==`${o==null?void 0:o.id}`);e===LayerOffset.BOTTOM?n.splice(n.length-1,0,n.splice(a,1)[0]):e===LayerOffset.TOP?n.splice(0,0,n.splice(a,1)[0]):n.splice(a+parseInt(`${e}`,10),0,n.splice(a,1)[0]),(i=this.get("stage"))==null||i.update({config:cloneDeep(toRaw(t)),root:this.get("root")})}async undo(){const e=historyService.undo();return await this.changeHistoryState(e),e}async redo(){const e=historyService.redo();return await this.changeHistoryState(e),e}destroy(){this.removeAllListeners(),this.set("root",null),this.set("node",null),this.set("page",null),this.set("parent",null)}resetModifiedNodeId(){this.get("modifiedNodeIds").clear()}addModifiedNodeId(e){this.isHistoryStateChange||this.get("modifiedNodeIds").set(e,e)}pushHistoryState(){const e=cloneDeep(toRaw(this.get("node")));this.isHistoryStateChange||historyService.push({data:cloneDeep(toRaw(this.get("page"))),modifiedNodeIds:this.get("modifiedNodeIds"),nodeId:e.id}),this.isHistoryStateChange=!1}async changeHistoryState(e){!e||(this.isHistoryStateChange=!0,await this.update(e.data),this.set("modifiedNodeIds",e.modifiedNodeIds),setTimeout(()=>e.nodeId&&this.select(e.nodeId),0))}async toggleFixedPosition(e,t,o){var a;let n=cloneDeep(e);return!isPop(t)&&((a=n.style)==null?void 0:a.position)&&(isFixed$1(n)&&!isFixed$1(t)?n=change2Fixed(n,o):!isFixed$1(n)&&isFixed$1(t)&&(n=await Fixed2Other(n,o,this.getLayout))),n}}var editorService=new Editor$2;const COMMON_EVENT_PREFIX="magic:common:events:",COMMON_METHOD_PREFIX="magic:common:actions:",CommonMethod={SHOW:"show",HIDE:"hide",SCROLL_TO_VIEW:"scrollIntoView",SCROLL_TO_TOP:"scrollToTop"},DEFAULT_EVENTS=[{label:"\u70B9\u51FB",value:`${COMMON_EVENT_PREFIX}click`}],DEFAULT_METHODS=[{label:"\u663E\u793A",value:`${COMMON_METHOD_PREFIX}${CommonMethod.SHOW}`},{label:"\u9690\u85CF",value:`${COMMON_METHOD_PREFIX}${CommonMethod.HIDE}`},{label:"\u6EDA\u52A8\u5230\u8BE5\u7EC4\u4EF6",value:`${COMMON_METHOD_PREFIX}${CommonMethod.SCROLL_TO_VIEW}`},{label:"\u56DE\u5230\u9876\u90E8",value:`${COMMON_METHOD_PREFIX}${CommonMethod.SCROLL_TO_TOP}`}];var resetcss="";const eventMap=reactive({}),methodMap=reactive({});class Events extends BaseService{constructor(){super([])}init(t){t.forEach(o=>{o.items.forEach(n=>{const a=toLine(n.type);this.getEvent(a)||this.setEvent(a,DEFAULT_EVENTS),this.getMethod(a)||this.setMethod(a,DEFAULT_METHODS)})})}setEvents(t){Object.keys(t).forEach(o=>{this.setEvent(toLine(o),t[o]||[])})}setEvent(t,o){eventMap[t]=[...DEFAULT_EVENTS,...o]}getEvent(t){return cloneDeep(eventMap[t]||DEFAULT_EVENTS)}setMethods(t){Object.keys(t).forEach(o=>{this.setMethod(toLine(o),t[o]||[])})}setMethod(t,o){methodMap[t]=[...DEFAULT_METHODS,...o]}getMethod(t){return cloneDeep(methodMap[t]||DEFAULT_METHODS)}}var eventsService=new Events;const fillConfig=(e=[])=>[{type:"tab",items:[{title:"\u5C5E\u6027",labelWidth:"80px",items:[{text:"type",name:"type",type:"hidden"},{name:"id",type:"display",text:"id"},{name:"name",text:"\u7EC4\u4EF6\u540D\u79F0"},...e]},{title:"\u6837\u5F0F",labelWidth:"80px",items:[{name:"style",items:[{type:"fieldset",legend:"\u4F4D\u7F6E",items:[{name:"position",type:"checkbox",activeValue:"fixed",inactiveValue:"absolute",defaultValue:"absolute",text:"\u56FA\u5B9A\u5B9A\u4F4D"},{name:"left",text:"left"},{name:"top",text:"top",disabled:(t,{model:o})=>o.position==="fixed"&&o._magic_position==="fixedBottom"},{name:"right",text:"right"},{name:"bottom",text:"bottom",disabled:(t,{model:o})=>o.position==="fixed"&&o._magic_position==="fixedTop"}]},{type:"fieldset",legend:"\u76D2\u5B50",items:[{name:"width",text:"\u5BBD\u5EA6"},{name:"height",text:"\u9AD8\u5EA6"}]},{type:"fieldset",legend:"\u80CC\u666F",items:[{name:"backgroundImage",text:"\u80CC\u666F\u56FE"},{name:"backgroundColor",text:"\u80CC\u666F\u989C\u8272",type:"colorPicker"},{name:"backgroundRepeat",text:"\u80CC\u666F\u56FE\u91CD\u590D",type:"select",defaultValue:"no-repeat",options:[{text:"repeat",value:"repeat"},{text:"repeat-x",value:"repeat-x"},{text:"repeat-y",value:"repeat-y"},{text:"no-repeat",value:"no-repeat"},{text:"inherit",value:"inherit"}]},{name:"backgroundSize",text:"\u80CC\u666F\u56FE\u5927\u5C0F",defaultValue:"100% 100%"}]}]}]},{title:"\u4E8B\u4EF6",items:[{type:"table",name:"events",items:[{name:"name",label:"\u4E8B\u4EF6\u540D",type:"select",options:(t,{formValue:o})=>eventsService.getEvent(o.type).map(n=>({text:n.label,value:n.value}))},{name:"to",label:"\u8054\u52A8\u7EC4\u4EF6",type:"ui-select"},{name:"method",label:"\u52A8\u4F5C",type:"select",options:(t,{model:o})=>{const n=editorService.getNodeById(o.to);return n?eventsService.getMethod(n.type).map(a=>({text:a.label,value:a.value})):[]}}]}]},{title:"\u9AD8\u7EA7",labelWidth:"80px",items:[{type:"code-link",name:"created",text:"created",formTitle:"created"}]}]}],DEFAULT_CONFIG=fillConfig([]),getDefaultPropsValue=e=>({type:e,id:generateId(e),style:{},name:e}),_sfc_main$R=defineComponent({components:{Plus},setup(){const e=inject("services");return{clickHandler(){const{editorService:t}=e||{};!t||t.add({type:"page",name:generatePageNameByApp(toRaw(t.get("root")))})}}}}),_hoisted_1$w={class:"m-editor-empty-panel"},_hoisted_2$i={class:"m-editor-empty-content"},_hoisted_3$e=createBaseVNode("p",null,"\u65B0\u589E\u9875\u9762",-1);function _sfc_render$M(e,t,o,n,a,i){const l=resolveComponent("plus"),s=resolveComponent("el-icon");return openBlock(),createElementBlock("div",_hoisted_1$w,[createBaseVNode("div",_hoisted_2$i,[createBaseVNode("div",{class:"m-editor-empty-button",onClick:t[0]||(t[0]=(...r)=>e.clickHandler&&e.clickHandler(...r))},[createBaseVNode("div",null,[createVNode(s,null,{default:withCtx(()=>[createVNode(l)]),_:1})]),_hoisted_3$e])])])}var AddPageBox=_export_sfc(_sfc_main$R,[["render",_sfc_render$M]]);const _sfc_main$Q=defineComponent({name:"m-editor-resize",props:{type:{type:String}},setup(e){const t=inject("services"),o=ref();let n;return onMounted(()=>{!o.value||(n=new Gesto(o.value,{container:window,pinchOutside:!0}).on("drag",a=>{if(!o.value||!t)return;let{left:i,right:l}=$({},toRaw(t.uiService.get("columnWidth")));e.type==="left"?i+=a.deltaX:e.type==="right"&&(l-=a.deltaX),t.uiService.set("columnWidth",{left:i,right:l})}))}),onUnmounted(()=>{n==null||n.unset()}),{target:o}}}),_hoisted_1$v={ref:"target",class:"m-editor-resizer"};function _sfc_render$L(e,t,o,n,a,i){return openBlock(),createElementBlock("span",_hoisted_1$v,[renderSlot(e.$slots,"default")],512)}var Resizer=_export_sfc(_sfc_main$Q,[["render",_sfc_render$L]]);const _sfc_main$P=defineComponent({components:{AddPageBox,Resizer},setup(){const services=inject("services"),root=computed(()=>services==null?void 0:services.editorService.get("root"));return{root,pageLength:computed(()=>{var e,t;return((t=(e=root.value)==null?void 0:e.items)==null?void 0:t.length)||0}),showSrc:computed(()=>services==null?void 0:services.uiService.get("showSrc")),columnWidth:computed(()=>services==null?void 0:services.uiService.get("columnWidth")),saveCode(value){try{services==null||services.editorService.set("root",eval(value))}catch(e){console.error(e)}}}}}),_hoisted_1$u={class:"m-editor"},_hoisted_2$h={key:1,class:"m-editor-content"};function _sfc_render$K(e,t,o,n,a,i){var c,u,m;const l=resolveComponent("magic-code-editor"),s=resolveComponent("resizer"),r=resolveComponent("el-scrollbar"),d=resolveComponent("add-page-box");return openBlock(),createElementBlock("div",_hoisted_1$u,[renderSlot(e.$slots,"nav",{class:"m-editor-nav-menu"}),e.showSrc?(openBlock(),createBlock(l,{key:0,class:"m-editor-content","init-values":e.root,onSave:e.saveCode},null,8,["init-values","onSave"])):(openBlock(),createElementBlock("div",_hoisted_2$h,[createBaseVNode("div",{class:"m-editor-framework-left",style:normalizeStyle(`width: ${(c=e.columnWidth)==null?void 0:c.left}px`)},[renderSlot(e.$slots,"sidebar")],4),createVNode(s,{type:"left"}),e.pageLength>0?(openBlock(),createElementBlock(Fragment,{key:0},[createBaseVNode("div",{class:"m-editor-framework-center",style:normalizeStyle(`width: ${(u=e.columnWidth)==null?void 0:u.center}px`)},[renderSlot(e.$slots,"workspace")],4),createVNode(s,{type:"right"}),createBaseVNode("div",{class:"m-editor-framework-right",style:normalizeStyle(`width: ${(m=e.columnWidth)==null?void 0:m.right}px`)},[createVNode(r,null,{default:withCtx(()=>[renderSlot(e.$slots,"propsPanel")]),_:3})],4)],64)):renderSlot(e.$slots,"empty",{key:1},()=>[createVNode(d)])]))])}var Framework=_export_sfc(_sfc_main$P,[["render",_sfc_render$K]]);const _sfc_main$O=defineComponent({name:"m-icon",components:{Edit},props:{icon:{type:[String,Object]}},setup(){return{toRaw}}}),_hoisted_1$t=["src"];function _sfc_render$J(e,t,o,n,a,i){const l=resolveComponent("edit"),s=resolveComponent("el-icon");return e.icon?typeof e.icon=="string"&&e.icon.startsWith("http")?(openBlock(),createElementBlock("img",{key:1,src:e.icon},null,8,_hoisted_1$t)):typeof e.icon=="string"?(openBlock(),createElementBlock("i",{key:2,class:normalizeClass(e.icon)},null,2)):(openBlock(),createBlock(s,{key:3},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(e.toRaw(e.icon))))]),_:1})):(openBlock(),createBlock(s,{key:0},{default:withCtx(()=>[createVNode(l)]),_:1}))}var MIcon=_export_sfc(_sfc_main$O,[["render",_sfc_render$J]]);const _sfc_main$N=defineComponent({components:{MIcon,ArrowDown},props:{data:{type:[Object,String],require:!0,default:()=>({type:"text",display:!1})}},setup(e){const t=inject("services"),o=t==null?void 0:t.uiService,n=()=>o==null?void 0:o.set("zoom",i.value+.1),a=()=>o==null?void 0:o.set("zoom",i.value-.1),i=computed(()=>{var c;return(c=o==null?void 0:o.get("zoom"))!=null?c:1}),l=computed(()=>{var c;return(c=o==null?void 0:o.get("showGuides"))!=null?c:!0}),s=computed(()=>{var c;return(c=o==null?void 0:o.get("showRule"))!=null?c:!0}),r=computed(()=>{if(typeof e.data!="string")return e.data;switch(e.data){case"/":return{type:"divider"};case"zoom":return{type:"zoom"};case"delete":return{type:"button",icon:Delete,tooltip:"\u522A\u9664",disabled:()=>{var c;return((c=t==null?void 0:t.editorService.get("node"))==null?void 0:c.type)==="page"},handler:()=>t==null?void 0:t.editorService.remove(t==null?void 0:t.editorService.get("node"))};case"undo":return{type:"button",icon:Back,tooltip:"\u540E\u9000",disabled:()=>!(t==null?void 0:t.historyService.state.canUndo),handler:()=>t==null?void 0:t.editorService.undo()};case"redo":return{type:"button",icon:Right,tooltip:"\u524D\u8FDB",disabled:()=>!(t==null?void 0:t.historyService.state.canRedo),handler:()=>t==null?void 0:t.editorService.redo()};case"zoom-in":return{type:"button",icon:ZoomIn,tooltip:"\u653E\u5927",handler:n};case"zoom-out":return{type:"button",icon:ZoomOut,tooltip:"\u7E2E\u5C0F",handler:a};case"rule":return{type:"button",icon:ScaleToOriginal,tooltip:s.value?"\u9690\u85CF\u6807\u5C3A":"\u663E\u793A\u6807\u5C3A",handler:()=>o==null?void 0:o.set("showRule",!s.value)};case"guides":return{type:"button",icon:Grid,tooltip:l.value?"\u9690\u85CF\u53C2\u8003\u7EBF":"\u663E\u793A\u53C2\u8003\u7EBF",handler:()=>o==null?void 0:o.set("showGuides",!l.value)};default:return{type:"text",text:e.data}}}),d=computed(()=>typeof r.value=="string"||r.value.type==="component"?!1:typeof r.value.disabled=="function"?r.value.disabled(t):r.value.disabled);return{ZoomIn,ZoomOut,item:r,zoom:i,disabled:d,display:computed(()=>{var c;return r.value?typeof r.value=="string"?!0:typeof r.value.display=="function"?r.value.display(t):(c=r.value.display)!=null?c:!0:!1}),zoomInHandler:n,zoomOutHandler:a,dropdownHandler(c){c.item.handler&&c.item.handler(t)},buttonHandler(c){var u;d.value||typeof c.handler=="function"&&((u=c.handler)==null||u.call(c,t))}}}}),_hoisted_1$s={key:0,class:"menu-item"},_hoisted_2$g={key:1,class:"menu-item-text"},_hoisted_3$d={class:"menu-item-text",style:{margin:"0 5px"}},_hoisted_4$b={class:"el-dropdown-link menubar-menu-button"};function _sfc_render$I(e,t,o,n,a,i){const l=resolveComponent("el-divider"),s=resolveComponent("m-icon"),r=resolveComponent("el-button"),d=resolveComponent("el-tooltip"),c=resolveComponent("arrow-down"),u=resolveComponent("el-icon"),m=resolveComponent("el-dropdown-item"),f=resolveComponent("el-dropdown-menu"),g=resolveComponent("el-dropdown");return e.display?(openBlock(),createElementBlock("div",_hoisted_1$s,[e.item.type==="divider"?(openBlock(),createBlock(l,{key:0,direction:"vertical"})):e.item.type==="text"?(openBlock(),createElementBlock("div",_hoisted_2$g,toDisplayString(e.item.text),1)):e.item.type==="zoom"?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(s,{icon:e.ZoomIn,onClick:e.zoomInHandler},null,8,["icon","onClick"]),createBaseVNode("span",_hoisted_3$d,toDisplayString(parseInt(`${e.zoom*100}`,10))+"%",1),createVNode(s,{icon:e.ZoomOut,onClick:e.zoomOutHandler},null,8,["icon","onClick"])],64)):e.item.type==="button"?(openBlock(),createBlock(d,{key:3,effect:"dark",placement:"bottom-start",content:e.item.tooltip||e.item.text},{default:withCtx(()=>[createVNode(r,{size:"small",type:"text",disabled:e.disabled,onClick:t[0]||(t[0]=B=>e.buttonHandler(e.item))},{default:withCtx(()=>[createVNode(s,{icon:e.item.icon},null,8,["icon"]),createBaseVNode("span",null,toDisplayString(e.item.text),1)]),_:1},8,["disabled"])]),_:1},8,["content"])):e.item.type==="dropdown"?(openBlock(),createBlock(g,{key:4,trigger:"click",disabled:e.disabled,onCommand:e.dropdownHandler},{dropdown:withCtx(()=>[e.item.items&&e.item.items.length?(openBlock(),createBlock(f,{key:0},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.item.items,(B,S)=>(openBlock(),createBlock(m,{key:S,command:{item:e.item,subItem:B}},{default:withCtx(()=>[createTextVNode(toDisplayString(B.text),1)]),_:2},1032,["command"]))),128))]),_:1})):createCommentVNode("",!0)]),default:withCtx(()=>[createBaseVNode("span",_hoisted_4$b,[createTextVNode(toDisplayString(e.item.text),1),createVNode(u,{class:"el-icon--right"},{default:withCtx(()=>[createVNode(c)]),_:1})])]),_:1},8,["disabled","onCommand"])):e.item.type==="component"?(openBlock(),createBlock(resolveDynamicComponent(e.item.component),normalizeProps(mergeProps({key:5},e.item.props||{})),null,16)):createCommentVNode("",!0)])):createCommentVNode("",!0)}var ToolButton=_export_sfc(_sfc_main$N,[["render",_sfc_render$I]]);const _sfc_main$M=defineComponent({name:"nav-menu",components:{ToolButton},props:{data:{type:Object,default:()=>({})},height:{type:Number}},setup(e){return{keys:computed(()=>Object.keys(e.data))}}});function _sfc_render$H(e,t,o,n,a,i){const l=resolveComponent("tool-button");return openBlock(),createElementBlock("div",{class:"m-editor-nav-menu",style:normalizeStyle({height:`${e.height}px`})},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.keys,s=>(openBlock(),createElementBlock("div",{class:normalizeClass(`menu-${s}`),key:s},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.data[s],(r,d)=>(openBlock(),createBlock(l,{data:r,key:d},null,8,["data"]))),128))],2))),128))],4)}var NavMenu=_export_sfc(_sfc_main$M,[["render",_sfc_render$H]]);const _sfc_main$L=defineComponent({name:"m-editor-props-panel",emits:["mounted"],setup(e,{emit:t}){const o=getCurrentInstance(),n=ref({}),a=ref(),i=ref([]),l=inject("services"),s=async()=>{const r=l==null?void 0:l.editorService.get("node");if(!r){i.value=[];return}r.devconfig&&r.style&&!isNaN(+r.style.height)&&!isNaN(+r.style.width)&&(r.devconfig.ratio=r.style.height/r.style.width||1),n.value=r;const d=r.type||(r.items?"container":"text");i.value=await(l==null?void 0:l.propsService.getPropsConfig(d))||[]};return watchEffect(s),l==null||l.propsService.on("props-configs-change",s),onMounted(()=>{t("mounted",o)}),{values:n,configForm:a,curFormConfig:i,async submit(){var r;try{const d=await((r=a.value)==null?void 0:r.submitForm());l==null||l.editorService.update(d)}catch(d){console.error(d),ElMessage.closeAll(),ElMessage.error({duration:1e4,showClose:!0,message:d.message,dangerouslyUseHTMLString:!0})}}}}});function _sfc_render$G(e,t,o,n,a,i){const l=resolveComponent("m-form");return openBlock(),createBlock(l,{class:"m-editor-props-panel",ref:"configForm",size:"small","init-values":e.values,config:e.curFormConfig,onChange:e.submit},null,8,["init-values","config","onChange"])}var PropsPanel=_export_sfc(_sfc_main$L,[["render",_sfc_render$G]]);const _sfc_main$K=defineComponent({name:"ui-component-panel",components:{MIcon},setup(){const e=ref(""),t=inject("services"),o=computed(()=>t==null?void 0:t.componentListService.getList().map(a=>V($({},a),{items:a.items.filter(i=>i.text.includes(e.value))}))),n=computed(()=>{var a;return Array((a=o.value)==null?void 0:a.length).fill(1).map((i,l)=>l)});return{searchText:e,collapseValue:n,list:o,appendComponent(s){var r=s,{text:a,type:i}=r,l=z(r,["text","type"]);t==null||t.editorService.add($({name:a,type:i},l))}}}}),_hoisted_1$r=createBaseVNode("i",{class:"el-icon-s-grid"},null,-1),_hoisted_2$f=["onClick"];function _sfc_render$F(e,t,o,n,a,i){const l=resolveComponent("el-input"),s=resolveComponent("m-icon"),r=resolveComponent("el-tooltip"),d=resolveComponent("el-collapse-item"),c=resolveComponent("el-collapse"),u=resolveComponent("el-scrollbar");return openBlock(),createBlock(u,null,{default:withCtx(()=>[createVNode(c,{class:"ui-component-panel","model-value":e.collapseValue},{default:withCtx(()=>[createVNode(l,{"prefix-icon":"el-icon-search",placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4",class:"search-input",size:"small",clearable:"",modelValue:e.searchText,"onUpdate:modelValue":t[0]||(t[0]=m=>e.searchText=m)},null,8,["modelValue"]),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.list,(m,f)=>(openBlock(),createElementBlock(Fragment,null,[m.items&&m.items.length?(openBlock(),createBlock(d,{key:f,name:f},{title:withCtx(()=>[_hoisted_1$r,createTextVNode(toDisplayString(m.title),1)]),default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(m.items,g=>(openBlock(),createElementBlock("div",{class:"component-item",key:g.type,onClick:B=>e.appendComponent(g)},[createVNode(s,{icon:g.icon},null,8,["icon"]),createVNode(r,{effect:"dark",placement:"bottom",content:g.text},{default:withCtx(()=>[createBaseVNode("span",null,toDisplayString(g.text),1)]),_:2},1032,["content"])],8,_hoisted_2$f))),128))]),_:2},1032,["name"])):createCommentVNode("",!0)],64))),256))]),_:1},8,["model-value"])]),_:1})}var ComponentListPanel=_export_sfc(_sfc_main$K,[["render",_sfc_render$F]]);const _sfc_main$J=defineComponent({name:"magic-editor-content-menu",props:{componentGroupList:{type:Array,default:()=>[]}},setup(e){const t=inject("services"),o=ref(!1),n=computed(()=>t==null?void 0:t.editorService.get("node"));return{subVisible:o,node:n,menu:computed(()=>({app:[{type:"page",text:"\u9875\u9762"}],component:e.componentGroupList})),append(a){t==null||t.editorService.add({name:a.text,type:a.type})},remove(){n.value&&(t==null||t.editorService.remove(n.value))},copy(a){t==null||t.editorService.copy(a)},setSubVisiable(a){o.value=a}}}}),_hoisted_1$q={key:0,class:"magic-editor-content-menu"},_hoisted_2$e=["onClick"],_hoisted_3$c=["onClick"],_hoisted_4$a=createBaseVNode("div",{class:"separation"},null,-1);function _sfc_render$E(e,t,o,n,a,i){const l=resolveComponent("el-scrollbar");return e.node?(openBlock(),createElementBlock("div",_hoisted_1$q,[e.node.items?(openBlock(),createElementBlock("div",{key:0,class:"magic-editor-content-menu-item",onMouseenter:t[0]||(t[0]=s=>e.setSubVisiable(!0)),onMouseleave:t[1]||(t[1]=s=>e.setSubVisiable(!1))}," \u65B0\u589E ",32)):createCommentVNode("",!0),e.node.type!=="app"?(openBlock(),createElementBlock("div",{key:1,class:"magic-editor-content-menu-item",onClick:t[2]||(t[2]=()=>e.copy(e.node))},"\u590D\u5236")):createCommentVNode("",!0),e.node.type!=="app"&&e.node.type!=="page"?(openBlock(),createElementBlock("div",{key:2,class:"magic-editor-content-menu-item",onClick:t[3]||(t[3]=()=>e.remove())}," \u5220\u9664 ")):createCommentVNode("",!0),withDirectives(createBaseVNode("div",{class:"subMenu",onMouseenter:t[5]||(t[5]=s=>e.setSubVisiable(!0)),onMouseleave:t[6]||(t[6]=s=>e.setSubVisiable(!1))},[createVNode(l,null,{default:withCtx(()=>[e.node.type==="tabs"?(openBlock(),createElementBlock("div",{key:0,class:"magic-editor-content-menu-item",onClick:t[4]||(t[4]=()=>e.append({type:"tab-pane"}))}," \u6807\u7B7E ")):e.node.type==="app"?(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(e.menu.app,s=>(openBlock(),createElementBlock("div",{class:"magic-editor-content-menu-item",key:s.type,onClick:()=>e.append(s)},toDisplayString(s.text),9,_hoisted_2$e))),128)):e.node.items?(openBlock(!0),createElementBlock(Fragment,{key:2},renderList(e.menu.component,s=>(openBlock(),createElementBlock("div",{key:s.title},[(openBlock(!0),createElementBlock(Fragment,null,renderList(s.items,r=>(openBlock(),createElementBlock(Fragment,null,[r?(openBlock(),createElementBlock("div",{class:"magic-editor-content-menu-item",key:r.type,onClick:()=>e.append(r)},toDisplayString(r.text),9,_hoisted_3$c)):createCommentVNode("",!0)],64))),256)),_hoisted_4$a]))),128)):createCommentVNode("",!0)]),_:1})],544),[[vShow,e.subVisible]])])):createCommentVNode("",!0)}var LayerMenu=_export_sfc(_sfc_main$J,[["render",_sfc_render$E]]);const select=(e,t)=>{if(!e.id)throw new Error("\u6CA1\u6709id");t==null||t.select(e)},useDrop=(e,t)=>({allowDrop:(o,n,a)=>{const{data:i}=n||{},{data:l}=o,{type:s}=l;return s!=="page"&&i.type==="page"||s==="page"&&i.type!=="page"||!i||!i.type?!1:!!(["prev","next"].includes(a)||i.items||i.type==="container")},handleDragEnd(){if(!e.value)return;const{data:o}=e.value,[n]=o;t==null||t.update(n)}}),useStatus=(e,t)=>{const o=computed(()=>t==null?void 0:t.get("page"));return watchEffect(()=>{if(!e.value)return;const n=t==null?void 0:t.get("node");n&&e.value.setCurrentKey(n.id,!0);const a=t==null?void 0:t.get("parent");if(!(a==null?void 0:a.id))return;const i=e.value.getNode(a.id);i==null||i.updateChildren()}),{values:computed(()=>o.value?[o.value]:[]),loadItems:(n,a)=>{var i,l;if(Array.isArray(n.data))return a(n.data);if(Array.isArray((i=n.data)==null?void 0:i.items))return a((l=n.data)==null?void 0:l.items);a([])}}},useFilter=e=>({filterText:ref(""),filterNode:(t,o)=>{if(!t)return!0;let n="";return o.name?n=o.name:o.type?n=o.type:o.items&&(n="container"),n.indexOf(t)!==-1},filterTextChangeHandler(t){var o;(o=e.value)==null||o.filter(t)}}),useContentMenu=e=>{const t=ref({position:"absolute",left:"0",top:"0",display:"none"});return onMounted(()=>{document.addEventListener("click",()=>{t.value.display="none"},!0)}),{menuStyle:t,contextmenu(o,n){const a=globalThis.document.body.clientHeight,i=`${o.clientX+20}px`;let l=`${o.clientY-10}px`;o.clientY+300>a&&(l=`${a-300}px`),t.value.left=i,t.value.top=l,t.value.display="",select(n,e)}}},_sfc_main$I=defineComponent({name:"magic-editor-layer-panel",components:{LayerMenu},setup(){const e=inject("services"),t=ref(),o=e==null?void 0:e.editorService;return V($($($($({tree:t},useDrop(t,o)),useStatus(t,o)),useFilter(t)),useContentMenu(o)),{clickHandler(n){if(e==null?void 0:e.uiService.get("uiSelectMode")){document.dispatchEvent(new CustomEvent("ui-select",{detail:n}));return}select(n,o)}})}});function _sfc_render$D(e,t,o,n,a,i){const l=resolveComponent("el-input"),s=resolveComponent("el-tree"),r=resolveComponent("layer-menu"),d=resolveComponent("el-scrollbar");return openBlock(),createBlock(d,{class:"magic-editor-layer-panel"},{default:withCtx(()=>[createVNode(l,{class:"filterInput",size:"small",placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4",clearable:"",modelValue:e.filterText,"onUpdate:modelValue":t[0]||(t[0]=c=>e.filterText=c),onChange:e.filterTextChangeHandler},null,8,["modelValue","onChange"]),e.values.length?(openBlock(),createBlock(s,{key:0,ref:"tree","node-key":"id",draggable:"",load:e.loadItems,data:e.values,"expand-on-click-node":!1,"highlight-current":!0,props:{children:"items"},"filter-node-method":e.filterNode,"allow-drop":e.allowDrop,onNodeClick:e.clickHandler,onNodeContextmenu:e.contextmenu,onNodeDragEnd:e.handleDragEnd,"empty-text":"\u9875\u9762\u7A7A\u8361\u8361\u7684"},{default:withCtx(({node:c,data:u})=>[renderSlot(e.$slots,"layer-node-content",{node:c,data:u},()=>[createBaseVNode("span",null,toDisplayString(`${u.name} (${u.id})`),1)])]),_:3},8,["load","data","filter-node-method","allow-drop","onNodeClick","onNodeContextmenu","onNodeDragEnd"])):createCommentVNode("",!0),(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(r,{style:normalizeStyle(e.menuStyle)},null,8,["style"])]))]),_:3})}var LayerPanel=_export_sfc(_sfc_main$I,[["render",_sfc_render$D]]);const _sfc_main$H=defineComponent({name:"m-sidebar",components:{MIcon},props:{data:{type:Object,default:()=>({type:"tabs",status:"\u7EC4\u4EF6",items:["component-list","layer"]})}},setup(e){var o;const t=ref((o=e.data)==null?void 0:o.status);return watch(()=>{var n;return(n=e.data)==null?void 0:n.status},n=>{t.value=n||"0"}),{activeTabName:t,items:computed(()=>{var n;return(n=e.data)==null?void 0:n.items.map(a=>{if(typeof a!="string")return a;switch(a){case"component-list":return{type:"component",icon:Coin,text:"\u7EC4\u4EF6",component:ComponentListPanel,slots:{}};case"layer":return{type:"component",icon:Files,text:"\u5DF2\u9009\u7EC4\u4EF6",component:LayerPanel,slots:{}};default:return{}}})})}}}),_hoisted_1$p={key:1,class:"magic-editor-tab-panel-title"};function _sfc_render$C(e,t,o,n,a,i){const l=resolveComponent("m-icon"),s=resolveComponent("el-tab-pane"),r=resolveComponent("el-tabs");return e.data.type==="tabs"?(openBlock(),createBlock(r,{key:0,class:"m-editor-sidebar",modelValue:e.activeTabName,"onUpdate:modelValue":t[0]||(t[0]=d=>e.activeTabName=d),type:"card","tab-position":"left"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.items,d=>(openBlock(),createBlock(s,{key:d.text,name:d.text},{label:withCtx(()=>[createBaseVNode("span",null,[d.icon?(openBlock(),createBlock(l,{key:0,icon:d.icon},null,8,["icon"])):createCommentVNode("",!0),d.text?(openBlock(),createElementBlock("div",_hoisted_1$p,toDisplayString(d.text),1)):createCommentVNode("",!0)])]),default:withCtx(()=>{var c;return[(openBlock(),createBlock(resolveDynamicComponent(d.component),mergeProps(d.props||{},toHandlers(d.listeners||{})),createSlots({_:2},[((c=d.slots)==null?void 0:c.layerNodeContent)?{name:"layer-node-content",fn:withCtx(({data:u,node:m})=>[(openBlock(),createBlock(resolveDynamicComponent(d.slots.layerNodeContent),{data:u,node:m},null,8,["data","node"]))])}:void 0]),1040))]}),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])):createCommentVNode("",!0)}var Sidebar=_export_sfc(_sfc_main$H,[["render",_sfc_render$C]]);const _sfc_main$G=defineComponent({components:{CaretBottom,Plus},setup(){const e=inject("services"),t=e==null?void 0:e.editorService;return{root:computed(()=>t==null?void 0:t.get("root")),page:computed(()=>t==null?void 0:t.get("page")),switchPage(o){t==null||t.select(o)},addPage(){if(!t)return;const o={type:"page",name:generatePageNameByApp(toRaw(t.get("root")))};t.add(o)},copy(o){o&&(t==null||t.copy(o)),t==null||t.paste({left:0,top:0})},remove(o){t==null||t.remove(o)}}}}),_hoisted_1$o={class:"m-editor-page-bar"},_hoisted_2$d=["onClick"],_hoisted_3$b=["onClick"],_hoisted_4$9=["onClick"];function _sfc_render$B(e,t,o,n,a,i){const l=resolveComponent("plus"),s=resolveComponent("el-icon"),r=resolveComponent("caret-bottom"),d=resolveComponent("el-popover");return openBlock(),createElementBlock("div",_hoisted_1$o,[createBaseVNode("div",{class:"m-editor-page-bar-item",onClick:t[0]||(t[0]=(...c)=>e.addPage&&e.addPage(...c))},[createVNode(s,{class:"m-editor-page-bar-menu-add-icon"},{default:withCtx(()=>[createVNode(l)]),_:1})]),e.root?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.root.items,c=>{var u;return openBlock(),createElementBlock("div",{key:c.key,class:normalizeClass(["m-editor-page-bar-item",{active:((u=e.page)==null?void 0:u.id)===c.id}]),onClick:m=>e.switchPage(c)},[renderSlot(e.$slots,"page-bar-title",{page:c},()=>[createBaseVNode("span",null,toDisplayString(c.name),1)]),createVNode(d,{placement:"top",width:160,trigger:"hover"},{reference:withCtx(()=>[createVNode(s,{class:"m-editor-page-bar-menu-icon"},{default:withCtx(()=>[createVNode(r)]),_:1})]),default:withCtx(()=>[createBaseVNode("div",null,[renderSlot(e.$slots,"page-bar-popover",{page:c},()=>[createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:()=>e.copy(c)},"\u590D\u5236",8,_hoisted_3$b),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:()=>e.remove(c)},"\u5220\u9664",8,_hoisted_4$9)])])]),_:2},1024)],10,_hoisted_2$d)}),128)):createCommentVNode("",!0)])}var PageBar=_export_sfc(_sfc_main$G,[["render",_sfc_render$B]]);const GHOST_EL_ID_PREFIX="ghost_el_",DEFAULT_ZOOM=1;var Mode=(e=>(e.ABSOLUTE="absolute",e.FIXED="fixed",e.SORTABLE="sortable",e))(Mode||{});const getOffset=e=>{const{transform:t}=getComputedStyle(e),{offsetParent:o}=e;let n=e.offsetLeft,a=e.offsetTop;if(t.indexOf("matrix")>-1){let i=1,l=1,s=1,r=1,d=0,c=0;t.replace(/matrix\((.+), (.+), (.+), (.+), (.+), (.+)\)/,(u,m,f,g,B,S,h)=>(i=+m,l=+f,s=+g,r=+B,d=+S,c=+h,t)),n=i*n+s*a+d,a=l*n+r*a+c}if(o){const i=getOffset(o);return{left:n+i.left,top:a+i.top}}return{left:n,top:a}},getAbsolutePosition=(e,{top:t,left:o})=>{const{offsetParent:n}=e;if(n){const a=getOffset(n);return{left:o-a.left,top:t-a.top}}return{left:o,top:t}},getHost=e=>{var t;return(t=e.match(/\/\/([^/]+)/))==null?void 0:t[1]},isSameDomain=(e="",t=globalThis.location.host)=>/^(http[s]?:)?\/\//.test(e)?getHost(e)===t:!0,isRelative=e=>e?getComputedStyle(e).position==="relative":!1,isStatic=e=>e?getComputedStyle(e).position==="static":!1,isFixed=e=>e?getComputedStyle(e).position==="fixed":!1,getMode=e=>isFixed(e)?"fixed":isStatic(e)||isRelative(e)?"sortable":"absolute";class StageDragResize extends events.exports.EventEmitter{constructor(t){super();_(this,"core");_(this,"container");_(this,"target");_(this,"moveable");_(this,"dragStatus","end");_(this,"elObserver");_(this,"ghostEl");_(this,"horizontalGuidelines",[]);_(this,"verticalGuidelines",[]);_(this,"mode",Mode.ABSOLUTE);this.core=t.core,this.container=t.container,this.initObserver()}async select(t){var n;if(this.target===t){this.refresh();return}(n=this.moveable)==null||n.destroy(),this.target=t,this.mode=getMode(t);const o=await this.getOptions();this.moveable=new Moveable(this.container,o),this.bindResizeEvent(),this.bindDragEvent(),this.syncRect(t)}async refresh(){const t=await this.getOptions();Object.entries(t).forEach(([o,n])=>{this.moveable[o]=n}),this.updateMoveableTarget()}async setVGuidelines(t){this.verticalGuidelines=t,this.target&&await this.select(this.target)}async setHGuidelines(t){this.horizontalGuidelines=t,this.target&&await this.select(this.target)}updateMoveableTarget(t){if(!this.moveable)throw new Error("\u4E3A\u521D\u59CB\u5316\u76EE\u6807");t&&(this.moveable.target=t),this.target&&(this.mode=getMode(this.target)),this.moveable.updateTarget()}destroy(){var t,o;this.destroyGhostEl(),(t=this.moveable)==null||t.destroy(),this.dragStatus="end",(o=this.elObserver)==null||o.disconnect(),this.removeAllListeners()}bindResizeEvent(){if(!this.moveable)throw new Error("moveable \u4E3A\u521D\u59CB\u5316");this.moveable.on("resizeStart",t=>{if(t.dragStart){const o=this.moveable.getRect(),n=getAbsolutePosition(t.target,o);t.dragStart.set([n.left,n.top]),this.ghostEl&&(this.destroyGhostEl(),this.updateMoveableTarget(this.target))}}).on("resize",({target:t,width:o,height:n,drag:a})=>{if(!this.moveable||!this.target)return;const{beforeTranslate:i}=a;this.dragStatus="ing",t.style.width=`${o}px`,t.style.height=`${n}px`,[Mode.ABSOLUTE,Mode.FIXED].includes(this.mode)&&(t.style.left=`${i[0]}px`,t.style.top=`${i[1]}px`)}).on("resizeEnd",({target:t})=>{var a;this.dragStatus="end";const o=this.moveable.getRect(),n=getAbsolutePosition(t,o);this.updateMoveableTarget(this.target),this.emit("update",{el:this.target,style:$({width:this.calcValueByFontsize(o.width),height:this.calcValueByFontsize(o.height),position:(a=this.target)==null?void 0:a.style.position},this.mode===Mode.SORTABLE?{}:{left:this.calcValueByFontsize(n.left),top:this.calcValueByFontsize(n.top)})})})}bindDragEvent(){if(!this.moveable)throw new Error("moveable \u4E3A\u521D\u59CB\u5316");this.moveable.on("dragStart",()=>{if(!this.target)throw new Error("\u672A\u9009\u4E2D\u7EC4\u4EF6");this.dragStatus="start",this.mode===Mode.SORTABLE&&(this.ghostEl=this.generateGhostEl(this.target),this.updateMoveableTarget(this.ghostEl))}).on("drag",({target:t,left:o,top:n})=>{if(this.dragStatus="ing",!(this.mode===Mode.SORTABLE&&(!this.ghostEl||t!==this.ghostEl))){if([Mode.ABSOLUTE,Mode.FIXED].includes(this.mode))t.style.left=`${o}px`,t.style.top=`${n}px`;else if(this.target){const a=getAbsolutePosition(this.target,getOffset(this.target));t.style.top=`${a.top+n}px`}}}).on("dragEnd",()=>{if(this.dragStatus==="ing"&&!!this.target){switch(this.dragStatus="end",this.updateMoveableTarget(this.target),this.mode){case Mode.SORTABLE:this.sort();break;default:this.drag()}this.destroyGhostEl()}})}async getSnapElements(t){var a;const{renderer:o}=this.core;return(((a=await o.getRuntime())==null?void 0:a.getSnapElements)||(()=>{var s;const i=(s=o.contentWindow)==null?void 0:s.document;return(i?Array.from(i.querySelectorAll("[id]")):[]).filter(r=>{var d;return r!==this.target&&!((d=this.target)==null?void 0:d.contains(r))})}))(t)}sort(){if(!this.target||!this.ghostEl)throw new Error("\u672A\u77E5\u9519\u8BEF");const{top:t}=this.ghostEl.getBoundingClientRect(),{top:o}=this.target.getBoundingClientRect(),n=t-o;Math.abs(n)>=this.target.clientHeight/2?n>0?this.emit("sort",down(n,this.target)):this.emit("sort",up(n,this.target)):this.emit("sort",{src:this.target.id,dist:this.target.id})}drag(){const t=this.moveable.getRect(),o=getAbsolutePosition(this.target,t);this.emit("update",{el:this.target,style:{left:this.calcValueByFontsize(this.mode===Mode.FIXED?t.left:o.left),top:this.calcValueByFontsize(this.mode===Mode.FIXED?t.top:o.top),width:this.calcValueByFontsize(t.width),height:this.calcValueByFontsize(t.height)}})}generateGhostEl(t){this.ghostEl&&this.destroyGhostEl();const o=t.cloneNode(!0),{top:n,left:a}=getAbsolutePosition(t,getOffset(t));return o.id=`${GHOST_EL_ID_PREFIX}${o.id}`,o.style.zIndex="5",o.style.opacity=".5",o.style.position="absolute",o.style.left=`${a}px`,o.style.top=`${n}px`,t.after(o),o}destroyGhostEl(){var t;(t=this.ghostEl)==null||t.remove(),this.ghostEl=void 0}async getOptions(t={}){var d,c;if(!this.target)return{};const o=this.mode===Mode.SORTABLE,{config:n,renderer:a,mask:i}=this.core,{iframe:l}=a;let{moveableOptions:s={}}=n;typeof s=="function"&&(s=s(this.core));const r=$({top:0,left:0,right:l==null?void 0:l.clientWidth,bottom:this.mode===Mode.FIXED?l==null?void 0:l.clientHeight:(d=i.page)==null?void 0:d.clientHeight},s.bounds||{});return $($({target:this.target,scrollable:!0,origin:!0,zoom:1,dragArea:!0,draggable:!0,resizable:!0,snappable:!o,snapGap:!o,snapElement:!o,snapVertical:!o,snapHorizontal:!o,snapCenter:!o,container:(c=a.contentWindow)==null?void 0:c.document.body,elementGuidelines:o?[]:await this.getSnapElements(this.target),horizontalGuidelines:this.horizontalGuidelines,verticalGuidelines:this.verticalGuidelines,bounds:r},t),s)}initObserver(){typeof ResizeObserver!="undefined"&&(this.elObserver=new ResizeObserver(()=>{var n;const t=(n=this.core.renderer.contentWindow)==null?void 0:n.document;if(!t||!this.target||!this.moveable)return;const o=t.getElementById(this.target.id);this.ghostEl&&this.destroyGhostEl(),o&&o!==this.target&&(this.syncRect(o),this.target=o),this.updateMoveableTarget(this.target)}))}syncRect(t){var o,n;(o=this.elObserver)==null||o.disconnect(),(n=this.elObserver)==null||n.observe(t)}calcValueByFontsize(t){const{contentWindow:o}=this.core.renderer,n=o==null?void 0:o.document.documentElement.style.fontSize;if(n){const a=globalThis.parseFloat(n)/100;return t/a}return t}}const down=(e,t)=>{var s,r;let o=0,n=t.clientHeight;const a=Array.from(((s=t.parentNode)==null?void 0:s.children)||[]).filter(d=>!d.id.startsWith(GHOST_EL_ID_PREFIX)),i=a.indexOf(t),l=a.slice(i+1);for(let d=0;d<l.length;d++){const c=l[d];if(((r=c.style)==null?void 0:r.position)!=="fixed"){if(n+=c.clientHeight/2,e<=n)break;n+=c.clientHeight/2,o=d}}return{src:t.id,dist:l.length&&o>-1?l[o].id:t.id}},up=(e,t)=>{var s;const o=Array.from(((s=t.parentNode)==null?void 0:s.children)||[]).filter(r=>!r.id.startsWith(GHOST_EL_ID_PREFIX)),n=o.indexOf(t),a=o.slice(0,n);let i=t.clientHeight,l=a.length-1;for(let r=a.length-1;r>=0;r--){const d=a[r];if(!!d&&d.style.position!=="fixed"){if(i+=d.clientHeight/2,-e<=i)break;i+=d.clientHeight/2,l=r}}return{src:t.id,dist:a.length&&l>-1?a[l].id:t.id}};var ZIndex=(e=>(e.MASK="99999",e.GHOST_EL="99998",e))(ZIndex||{}),MouseButton=(e=>(e[e.LEFT=0]="LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.RIGHT=2]="RIGHT",e))(MouseButton||{});const wrapperClassName="editor-mask-wrapper",hideScrollbar=()=>{const e=globalThis.document.createElement("style");e.innerHTML=`
    .${wrapperClassName}::-webkit-scrollbar { width: 0 !important; display: none }
  `,globalThis.document.head.appendChild(e)},createContent=()=>{const e=globalThis.document.createElement("div");return e.className="editor-mask",e.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    transform: translate3d(0, 0, 0);
  `,e},createWrapper=()=>{const e=globalThis.document.createElement("div");return e.className=wrapperClassName,e.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
    overflow: auto;
    z-index: ${ZIndex.MASK};
  `,hideScrollbar(),e};class StageMask extends events.exports.EventEmitter{constructor(t){super();_(this,"content",createContent());_(this,"wrapper",createWrapper());_(this,"core");_(this,"page",null);_(this,"hGuides");_(this,"vGuides");_(this,"target",null);_(this,"resizeObserver",null);_(this,"parentResizeObserver",null);_(this,"canSelect");_(this,"mouseDownHandler",async t=>{t.button===MouseButton.LEFT&&t.target.className.indexOf("moveable-control")===-1&&this.select(t)});_(this,"mouseUpHandler",()=>{var t;(t=this.content)==null||t.removeEventListener("mouseup",this.mouseUpHandler,!0),this.emit("selected",this.target),this.target=null});_(this,"contextmenuHandler",async t=>{await this.select(t),this.mouseUpHandler()});_(this,"getGuidesStyle",t=>({position:"fixed",left:t==="horizontal"?0:"-30px",top:t==="horizontal"?"-30px":0,width:t==="horizontal"?"100%":"30px",height:t==="horizontal"?"30px":"100%"}));_(this,"createGuides",t=>new Guides(this.wrapper,{type:t,displayDragPos:!0,backgroundColor:"#fff",lineColor:"#000",textColor:"#000",style:this.getGuidesStyle(t)}));this.core=t.core;const{config:o}=t.core;this.canSelect=o.canSelect||(n=>!!n.id),this.content.addEventListener("mousedown",this.mouseDownHandler,!0),this.content.addEventListener("contextmenu",this.contextmenuHandler,!0),this.wrapper.appendChild(this.content),this.hGuides=this.createGuides("horizontal"),this.vGuides=this.createGuides("vertical")}setFixed(){this.wrapper.scrollTo({top:0}),this.wrapper.style.overflow="hidden",setTimeout(()=>{this.core.dr.refresh()})}setAbsolute(){this.wrapper.style.overflow="auto"}observe(t){var o;!t||(this.page=t,(o=this.resizeObserver)==null||o.disconnect(),typeof ResizeObserver!="undefined"&&(this.resizeObserver=new ResizeObserver(n=>{const[a]=n,{clientHeight:i,clientWidth:l}=a.target;this.setHeight(i),this.setWidth(l)}),this.resizeObserver.observe(t)))}mount(t){if(!this.content)throw new Error("content \u4E0D\u5B58\u5728");t.appendChild(this.wrapper),this.parentResizeObserver=new ResizeObserver(()=>{this.vGuides.resize(),this.hGuides.resize()}),this.parentResizeObserver.observe(t)}destroy(){var t,o,n;(t=this.content)==null||t.remove(),this.page=null,(o=this.resizeObserver)==null||o.disconnect(),(n=this.parentResizeObserver)==null||n.disconnect(),this.removeAllListeners()}showGuides(t=!0){this.hGuides.setState({showGuides:t}),this.vGuides.setState({showGuides:t})}showRule(t=!0){this.hGuides.setState({rulerStyle:{visibility:t?"":"hidden"}}),this.vGuides.setState({rulerStyle:{visibility:t?"":"hidden"}})}clearGuides(){this.vGuides.setState({defaultGuides:[]}),this.hGuides.setState({defaultGuides:[]})}setHeight(t){this.content.style.height=lodash.exports.isNumber(t)?`${t}px`:t}setWidth(t){this.content.style.width=lodash.exports.isNumber(t)?`${t}px`:t}async select(t){var c,u;const{renderer:o,zoom:n}=this.core,a=(c=o.contentWindow)==null?void 0:c.document;let i=t.clientX,l=t.clientY;if(o.iframe){const m=o.iframe.getClientRects()[0];m&&(i=i-m.left,l=l-m.top)}const s=a==null?void 0:a.elementsFromPoint(i/n,l/n);let r=!1;const d=()=>r=!0;for(const m of s)if(!m.id.startsWith(GHOST_EL_ID_PREFIX)&&await this.canSelect(m,d)){if(r)break;this.emit("select",m,t),this.target=m,(u=this.content)==null||u.addEventListener("mouseup",this.mouseUpHandler,!0);break}}}class StageRender extends events.exports.EventEmitter{constructor({core:t}){super();_(this,"contentWindow",null);_(this,"runtime",null);_(this,"iframe");_(this,"runtimeUrl");_(this,"core");_(this,"render");_(this,"getMagicApi",()=>({onPageElUpdate:t=>this.emit("page-el-update",t),onRuntimeReady:t=>{this.runtime=t,globalThis.runtime=t,this.emit("runtime-ready",t)}}));_(this,"getRuntime",()=>this.runtime?Promise.resolve(this.runtime):new Promise(t=>{const o=n=>{this.off("runtime-ready",o),t(n)};this.on("runtime-ready",o)}));this.core=t,this.runtimeUrl=t.config.runtimeUrl||"",this.render=t.config.render,this.iframe=globalThis.document.createElement("iframe"),this.iframe.src=isSameDomain(this.runtimeUrl)?this.runtimeUrl:"",this.iframe.style.cssText=`
      border: 0;
      width: 100%;
      height: 100%;
    `,this.iframe.onload=async()=>{var o,n,a;if(this.emit("onload"),this.render){const i=await this.render(this.core);i&&((a=(n=(o=this.iframe)==null?void 0:o.contentDocument)==null?void 0:n.body)==null||a.appendChild(i))}}}async mount(t){var o;if(this.iframe){if(!isSameDomain(this.runtimeUrl)&&this.runtimeUrl){let n=await fetch(this.runtimeUrl).then(i=>i.text());const a=`${location.protocol}//${getHost(this.runtimeUrl)}`;n=n.replace("<head>",`<head>
<base href="${a}">`),this.iframe.srcdoc=n}t.appendChild(this.iframe),this.contentWindow=(o=this.iframe)==null?void 0:o.contentWindow,this.contentWindow.magic=this.getMagicApi()}else throw Error("mount \u5931\u8D25")}destroy(){var t;this.contentWindow=null,(t=this.iframe)==null||t.remove(),this.iframe=void 0,this.removeAllListeners()}}class StageCore extends events.exports.EventEmitter{constructor(t){super();_(this,"selectedDom");_(this,"renderer");_(this,"mask");_(this,"dr");_(this,"config");_(this,"zoom",DEFAULT_ZOOM);_(this,"maskScrollHandler",t=>{var r;const{mask:o,renderer:n}=this,{wrapper:a,hGuides:i,vGuides:l}=o,{scrollTop:s}=a;(r=n==null?void 0:n.contentWindow)==null||r.document.documentElement.scrollTo({top:s}),i.scrollGuides(s),i.scroll(0),l.scrollGuides(0),l.scroll(s),this.emit("scroll",t)});_(this,"hGuidesChangeGuidesHandler",t=>{this.dr.setHGuidelines(t.guides),this.emit("changeGuides")});_(this,"vGuidesChangeGuidesHandler",t=>{this.dr.setVGuidelines(t.guides),this.emit("changeGuides")});this.config=t,this.setZoom(t.zoom),this.renderer=new StageRender({core:this}),this.mask=new StageMask({core:this}),this.dr=new StageDragResize({core:this,container:this.mask.content}),this.renderer.on("runtime-ready",o=>this.emit("runtime-ready",o)),this.renderer.on("page-el-update",o=>{var n;return(n=this.mask)==null?void 0:n.observe(o)}),this.mask.on("select",async(o,n)=>{var a;await((a=this.dr)==null?void 0:a.select(o)),setTimeout(()=>{var i,l;return(l=(i=this.dr)==null?void 0:i.moveable)==null?void 0:l.dragStart(n)})}),this.mask.on("selected",o=>{this.select(o),this.emit("select",o)}),this.dr.on("update",o=>this.emit("update",o)),this.dr.on("sort",o=>this.emit("sort",o))}async select(t){var n,a,i;let o;if(typeof t=="string"||typeof t=="number"){const l=await((n=this.renderer)==null?void 0:n.getRuntime());if(o=await((a=l==null?void 0:l.select)==null?void 0:a.call(l,`${t}`)),!o)throw new Error(`\u4E0D\u5B58\u5728ID\u4E3A${t}\u7684\u5143\u7D20`)}else o=t;this.selectedDom!==o&&(await this.beforeSelect(o),this.selectedDom=o,this.setMaskLayout(o),(i=this.dr)==null||i.select(o))}update(t){var n;const{config:o}=t;(n=this.renderer)==null||n.getRuntime().then(a=>{var i;(i=a==null?void 0:a.update)==null||i.call(a,t),setTimeout(()=>{var s,r;const l=(s=this.renderer.contentWindow)==null?void 0:s.document.getElementById(`${o.id}`);l&&this.setMaskLayout(l),(r=this.dr)==null||r.refresh()},0)})}sortNode(t){var o;(o=this.renderer)==null||o.getRuntime().then(n=>{var a;return(a=n==null?void 0:n.sortNode)==null?void 0:a.call(n,t)})}add(t){var o;(o=this.renderer)==null||o.getRuntime().then(n=>{var a;return(a=n==null?void 0:n.add)==null?void 0:a.call(n,t)})}remove(t){var o;(o=this.renderer)==null||o.getRuntime().then(n=>{var a;return(a=n==null?void 0:n.remove)==null?void 0:a.call(n,t)})}setZoom(t=DEFAULT_ZOOM){this.zoom=t}mount(t){const{mask:o,renderer:n}=this;n.mount(t),o.mount(t);const{wrapper:a,hGuides:i,vGuides:l}=o;a.addEventListener("scroll",this.maskScrollHandler),i.on("changeGuides",this.hGuidesChangeGuidesHandler),l.on("changeGuides",this.vGuidesChangeGuidesHandler),this.emit("mounted")}clearGuides(){this.mask.clearGuides(),this.dr.setHGuidelines([]),this.dr.setVGuidelines([])}destroy(){const{mask:t,renderer:o,dr:n}=this,{wrapper:a,hGuides:i,vGuides:l}=t;o.destroy(),t.destroy(),n.destroy(),a.removeEventListener("scroll",this.maskScrollHandler),i.off("changeGuides",this.hGuidesChangeGuidesHandler),l.off("changeGuides",this.vGuidesChangeGuidesHandler),this.removeAllListeners()}setMaskLayout(t){var a,i;let o=!1,n=t;for(;n&&(o=isFixed(n),!o);){const{parentElement:l}=n;if(!l||l.tagName==="BODY")break;n=l}o?(a=this.mask)==null||a.setFixed():(i=this.mask)==null||i.setAbsolute()}async beforeSelect(t){var n;const o=await((n=this.renderer)==null?void 0:n.getRuntime());(o==null?void 0:o.beforeSelect)&&await o.beforeSelect(t)}}const _sfc_main$F=defineComponent({name:"magic-editor-ui-viewer-menu",setup(){const e=inject("services"),t=e==null?void 0:e.editorService,o=ref(),n=ref(!1),a=ref(!1),i=computed(()=>t==null?void 0:t.get("node")),l=computed(()=>t==null?void 0:t.get("parent"));return onMounted(()=>{const s=globalThis.localStorage.getItem(COPY_STORAGE_KEY);n.value=s!=="undefined"&&!!s}),watch(l,async()=>{var r;if(!l.value||!t)return a.value=!1;const s=await t.getLayout(l.value);a.value=[Layout.ABSOLUTE,Layout.FIXED].includes(s)&&!["app","page","pop"].includes(`${(r=i.value)==null?void 0:r.type}`)},{immediate:!0}),{menu:o,canPaste:n,canDelete:computed(()=>{var s;return((s=i.value)==null?void 0:s.type)!=="page"}),canMoveZPos:computed(()=>{var s;return((s=i.value)==null?void 0:s.type)!=="page"}),canCenter:a,center(){i.value&&(t==null||t.alignCenter(i.value))},copy(){i.value&&(t==null||t.copy(i.value)),n.value=!0},paste(){var d,c;const s=((d=o.value)==null?void 0:d.offsetTop)||0,r=((c=o.value)==null?void 0:c.offsetLeft)||0;t==null||t.paste({left:r,top:s})},remove(){i.value&&(t==null||t.remove(i.value))},top(){t==null||t.moveLayer(LayerOffset.TOP)},bottom(){t==null||t.moveLayer(LayerOffset.BOTTOM)},topItem(){t==null||t.moveLayer(1)},bottomItem(){t==null||t.moveLayer(-1)},clearGuides(){t==null||t.get("stage").clearGuides()}}}}),_hoisted_1$n={class:"magic-editor-content-menu",ref:"menu"},_hoisted_2$c=createBaseVNode("div",{class:"separation"},null,-1),_hoisted_3$a=createBaseVNode("div",{class:"separation"},null,-1),_hoisted_4$8=createBaseVNode("div",{class:"separation"},null,-1);function _sfc_render$A(e,t,o,n,a,i){return openBlock(),createElementBlock("div",_hoisted_1$n,[createBaseVNode("div",null,[e.canCenter?(openBlock(),createElementBlock("div",{key:0,class:"magic-editor-content-menu-item",onClick:t[0]||(t[0]=()=>e.center())},"\u6C34\u5E73\u5C45\u4E2D")):createCommentVNode("",!0),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[1]||(t[1]=()=>e.copy())},"\u590D\u5236"),e.canPaste?(openBlock(),createElementBlock("div",{key:1,class:"magic-editor-content-menu-item",onClick:t[2]||(t[2]=(...l)=>e.paste&&e.paste(...l))},"\u7C98\u8D34")):createCommentVNode("",!0),e.canMoveZPos?(openBlock(),createElementBlock(Fragment,{key:2},[_hoisted_2$c,createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[3]||(t[3]=(...l)=>e.topItem&&e.topItem(...l))},"\u4E0A\u79FB\u4E00\u5C42"),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[4]||(t[4]=(...l)=>e.bottomItem&&e.bottomItem(...l))},"\u4E0B\u79FB\u4E00\u5C42"),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[5]||(t[5]=(...l)=>e.top&&e.top(...l))},"\u7F6E\u9876"),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[6]||(t[6]=(...l)=>e.bottom&&e.bottom(...l))},"\u7F6E\u5E95")],64)):createCommentVNode("",!0),e.canDelete?(openBlock(),createElementBlock(Fragment,{key:3},[_hoisted_3$a,createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[7]||(t[7]=()=>e.remove())},"\u5220\u9664")],64)):createCommentVNode("",!0),_hoisted_4$8,createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[8]||(t[8]=(...l)=>e.clearGuides&&e.clearGuides(...l))},"\u6E05\u7A7A\u53C2\u8003\u7EBF")])],512)}var ViewerMenu=_export_sfc(_sfc_main$F,[["render",_sfc_render$A]]);const useMenu=()=>{const e=ref(),t=ref({display:"none",left:"0",top:"0"});return onMounted(()=>{document.addEventListener("click",()=>{t.value.display="none"},!0)}),{menu:e,menuStyle:t,contextmenuHandler(o){var i;o.preventDefault();const n=(i=e.value)==null?void 0:i.$el.clientHeight;let a=o.clientY;n+o.clientY>document.body.clientHeight&&(a=document.body.clientHeight-n),t.value={display:"block",top:`${a}px`,left:`${o.clientX}px`}}}},_sfc_main$E=defineComponent({name:"magic-stage",components:{ViewerMenu},props:{render:{type:Function},runtimeUrl:String,root:{type:Object},page:{type:Object},node:{type:Object},uiSelectMode:{type:Boolean},zoom:{type:Number},canSelect:{type:Function,default:e=>Boolean(e.id)},moveableOptions:{type:[Object,Function],default:()=>e=>{var t,o;return{container:(o=(t=e==null?void 0:e.renderer)==null?void 0:t.contentWindow)==null?void 0:o.document.getElementById("app")}}}},emits:["select","update","sort"],setup(e,{emit:t}){const o=inject("services"),n=ref(),a=computed(()=>V($({},o==null?void 0:o.uiService.get("stageStyle")),{transform:`scale(${e.zoom}) translate3d(0, -50%, 0)`}));let i=null,l=null;return watchEffect(()=>{var s;i||!n.value||!(e.runtimeUrl||e.render)||!e.root||(i=new StageCore({render:e.render,runtimeUrl:e.runtimeUrl,zoom:e.zoom,canSelect:(r,d)=>{const c=e.canSelect(r);return e.uiSelectMode&&c?(document.dispatchEvent(new CustomEvent("ui-select",{detail:r})),d()):c},moveableOptions:e.moveableOptions}),o==null||o.editorService.set("stage",i),i==null||i.mount(n.value),i==null||i.on("select",r=>t("select",r)),i==null||i.on("update",r=>{t("update",{id:r.el.id,style:r.style})}),i==null||i.on("sort",r=>{t("sort",r)}),i==null||i.on("changeGuides",()=>{o==null||o.uiService.set("showGuides",!0)}),!!((s=e.node)==null?void 0:s.id)&&(i==null||i.on("runtime-ready",r=>{var d,c;l=r,e.root&&(l==null||l.updateRootConfig(cloneDeep(toRaw(e.root)))),((d=e.page)==null?void 0:d.id)&&((c=l==null?void 0:l.updatePageId)==null||c.call(l,e.page.id)),setTimeout(()=>{e.node&&(i==null||i.select(toRaw(e.node.id)))})})))}),watch(()=>e.zoom,s=>{!i||!s||i==null||i.setZoom(s)}),watch(()=>e.root,s=>{l&&s&&l.updateRootConfig(cloneDeep(toRaw(s)))}),onUnmounted(()=>{i==null||i.destroy(),o==null||o.editorService.set("stage",null)}),V($({stageStyle:a},useMenu()),{stageContainer:n})}}),_hoisted_1$m={class:"m-editor-stage"};function _sfc_render$z(e,t,o,n,a,i){const l=resolveComponent("viewer-menu");return openBlock(),createElementBlock("div",_hoisted_1$m,[createBaseVNode("div",{class:"m-editor-stage-container",ref:"stageContainer",style:normalizeStyle(e.stageStyle),onContextmenu:t[0]||(t[0]=(...s)=>e.contextmenuHandler&&e.contextmenuHandler(...s))},null,36),(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(l,{ref:"menu",style:normalizeStyle(e.menuStyle)},null,8,["style"])]))])}var MagicStage=_export_sfc(_sfc_main$E,[["render",_sfc_render$z]]);const _sfc_main$D=defineComponent({name:"m-editor-workspace",components:{PageBar,MagicStage},props:{runtimeUrl:String,render:{type:Function},moveableOptions:{type:[Object,Function]},canSelect:{type:Function}},setup(){const e=inject("services"),t=computed(()=>e==null?void 0:e.editorService.get("node")),o=computed(()=>e==null?void 0:e.editorService.get("stage"));return watch([()=>{var n;return(n=t.value)==null?void 0:n.id},o],([n,a])=>{nextTick(()=>{n&&(a==null||a.select(n))})}),{uiSelectMode:computed(()=>e==null?void 0:e.uiService.get("uiSelectMode")),root:computed(()=>e==null?void 0:e.editorService.get("root")),page:computed(()=>e==null?void 0:e.editorService.get("page")),zoom:computed(()=>e==null?void 0:e.uiService.get("zoom")),node:t,selectHandler(n){e==null||e.editorService.select(n.id)},updateNodeHandler(n){e==null||e.editorService.update(n)},sortNodeHandler(n){e==null||e.editorService.sort(n.src,n.dist)}}}}),_hoisted_1$l={class:"m-editor-workspace"};function _sfc_render$y(e,t,o,n,a,i){var r;const l=resolveComponent("magic-stage"),s=resolveComponent("page-bar");return openBlock(),createElementBlock("div",_hoisted_1$l,[(openBlock(),createBlock(l,{key:(r=e.page)==null?void 0:r.id,"runtime-url":e.runtimeUrl,render:e.render,"ui-select-mode":e.uiSelectMode,root:e.root,page:e.page,node:e.node,zoom:e.zoom,"moveable-options":e.moveableOptions,"can-select":e.canSelect,onSelect:e.selectHandler,onUpdate:e.updateNodeHandler,onSort:e.sortNodeHandler},null,8,["runtime-url","render","ui-select-mode","root","page","node","zoom","moveable-options","can-select","onSelect","onUpdate","onSort"])),renderSlot(e.$slots,"workspace-content"),createVNode(s,null,{"page-bar-title":withCtx(({page:d})=>[renderSlot(e.$slots,"page-bar-title",{page:d})]),"page-bar-popover":withCtx(({page:d})=>[renderSlot(e.$slots,"page-bar-popover",{page:d})]),_:3})])}var Workspace=_export_sfc(_sfc_main$D,[["render",_sfc_render$y]]);class ComponentList extends BaseService{constructor(){super([]);_(this,"state",reactive({list:[]}))}setList(t){this.state.list=t}getList(){return this.state.list}}var componentListService=new ComponentList;const state=reactive({uiSelectMode:!1,showSrc:!1,zoom:1,stageStyle:{},columnWidth:{left:310,center:globalThis.document.body.clientWidth-310-400,right:400},showGuides:!0,showRule:!0});class Ui extends BaseService{constructor(){super([]);globalThis.addEventListener("resize",()=>{this.setColumnWidth({center:"auto"})})}set(t,o){var a;const n=(a=editorService.get("stage"))==null?void 0:a.mask;if(t==="columnWidth"){this.setColumnWidth(o);return}t==="showGuides"&&(n==null||n.showGuides(o)),t==="showRule"&&(n==null||n.showRule(o)),state[t]=o}get(t){return state[t]}setColumnWidth({left:t,center:o,right:n}){const a=$({},toRaw(this.get("columnWidth")));if(t&&(a.left=t),n&&(a.right=n),!o||o==="auto"){const i=globalThis.document.body.clientWidth;a.center=i-((a==null?void 0:a.left)||0)-((a==null?void 0:a.right)||0)}else a.center=o;state.columnWidth=a}}var uiService=new Ui;const _sfc_main$C=defineComponent({name:"m-editor",components:{NavMenu,Sidebar,Workspace,PropsPanel,Framework},props:{modelValue:{type:Object,default:()=>({}),require:!0},componentGroupList:{type:Array,default:()=>[]},sidebar:{type:Object},menu:{type:Object,default:()=>({left:[],right:[]})},render:{type:Function},runtimeUrl:String,propsConfigs:{type:Object,default:()=>({})},propsValues:{type:Object,default:()=>({})},eventMethodList:{type:Object,default:()=>({})},moveableOptions:{type:[Object,Function]},defaultSelected:{type:[Number,String]},canSelect:{type:Function},stageStyle:{type:[String,Object]}},emits:["props-panel-mounted","update:modelValue"],setup(e,{emit:t}){editorService.on("root-change",()=>{const n=editorService.get("node")||e.defaultSelected;n&&editorService.select(n),t("update:modelValue",toRaw(editorService.get("root")))}),watch(()=>e.modelValue,n=>editorService.set("root",n),{immediate:!0}),watch(()=>e.componentGroupList,n=>componentListService.setList(n),{immediate:!0}),watch(()=>e.propsConfigs,n=>propsService.setPropsConfigs(n),{immediate:!0}),watch(()=>e.propsValues,n=>propsService.setPropsValues(n),{immediate:!0}),watch(()=>e.eventMethodList,n=>{const a={},i={};Object.keys(n).forEach(l=>{a[l]=n[l].events,i[l]=n[l].methods}),eventsService.setEvents(a),eventsService.setMethods(i)},{immediate:!0}),watch(()=>e.defaultSelected,n=>n&&editorService.select(n),{immediate:!0}),watch(()=>e.stageStyle,n=>uiService.set("stageStyle",n),{immediate:!0}),onUnmounted(()=>editorService.destroy());const o={componentListService,eventsService,historyService,propsService,editorService,uiService};return provide("services",o),o}});function _sfc_render$x(e,t,o,n,a,i){const l=resolveComponent("nav-menu"),s=resolveComponent("sidebar"),r=resolveComponent("workspace"),d=resolveComponent("props-panel"),c=resolveComponent("framework");return openBlock(),createBlock(c,null,{nav:withCtx(()=>[renderSlot(e.$slots,"nav",{editorService:e.editorService},()=>[createVNode(l,{data:e.menu},null,8,["data"])])]),sidebar:withCtx(()=>[renderSlot(e.$slots,"sidebar",{editorService:e.editorService},()=>[createVNode(s,{data:e.sidebar},null,8,["data"])])]),workspace:withCtx(()=>[renderSlot(e.$slots,"workspace",{},()=>[createVNode(r,{"runtime-url":e.runtimeUrl,render:e.render,"moveable-options":e.moveableOptions,"can-select":e.canSelect},{"workspace-content":withCtx(()=>[renderSlot(e.$slots,"workspace-content",{editorService:e.editorService})]),"page-bar-title":withCtx(({page:u})=>[renderSlot(e.$slots,"page-bar-title",{page:u})]),"page-bar-popover":withCtx(({page:u})=>[renderSlot(e.$slots,"page-bar-popover",{page:u})]),_:3},8,["runtime-url","render","moveable-options","can-select"])])]),propsPanel:withCtx(()=>[renderSlot(e.$slots,"propsPanel",{},()=>[createVNode(d,{ref:"propsPanel",onMounted:t[0]||(t[0]=u=>e.$emit("props-panel-mounted",u))},null,512)])]),empty:withCtx(()=>[renderSlot(e.$slots,"empty",{editorService:e.editorService})]),_:3})}var Editor$1=_export_sfc(_sfc_main$C,[["render",_sfc_render$x]]),index$2="";const defaultInstallOpt$1={};var MagicEditor={install:(e,t)=>{const o=Object.assign(defaultInstallOpt$1,t||{});e.config.globalProperties.$TMAGIC_EDITOR=o,e.component(Editor$1.name,Editor$1),e.component(uiSelect.name,uiSelect),e.component(CodeLink.name,CodeLink),e.component(Code.name,Code),e.component(CodeEditor.name,CodeEditor)}};const isTableSelect=e=>typeof e=="string"&&["table-select","tableSelect"].includes(e),asyncLoadConfig=(e,t,{asyncLoad:o,name:n,type:a})=>{a==="html"&&typeof o=="object"&&typeof n!="undefined"&&(o.name=n,e.asyncLoad=typeof t.asyncLoad=="object"?t.asyncLoad:o)},isMultipleValue=e=>typeof e=="string"&&["checkbox-group","checkboxGroup","table","cascader","group-list","groupList","dynamic-tab","dynamicTab"].includes(e),initItemsValue=(e,t,o,{items:n,name:a,extensible:i})=>{Array.isArray(o[a])?t[a]=o[a].map(l=>init(e,n,l)):(t[a]=init(e,n,o[a],t[a]),i&&(t[a]=Object.assign({},o[a],t[a])))},setValue=(e,t,o,n)=>{const{items:a,name:i,type:l,checkbox:s}=n;isMultipleValue(l)&&(t[i]=o[i]||[]),a?initItemsValue(e,t,o,n):t[i]=getDefaultValue(e,n),l==="fieldset"&&s&&typeof t[i]=="object"&&(t[i].value=typeof o[i]=="object"&&o[i].value||0)},initValueItem=function(e,t,o,n){const{items:a}=t,{names:i}=t,{type:l,name:s}=t;return isTableSelect(l)&&s?(n[s]=o[s]||"",n):(asyncLoadConfig(n,o,t),s&&!a&&typeof o[s]!="undefined"?(typeof n[s]=="undefined"&&(n[s]=typeof o[s]=="object"?cloneDeep(o[s]):o[s]),n):i?i.forEach(r=>n[r]=o[r]||""):s?(setValue(e,n,o,t),n):init(e,a,o,n))},init=function(e,t=[],o={},n={}){return Array.isArray(t)&&t.forEach(a=>{initValueItem(e,a,o,n)}),n},getDefaultValue=function(e,{defaultValue:t,type:o,filter:n,multiple:a}){if(typeof t=="function")return t(e);if(t!=="undefined")return typeof t!="undefined"?t:o==="number"||n==="number"?0:["switch","checkbox"].includes(o)?!1:a?[]:""},filterFunction=(e,t,o)=>typeof t!="function"?t:t(e,{values:(e==null?void 0:e.initValues)||{},model:o.model,parent:(e==null?void 0:e.parentValues)||{},formValue:(e==null?void 0:e.values)||o.model,prop:o.prop}),display=function(e,t,o){return typeof t=="function"?filterFunction(e,t,o):t!==!1},getRules=function(e,t=[],o){return t=cloneDeep(t),typeof t=="object"&&!Array.isArray(t)&&(t=[t]),t.map(n=>{if(typeof n.validator=="function"){const a=n.validator;n.validator=(i,l,s,r,d)=>a({rule:i,value:l,callback:s,source:r,options:d},{values:(e==null?void 0:e.initValues)||{},model:o.model,parent:(e==null?void 0:e.parentValues)||{},formValue:(e==null?void 0:e.values)||o.model,prop:o.prop},e)}return n})},initValue=async(e,{initValues:t,config:o})=>{if(!Array.isArray(o))throw new Error("config\u5E94\u8BE5\u4E3A\u6570\u7EC4");let n=init(e,o,toRaw(t),{});const[a]=o;return a&&typeof a.onInitValue=="function"&&(n=await a.onInitValue(e,{formValue:n,initValue:t})),n||{}},_sfc_main$B=defineComponent({name:"m-form-container",props:{labelWidth:String,expandMore:Boolean,model:{type:[Object,Array],required:!0},config:{type:Object,required:!0},prop:{type:String,default:()=>""},stepActive:{type:[String,Number]},size:{type:String,default:"small"}},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(!1),a=computed(()=>e.config.name||""),i=computed(()=>e.config.items),l=computed(()=>a.value?`${e.prop}${e.prop?".":""}${a.value}`:e.prop),s=computed(()=>{const y=resolveComponent(`m-${i.value?"form":"fields"}-${m.value}`);return typeof y!="string"?y:"m-fields-text"}),r=computed(()=>filterFunction(o,e.config.disabled,e)),d=computed(()=>filterFunction(o,e.config.tooltip,e)),c=computed(()=>filterFunction(o,e.config.extra,e)),u=computed(()=>getRules(o,e.config.rules,e)),m=computed(()=>{let{type:y}=e.config;return typeof y=="function"&&(y=y(o,{model:e.model})),y==="form"?"":(y==null?void 0:y.replace(/([A-Z])/g,"-$1").toLowerCase())||(i.value?"":"text")}),f=computed(()=>e.config.display==="expand"?n.value:display(o,e.config.display,e));watchEffect(()=>{n.value=e.expandMore});const g=()=>n.value=!n.value,B=y=>y[o==null?void 0:o.keyProps],S=(y,C)=>typeof y=="function"?y(o,C,{model:e.model,values:o==null?void 0:o.initValues,formValue:o==null?void 0:o.values,prop:l.value}):y==="number"?+C:C,h=(y,C)=>{if(typeof y=="function")return y(o,C,{model:e.model,values:o==null?void 0:o.initValues,formValue:o==null?void 0:o.values,prop:l.value})},k=(y,C)=>{if(typeof C=="string"&&y)return C.replace(/^\s*/,"").replace(/\s*$/,"")};return{expand:n,name:a,type:m,disabled:r,itemProp:l,items:i,display:f,tagName:s,rule:u,tooltip:d,extra:c,key:B,onChangeHandler:async function(y,C){var M,H;const{filter:w,onChange:E,trim:F,name:N,dynamicKey:D}=e.config;let T=S(w,y);T=(M=await h(E,T))!=null?M:T,T=(H=k(F,T))!=null?H:T,(N||N===0)&&e.model!==T&&(y!==T||e.model[N]!==T)&&(e.model[N]=T),C!==void 0&&D&&(e.model[C]=T),t("change",e.model)},expandHandler:g}}}),_hoisted_1$k=["innerHTML"],_hoisted_2$b=["innerHTML"],_hoisted_3$9=["innerHTML"],_hoisted_4$7=createBaseVNode("i",{class:"el-icon-warning"},null,-1),_hoisted_5$5=["innerHTML"],_hoisted_6$3={key:4,style:{"text-align":"center"}};function _sfc_render$w(e,t,o,n,a,i){const l=resolveComponent("m-fields-hidden"),s=resolveComponent("el-tooltip"),r=resolveComponent("el-form-item"),d=resolveComponent("m-form-container"),c=resolveComponent("el-button");return e.config?(openBlock(),createElementBlock("div",{key:0,style:normalizeStyle(e.config.tip?"display: flex":""),class:normalizeClass([e.config.className,"m-form-container"])},[e.type==="hidden"?(openBlock(),createBlock(l,{key:0,model:e.model,config:e.config,name:e.config.name,disabled:e.disabled,prop:e.itemProp},null,8,["model","config","name","disabled","prop"])):e.items&&!e.config.text&&e.type&&e.display?(openBlock(),createBlock(resolveDynamicComponent(e.tagName),{key:e.key(e.config),size:e.size,model:e.model,config:e.config,name:e.name,prop:e.itemProp,"step-active":e.stepActive,"expand-more":e.expand,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.onChangeHandler},null,8,["size","model","config","name","prop","step-active","expand-more","label-width","onChange"])):e.type&&e.display?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(r,{style:normalizeStyle(e.config.tip?"flex: 1":""),prop:e.itemProp,"label-width":e.config.text?e.config.labelWidth||e.labelWidth:"0",rules:e.rule},{label:withCtx(()=>[createBaseVNode("span",{innerHTML:e.type==="checkbox"?"":e.config.text},null,8,_hoisted_1$k)]),default:withCtx(()=>[e.tooltip?(openBlock(),createBlock(s,{key:0},{content:withCtx(()=>[createBaseVNode("div",{innerHTML:e.tooltip},null,8,_hoisted_2$b)]),default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(e.tagName),{key:e.key(e.config),size:e.size,model:e.model,config:e.config,name:e.name,disabled:e.disabled,prop:e.itemProp,onChange:e.onChangeHandler},null,8,["size","model","config","name","disabled","prop","onChange"]))]),_:1})):(openBlock(),createBlock(resolveDynamicComponent(e.tagName),{key:e.key(e.config),size:e.size,model:e.model,config:e.config,name:e.name,disabled:e.disabled,prop:e.itemProp,onChange:e.onChangeHandler},null,8,["size","model","config","name","disabled","prop","onChange"])),e.extra?(openBlock(),createElementBlock("div",{key:2,innerHTML:e.extra,class:"m-form-tip"},null,8,_hoisted_3$9)):createCommentVNode("",!0)]),_:1},8,["style","prop","label-width","rules"]),e.config.tip?(openBlock(),createBlock(s,{key:0,placement:"top",style:{"line-height":"40px","margin-left":"5px"}},{content:withCtx(()=>[createBaseVNode("div",{innerHTML:e.config.tip},null,8,_hoisted_5$5)]),default:withCtx(()=>[_hoisted_4$7]),_:1})):createCommentVNode("",!0)],64)):e.items&&e.display?(openBlock(),createElementBlock(Fragment,{key:3},[(e.name||e.name===0?e.model[e.name]:e.model)?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.items,u=>(openBlock(),createBlock(d,{key:e.key(u),model:e.name||e.name===0?e.model[e.name]:e.model,config:u,size:e.size,"step-active":e.stepActive,"expand-more":e.expand,"label-width":e.config.labelWidth||e.labelWidth,prop:e.itemProp,onChange:e.onChangeHandler},null,8,["model","config","size","step-active","expand-more","label-width","prop","onChange"]))),128)):createCommentVNode("",!0)],64)):createCommentVNode("",!0),e.config.expand&&e.type!=="fieldset"?(openBlock(),createElementBlock("div",_hoisted_6$3,[createVNode(c,{type:"text",onClick:e.expandHandler},{default:withCtx(()=>[createTextVNode(toDisplayString(e.expand?"\u6536\u8D77\u914D\u7F6E":"\u5C55\u5F00\u66F4\u591A\u914D\u7F6E"),1)]),_:1},8,["onClick"])])):createCommentVNode("",!0)],6)):createCommentVNode("",!0)}var Container=_export_sfc(_sfc_main$B,[["render",_sfc_render$w]]);const _sfc_main$A=defineComponent({name:"m-form-fieldset",props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},rules:{type:Object,default:()=>({})},prop:{type:String,default:()=>""},size:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=computed(()=>e.config.name||""),a=computed(()=>{var r;return e.config.expand&&n.value?(r=e.model[n.value])==null?void 0:r.value:!0}),i=computed(()=>e.config.items?e.config.labelWidth||e.labelWidth:e.config.labelWidth||e.labelWidth||(e.config.text?null:"0"));return{show:a,name:n,mForm:o,lWidth:i,key:(r,d)=>{var c;return(c=r[(o==null?void 0:o.keyProp)||"__key"])!=null?c:d},change:()=>{t("change",e.model)}}}}),_hoisted_1$j=["innerHTML"],_hoisted_2$a=["innerHTML"],_hoisted_3$8={key:1},_hoisted_4$6=["innerHTML"],_hoisted_5$4=["innerHTML"],_hoisted_6$2={key:2},_hoisted_7$2=["innerHTML"],_hoisted_8$1=["innerHTML"],_hoisted_9$1={key:3,style:{display:"flex"}},_hoisted_10$1={style:{flex:"1"}},_hoisted_11=["src"];function _sfc_render$v(e,t,o,n,a,i){const l=resolveComponent("el-checkbox"),s=resolveComponent("m-form-container");return(e.name?e.model[e.name]:e.model)?(openBlock(),createElementBlock("fieldset",{key:0,class:"m-fieldset",style:normalizeStyle(e.show?"padding: 15px 15px 0 5px;":"border: 0")},[!e.show&&e.name?(openBlock(),createBlock(l,{key:0,modelValue:e.model[e.name].value,"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name].value=r),prop:`${e.prop}${e.prop?".":""}${e.config.name}.value`,"true-label":1,"false-label":0,onChange:e.change},{default:withCtx(()=>[createBaseVNode("span",{innerHTML:e.config.legend},null,8,_hoisted_1$j),e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_2$a)):createCommentVNode("",!0)]),_:1},8,["modelValue","prop","onChange"])):e.config.checkbox&&e.name?(openBlock(),createElementBlock("legend",_hoisted_3$8,[createVNode(l,{modelValue:e.model[e.name].value,"onUpdate:modelValue":t[1]||(t[1]=r=>e.model[e.name].value=r),prop:`${e.prop}${e.prop?".":""}${e.config.name}.value`,"true-label":1,"false-label":0,onChange:e.change},{default:withCtx(()=>[createBaseVNode("span",{innerHTML:e.config.legend},null,8,_hoisted_4$6),e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_5$4)):createCommentVNode("",!0)]),_:1},8,["modelValue","prop","onChange"])])):(openBlock(),createElementBlock("legend",_hoisted_6$2,[createBaseVNode("span",{innerHTML:e.config.legend},null,8,_hoisted_7$2),e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_8$1)):createCommentVNode("",!0)])),e.config.schematic&&e.show?(openBlock(),createElementBlock("div",_hoisted_9$1,[createBaseVNode("div",_hoisted_10$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(r,d)=>(openBlock(),createBlock(s,{key:e.key(r,d),model:e.name?e.model[e.name]:e.model,rules:e.name?e.rules[e.name]:[],config:r,prop:e.prop,labelWidth:e.lWidth,size:e.size,onChange:e.change},null,8,["model","rules","config","prop","labelWidth","size","onChange"]))),128))]),createBaseVNode("img",{class:"m-form-schematic",src:e.config.schematic},null,8,_hoisted_11)])):e.show?(openBlock(!0),createElementBlock(Fragment,{key:4},renderList(e.config.items,(r,d)=>(openBlock(),createBlock(s,{key:e.key(r,d),model:e.name?e.model[e.name]:e.model,rules:e.name?e.rules[e.name]:[],config:r,prop:e.prop,labelWidth:e.lWidth,size:e.size,onChange:e.change},null,8,["model","rules","config","prop","labelWidth","size","onChange"]))),128)):createCommentVNode("",!0)],4)):createCommentVNode("",!0)}var Fieldset=_export_sfc(_sfc_main$A,[["render",_sfc_render$v]]);const _sfc_main$z=defineComponent({name:"m-form-group-list-item",components:{CaretRight,CaretBottom:CaretBottom$1},props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,size:String,index:{type:[Number,String,Symbol],default:0},groupModel:{type:Array,default:()=>[]}},emits:["swap-item","remove-item","change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(!1);watchEffect(()=>{n.value=!e.index});const a=computed(()=>({type:"row",span:e.config.span||24,items:e.config.items,labelWidth:e.config.labelWidth,[(o==null?void 0:o.keyProp)||"__key"]:`${e.config[(o==null?void 0:o.keyProp)||"__key"]}${String(e.index)}`})),i=computed(()=>e.config.titleKey&&e.model[e.config.titleKey]?e.model[e.config.titleKey]:`\u7EC4 ${String(e.index)}`),l=computed(()=>{var g;return((g=e.groupModel)==null?void 0:g.length)||0}),s=computed(()=>filterFunction(o,e.config.itemExtra,e));return{expand:n,expandHandler:()=>{n.value=!n.value},title:i,showDelete:g=>{const B=e.config.delete;return B&&typeof B=="function"?B(e.model,g,o==null?void 0:o.values):!0},removeHandler:()=>t("remove-item",e.index),movable:()=>{const{movable:g}=e.config;return g===void 0?!0:typeof g=="function"?g(o,e.index||0,e.model,e.groupModel):g},changeOrder:(g=0)=>t("swap-item",e.index,`${String(e.index)}${g}`),itemExtra:s,rowConfig:a,changeHandler:()=>t("change"),length:l,Delete:Delete$1}}}),_hoisted_1$i={class:"m-fields-group-list-item"},_hoisted_2$9=createTextVNode("\u4E0A\u79FB"),_hoisted_3$7=createTextVNode("\u4E0B\u79FB"),_hoisted_4$5=["innerHTML"];function _sfc_render$u(e,t,o,n,a,i){const l=resolveComponent("caret-bottom"),s=resolveComponent("caret-right"),r=resolveComponent("el-icon"),d=resolveComponent("el-button"),c=resolveComponent("CaretRight"),u=resolveComponent("CaretBottom"),m=resolveComponent("m-form-container");return openBlock(),createElementBlock("div",_hoisted_1$i,[createBaseVNode("div",null,[createVNode(r,{style:{"margin-right":"7px"},onClick:e.expandHandler},{default:withCtx(()=>[e.expand?(openBlock(),createBlock(l,{key:0})):(openBlock(),createBlock(s,{key:1}))]),_:1},8,["onClick"]),createVNode(d,{type:"text",onClick:e.expandHandler},{default:withCtx(()=>[createTextVNode(toDisplayString(e.title),1)]),_:1},8,["onClick"]),withDirectives(createVNode(d,{type:"text",icon:e.Delete,style:{color:"#f56c6c"},onClick:e.removeHandler},null,8,["icon","onClick"]),[[vShow,e.showDelete(parseInt(String(e.index)))]]),e.movable()?(openBlock(),createElementBlock(Fragment,{key:0},[withDirectives(createVNode(d,{type:"text",size:"small",onClick:t[0]||(t[0]=f=>e.changeOrder(-1))},{default:withCtx(()=>[_hoisted_2$9,createVNode(r,null,{default:withCtx(()=>[createVNode(c)]),_:1})]),_:1},512),[[vShow,e.index!==0]]),withDirectives(createVNode(d,{type:"text",size:"small",onClick:t[1]||(t[1]=f=>e.changeOrder(1))},{default:withCtx(()=>[_hoisted_3$7,createVNode(r,null,{default:withCtx(()=>[createVNode(u)]),_:1})]),_:1},512),[[vShow,e.index!==e.length-1]])],64)):createCommentVNode("",!0),e.itemExtra?(openBlock(),createElementBlock("span",{key:1,innerHTML:e.itemExtra,class:"m-form-tip"},null,8,_hoisted_4$5)):createCommentVNode("",!0)]),e.expand?(openBlock(),createBlock(m,{key:0,config:e.rowConfig,model:e.model,labelWidth:e.labelWidth,prop:`${e.prop}${e.prop?".":""}${String(e.index)}`,size:e.size,onChange:e.changeHandler},null,8,["config","model","labelWidth","prop","size","onChange"])):createCommentVNode("",!0)])}var MFieldsGroupListItem=_export_sfc(_sfc_main$z,[["render",_sfc_render$u]]);const _sfc_main$y=defineComponent({name:"m-form-group-list",components:{MFieldsGroupListItem},props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:{type:String,default:""},size:String,name:{type:String,default:""}},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=computed(()=>e.name?typeof e.config.addable=="function"?e.config.addable(o,{model:e.model[e.name],formValue:o==null?void 0:o.values}):typeof e.config.addable=="undefined"?!0:e.config.addable:!1),a=()=>{if(!e.name)return!1;t("change",e.model[e.name])};return{addable:n,toggleMode:()=>{e.config.type="table",e.config.groupItems=e.config.items,e.config.items=e.config.tableItems||e.config.items.map(d=>V($({},d),{label:d.label||d.text,text:null}))},removeHandler:d=>{if(!e.name)return!1;e.model[e.name].splice(d,1),a()},swapHandler:(d,c)=>{if(!e.name)return!1;const[u]=e.model[e.name].splice(d,1);e.model[e.name].splice(c,0,u),a()},changeHandler:a,addHandler:async()=>{if(!e.name)return!1;let d={};typeof e.config.defaultAdd=="function"?d=await e.config.defaultAdd(o,{model:e.model[e.name],formValue:o==null?void 0:o.values}):e.config.defaultAdd&&(d=e.config.defaultAdd);const c=await initValue(o,{config:e.config.items,initValues:d});e.model[e.name].push(c)}}}}),_hoisted_1$h={class:"m-fields-group-list"},_hoisted_2$8=["innerHTML"],_hoisted_3$6={key:1,class:"el-table__empty-block"},_hoisted_4$4=createBaseVNode("span",{class:"el-table__empty-text"},"\u6682\u65E0\u6570\u636E",-1),_hoisted_5$3=[_hoisted_4$4],_hoisted_6$1=createTextVNode("\u6DFB\u52A0\u7EC4"),_hoisted_7$1=createTextVNode("\u5207\u6362\u4E3A\u8868\u683C");function _sfc_render$t(e,t,o,n,a,i){const l=resolveComponent("m-fields-group-list-item"),s=resolveComponent("el-button");return openBlock(),createElementBlock("div",_hoisted_1$h,[e.config.extra?(openBlock(),createElementBlock("div",{key:0,innerHTML:e.config.extra,style:{color:"rgba(0, 0, 0, 0.45)"}},null,8,_hoisted_2$8)):createCommentVNode("",!0),!e.model[e.name]||!e.model[e.name].length?(openBlock(),createElementBlock("div",_hoisted_3$6,_hoisted_5$3)):(openBlock(!0),createElementBlock(Fragment,{key:2},renderList(e.model[e.name],(r,d)=>(openBlock(),createBlock(l,{key:d,model:r,config:e.config,prop:e.prop,index:d,"label-width":e.labelWidth,size:e.size,"group-model":e.model[e.name],onRemoveItem:e.removeHandler,onSwapItem:e.swapHandler,onChange:e.changeHandler},null,8,["model","config","prop","index","label-width","size","group-model","onRemoveItem","onSwapItem","onChange"]))),128)),e.addable?(openBlock(),createBlock(s,{key:3,onClick:e.addHandler,size:"small"},{default:withCtx(()=>[_hoisted_6$1]),_:1},8,["onClick"])):createCommentVNode("",!0),e.config.enableToggleMode?(openBlock(),createBlock(s,{key:4,icon:"el-icon-s-grid",size:"small",onClick:e.toggleMode},{default:withCtx(()=>[_hoisted_7$1]),_:1},8,["onClick"])):createCommentVNode("",!0)])}var GroupList=_export_sfc(_sfc_main$y,[["render",_sfc_render$t]]);const _sfc_main$x=defineComponent({name:"m-form-panel",components:{CaretBottom:CaretBottom$1,CaretRight},props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,size:String,name:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(e.config.expand!==!1),a=computed(()=>e.config.items);return{mForm:o,expand:n,items:a,filter:s=>filterFunction(o,s,e),changeHandler:()=>t("change",e.model)}}}),_hoisted_1$g={class:"clearfix"},_hoisted_2$7=["innerHTML"],_hoisted_3$5={key:0,style:{display:"flex"}},_hoisted_4$3={style:{flex:"1"}},_hoisted_5$2=["src"];function _sfc_render$s(e,t,o,n,a,i){const l=resolveComponent("caret-bottom"),s=resolveComponent("caret-right"),r=resolveComponent("el-icon"),d=resolveComponent("m-form-container"),c=resolveComponent("el-card");return e.items&&e.items.length?(openBlock(),createBlock(c,{key:0,class:"box-card m-form-panel","body-style":{display:e.expand?"block":"none"}},{header:withCtx(()=>[createBaseVNode("div",_hoisted_1$g,[createBaseVNode("a",{href:"javascript:",style:{width:"100%",display:"block"},onClick:t[0]||(t[0]=u=>e.expand=!e.expand)},[createVNode(r,null,{default:withCtx(()=>[e.expand?(openBlock(),createBlock(l,{key:0})):(openBlock(),createBlock(s,{key:1}))]),_:1}),createTextVNode(" "+toDisplayString(e.filter(e.config.title))+" ",1),e.config&&e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_2$7)):createCommentVNode("",!0)])])]),default:withCtx(()=>[createBaseVNode("div",null,[renderSlot(e.$slots,"default"),e.config.schematic?(openBlock(),createElementBlock("div",_hoisted_3$5,[createBaseVNode("div",_hoisted_4$3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.items,(u,m)=>{var f,g;return openBlock(),createBlock(d,{key:(g=u[((f=e.mForm)==null?void 0:f.keyProp)||"__key"])!=null?g:m,config:u,model:e.name?e.model[e.name]:e.model,prop:e.prop,size:e.size,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","onChange"])}),128))]),createBaseVNode("img",{class:"m-form-schematic",src:e.config.schematic},null,8,_hoisted_5$2)])):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(e.items,(u,m)=>{var f,g;return openBlock(),createBlock(d,{key:(g=u[((f=e.mForm)==null?void 0:f.keyProp)||"__key"])!=null?g:m,config:u,model:e.name?e.model[e.name]:e.model,prop:e.prop,size:e.size,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","onChange"])}),128))])]),_:3},8,["body-style"])):createCommentVNode("",!0)}var Panel=_export_sfc(_sfc_main$x,[["render",_sfc_render$s]]);const _sfc_main$w=defineComponent({name:"m-form-row",props:{labelWidth:String,expandMore:Boolean,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,name:String,size:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm");return{mForm:o,display(a){return display(o,a.display,e)},changeHandler:()=>t("change",e.name?e.model[e.name]:e.model)}}});function _sfc_render$r(e,t,o,n,a,i){const l=resolveComponent("m-form-container"),s=resolveComponent("el-col"),r=resolveComponent("el-row");return openBlock(),createBlock(r,{gutter:10},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(d,c)=>{var u,m;return openBlock(),createBlock(s,{style:normalizeStyle(!e.display(d)||d.type==="hidden"?"display: none":""),key:(m=d[((u=e.mForm)==null?void 0:u.keyProp)||"__key"])!=null?m:c,span:d.span||e.config.span||24/e.config.items.length},{default:withCtx(()=>[createVNode(l,{model:e.name?e.model[e.name]:e.model,config:d,prop:e.prop,"label-width":e.config.labelWidth||e.labelWidth,"expand-more":e.expandMore,size:e.size,onChange:e.changeHandler},null,8,["model","config","prop","label-width","expand-more","size","onChange"])]),_:2},1032,["style","span"])}),128))]),_:1})}var Row=_export_sfc(_sfc_main$w,[["render",_sfc_render$r]]);const _sfc_main$v=defineComponent({name:"m-form-step",props:{model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},stepActive:{type:Number,default:()=>1},size:String,labelWidth:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(1);return watchEffect(()=>{n.value=e.stepActive}),{mForm:o,active:n,stepClick:l=>{n.value=l+1,o==null||o.$emit("update:stepActive",n.value)},changeHandler:()=>{t("change",e.model)}}}});function _sfc_render$q(e,t,o,n,a,i){const l=resolveComponent("el-step"),s=resolveComponent("el-steps"),r=resolveComponent("m-form-container");return openBlock(),createElementBlock("div",null,[createVNode(s,{active:e.active,"align-center":"",space:e.config.space},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(d,c)=>(openBlock(),createBlock(l,{key:d.__key,title:d.title,active:e.active,onClick:u=>e.stepClick(c)},null,8,["title","active","onClick"]))),128))]),_:1},8,["active","space"]),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(d,c)=>(openBlock(),createElementBlock(Fragment,null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(d.items,u=>{var m;return openBlock(),createElementBlock(Fragment,null,[u?withDirectives((openBlock(),createBlock(r,{key:u[((m=e.mForm)==null?void 0:m.keyProp)||"__key"],config:u,model:d.name?e.model[d.name]:e.model,prop:d.name,size:e.size,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","onChange"])),[[vShow,e.active-1===c]]):createCommentVNode("",!0)],64)}),256))],64))),256))])}var MStep=_export_sfc(_sfc_main$v,[["render",_sfc_render$q]]);let loadedAMapJS=!1,firstLoadingAMapJS=!0;const _sfc_main$u=defineComponent({name:"m-form-table",props:{name:{type:String,required:!0},model:{type:Object,required:!0,default:()=>({})},config:{type:Object,required:!0,default:()=>({})},prop:{type:String},labelWidth:{type:String},sort:{type:Boolean,default:!1},sortKey:{type:String,default:""},text:{type:String},size:String,enableToggleMode:{type:Boolean,default:!0}},emits:["change","select"],setup(e,{emit:t}){let o=null;const n=inject("mForm"),a=ref(),i=ref(),l=ref(),s=ref(10),r=ref(0),d=ref(1),c=ref(!1),u=computed(()=>e.name||e.config.name||""),m=({prop:h,order:k})=>{k==="ascending"?e.model[u.value]=e.model[u.value].sort((b,y)=>b[h]-y[h]):k==="descending"&&(e.model[u.value]=e.model[u.value].sort((b,y)=>y[h]-b[h]))},f=()=>{d.value+=1,setTimeout(()=>B())},g=(h,k)=>{if([e.model[u.value][h]]=e.model[u.value].splice(k,1,e.model[u.value][h]),e.sortKey)for(let b=e.model[u.value].length-1,y=0;b>=0;b--,y++)e.model[u.value][y][e.sortKey]=b;n==null||n.$emit("field-change",e.prop,e.model[u.value])},B=()=>{var k;const h=(k=a.value)==null?void 0:k.$el;if(h==null?void 0:h.querySelectorAll(".el-table__body > tbody")){const b=h.querySelectorAll(".el-table__body > tbody")[0],y=Sortable.create(b,{onEnd:({newIndex:C,oldIndex:w})=>{typeof C!="undefined"&&typeof w!="undefined"&&(g(C,w),t("change",e.model[u.value]),f(),y.destroy(),n==null||n.$emit("field-change",e.prop,e.model[u.value]),sleep(1e3).then(()=>{const E=h.querySelectorAll(".el-table__body > tbody > tr");(E==null?void 0:E[C])&&(E[C].style.backgroundColor="rgba(243, 89, 59, 0.2)",sleep(1e3).then(()=>{E[C].style.backgroundColor=""}))}))}})}},S=async h=>{if(e.config.max&&e.model[u.value].length>=e.config.max){ElMessage.error(`\u6700\u591A\u65B0\u589E\u914D\u7F6E\u4E0D\u80FD\u8D85\u8FC7${e.config.max}\u6761`);return}const k=e.config.items,b=e.config.enum||[];let y=[];const{length:C}=e.model[u.value],w=e.config.key||"id";let E={};if(b.length){if(C>=b.length)return;y=b.filter(F=>{let N=0;for(;N<C&&F[w]!==e.model[u.value][N][w];N++);return N===C}),y.length>0&&(E=y[0])}else Array.isArray(h)?k.forEach((F,N)=>{F.name&&(E[F.name]=h[N])}):(typeof e.config.defaultAdd=="function"?E=await e.config.defaultAdd(n,{model:e.model[u.value],formValue:n==null?void 0:n.values}):e.config.defaultAdd&&(E=e.config.defaultAdd),E=await initValue(n,{config:k,initValues:E}));e.sortKey&&C&&(E[e.sortKey]=e.model[u.value][C-1][e.sortKey]-1),e.model[u.value].push(E),t("change",e.model[u.value])};return!loadedAMapJS&&firstLoadingAMapJS&&!globalThis.XLSX&&(firstLoadingAMapJS=!1,asyncLoadJs("https://cdn.bootcdn.net/ajax/libs/xlsx/0.17.0/xlsx.full.min.js").then(()=>{loadedAMapJS=!0}).catch(()=>{firstLoadingAMapJS=!0})),onMounted(()=>{e.config.defautSort&&m(e.config.defautSort),e.sort&&e.sortKey&&e.model[u.value].sort((h,k)=>k[e.sortKey]-h[e.sortKey]),e.config.dropSort&&B()}),{mForm:n,pagesize:s,pagecontext:r,foreUpdate:f,isFullscreen:c,elTable:a,mTable:l,excelBtn:i,modelName:u,updateKey:d,ArrowDown:ArrowDown$1,ArrowUp,Delete:Delete$1,data:computed(()=>e.model[u.value].filter((h,k)=>k>=r.value*s.value&&k+1<=(r.value+1)*s.value)),addable:computed(()=>e.model[u.value].length?typeof e.config.addable=="function"?e.config.addable(n,{model:e.model[u.value],formValue:n==null?void 0:n.values,prop:e.prop}):typeof e.config.addable=="undefined"?!0:e.config.addable:!0),selection:computed(()=>typeof e.config.selection=="function"?e.config.selection(n,{model:e.model[u.value]}):e.config.selection),importable:computed(()=>typeof e.config.importable=="function"?e.config.importable(n,{formValue:n==null?void 0:n.values,model:e.model[u.value]}):typeof e.config.importable=="undefined"?!1:e.config.importable),sortChange:m,display(h){return display(n,h,e)},itemExtra(h,k){return typeof h=="function"?h(n,{values:n==null?void 0:n.initValues,model:e.model,formValue:n?n.values:e.model,prop:e.prop,index:k}):h},newHandler:S,removeHandler(h){e.model[u.value].splice(h,1),t("change",e.model[u.value])},selectHandle(h,k){var b,y;typeof e.config.selection=="string"&&e.config.selection==="single"&&((b=a.value)==null||b.clearSelection(),(y=a.value)==null||y.toggleRowSelection(k,!0)),t("select",h,k),typeof e.config.onSelect=="function"&&e.config.onSelect(n,{selection:h,row:k})},toggleRowSelection(h,k){var b;(b=a.value)==null||b.toggleRowSelection.call(a.value,h,k)},makeConfig(h){const k=cloneDeep(h);return delete k.display,k},upHandler(h){o&&clearTimeout(o),o=setTimeout(()=>{g(h,h-1)},300)},topHandler(h){o&&clearTimeout(o);const k=h;for(let b=0;b<k;b++)g(h,h-1),h-=1},downHandler(h){o&&clearTimeout(o),o=setTimeout(()=>{g(h,h+1)},300)},bottomHandler(h){o&&clearTimeout(o);const k=e.model[u.value].length-1-h;for(let b=0;b<k;b++)g(h,h+1),h+=1},showDelete(h){const k=e.config.delete;return k&&typeof k=="function"?k(e.model[u.value],h,n==null?void 0:n.values):!0},clearHandler(){const h=e.model[u.value].length;e.model[u.value].splice(0,h),n==null||n.$emit("field-change",e.prop,e.model[u.value])},excelHandler(h){if(!h||!h.raw)return!1;const k=new FileReader;return k.onload=()=>{const b=k.result,y=globalThis.XLSX.read(b,{type:"array"});y.SheetNames.forEach(C=>{const w=globalThis.XLSX.utils.sheet_to_json(y.Sheets[C],{header:1});(w==null?void 0:w[0])&&w.forEach(E=>{S(E)}),setTimeout(()=>{var E;(E=i.value)==null||E.clearFiles()},300)})},k.readAsArrayBuffer(h.raw),!1},handleSizeChange(h){s.value=h},handleCurrentChange(h){r.value=h-1},toggleMode(){const h=k=>{var C;if(!k)return"0px";const b=((C=k.match(/[^\x00-\xff]/g))==null?void 0:C.length)||0,y=k.length-b;return`${Math.max(y*8+b*20,80)}px`};e.config.type="groupList",e.config.enableToggleMode=!0,e.config.tableItems=e.config.items,e.config.items=e.config.groupItems||e.config.items.map(k=>{const b=k.text||k.label,y=h(b);return V($({},k),{text:b,labelWidth:y,span:k.span||12})})},toggleFullscreen(){var h,k;c.value?((h=l.value)==null||h.classList.remove("fixed"),c.value=!1):((k=l.value)==null||k.classList.add("fixed"),c.value=!0)},getProp(h){const{prop:k}=toRefs(e);return`${k.value}${k.value?".":""}${h+1+r.value*s.value-1}`}}}}),_hoisted_1$f=["innerHTML"],_hoisted_2$6={class:"el-form-item__content"},_hoisted_3$4=["innerHTML"],_hoisted_4$2=createTextVNode("\u6DFB\u52A0"),_hoisted_5$1=createTextVNode(" \xA0 "),_hoisted_6=createTextVNode("\u5C55\u5F00\u914D\u7F6E"),_hoisted_7=createTextVNode("\u5BFC\u5165EXCEL"),_hoisted_8=createTextVNode("\xA0 "),_hoisted_9=createTextVNode("\u6E05\u7A7A"),_hoisted_10={class:"bottom",style:{"text-align":"right"}};function _sfc_render$p(e,t,o,n,a,i){const l=resolveComponent("el-table-column"),s=resolveComponent("el-button"),r=resolveComponent("el-tooltip"),d=resolveComponent("m-form-container"),c=resolveComponent("el-table"),u=resolveComponent("el-upload"),m=resolveComponent("el-pagination");return openBlock(),createElementBlock("div",{ref:"mTable",class:normalizeClass(["m-fields-table",{"m-fields-table-item-extra":e.config.itemExtra}])},[e.config.extra?(openBlock(),createElementBlock("span",{key:0,style:{color:"rgba(0, 0, 0, 0.45)"},innerHTML:e.config.extra},null,8,_hoisted_1$f)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_2$6,[createVNode(r,{content:"\u62D6\u62FD\u53EF\u6392\u5E8F",placement:"left-start",disabled:e.config.dropSort!==!0},{default:withCtx(()=>[e.model[e.modelName]?(openBlock(),createBlock(c,{ref:"elTable",style:{width:"100%"},data:e.model[e.modelName],border:e.config.border,"max-height":e.config.maxHeight,"default-expand-all":!0,key:e.updateKey,onSelect:e.selectHandle,onSortChange:e.sortChange},{default:withCtx(()=>[e.config.itemExtra?(openBlock(),createBlock(l,{key:0,fixed:"left",width:"30",type:"expand"},{default:withCtx(f=>[createBaseVNode("span",{innerHTML:e.itemExtra(e.config.itemExtra,f.$index),class:"m-form-tip"},null,8,_hoisted_3$4)]),_:1})):createCommentVNode("",!0),createVNode(l,{label:"\u64CD\u4F5C",width:"50",fixed:e.config.fixed===!1?void 0:"left"},{default:withCtx(f=>[withDirectives(createVNode(s,{style:{color:"#f56c6c"},type:"text",icon:e.Delete,onClick:g=>e.removeHandler(f.$index+1+e.pagecontext*e.pagesize-1)},null,8,["icon","onClick"]),[[vShow,e.showDelete(f.$index+1+e.pagecontext*e.pagesize-1)]])]),_:1},8,["fixed"]),e.sort&&e.model[e.modelName]&&e.model[e.modelName].length>1?(openBlock(),createBlock(l,{key:1,label:"\u6392\u5E8F",width:"70"},{default:withCtx(f=>[f.$index+1+e.pagecontext*e.pagesize-1!==0?(openBlock(),createBlock(r,{key:0,content:"\u70B9\u51FB\u4E0A\u79FB\uFF0C\u53CC\u51FB\u7F6E\u9876",placement:"top"},{default:withCtx(()=>[createVNode(s,{plain:"",size:"small",icon:e.ArrowUp,type:"text",onClick:g=>e.upHandler(f.$index+1+e.pagecontext*e.pagesize-1),onDblclick:g=>e.topHandler(f.$index+1+e.pagecontext*e.pagesize-1)},null,8,["icon","onClick","onDblclick"])]),_:2},1024)):createCommentVNode("",!0),f.$index+1+e.pagecontext*e.pagesize-1!==e.model[e.modelName].length-1?(openBlock(),createBlock(r,{key:1,content:"\u70B9\u51FB\u4E0B\u79FB\uFF0C\u53CC\u51FB\u7F6E\u5E95",placement:"top"},{default:withCtx(()=>[createVNode(s,{plain:"",size:"small",icon:e.ArrowDown,type:"text",onClick:g=>e.downHandler(f.$index+1+e.pagecontext*e.pagesize-1),onDblclick:g=>e.bottomHandler(f.$index+1+e.pagecontext*e.pagesize-1)},null,8,["icon","onClick","onDblclick"])]),_:2},1024)):createCommentVNode("",!0)]),_:1})):createCommentVNode("",!0),e.selection?(openBlock(),createBlock(l,{key:2,align:"center","header-align":"center",type:"selection",width:"45"})):createCommentVNode("",!0),createVNode(l,{width:"50",label:"\u5E8F\u53F7"},{default:withCtx(f=>[createTextVNode(toDisplayString(f.$index+1+e.pagecontext*e.pagesize),1)]),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(f,g)=>{var B,S;return openBlock(),createElementBlock(Fragment,null,[f.type!=="hidden"&&e.display(f.display)?(openBlock(),createBlock(l,{prop:f.name,width:f.width,label:f.label,sortable:f.sortable,"sort-orders":["ascending","descending"],key:(S=f[((B=e.mForm)==null?void 0:B.keyProp)||"__key"])!=null?S:g,"class-name":e.config.dropSort===!0?"el-table__column--dropable":""},{default:withCtx(h=>[h.$index>-1?(openBlock(),createBlock(d,{key:0,labelWidth:"0",prop:e.getProp(h.$index),rules:f.rules,config:e.makeConfig(f),model:h.row,size:e.size,onChange:t[0]||(t[0]=k=>e.$emit("change",e.model[e.modelName]))},null,8,["prop","rules","config","model","size"])):createCommentVNode("",!0)]),_:2},1032,["prop","width","label","sortable","class-name"])):createCommentVNode("",!0)],64)}),256))]),_:1},8,["data","border","max-height","onSelect","onSortChange"])):createCommentVNode("",!0)]),_:1},8,["disabled"]),renderSlot(e.$slots,"default"),e.addable?(openBlock(),createBlock(s,{key:0,size:"small",type:"primary",plain:"",onClick:t[1]||(t[1]=f=>e.newHandler())},{default:withCtx(()=>[_hoisted_4$2]),_:1})):createCommentVNode("",!0),_hoisted_5$1,e.enableToggleMode&&!e.isFullscreen?(openBlock(),createBlock(s,{key:1,icon:"el-icon-s-grid",size:"small",onClick:e.toggleMode},{default:withCtx(()=>[_hoisted_6]),_:1},8,["onClick"])):createCommentVNode("",!0),e.config.enableFullscreen!==!1?(openBlock(),createBlock(s,{key:2,icon:"el-icon-s-grid",size:"small",onClick:e.toggleFullscreen},{default:withCtx(()=>[createTextVNode(toDisplayString(e.isFullscreen?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F\u7F16\u8F91"),1)]),_:1},8,["onClick"])):createCommentVNode("",!0),e.importable?(openBlock(),createBlock(u,{key:3,ref:"excelBtn",action:"/noop","on-change":e.excelHandler,"auto-upload":!1,style:{display:"inline-block"}},{default:withCtx(()=>[createVNode(s,{size:"small",type:"success",plain:""},{default:withCtx(()=>[_hoisted_7]),_:1})]),_:1},8,["on-change"])):createCommentVNode("",!0),_hoisted_8,e.importable?(openBlock(),createBlock(s,{key:4,size:"small",type:"warning",plain:"",onClick:t[2]||(t[2]=f=>e.clearHandler())},{default:withCtx(()=>[_hoisted_9]),_:1})):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_10,[createVNode(m,{layout:"total, sizes, prev, pager, next, jumper","hide-on-single-page":e.model[e.modelName].length<e.pagesize,"current-page":e.pagecontext+1,"page-sizes":[e.pagesize,60,120,300],"page-size":e.pagesize,total:e.model[e.modelName].length,onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["hide-on-single-page","current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"])])],2)}var Table$1=_export_sfc(_sfc_main$u,[["render",_sfc_render$p]]);const getActive=(e,t,o)=>{const{config:n,model:a,prop:i}=t,{active:l}=n;return typeof l=="function"?l(e,{model:a,formValue:e==null?void 0:e.values,prop:i}):+o>=t.config.items.length?"0":typeof l!="undefined"?l:"0"},tabClickHandler=(e,t,o)=>{const{config:n,model:a,prop:i}=o;typeof n.onTabClick=="function"&&n.onTabClick(e,t,{model:a,formValue:e==null?void 0:e.values,prop:i});const l=n.items.find(s=>t.name===s.status);l&&typeof l.onTabClick=="function"&&l.onTabClick(e,t,{model:a,formValue:e==null?void 0:e.values,prop:i})},Tab=defineComponent({name:"m-form-tab",props:{labelWidth:String,expandMore:Boolean,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,size:String},emits:{change(e){return e}},setup(e,{emit:t}){const o=inject("mForm"),n=ref(getActive(o,e,"")),a=computed(()=>{if(e.config.dynamic){if(!e.config.name)throw new Error("dynamic tab \u5FC5\u987B\u914D\u7F6Ename");return e.model[e.config.name]||[]}return e.config.items}),i=l=>filterFunction(o,l,e);return watchEffect(()=>{typeof e.config.activeChange=="function"&&e.config.activeChange(o,n.value,{model:e.model,prop:e.prop})}),{mForm:o,activeTabName:n,tabs:a,filter:i,tabItems:l=>e.config.dynamic?e.config.items:l.items,tabClickHandler:l=>tabClickHandler(o,l,e),onTabAdd:()=>{if(!e.config.name)throw new Error("dynamic tab \u5FC5\u987B\u914D\u7F6Ename");if(typeof e.config.onTabAdd=="function")e.config.onTabAdd(o,{model:e.model});else if(a.value.length>0){const l=cloneDeep(a.value[0]);l.title=`\u6807\u7B7E${a.value.length+1}`,e.model[e.config.name].push(l)}t("change",e.model),o==null||o.$emit("field-change",e.prop,e.model[e.config.name])},onTabRemove:l=>{if(!e.config.name)throw new Error("dynamic tab \u5FC5\u987B\u914D\u7F6Ename");typeof e.config.onTabRemove=="function"?e.config.onTabRemove(o,l,{model:e.model}):(e.model[e.config.name].splice(+l,1),(l<n.value||n.value>=e.model[e.config.name].length)&&(n.value=(+n.value-1).toString(),tabClickHandler(o,{name:n.value},e))),t("change",e.model),o==null||o.$emit("field-change",e.prop,e.model[e.config.name])},display:l=>display(o,l,e),changeHandler:()=>{t("change",e.model),typeof e.config.onChange=="function"&&e.config.onChange(o,{model:e.model})}}}}),_sfc_main$t=Tab;function _sfc_render$o(e,t,o,n,a,i){const l=resolveComponent("m-form-container"),s=resolveComponent("el-tab-pane"),r=resolveComponent("el-tabs");return openBlock(),createBlock(r,{modelValue:e.activeTabName,"onUpdate:modelValue":t[0]||(t[0]=d=>e.activeTabName=d),class:normalizeClass(e.config.dynamic?"magic-form-dynamic-tab":"magic-form-tab"),type:e.config.tabType,editable:e.config.editable||!1,"tab-position":e.config.tabPosition||"top",onTabClick:e.tabClickHandler,onTabAdd:e.onTabAdd,onTabRemove:e.onTabRemove},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tabs,(d,c)=>{var u,m;return openBlock(),createElementBlock(Fragment,null,[e.display(d.display)&&e.tabItems(d).length?(openBlock(),createBlock(s,{key:(m=d[((u=e.mForm)==null?void 0:u.keyProp)||"__key"])!=null?m:c,name:e.filter(d.status)||c.toString(),label:e.filter(d.title),lazy:d.lazy||!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tabItems(d),f=>{var g;return openBlock(),createBlock(l,{key:f[((g=e.mForm)==null?void 0:g.keyProp)||"__key"],config:f,model:e.config.dynamic?e.model[e.config.name||""][c]:d.name?e.model[d.name]:e.model,prop:e.config.dynamic?`${e.prop}${e.prop?".":""}${String(c)}`:e.prop,size:e.size,"label-width":d.labelWidth||e.labelWidth,"expand-more":e.expandMore,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","expand-more","onChange"])}),128))]),_:2},1032,["name","label","lazy"])):createCommentVNode("",!0)],64)}),256))]),_:1},8,["modelValue","class","type","editable","tab-position","onTabClick","onTabAdd","onTabRemove"])}var Tabs=_export_sfc(_sfc_main$t,[["render",_sfc_render$o]]);let $MAGIC_FORM={};const setConfig=e=>{$MAGIC_FORM=e},getConfig=e=>$MAGIC_FORM[e];var fieldProps={model:{type:Object,required:!0,default:()=>({})},name:{type:String,default:""},disabled:{type:Boolean,default:!1},size:String,prop:String,initValues:Object,values:Object};const useAddField=e=>{if(!e)return;const t=inject("mForm"),o=getCurrentInstance();watch(()=>o==null?void 0:o.proxy,n=>{n?t==null||t.setField(e,n):t==null||t.deleteField(e)},{immediate:!0})},_sfc_main$s=defineComponent({name:"m-fields-cascader",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=getCurrentInstance();useAddField(e.prop);const a=getConfig("request"),i=ref(null),l=ref(null),s=Array.isArray(e.config.options)?ref(e.config.options):ref([]),r=ref(null),d=async function(){const{config:u}=e,{option:m}=u;if(!m)return;let{body:f}=m;const g={url:m.url,cache:m.cache,timeout:m.timeout,data:{}};f&&o&&(typeof f=="function"&&e.model&&o&&(f=f(o,{model:e.model,formValue:null,formValues:o.values})),g.data=f);const B=await a(g);r.value=B[m.root],r.value&&typeof(m==null?void 0:m.item)=="function"&&(s.value=m.item(B[m.root]))};typeof e.config.options=="function"&&e.model&&o?watchEffect(()=>s.value=e.config.options(n,{model:e.model,formValues:o.values})):(!e.config.options||!e.config.options.length||e.config.remote)&&Promise.resolve(d());const c=computed(()=>{var u;return((u=e.config.add)==null?void 0:u.action.method)==="post"?m=>{var f,g;return a($($({},(g=(f=e.config)==null?void 0:f.add)==null?void 0:g.action.body),m))}:null});return{options:s,remoteData:r,addButtonStyle:{top:0,left:0,width:"auto"},dialogVisible:!1,cascader:i,dialog:l,action:c,setRemoteOptions:d,changeHandler:u=>{!i.value||(i.value.query="",i.value.previousQuery=null,t("change",u))},addHandler:()=>{!l.value||(l.value.dialogVisible=!0)},editAfterAction:()=>{d()}}}}),_hoisted_1$e={class:"m-cascader",style:{width:"100%"}};function _sfc_render$n(e,t,o,n,a,i){const l=resolveComponent("el-cascader");return openBlock(),createElementBlock("div",_hoisted_1$e,[createVNode(l,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),ref:"cascader",style:{width:"100%"},clearable:"",filterable:"",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,options:e.options,props:{multiple:e.config.multiple},onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","options","props","onChange"])])}var Cascader=_export_sfc(_sfc_main$s,[["render",_sfc_render$n]]);const _sfc_main$r=defineComponent({name:"m-fields-checkbox",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){return useAddField(e.prop),{activeValue:computed(()=>{if(typeof e.config.activeValue=="undefined"){if(e.config.filter==="number")return 1}else return e.config.activeValue;return"true"}),inactiveValue:computed(()=>{if(typeof e.config.inactiveValue=="undefined"){if(e.config.filter==="number")return 0}else return e.config.inactiveValue;return"false"}),changeHandler(o){t("change",o)}}}});function _sfc_render$m(e,t,o,n,a,i){const l=resolveComponent("el-checkbox");return openBlock(),createBlock(l,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),size:e.size,trueLabel:e.activeValue,falseLabel:e.inactiveValue,disabled:e.disabled,label:e.config.text,onChange:e.changeHandler},null,8,["modelValue","size","trueLabel","falseLabel","disabled","label","onChange"])}var Checkbox=_export_sfc(_sfc_main$r,[["render",_sfc_render$m]]);const _sfc_main$q=defineComponent({name:"m-fields-checkbox-group",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){return useAddField(e.prop),e.model&&!e.model[e.name]&&(e.model[e.name]=[]),{changeHandler:o=>{t("change",o)}}}});function _sfc_render$l(e,t,o,n,a,i){const l=resolveComponent("el-checkbox"),s=resolveComponent("el-checkbox-group");return openBlock(),createBlock(s,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),size:e.size,disabled:e.disabled,onChange:e.changeHandler},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.options,r=>(openBlock(),createBlock(l,{label:r.value,key:r.value},{default:withCtx(()=>[createTextVNode(toDisplayString(r.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","size","disabled","onChange"])}var CheckboxGroup=_export_sfc(_sfc_main$q,[["render",_sfc_render$l]]);const _hoisted_1$d={key:0},__default__$2=defineComponent({name:"m-fields-color-picker"}),_sfc_main$p=defineComponent(V($({},__default__$2),{props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const n=a=>t("change",a);return(a,i)=>{const l=resolveComponent("el-color-picker");return a.model?(openBlock(),createElementBlock("div",_hoisted_1$d,[createVNode(l,{modelValue:a.model[a.name],"onUpdate:modelValue":i[0]||(i[0]=s=>a.model[a.name]=s),size:a.size,disabled:a.disabled,showAlpha:!0,onChange:n},null,8,["modelValue","size","disabled"])])):createCommentVNode("",!0)}}})),_sfc_main$o=defineComponent({name:"m-fields-date",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){useAddField(e.prop);const o=computed(()=>e.prop||e.config.name||"");return e.model[o.value]=datetimeFormatter(e.model[o.value],""),{modelName:o,changeHandler(n){t("change",n)}}}}),_hoisted_1$c={key:0};function _sfc_render$k(e,t,o,n,a,i){const l=resolveComponent("el-date-picker");return e.model?(openBlock(),createElementBlock("div",_hoisted_1$c,[createVNode(l,{modelValue:e.model[e.modelName],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.modelName]=s),type:"date",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,format:e.config.format,"value-format":e.config.format||"YYYY-MM-DD HH:mm:ss",onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","format","value-format","onChange"])])):createCommentVNode("",!0)}var Date$1=_export_sfc(_sfc_main$o,[["render",_sfc_render$k]]);const _sfc_main$n=defineComponent({name:"m-fields-daterange",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const{names:o}=e.config,n=ref([]);e.model!==void 0&&((o==null?void 0:o.length)?n.value=o.map(i=>{var l;return datetimeFormatter((l=e.model)==null?void 0:l[i],"")}):e.name&&e.model[e.name]&&(n.value=e.model[e.name].map(i=>datetimeFormatter(i,""))));const a=i=>{(o==null?void 0:o.length)&&i instanceof Array?o.forEach((l,s)=>{e.model&&(e.model[l]=datetimeFormatter(i[s].toString(),""))}):e.model&&e.name&&i instanceof Date&&(e.model[e.name]=datetimeFormatter(i.toString(),""))};return{value:n,changeHandler(i){a(i),t("change",i)}}}});function _sfc_render$j(e,t,o,n,a,i){const l=resolveComponent("el-date-picker");return openBlock(),createElementBlock("div",null,[createVNode(l,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value=s),type:"datetimerange","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",size:e.size,"unlink-panels":!0,disabled:e.disabled,onChange:e.changeHandler},null,8,["modelValue","size","disabled","onChange"])])}var Daterange=_export_sfc(_sfc_main$n,[["render",_sfc_render$j]]);const _sfc_main$m=defineComponent({name:"m-fields-datetime",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){var n;useAddField(e.prop);const o=(n=e.model)==null?void 0:n[e.name].toString();return e.model&&(o==="Invalid Date"?e.model[e.name]="":e.model[e.name]=datetimeFormatter(e.model[e.name],"",e.config.valueFormat)),{value:o,changeHandler:a=>{t("change",a)}}}}),_hoisted_1$b={key:0};function _sfc_render$i(e,t,o,n,a,i){const l=resolveComponent("el-date-picker");return e.model?(openBlock(),createElementBlock("div",_hoisted_1$b,[createVNode(l,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),"popper-class":"magic-datetime-picker-popper",type:"datetime",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,format:e.config.format||"YYYY-MM-DD HH:mm:ss","value-format":e.config.valueFormat||"YYYY-MM-DD HH:mm:ss",onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","format","value-format","onChange"])])):createCommentVNode("",!0)}var DateTime=_export_sfc(_sfc_main$m,[["render",_sfc_render$i]]);const _hoisted_1$a={key:0},__default__$1=defineComponent({name:"m-fields-display"}),_sfc_main$l=defineComponent(V($({},__default__$1),{props:V($({},fieldProps),{config:{type:Object,required:!0}}),setup(e){const t=e,o=computed(()=>t.name||t.config.name||"");return t.config.initValue&&o.value&&t.model&&(t.model[o.value]=t.config.initValue),useAddField(t.prop),(n,a)=>n.model?(openBlock(),createElementBlock("span",_hoisted_1$a,toDisplayString(n.model[unref(o)]),1)):createCommentVNode("",!0)}})),_sfc_main$k=defineComponent({name:"m-fields-dynamic-field",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const o=getConfig("request"),n=reactive({value:{}}),a=reactive({value:{}}),i=async()=>{if(typeof e.config.returnFields!="function"||!e.model)return;const s=await e.config.returnFields(e.config,e.model,o);n.value={},a.value={},s.forEach(r=>{var c;if(typeof r!="object"||r.name===void 0)return;let d=((c=e.model)==null?void 0:c[r.name])||"";!d&&r.defaultValue!==void 0&&(d=r.defaultValue,t("change",d,r.name)),n.value[r.name]=d,a.value[r.name]=r.label||""})},l=watch(()=>{var s;return(s=e.model)==null?void 0:s[e.config.dynamicKey]},s=>{s!==""&&i()},{immediate:!0});return onBeforeUnmount(()=>{typeof l=="function"&&l()}),{request:o,fieldMap:n,fieldLabelMap:a,unwatch:l,changeFieldMap:i,inputChangeHandler:s=>{t("change",n.value[s],s)}}},methods:{init(){}}}),_hoisted_1$9={class:"m-fields-dynamic-field"};function _sfc_render$h(e,t,o,n,a,i){const l=resolveComponent("el-input"),s=resolveComponent("el-form-item"),r=resolveComponent("el-form");return openBlock(),createElementBlock("div",_hoisted_1$9,[createVNode(r,{size:"small"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(Object.keys(e.fieldMap.value),d=>(openBlock(),createBlock(s,{key:d,label:e.fieldLabelMap.value[d]},{default:withCtx(()=>[createVNode(l,{modelValue:e.fieldMap.value[d],"onUpdate:modelValue":c=>e.fieldMap.value[d]=c,placeholder:e.fieldLabelMap.value[d],onChange:c=>e.inputChangeHandler(d)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["label"]))),128))]),_:1})])}var DynamicField=_export_sfc(_sfc_main$k,[["render",_sfc_render$h]]);const __default__=defineComponent({name:"m-fields-hidden"}),_sfc_main$j=defineComponent(V($({},__default__),{props:V($({},fieldProps),{config:{type:Object,required:!0}}),setup(e){const t=e,o=computed(()=>t.name||t.config.name||"");return useAddField(t.prop),(n,a)=>n.model?withDirectives((openBlock(),createElementBlock("input",{key:0,"onUpdate:modelValue":a[0]||(a[0]=i=>n.model[unref(o)]=i),type:"hidden"},null,512)),[[vModelText,n.model[unref(o)]]]):createCommentVNode("",!0)}})),_sfc_main$i=defineComponent({name:"m-fields-link",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const o=ref({}),n=ref(),a=inject("mForm"),i=computed(()=>{var s;return typeof e.config.href=="function"&&e.model?e.config.href(e.model):e.config.href||((s=e.model)==null?void 0:s[e.name])}),l=()=>{var s;o.value=((s=e.model)==null?void 0:s[e.name])||{}};return{formValue:o,editor:n,href:i,formConfig:computed(()=>typeof e.config.form=="function"?e.config.form(a,{model:e.model||{},values:e.values||{}}):e.config.form),disable:computed(()=>typeof e.config.disabled!="undefined"?e.config.disabled:!i.value),displayText:computed(()=>typeof e.config.displayText=="function"?e.config.displayText(a,{model:e.model||{}}):e.config.displayText?e.config.displayText:"\u8DF3\u8F6C"),init:l,editHandler:()=>{l(),n.value&&(n.value.dialogVisible=!0)},action:s=>{e.model&&(e.model[e.name]=s,o.value=s,t("change",e.model[e.name])),n.value&&(n.value.dialogVisible=!1)}}}}),_hoisted_1$8=["href"],_hoisted_2$5={key:2,class:"m-fields-link"},_hoisted_3$3=createTextVNode("\u70B9\u51FB\u7F16\u8F91");function _sfc_render$g(e,t,o,n,a,i){const l=resolveComponent("el-button"),s=resolveComponent("m-form-dialog");return e.config.href&&!e.disabled?(openBlock(),createElementBlock("a",{key:0,target:"_blank",href:e.href,style:normalizeStyle(e.config.css||{})},toDisplayString(e.displayText),13,_hoisted_1$8)):e.config.href&&e.disabled?(openBlock(),createElementBlock("span",{key:1,style:normalizeStyle(e.config.disabledCss||{})},toDisplayString(e.displayText),5)):(openBlock(),createElementBlock("div",_hoisted_2$5,[createVNode(l,{type:"text",onClick:e.editHandler},{default:withCtx(()=>[_hoisted_3$3]),_:1},8,["onClick"]),createVNode(s,{ref:"editor",title:e.config.formTitle||"\u7F16\u8F91\u6269\u5C55\u914D\u7F6E",width:e.config.formWidth,values:e.formValue,config:e.formConfig,parentValues:e.values,fullscreen:e.config.fullscreen,onSubmit:e.action},null,8,["title","width","values","config","parentValues","fullscreen","onSubmit"])]))}var Link=_export_sfc(_sfc_main$i,[["render",_sfc_render$g]]);const _sfc_main$h=defineComponent({name:"m-fields-number",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){useAddField(e.prop);const o=inject("mForm");return{mForm:o,changeHandler:n=>{t("change",n)},inputHandler:n=>{t("input",n),o==null||o.$emit("field-input",e.prop,n)}}}});function _sfc_render$f(e,t,o,n,a,i){const l=resolveComponent("el-input-number");return e.model?(openBlock(),createBlock(l,{key:0,modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),clearable:"","controls-position":"right",size:e.size,max:e.config.max,min:e.config.min,step:e.config.step,placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler,onInput:e.inputHandler},null,8,["modelValue","size","max","min","step","placeholder","disabled","onChange","onInput"])):createCommentVNode("",!0)}var Number$1=_export_sfc(_sfc_main$h,[["render",_sfc_render$f]]);const _sfc_main$g=defineComponent({name:"m-fields-radio-group",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){return useAddField(e.prop),{changeHandler:o=>t("change",o)}}});function _sfc_render$e(e,t,o,n,a,i){const l=resolveComponent("el-radio"),s=resolveComponent("el-radio-group");return e.model?(openBlock(),createBlock(s,{key:0,modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),size:e.size,disabled:e.disabled,onChange:e.changeHandler},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.options,r=>(openBlock(),createBlock(l,{label:r.value,key:r.value},{default:withCtx(()=>[createTextVNode(toDisplayString(r.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","size","disabled","onChange"])):createCommentVNode("",!0)}var RadioGroup=_export_sfc(_sfc_main$g,[["render",_sfc_render$e]]);const _sfc_main$f=defineComponent({name:"m-fields-select",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){if(!e.model)throw new Error("\u4E0D\u80FD\u6CA1\u6709model");useAddField(e.prop);const o=ref(),n=inject("mForm"),a=ref([]),i=ref([]),l=ref(!1),s=ref(!1),r=ref(0),d=ref(0),c=ref(20),u=ref(""),m=ref([]),f=ref(!0),g=(b,y)=>{if(typeof y=="object"){const C=e.config.valueKey||"value";return y[C]===b[C]}return b===y},B=b=>{const{option:y}=e.config,{text:C}=y,{value:w}=y;return b.map(E=>({text:typeof C=="function"?C(E):E[C||"text"],value:typeof w=="function"?w(E):E[w||"value"]}))},S=async()=>{var M;if(!e.model)return[];if(i.value.length)return i.value;l.value=!0;let b=[];const{config:y}=e,{option:C}=y;let{body:w}=C,E={method:C.method||"POST",url:C.url,cache:C.cache,timeout:C.timeout,mode:C.mode,headers:C.headers||{},json:C.json||!1};w&&(typeof w=="function"&&(w=w(n,{model:e.model,formValue:n==null?void 0:n.values,formValues:n==null?void 0:n.values})),w.query=u.value,w.pgSize=c.value,w.pgIndex=d.value,E.data=w);const F=getConfig("request");typeof C.beforeRequest=="function"&&(E=C.beforeRequest(n,E,{model:e.model,formValue:n==null?void 0:n.values})),((M=C.method)==null?void 0:M.toLocaleLowerCase())==="jsonp"&&(E.jsonpCallback=C.jsonpCallback||"callback");let N=await F(E);typeof C.afterRequest=="function"&&(N=C.afterRequest(n,N,{model:e.model,formValue:n==null?void 0:n.values,formValues:n==null?void 0:n.values}));const D=N[C.root];N.total>0&&(r.value=N.total),m.value=m.value.concat(D),D&&(typeof C.item=="function"?b=C.item(D):D.map&&(b=B(D))),l.value=!1;const T=[];return e.config.multiple&&e.model[e.name]&&a.value.forEach(H=>{var O;((O=e.model)==null?void 0:O[e.name].includes(H.value))&&!b.find(R=>R.value===H.value)&&T.push(H)}),d.value===0?T.concat(b):a.value.concat(b)},h=async()=>{if(!e.model)return[];const b=e.model[e.name],{config:y}=e;return i.value=await S(),f.value=!1,y.group?y.multiple&&b.findIndex?i.value.filter(C=>C.options.findIndex(w=>b.find(E=>g(w.value,E))>-1)>-1):i.value.filter(C=>C.options.findIndex(w=>g(w.value,b))>-1):y.multiple&&b.findIndex?i.value.filter(C=>b.findIndex(w=>g(C.value,w))>-1):i.value.filter(C=>g(C.value,b))},k=async()=>{var T;if(!e.model)return[];const{config:b}=e,{option:y}=b;let C=[],w=y.initUrl;if(!w)return h();typeof w=="function"&&(w=await w(n,{model:e.model,formValue:n==null?void 0:n.values}));const E={method:y.method||"POST",url:w,data:{id:e.model[e.name]},mode:y.mode,headers:y.headers||{},json:y.json||!1};((T=y.method)==null?void 0:T.toLocaleLowerCase())==="jsonp"&&(E.jsonpCallback=y.jsonpCallback||"callback");let D=(await getConfig("request")(E))[y.root];return D&&(Array.isArray(D)||(D=[D]),typeof y.item=="function"?C=y.item(D):D.map&&(C=B(D))),C};return typeof e.config.options=="function"?watch(()=>n==null?void 0:n.values,()=>{typeof e.config.options=="function"&&Promise.resolve(e.config.options(n,{model:e.model,formValues:n==null?void 0:n.values,formValue:n==null?void 0:n.values})).then(b=>{a.value=b})},{deep:!0,immediate:!0}):Array.isArray(e.config.options)?watch(()=>e.config.options,()=>{a.value=e.config.options},{immediate:!0}):e.config.option&&onBeforeMount(()=>{if(!e.model)return;const b=e.model[e.name];(Array.isArray(b)?b.length:b)&&k().then(y=>{a.value=y})}),e.config.remote&&onMounted(()=>{var b;(b=o.value)==null||b.scrollbar.wrap$.addEventListener("scroll",async y=>{const C=y.currentTarget;s.value||C.scrollHeight-C.clientHeight-C.scrollTop>1||r.value<=a.value.length||(s.value=!0,d.value+=1,a.value=await S(),s.value=!1)})}),{select:o,loading:l,remote:f,options:a,moreLoadingVisible:s,getRequestFuc(){return getConfig("request")},async getInitOption(){},changeHandler(b){t("change",b)},async visibleHandler(b){var y;!b||!e.config.remote||(u.value&&o.value?(o.value.query=u.value,o.value.previousQuery=u.value,o.value.selectedLabel=u.value):a.value.length<=(e.config.multiple?(y=e.model)==null?void 0:y[e.name].length:1)&&(a.value=await S()))},async editAfterAction(){d.value=0,a.value=await S()},async remoteMethod(b){i.value.length||(u.value=b,d.value=0,a.value=await S(),e.config.multiple&&setTimeout(()=>{var y;(y=o.value)==null||y.setSelected()},0))}}}}),_hoisted_1$7={key:2};function _sfc_render$d(e,t,o,n,a,i){const l=resolveComponent("el-option"),s=resolveComponent("el-option-group"),r=resolveComponent("el-select"),d=resolveDirective("loading");return e.model?withDirectives((openBlock(),createBlock(r,{key:0,modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=c=>e.model[e.name]=c),class:"m-select",ref:"select",clearable:"",filterable:"",size:e.size,remote:e.remote,placeholder:e.config.placeholder,multiple:e.config.multiple,"value-key":e.config.valueKey||"value","allow-create":e.config.allowCreate,disabled:e.disabled,"remote-method":e.remoteMethod,onChange:e.changeHandler,onVisibleChange:e.visibleHandler},{default:withCtx(()=>[e.config.group?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.options,(c,u)=>(openBlock(),createBlock(s,{key:c.label+u,label:c.label,disabled:c.disabled},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.options,(m,f)=>(openBlock(),createBlock(l,{key:m.label+f,label:m.label,value:m.value,disabled:m.disabled},null,8,["label","value","disabled"]))),128))]),_:2},1032,["label","disabled"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(e.options,c=>(openBlock(),createBlock(l,{label:c.text,value:c.value,key:e.config.valueKey?c.value[e.config.valueKey]:c.value,disabled:c.disabled},null,8,["label","value","disabled"]))),128)),e.moreLoadingVisible?withDirectives((openBlock(),createElementBlock("div",_hoisted_1$7,null,512)),[[d,!0]]):createCommentVNode("",!0)]),_:1},8,["modelValue","size","remote","placeholder","multiple","value-key","allow-create","disabled","remote-method","onChange","onVisibleChange"])),[[d,e.loading]]):createCommentVNode("",!0)}var Select=_export_sfc(_sfc_main$f,[["render",_sfc_render$d]]);const _sfc_main$e=defineComponent({name:"m-fields-switch",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){return useAddField(e.prop),{n:computed(()=>e.name||e.config.name||""),activeValue:computed(()=>{if(typeof e.config.activeValue=="undefined"){if(e.config.filter==="number")return 1}else return e.config.activeValue;return!0}),inactiveValue:computed(()=>{if(typeof e.config.inactiveValue=="undefined"){if(e.config.filter==="number")return 0}else return e.config.inactiveValue;return!1}),changeHandler:o=>{t("change",o)}}}});function _sfc_render$c(e,t,o,n,a,i){const l=resolveComponent("el-switch");return e.model?(openBlock(),createBlock(l,{key:0,modelValue:e.model[e.n],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.n]=s),size:e.size,activeValue:e.activeValue,inactiveValue:e.inactiveValue,disabled:e.disabled,onChange:e.changeHandler},null,8,["modelValue","size","activeValue","inactiveValue","disabled","onChange"])):createCommentVNode("",!0)}var Switch=_export_sfc(_sfc_main$e,[["render",_sfc_render$c]]);const _sfc_main$d=defineComponent({name:"m-fields-text",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){useAddField(e.prop);const o=computed(()=>e.name||e.config.name||"");return{modelName:o,changeHandler(n){t("change",n)},inputHandler(n){const a=inject("mForm");t("input",n),a==null||a.$emit("field-input",e.prop,n)},buttonClickHandler(){var a;const n=inject("mForm");typeof e.config.append!="string"&&((a=e.config.append)==null?void 0:a.handler)&&e.config.append.handler(n,{model:e.model,values:n==null?void 0:n.values})},keyUpHandler(n){if(!e.model||!o.value)return;const a=n.key==="ArrowUp",i=n.key==="ArrowDown";if(!a&&!i)return;const l=e.model[o.value];let s,r;if(/^([0-9.]+)$/.test(l)?s=+l:l.replace(/^([0-9.]+)([a-z%]+)$/,(m,f,g)=>{s=+f,r=g}),s===void 0)return;const d=navigator.platform.match("Mac")?n.metaKey:n.ctrlKey,c=n.shiftKey,u=n.altKey;a?d?s+=100:u?s=(s*1e4+1e3)/1e4:c?s=s+10:s+=1:i&&(d?s-=100:u?s=(s*1e4-1e3)/1e4:c?s-=10:s-=1),e.model[o.value]=`${s}${r||""}`,t("change",e.model[o.value])}}}}),_hoisted_1$6={key:0};function _sfc_render$b(e,t,o,n,a,i){const l=resolveComponent("el-button"),s=resolveComponent("el-input");return openBlock(),createBlock(s,{modelValue:e.model[e.modelName],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.modelName]=r),clearable:"",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler,onInput:e.inputHandler,onKeyup:t[1]||(t[1]=r=>e.keyUpHandler(r))},createSlots({_:2},[e.config.append?{name:"append",fn:withCtx(()=>[typeof e.config.append=="string"?(openBlock(),createElementBlock("span",_hoisted_1$6,toDisplayString(e.config.append),1)):createCommentVNode("",!0),typeof e.config.append=="object"&&e.config.append.type==="button"?(openBlock(),createBlock(l,{key:1,style:{color:"#409eff"},onClick:e.buttonClickHandler},{default:withCtx(()=>[createTextVNode(toDisplayString(e.config.append.text),1)]),_:1},8,["onClick"])):createCommentVNode("",!0)])}:void 0]),1032,["modelValue","size","placeholder","disabled","onChange","onInput"])}var Text=_export_sfc(_sfc_main$d,[["render",_sfc_render$b]]);const _sfc_main$c=defineComponent({name:"m-fields-textarea",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:{change(e){return e},input(e){return e}},setup(e,{emit:t}){useAddField(e.prop);const o=inject("mForm");return{mForm:o,changeHandler:n=>{t("change",n)},inputHandler:n=>{t("input",n),o==null||o.$emit("field-input",e.prop,n)}}}}),_hoisted_1$5={key:0};function _sfc_render$a(e,t,o,n,a,i){const l=resolveComponent("el-input");return e.model?(openBlock(),createElementBlock("div",_hoisted_1$5,[createVNode(l,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),type:"textarea",size:e.size,clearable:"",placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler,onInput:e.inputHandler},null,8,["modelValue","size","placeholder","disabled","onChange","onInput"])])):createCommentVNode("",!0)}var Textarea=_export_sfc(_sfc_main$c,[["render",_sfc_render$a]]);const _sfc_main$b=defineComponent({name:"m-fields-time",props:V($({},fieldProps),{config:{type:Object,required:!0}}),emits:{change(e){return e}},setup(e,{emit:t}){return useAddField(e.prop),{changeHandler:o=>{t("change",o)}}}});function _sfc_render$9(e,t,o,n,a,i){const l=resolveComponent("el-time-picker");return openBlock(),createElementBlock("div",null,[createVNode(l,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),size:e.size,"value-format":"HH:mm:ss",placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","onChange"])])}var Time=_export_sfc(_sfc_main$b,[["render",_sfc_render$9]]);const _sfc_main$a=defineComponent({name:"m-form",components:{ElForm,MContainer:Container},props:{initValues:{type:Object,required:!0,default:()=>({})},parentValues:{type:Object,default:()=>({})},config:{type:Array,required:!0,default:()=>[]},labelWidth:{type:String,default:()=>"200px"},disabled:{type:Boolean,default:()=>!1},height:{type:String,default:()=>"auto"},stepActive:{type:[String,Number],default:()=>1},size:{type:String,default:"small"},inline:{type:Boolean,default:!1},labelPosition:{type:String,default:"right"},keyProp:{type:String,default:"__key"}},emits:["change","field-input","field-change"],setup(e,{emit:t}){const o=ref(),n=ref(!1),a=ref({}),i=new Map,l=getConfig("request"),s=reactive({keyProp:e.keyProp,config:e.config,initValues:e.initValues,parentValues:e.parentValues,values:a,$emit:t,fields:i,setField:(r,d)=>i.set(r,d),getField:r=>i.get(r),deleteField:r=>i.delete(r),post:r=>{if(l)return l(V($({},r),{method:"POST"}))}});return provide("mForm",s),watchEffect(()=>{n.value=!1,initValue(s,{initValues:e.initValues,config:e.config}).then(r=>{a.value=r,n.value=!0})}),{initialized:n,values:a,elForm:o,formState:s,changeHandler:()=>{t("change",a.value)},resetForm:()=>{var r;return(r=o.value)==null?void 0:r.resetFields()},submitForm:async r=>{var d;try{return await((d=o.value)==null?void 0:d.validate()),r?a.value:cloneDeep(a.value)}catch(c){const u=[];throw Object.entries(c).forEach(([,m])=>{m.forEach(({field:f,message:g})=>{f&&g&&u.push(`${f} -> ${g}`),f&&!g&&u.push(`${f} -> \u51FA\u73B0\u9519\u8BEF`),!f&&g&&u.push(`${g}`)})}),new Error(u.join("<br>"))}}}}});function _sfc_render$8(e,t,o,n,a,i){const l=resolveComponent("MContainer"),s=resolveComponent("ElForm");return e.initialized&&Array.isArray(e.config)?(openBlock(),createBlock(s,{key:0,class:"m-form",ref:"elForm",model:e.values,"label-width":e.labelWidth,disabled:e.disabled,style:normalizeStyle(`height: ${e.height}`),inline:e.inline,"label-position":e.labelPosition},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config,(r,d)=>{var c;return openBlock(),createBlock(l,{key:(c=r[e.keyProp])!=null?c:d,config:r,model:e.values,"label-width":r.labelWidth||e.labelWidth,"step-active":e.stepActive,size:e.size,onChange:e.changeHandler},null,8,["config","model","label-width","step-active","size","onChange"])}),128))]),_:1},8,["model","label-width","disabled","style","inline","label-position"])):createCommentVNode("",!0)}var MForm=_export_sfc(_sfc_main$a,[["render",_sfc_render$8]]);const _sfc_main$9=defineComponent({name:"m-form-dialog",props:{values:{type:Object,default:()=>({})},width:[Number,String],fullscreen:Boolean,title:String,config:{type:Array,required:!0,default:()=>[]},labelWidth:[Number,String],confirmText:{type:String,default:"\u786E\u5B9A"}},emits:["close","submit","error","change"],setup(e,{emit:t}){const o=ref(),n=ref(!1),a=ref(!1),i=ref(1),l=ref(`${document.body.clientHeight-194}px`),s=computed(()=>{const{length:B}=e.config;for(let S=0;S<B;S++)if(e.config[S].type==="step")return e.config[S].items.length;return 0}),r=computed(()=>{const{length:B}=e.config;for(let S=0;S<B;S++)if(e.config[S].type==="step")return!0;return!1});return{form:o,saveFetch:a,stepActive:i,dialogVisible:n,bodyHeight:l,stepCount:s,hasStep:r,cancel:()=>{n.value=!1},closeHandler:()=>{i.value=1,t("close")},save:async()=>{var B;try{const S=await((B=o.value)==null?void 0:B.submitForm());t("submit",S)}catch(S){t("error",S)}},preStep:()=>{i.value-=1},nextStep:()=>{i.value+=1},changeHandler:B=>{t("change",B)}}}}),_hoisted_1$4={style:{"min-height":"1px"}},_hoisted_2$4=createTextVNode("\u53D6 \u6D88"),_hoisted_3$2=createTextVNode("\u4E0A\u4E00\u6B65"),_hoisted_4$1=createTextVNode("\u4E0B\u4E00\u6B65");function _sfc_render$7(e,t,o,n,a,i){const l=resolveComponent("m-form"),s=resolveComponent("el-col"),r=resolveComponent("el-button"),d=resolveComponent("el-row"),c=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",null,[createVNode(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=u=>e.dialogVisible=u),"custom-class":"m-form-dialog",top:"20px",title:e.title,appendToBody:!0,width:e.width,fullscreen:e.fullscreen,"close-on-click-modal":!1,onClose:e.closeHandler},{footer:withCtx(()=>[createVNode(d,{class:"dialog-footer"},{default:withCtx(()=>[createVNode(s,{span:12,style:{"text-align":"left"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$4,[renderSlot(e.$slots,"left")])]),_:3}),createVNode(s,{span:12},{default:withCtx(()=>[renderSlot(e.$slots,"footer",{},()=>[createVNode(r,{onClick:e.cancel,size:"small"},{default:withCtx(()=>[_hoisted_2$4]),_:1},8,["onClick"]),e.hasStep&&e.stepActive>1?(openBlock(),createBlock(r,{key:0,type:"info",size:"small",onClick:e.preStep},{default:withCtx(()=>[_hoisted_3$2]),_:1},8,["onClick"])):createCommentVNode("",!0),e.hasStep&&e.stepCount>e.stepActive?(openBlock(),createBlock(r,{key:1,type:"info",size:"small",onClick:e.nextStep},{default:withCtx(()=>[_hoisted_4$1]),_:1},8,["onClick"])):(openBlock(),createBlock(r,{key:2,type:"primary",size:"small",loading:e.saveFetch,onClick:e.save},{default:withCtx(()=>[createTextVNode(toDisplayString(e.confirmText),1)]),_:1},8,["loading","onClick"]))])]),_:3})]),_:3})]),default:withCtx(()=>[createBaseVNode("div",{class:"m-dialog-body",style:normalizeStyle(`max-height: ${e.bodyHeight}; overflow-y: auto; overflow-x: hidden;`)},[createVNode(l,{modelValue:e.stepActive,"onUpdate:modelValue":t[0]||(t[0]=u=>e.stepActive=u),ref:"form",config:e.config,"init-values":e.values,"label-width":e.labelWidth,onChange:e.changeHandler},null,8,["modelValue","config","init-values","label-width","onChange"]),renderSlot(e.$slots,"default")],4)]),_:3},8,["modelValue","title","width","fullscreen","onClose"])])}var FormDialog=_export_sfc(_sfc_main$9,[["render",_sfc_render$7]]),index$1="";const defaultInstallOpt={},install=(e,t)=>{const o=Object.assign(defaultInstallOpt,t);e.config.globalProperties.$MAGIC_FORM=o,setConfig(o),e.component(MForm.name,MForm),e.component(FormDialog.name,FormDialog),e.component(Container.name,Container),e.component(Fieldset.name,Fieldset),e.component(GroupList.name,GroupList),e.component(Panel.name,Panel),e.component(Row.name,Row),e.component(MStep.name,MStep),e.component(Table$1.name,Table$1),e.component(Tabs.name,Tabs),e.component(Text.name,Text),e.component(Number$1.name,Number$1),e.component(Textarea.name,Textarea),e.component(_sfc_main$j.name,_sfc_main$j),e.component(Date$1.name,Date$1),e.component(DateTime.name,DateTime),e.component(Time.name,Time),e.component(Checkbox.name,Checkbox),e.component(Switch.name,Switch),e.component(Daterange.name,Daterange),e.component(_sfc_main$p.name,_sfc_main$p),e.component(CheckboxGroup.name,CheckboxGroup),e.component(RadioGroup.name,RadioGroup),e.component(_sfc_main$l.name,_sfc_main$l),e.component(Link.name,Link),e.component(Select.name,Select),e.component(Cascader.name,Cascader),e.component(DynamicField.name,DynamicField)};var MagicForm={install};const _hoisted_1$3=createTextVNode("\u4FDD\u5B58"),_hoisted_2$3=createTextVNode("\u53D6\u6D88"),_sfc_main$8=defineComponent({props:{columns:{type:Array,require:!0,default:()=>[]},config:{type:Object,require:!0,default:()=>{}},rowkeyName:{type:String,default:"c_id"},editState:{type:Object,default:()=>{}}},emits:["afterAction"],setup(e,{emit:t}){const o=e,n=(c,u)=>typeof c=="function"?c.call(this,this,u):!0,a=(c,u)=>{var m;ElMessage.success(c),(m=u.after)==null||m.call(u)},i=c=>ElMessage.error(c),l=async(c,u)=>{var f;await ElMessageBox.confirm(`\u786E\u8BA4\u5220\u9664${u[c.name||"c_name"]}(${u[o.rowkeyName]})?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"});const m=await((f=c.handler)==null?void 0:f.call(c,u));m.ret===0?a("\u5220\u9664\u6210\u529F!",c):i(m.msg||"\u5220\u9664\u5931\u8D25")},s=async(c,u)=>{var m;await ElMessageBox.confirm(`\u786E\u5B9A\u590D\u5236${u[c.name||"c_name"]}(${u.c_id})?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"});try{const f=await((m=c.handler)==null?void 0:m.call(c,u));f.ret===0?a("\u590D\u5236\u6210\u529F!",c):i(`\u590D\u5236\u5931\u8D25!${f.msg}`)}catch{i("\u590D\u5236\u5931\u8D25!")}},r=async(c,u,m)=>{var f,g;c.type==="delete"?await l(c,u):c.type==="copy"?await s(c,u):c.type==="edit"?o.editState[m]=u:(await((f=c.handler)==null?void 0:f.call(c,u)),(g=c.after)==null||g.call(c))},d=async(c,u)=>{var S,h;const m=(h=(S=u.actions)==null?void 0:S.find(k=>k.type==="edit"))==null?void 0:h.action;if(!m)return;const f={},g=o.editState[c];o.columns.filter(k=>k.type).forEach(k=>{f[k.prop]=g[k.prop]});const B=await m({data:f});B?B.ret===0?(ElMessage.success("\u4FDD\u5B58\u6210\u529F"),o.editState[c]=void 0,t("afterAction")):ElMessage.error({duration:1e4,showClose:!0,dangerouslyUseHTMLString:!0,message:B.msg||"\u4FDD\u5B58\u5931\u8D25"}):(o.editState[c]=void 0,t("afterAction"))};return(c,u)=>{const m=resolveComponent("el-button"),f=resolveComponent("el-table-column");return openBlock(),createBlock(f,{label:e.config.label,width:e.config.width,fixed:e.config.fixed},{default:withCtx(g=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.actions,(B,S)=>withDirectives((openBlock(),createBlock(m,{innerHTML:B.text,class:"action-btn",type:"text",size:"small",key:S,onClick:h=>r(B,g.row,g.$index)},null,8,["innerHTML","onClick"])),[[vShow,n(B.display,g.row)&&!e.editState[g.$index]]])),128)),withDirectives(createVNode(m,{class:"action-btn",type:"text",size:"small",onClick:B=>d(g.$index,e.config)},{default:withCtx(()=>[_hoisted_1$3]),_:2},1032,["onClick"]),[[vShow,e.editState[g.$index]]]),withDirectives(createVNode(m,{class:"action-btn",type:"text",size:"small",onClick:B=>e.editState[g.$index]=void 0},{default:withCtx(()=>[_hoisted_2$3]),_:2},1032,["onClick"]),[[vShow,e.editState[g.$index]]])]),_:1},8,["label","width","fixed"])}}}),_sfc_main$7=defineComponent({components:{MForm},props:{config:{type:Object,default:()=>({}),required:!0}}});function _sfc_render$6(e,t,o,n,a,i){const l=resolveComponent("m-table"),s=resolveComponent("m-form"),r=resolveComponent("el-table-column");return openBlock(),createBlock(r,{type:"expand"},{default:withCtx(d=>[e.config.table?(openBlock(),createBlock(l,{key:0,"show-header":!1,columns:e.config.table,data:d.row[e.config.prop]},null,8,["columns","data"])):createCommentVNode("",!0),e.config.form?(openBlock(),createBlock(s,{key:1,config:e.config.form,"init-values":e.config.values||d.row[e.config.prop]||{}},null,8,["config","init-values"])):createCommentVNode("",!0)]),_:1})}var ExpandColumn=_export_sfc(_sfc_main$7,[["render",_sfc_render$6]]);const formatter=(e,t)=>{if(e.formatter){e.formatter==="datetime"&&(e.formatter=o=>datetimeFormatter(o));try{return e.formatter(t[e.prop],t)}catch{return t[e.prop]}}else return t[e.prop]},_sfc_main$6=defineComponent({props:{config:{type:Object,default:()=>({}),required:!0}},setup(){return{formatter}}});function _sfc_render$5(e,t,o,n,a,i){const l=resolveComponent("m-table"),s=resolveComponent("el-button"),r=resolveComponent("el-popover"),d=resolveComponent("el-table-column");return openBlock(),createBlock(d,{label:e.config.label,width:e.config.width,fixed:e.config.fixed},{default:withCtx(c=>[createVNode(r,{placement:e.config.popover.placement,width:e.config.popover.width,trigger:e.config.popover.trigger},{reference:withCtx(()=>[createVNode(s,{type:"text"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.config.text||e.formatter(e.config,c.row)),1)]),_:2},1024)]),default:withCtx(()=>[e.config.popover.tableEmbed?(openBlock(),createBlock(l,{key:0,"show-header":e.config.showHeader,columns:e.config.table,data:c.row[e.config.prop]},null,8,["show-header","columns","data"])):createCommentVNode("",!0)]),_:2},1032,["placement","width","trigger"])]),_:1},8,["label","width","fixed"])}var PopoverColumn=_export_sfc(_sfc_main$6,[["render",_sfc_render$5]]);const _sfc_main$5=defineComponent({props:{config:{type:Object,default:()=>({}),required:!0},editState:{type:Object,default:()=>{}}},setup(){return{formatter}}}),_hoisted_1$2=["href"],_hoisted_2$2=["src"],_hoisted_3$1=["href"],_hoisted_4=createTextVNode("\u6269\u5C55\u914D\u7F6E"),_hoisted_5=["innerHTML"];function _sfc_render$4(e,t,o,n,a,i){const l=resolveComponent("m-form-container"),s=resolveComponent("el-form"),r=resolveComponent("el-button"),d=resolveComponent("el-tooltip"),c=resolveComponent("el-tag"),u=resolveComponent("el-table-column");return openBlock(),createBlock(u,{"show-overflow-tooltip":"",label:e.config.label,width:e.config.width,fixed:e.config.fixed,sortable:e.config.sortable,prop:e.config.prop},{default:withCtx(m=>[e.config.type&&e.editState[m.$index]?(openBlock(),createBlock(s,{key:0,"label-width":"0",model:e.editState[m.$index]},{default:withCtx(()=>[createVNode(l,{prop:e.config.prop,rules:e.config.rules,config:e.config,name:e.config.prop,model:e.editState[m.$index]},null,8,["prop","rules","config","name","model"])]),_:2},1032,["model"])):e.config.action==="actionLink"?(openBlock(),createBlock(r,{key:1,type:"text",onClick:f=>e.config.handler(m.row)},{default:withCtx(()=>[createTextVNode(toDisplayString(e.formatter(e.config,m.row)),1)]),_:2},1032,["onClick"])):e.config.action==="img"?(openBlock(),createElementBlock("a",{key:2,target:"_blank",href:m.row[e.config.prop]},[createBaseVNode("img",{src:m.row[e.config.prop],height:"50"},null,8,_hoisted_2$2)],8,_hoisted_1$2)):e.config.action==="link"?(openBlock(),createElementBlock("a",{key:3,target:"_blank",href:m.row[e.config.prop],class:"keep-all"},toDisplayString(m.row[e.config.prop]),9,_hoisted_3$1)):e.config.action==="tip"?(openBlock(),createBlock(d,{key:4,placement:"left"},{content:withCtx(()=>[createBaseVNode("div",null,toDisplayString(e.formatter(e.config,m.row)),1)]),default:withCtx(()=>[createVNode(r,{type:"text"},{default:withCtx(()=>[_hoisted_4]),_:1})]),_:2},1024)):e.config.action==="tag"?(openBlock(),createBlock(c,{key:5,type:typeof e.config.type=="function"?e.config.type(m.row[e.config.prop],m.row):e.config.type,"close-transition":""},{default:withCtx(()=>[createTextVNode(toDisplayString(e.formatter(e.config,m.row)),1)]),_:2},1032,["type"])):(openBlock(),createElementBlock("div",{key:6,innerHTML:e.formatter(e.config,m.row)},null,8,_hoisted_5))]),_:1},8,["label","width","fixed","sortable","prop"])}var TextColumn=_export_sfc(_sfc_main$5,[["render",_sfc_render$4]]),Table_vue_vue_type_style_index_0_lang="";const _sfc_main$4=defineComponent({name:"m-table",components:{ExpandColumn,ActionsColumn:_sfc_main$8,PopoverColumn,TextColumn},props:{data:{type:Array,require:!0},columns:{type:Array,require:!0,default:()=>[]},spanMethod:{type:Function},fetch:{type:Boolean,default:!1},bodyHeight:{type:[String,Number]},showHeader:{type:Boolean},emptyText:{type:String},defaultExpandAll:{type:Boolean,default:!1},rowkeyName:{type:String},border:{type:Boolean,default:!1}},emits:["sort-change","afterAction","select","select-all","selection-change"],data(){return{editState:[]}},computed:{tableData(){return this.selectionColumn?this.data||[]:cloneDeep(this.data)||[]},selectionColumn(){const e=this.columns.filter(t=>t.selection);return e.length?e[0]:null},hasBorder(){return typeof this.border!="undefined"?this.border:!0}},methods:{sortChange(e){this.$emit("sort-change",e)},selectHandler(e,t){const o=this.selectionColumn;!o||(o.selection==="single",this.$emit("select",e,t))},selectAllHandler(e){this.$emit("select-all",e)},selectionChangeHandler(e){this.$emit("selection-change",e)},toggleRowSelection(e,t){const o=this.$refs.table;o.toggleRowSelection.bind(o)(e,t)},toggleRowExpansion(e,t){const o=this.$refs.table;o.toggleRowExpansion.bind(o)(e,t)},clearSelection(){const e=this.$refs.table;e.clearSelection.bind(e)()},objectSpanMethod(e){return typeof this.spanMethod=="function"?this.spanMethod(e):()=>({rowspan:0,colspan:0})}}});function _sfc_render$3(e,t,o,n,a,i){const l=resolveComponent("expand-column"),s=resolveComponent("el-table-column"),r=resolveComponent("actions-column"),d=resolveComponent("popover-column"),c=resolveComponent("text-column"),u=resolveComponent("el-table");return openBlock(),createBlock(u,{data:e.tableData,"show-header":e.showHeader,"max-height":e.bodyHeight,"tooltip-effect":"dark",class:"m-table",ref:"table","default-expand-all":e.defaultExpandAll,border:e.hasBorder,"row-key":e.rowkeyName||"c_id","tree-props":{children:"children"},"empty-text":e.emptyText||"\u6682\u65E0\u6570\u636E","span-method":e.objectSpanMethod,onSortChange:e.sortChange,onSelect:e.selectHandler,onSelectAll:e.selectAllHandler,onSelectionChange:e.selectionChangeHandler},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.columns,(m,f)=>(openBlock(),createElementBlock(Fragment,null,[m.type==="expand"?(openBlock(),createBlock(l,{config:m,key:f},null,8,["config"])):createCommentVNode("",!0),m.selection?(openBlock(),createBlock(s,{type:"selection",key:f,width:"40",selectable:m.selectable},null,8,["selectable"])):m.actions?(openBlock(),createBlock(r,{columns:e.columns,config:m,"rowkey-name":e.rowkeyName,"edit-state":e.editState,key:f,onAfterAction:t[0]||(t[0]=g=>e.$emit("afterAction"))},null,8,["columns","config","rowkey-name","edit-state"])):m.type==="popover"?(openBlock(),createBlock(d,{key:f,config:m},null,8,["config"])):(openBlock(),createBlock(c,{key:f,config:m,"edit-state":e.editState},null,8,["config","edit-state"]))],64))),256))]),_:1},8,["data","show-header","max-height","default-expand-all","border","row-key","empty-text","span-method","onSortChange","onSelect","onSelectAll","onSelectionChange"])}var Table=_export_sfc(_sfc_main$4,[["render",_sfc_render$3]]);const components=[Table];var MagicTable={install(e){components.forEach(t=>{e.component(t.name,t)})}},App_vue_vue_type_style_index_0_lang="";const _sfc_main$3={name:"App"};function _sfc_render$2(e,t,o,n,a,i){const l=resolveComponent("router-view");return openBlock(),createBlock(l)}var App=_export_sfc(_sfc_main$3,[["render",_sfc_render$2]]),config={id:"75f0extui9d7yksklx27hff8xg",name:"test",type:"app",items:[{type:"page",id:"page_299",name:"index",title:"",layout:"absolute",style:{position:"relative",left:0,top:0,right:"",bottom:"",width:"375",height:"1728",backgroundImage:"",backgroundColor:"rgba(248, 218, 218, 1)",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"},events:[],created:"",items:[{id:"container_3001",style:{left:0,top:175,width:375,height:100,position:"absolute"},type:"container",name:"\u7EC4",items:[{id:"button_5137",style:{left:57,top:31,width:270,height:38,position:"absolute",border:0,backgroundColor:"#fb6f00"},type:"button",name:"\u6309\u94AE",text:"\u8BF7\u8F93\u5165\u6587\u672C\u5185\u5BB9",multiple:!0}]}]}]},Editor_vue_vue_type_style_index_0_lang="";const RUNTIME_PATH="/tmagic-editor/playground/runtime/vue3",_sfc_main$2=defineComponent({name:"EditorApp",setup(){const e=ref(),t=ref(!1),o=ref(config),n=ref(config.items[0].id),a=ref({}),i=ref({}),l=ref({}),s={left:[{type:"text",text:"\u9B54\u65B9"}],center:["delete","undo","redo","guides","rule","zoom"],right:[{type:"button",text:"\u9884\u89C8",icon:Connection,handler:()=>{t.value=!0}},{type:"button",text:"\u4FDD\u5B58",icon:Coin$1,handler:r=>{localStorage.setItem("magicUiConfig",serializeJavascript(toRaw(o.value),{space:2,unsafe:!0}).replace(/"(\w+)":\s/g,"$1: ")),r==null||r.editorService.resetModifiedNodeId(),ElMessage.success("\u4FDD\u5B58\u6210\u529F")}},"/",{type:"button",icon:Document,tooltip:"\u6E90\u7801",handler:r=>r==null?void 0:r.uiService.set("showSrc",!(r==null?void 0:r.uiService.get("showSrc")))}]};return asyncLoadJs(`${RUNTIME_PATH}/assets/config.js`).then(()=>{i.value=globalThis.magicPresetConfigs}),asyncLoadJs(`${RUNTIME_PATH}/assets/value.js`).then(()=>{a.value=globalThis.magicPresetValues}),asyncLoadJs(`${RUNTIME_PATH}/assets/event.js`).then(()=>{l.value=globalThis.magicPresetEvents}),{RUNTIME_PATH,editor:e,menu:s,value:o,defaultSelected:n,propsValues:a,propsConfigs:i,eventMethodList:l,previewVisible:t,runtimeUrl:`${RUNTIME_PATH}/playground.html`,componentGroupList:ref([{title:"\u793A\u4F8B\u5BB9\u5668",items:[{icon:FolderOpened,text:"\u7EC4",type:"container"}]},{title:"\u793A\u4F8B\u7EC4\u4EF6",items:[{icon:Tickets,text:"\u6587\u672C",type:"text"},{icon:SwitchButton,text:"\u6309\u94AE",type:"button"}]}]),moveableOptions:r=>{var f,g;const d={},c=(g=(f=r==null?void 0:r.dr)==null?void 0:f.target)==null?void 0:g.id;if(!c||!e.value)return d;const u=e.value.editorService.getNodeById(c);if(!u)return d;const m=u.type==="page";return d.draggable=!m,d.resizable=!m,d}}}}),_hoisted_1$1={class:"editor-app"},_hoisted_2$1=["src"];function _sfc_render$1(e,t,o,n,a,i){const l=resolveComponent("m-editor"),s=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",_hoisted_1$1,[createVNode(l,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=r=>e.value=r),ref:"editor",menu:e.menu,"runtime-url":e.runtimeUrl,"props-configs":e.propsConfigs,"props-values":e.propsValues,"event-method-list":e.eventMethodList,"component-group-list":e.componentGroupList,"default-selected":e.defaultSelected,"moveable-options":e.moveableOptions},null,8,["modelValue","menu","runtime-url","props-configs","props-values","event-method-list","component-group-list","default-selected","moveable-options"]),createVNode(s,{modelValue:e.previewVisible,"onUpdate:modelValue":t[1]||(t[1]=r=>e.previewVisible=r),"destroy-on-close":"",width:375,"custom-class":"pre-viewer",title:"\u9884\u89C8"},{default:withCtx(()=>{var r;return[e.previewVisible?(openBlock(),createElementBlock("iframe",{key:0,width:"100%",height:"817",src:`${e.RUNTIME_PATH}/page.html?localPreview=1&page=${(r=e.editor)==null?void 0:r.editorService.get("page").id}`},null,8,_hoisted_2$1)):createCommentVNode("",!0)]}),_:1},8,["modelValue"])])}var Editor=_export_sfc(_sfc_main$2,[["render",_sfc_render$1]]);const _sfc_main$1=defineComponent({name:"App",data(){return{resultVisible:!1,result:"",config:[{text:"\u6587\u672C",name:"text",tooltip:(e,{model:t})=>t.text,extra:(e,{model:t})=>`${t.text}extra`,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}]},{type:"checkbox",text:"checkbox",name:"option",activeValue:1,inactiveValue:0,defaultValue:1},{type:"link",displayText:"\u94FE\u63A5",text:"link",name:"link",href:"",tooltip:"element-ui"},{type:"display",text:"\u5C55\u793A",name:"display",initValue:"display",tooltip:"hello"},{type:"number",text:"\u8BA1\u6570\u5668",name:"number"},{type:"textarea",text:"\u8F93\u5165\u6846",name:"textarea1"},{type:"datetime",text:"\u65E5\u671F",name:"datetime"},{type:"switch",text:"\u5F00\u5173",name:"switch",filter:"number",defaultValue:1},{type:"daterange",text:"\u65E5\u671F\u8303\u56F4",name:"daterange"},{type:"time",text:"\u65E5\u671F\u9009\u62E9",name:"time"},{type:"colorPicker",text:"\u53D6\u8272\u5668",name:"colorPicker"},{type:"checkbox-group",text:"\u9009\u9879\u7EC4",name:"checkGroup",options:[{value:1,text:"one"},{value:2,text:"two"}]},{type:"radio-group",text:"\u5355\u9009\u6846",name:"radioGroup",options:[{value:1,text:"one"},{value:2,text:"two"}]},{type:"cascader",text:"\u7EA7\u8054\u9009\u62E9",placeholder:"test",name:"cascader",options:[{value:1,label:"one",children:[{value:3,label:"three",children:[{value:8,label:"eight"}]},{value:4,label:"four"},{value:6,label:"six"}]},{value:2,label:"two",children:[{value:5,label:"five"},{value:7,label:"seven"}]}]},{type:"dynamic-field",name:"dynamic-field",dynamicKey:"textarea",text:"\u52A8\u6001\u8868\u5355",returnFields:()=>[{name:"one",label:"number",defaultValue:"yes"}]},{type:"row",items:[{type:"date",text:"\u65E5\u671F",name:"date"},{type:"checkbox",text:"\u591A\u9009\u6846",name:"checkbox",tooltip:"\u5206\u7EC4xxxxxxxxxxxx",extra:"extra"}]},{type:"fieldset",name:"fieldset",text:"\u5206\u7EC4",extra:"extra",checkbox:!0,expand:"checkbox",items:[{type:"select",text:"\u4E0B\u62C9\u9009\u9879",name:"select",options:[{text:"\u9009\u98791",value:1},{text:"\u9009\u98792",value:2}]}]},{type:"table",name:"table",defautSort:{prop:"name",order:"descending"},extra:"extra",itemExtra:(e,{model:t})=>`${t.text}itemExtra`,items:[{label:"id",name:"id",sortable:!0,tooltip:"\u5206\u7EC4xxxxxxxxxxxx",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}]},{label:"\u540D\u79F0",name:"name"}]},{type:"groupList",name:"groupList",extra:"\u5206\u7EC4xxxxxxxxxxxx",itemExtra:(e,{model:t})=>`${t.name}extra`,items:[{text:"id",name:"id",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}]},{text:"\u540D\u79F0",name:"name"}]},{type:"panel",title:"panel",extra:"panel",schematic:"https://vfiles.gtimg.cn/vupload/20210329/9712631617027075445.png",items:[{text:"\u540D\u79F0",name:"name"}]},{type:"step",items:[{name:"step1",title:"step1",items:[{text:"\u540D\u79F0",name:"name"}]},{name:"step2",title:"step2",items:[{text:"\u540D\u79F02",name:"name"}]}]}],initValue:{text:"\u6587\u672C",number:10,fieldset:{select:1},table:[{id:1,name:"a"},{id:2,name:"b"}]},tableConfig:[{label:"id",prop:"id"},{label:"name",prop:"name"}],tableData:[{id:1,name:"xx"},{id:2,name:"xx2"}]}},methods:{async submit(){try{const e=await this.$refs.form.submitForm();this.resultVisible=!0,this.result=JSON.stringify(e,null,2)}catch(e){console.error(e),ElMessage.error({duration:1e4,showClose:!0,message:e.message,dangerouslyUseHTMLString:!0})}},spanMethod({rowIndex:e,columnIndex:t}){if(t===0)return e%2===0?{rowspan:2,colspan:1}:{rowspan:0,colspan:0}}}}),_hoisted_1={style:{padding:"20px"}},_hoisted_2=createTextVNode("\u63D0\u4EA4"),_hoisted_3=["innerHTML"];function _sfc_render(e,t,o,n,a,i){const l=resolveComponent("m-form"),s=resolveComponent("el-button"),r=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(l,{ref:"form",config:e.config,"init-values":e.initValue,size:"small"},null,8,["config","init-values"]),createVNode(s,{onClick:e.submit},{default:withCtx(()=>[_hoisted_2]),_:1},8,["onClick"]),createVNode(r,{modelValue:e.resultVisible,"onUpdate:modelValue":t[0]||(t[0]=d=>e.resultVisible=d),title:"result"},{default:withCtx(()=>[createBaseVNode("pre",null,[createBaseVNode("code",{class:"language-javascript hljs",innerHTML:e.result},null,8,_hoisted_3)])]),_:1},8,["modelValue"])])}var Form=_export_sfc(_sfc_main$1,[["render",_sfc_render]]);const _sfc_main=defineComponent({setup(e){const t=ref([{type:"expand",prop:"b",table:[{prop:"a",label:"1"}]},{prop:"a",label:"1231"}]),o=ref([{a:"a1",b:[{a:1}]}]);return(n,a)=>{const i=resolveComponent("m-table");return openBlock(),createBlock(i,{columns:t.value,data:o.value,"show-header":!0},null,8,["columns","data"])}}}),routes=[{path:"/",component:Editor},{path:"/form",component:Form},{path:"/table",component:_sfc_main}];var router=createRouter({history:createWebHashHistory(),routes}),index="";const app=createApp(App);app.use(router);app.use(installer,{locale:zhCn});app.use(MagicEditor);app.use(MagicForm);app.use(MagicTable);app.mount("#app");
//# sourceMappingURL=index.2774f2d7.js.map
