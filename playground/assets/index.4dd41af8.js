var j=Object.defineProperty,W=Object.defineProperties;var U=Object.getOwnPropertyDescriptors;var M=Object.getOwnPropertySymbols;var P=Object.prototype.hasOwnProperty,I=Object.prototype.propertyIsEnumerable;var F=(e,t,o)=>t in e?j(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,_=(e,t)=>{for(var o in t||(t={}))P.call(t,o)&&F(e,o,t[o]);if(M)for(var o of M(t))I.call(t,o)&&F(e,o,t[o]);return e},V=(e,t)=>W(e,U(t));var z=(e,t)=>{var o={};for(var n in e)P.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(e!=null&&M)for(var n of M(e))t.indexOf(n)<0&&I.call(e,n)&&(o[n]=e[n]);return o};var g=(e,t,o)=>(F(e,typeof t!="symbol"?t+"":t,o),o);import{d as defineComponent,c as computed,r as resolveComponent,o as openBlock,a as createBlock,n as normalizeStyle,b as ref,w as watchEffect,s as serializeJavascript,i as inject,e as createElementBlock,f as createBaseVNode,t as toDisplayString,g as withModifiers,h as createCommentVNode,j as watch,k as onMounted,l as onUnmounted,m as editor,p as hooks,q as cloneDeep,u as events,v as reactive,x as random,y as toRaw,z as mergeWith,P as Plus,A as createVNode,B as withCtx,G as Gesto,C as renderSlot,F as Fragment,E as Edit,D as normalizeClass,H as resolveDynamicComponent,I as ArrowDown,J as Grid,S as ScaleToOriginal,Z as ZoomOut,K as ZoomIn,R as Right,L as Back,M as Delete,N as renderList,O as createTextVNode,Q as normalizeProps,T as mergeProps,U as getCurrentInstance,V as ElMessage,W as withDirectives,X as vShow,Y as throttle,_ as Teleport,$ as Files,a0 as Coin,a1 as toHandlers,a2 as createSlots,a3 as ArrowLeftBold,a4 as ArrowRightBold,a5 as CaretBottom,a6 as MoveableHelper,a7 as Moveable,a8 as EventEmitter,a9 as Guides,aa as markRaw,ab as provide,ac as WarningFilled,ad as CaretRight,ae as CaretBottom$1,af as Delete$1,ag as ArrowDown$1,ah as ArrowUp,ai as FullScreen,aj as Grid$1,ak as toRefs,al as Sortable,am as unref,an as onBeforeUnmount,ao as vModelText,ap as onBeforeMount,aq as resolveDirective,ar as isEqual,as as ElMessageBox,at as Connection,au as Coin$1,av as Document,aw as FolderOpened,ax as Tickets,ay as SwitchButton,az as createRouter,aA as createWebHashHistory,aB as WorkerWrapper,aC as WorkerWrapper$1,aD as WorkerWrapper$2,aE as WorkerWrapper$3,aF as WorkerWrapper$4,aG as languages,aH as createApp,aI as installer,aJ as zhCn}from"./vendor.e34362d3.js";const p=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const l of i)if(l.type==="childList")for(const a of l.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function o(i){const l={};return i.integrity&&(l.integrity=i.integrity),i.referrerpolicy&&(l.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?l.credentials="include":i.crossorigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function n(i){if(i.ep)return;i.ep=!0;const l=o(i);fetch(i.href,l)}};p();typeof window.global=="undefined"&&(window.global=window);var _export_sfc=(e,t)=>{const o=e.__vccOpts||e;for(const[n,i]of t)o[n]=i;return o};const _sfc_main$W=defineComponent({name:"m-fields-vs-code",props:["model","name","config","prop"],emits:["change"],setup(e,{emit:t}){const o=computed(()=>e.config.language||"javascript");return{height:computed(()=>`${document.body.clientHeight-168}px`),language:o,save(i){e.model[e.name]=i,t("change",i)}}}});function _sfc_render$R(e,t,o,n,i,l){const a=resolveComponent("magic-code-editor");return openBlock(),createBlock(a,{style:normalizeStyle(`height: ${e.height}`),"init-values":e.model[e.name],language:e.language,onSave:e.save},null,8,["style","init-values","language","onSave"])}var Code=_export_sfc(_sfc_main$W,[["render",_sfc_render$R]]);const _sfc_main$V=defineComponent({name:"m-fields-code-link",props:{config:{type:Object},model:{type:Object},name:{type:String},prop:{type:String}},emits:["change"],setup(props,{emit}){const modelValue=ref({form:{}});return watchEffect(()=>{!props.model||!props.name||(modelValue.value.form[props.name]=serializeJavascript(props.model[props.name],{space:2,unsafe:!0}).replace(/"(\w+)":\s/g,"$1: "))}),{modelValue,formConfig:computed(()=>V(_({},props.config),{text:"",type:"link",form:[{name:props.name,type:"vs-code"}]})),changeHandler(v){if(!(!props.name||!props.model))try{props.model[props.name]=eval(`${v[props.name]}`),emit("change",props.model[props.name])}catch(e){console.error(e)}}}}});function _sfc_render$Q(e,t,o,n,i,l){const a=resolveComponent("m-fields-link");return openBlock(),createBlock(a,{config:e.formConfig,model:e.modelValue,name:"form",onChange:e.changeHandler},null,8,["config","model","onChange"])}var CodeLink=_export_sfc(_sfc_main$V,[["render",_sfc_render$Q]]),UISelect_vue_vue_type_style_index_0_lang="";const _sfc_main$U=defineComponent({name:"m-fields-ui-select",props:{labelWidth:String,config:Object,model:Object,prop:{type:String,default(){return""}},name:String},emits:["change"],setup(e,{emit:t}){const o=inject("services"),n=inject("mForm"),i=computed(()=>e.model[e.name]),l=ref(!1),a=()=>{!(o==null?void 0:o.uiService)||(o.uiService.set("uiSelectMode",!1),l.value=!1,globalThis.document.removeEventListener("ui-select",r))},r=({detail:s})=>{s.id&&(e.model[e.name]=s.id,t("change",s.id),n==null||n.$emit("field-change",e.prop,s.id)),a&&a()};return{val:i,uiSelectMode:l,toName:computed(()=>{const s=o==null?void 0:o.editorService.getNodeById(i.value);return(s==null?void 0:s.name)||""}),startSelect(){!(o==null?void 0:o.uiService)||(o.uiService.set("uiSelectMode",!0),l.value=!0,globalThis.document.addEventListener("ui-select",r))},cancelHandler:a,deleteHandler(){e.model&&(e.model[e.name]="",t("change",""),n==null||n.$emit("field-change",e.prop,""))}}}}),_hoisted_1$z=createBaseVNode("i",{class:"el-icon-delete",style:{color:"rgb(221, 75, 57)"}},"\u53D6\u6D88",-1),_hoisted_2$j=[_hoisted_1$z],_hoisted_3$f=createBaseVNode("i",{class:"el-icon-thumb"},null,-1);function _sfc_render$P(e,t,o,n,i,l){return e.uiSelectMode?(openBlock(),createElementBlock("div",{key:0,class:"m-fields-ui-select",onClick:t[0]||(t[0]=(...a)=>e.cancelHandler&&e.cancelHandler(...a))},_hoisted_2$j)):(openBlock(),createElementBlock("div",{key:1,class:"m-fields-ui-select",onClick:t[2]||(t[2]=(...a)=>e.startSelect&&e.startSelect(...a))},[_hoisted_3$f,createBaseVNode("span",null,toDisplayString(e.val?e.toName+"_"+e.val:"\u70B9\u51FB\u6B64\u5904\u9009\u62E9"),1),e.val?(openBlock(),createElementBlock("i",{key:0,class:"el-icon-delete",onClick:t[1]||(t[1]=withModifiers((...a)=>e.deleteHandler&&e.deleteHandler(...a),["stop"]))})):createCommentVNode("",!0)]))}var uiSelect=_export_sfc(_sfc_main$U,[["render",_sfc_render$P]]);const toString=(e,t)=>{let o="";return typeof e!="string"?o=serializeJavascript(e,{space:2,unsafe:!0}).replace(/"(\w+)":\s/g,"$1: "):o=e,t==="javascript"&&o.startsWith("{")&&o.endsWith("}")&&(o=`(${o})`),o},_sfc_main$T=defineComponent({name:"magic-code-editor",props:{initValues:{type:[String,Object]},modifiedValues:{type:[String,Object]},type:{type:[String],default:()=>""},language:{type:[String],default:()=>"javascript"}},emits:["initd","save"],setup(e,{emit:t}){let o=null,n=null;const i=ref(""),l=ref(!1),a=ref(),r=(u,f)=>{if(i.value=toString(u,e.language),e.type==="diff"){const m=editor.createModel(i.value,"text/javascript"),h=editor.createModel(toString(f,e.language),"text/javascript");return n==null?void 0:n.setModel({original:m,modified:h})}return o==null?void 0:o.setValue(i.value)},s=()=>{o==null||o.layout(),n==null||n.layout()},d=()=>e.type==="diff"?n==null?void 0:n.getModifiedEditor().getValue():o==null?void 0:o.getValue(),c=async()=>{if(!a.value)return;const u={value:i.value,language:e.language,tabSize:2,theme:"vs-dark",fontFamily:'dm, Menlo, Monaco, "Courier New", monospace',fontSize:15,formatOnPaste:!0};e.type==="diff"?n=editor.createDiffEditor(a.value,u):o=editor.create(a.value,u),r(e.initValues,e.modifiedValues),l.value=!1,t("initd",o),a.value.addEventListener("keydown",f=>{f.keyCode===83&&(navigator.platform.match("Mac")?f.metaKey:f.ctrlKey)&&(f.preventDefault(),t("save",d()))}),e.type!=="diff"&&(o==null||o.onDidBlurEditorWidget(()=>{t("save",d())})),globalThis.addEventListener("resize",s)};return watch(()=>e.initValues,(u,f)=>{u!==f&&r(e.initValues,e.modifiedValues)},{deep:!0,immediate:!0}),onMounted(async()=>{l.value=!0,c()}),onUnmounted(()=>{globalThis.removeEventListener("resize",s)}),{values:i,loading:l,codeEditor:a,getEditor(){return o||n},setEditorValue:r,focus(){o==null||o.focus(),n==null||n.focus()}}}}),_hoisted_1$y={ref:"codeEditor",class:"magic-code-editor"};function _sfc_render$O(e,t,o,n,i,l){return openBlock(),createElementBlock("div",_hoisted_1$y,null,512)}var CodeEditor=_export_sfc(_sfc_main$T,[["render",_sfc_render$O]]),NodeType=(e=>(e.CONTAINER="container",e.PAGE="page",e.ROOT="app",e))(NodeType||{});const sleep=e=>new Promise(t=>{const o=setTimeout(()=>{clearTimeout(o),t()},e)}),datetimeFormatter=(e,t="-",o="YYYY-MM-DD HH:mm:ss")=>{let n=o;if(n==="timestamp"&&(n="x"),e){let i=null;return typeof e=="string"&&e.includes("Z")||e.constructor===Date?i=hooks(e).utcOffset("+08:00").format(n):i=hooks(e).format(n),n==="x"?+i:i!=="Invalid date"?i:t}return t},asyncLoadJs=(()=>{const e=new Map;return(t,o,n=globalThis.document)=>{let i=e.get(n);if(i||(i=new Map,e.set(n,i)),i.get(t))return i.get(t);const l=new Promise((a,r)=>{const s=n.createElement("script");s.type="text/javascript",o&&(s.crossOrigin=o),s.src=t,n.body.appendChild(s),s.onload=()=>{a()},s.onerror=()=>{r(new Error("\u52A0\u8F7D\u5931\u8D25"))},setTimeout(()=>{r(new Error("timeout"))},60*1e3)}).catch(a=>{throw i.delete(t),a});return i.set(t,l),i.get(t)}})(),toLine=(e="")=>e.replace(/\B([A-Z])/g,"-$1").toLowerCase(),getNodePath=(e,t=[])=>{const o=[],n=function(i,l){if(!Array.isArray(l))return null;for(let a=0,r=l.length;a<r;a++){const s=l[a];if(o.push(s),`${s.id}`==`${i}`)return s;if(s.items){const d=n(i,s.items);if(d)return d}o.pop()}return null};return n(e,t),o},isPop=e=>{var t;return Boolean((t=e.type)==null?void 0:t.toLowerCase().endsWith("pop"))};class UndoRedo{constructor(t=200){g(this,"elementList");g(this,"listCursor");g(this,"listMaxSize");this.elementList=[],this.listCursor=0,this.listMaxSize=t>2?t:2}pushElement(t){this.elementList.splice(this.listCursor,this.elementList.length-this.listCursor,cloneDeep(t)),this.listCursor+=1,this.elementList.length>this.listMaxSize&&(this.elementList.shift(),this.listCursor-=1)}canUndo(){return this.listCursor>1}undo(){return this.canUndo()?(this.listCursor-=1,this.getCurrentElement()):null}canRedo(){return this.elementList.length>this.listCursor}redo(){return this.canRedo()?(this.listCursor+=1,this.getCurrentElement()):null}getCurrentElement(){return this.listCursor<1?null:cloneDeep(this.elementList[this.listCursor-1])}}const compose=e=>{if(!Array.isArray(e))throw new TypeError("Middleware \u5FC5\u987B\u662F\u4E00\u4E2A\u6570\u7EC4!");for(const t of e)if(typeof t!="function")throw new TypeError("Middleware \u5FC5\u987B\u7531\u51FD\u6570\u7EC4\u6210!");return(t,o)=>{let n=-1;return i(0);function i(l){if(l<=n)return Promise.reject(new Error("next() \u88AB\u591A\u6B21\u8C03\u7528"));n=l;let a=e[l];if(l===e.length&&o&&(a=o),!a)return Promise.resolve();try{return Promise.resolve(a(...t,i.bind(null,l+1)))}catch(r){return Promise.reject(r)}}}},methodName=(e,t)=>`${e}${t[0].toUpperCase()}${t.substring(1)}`,isError=e=>Object.prototype.toString.call(e)==="[object Error]",doAction=async(e,t,o,n,i,l)=>{try{let a=e;for(const s of t.pluginOptionsList[n]){let d=await s(...a)||[];if(isError(d))throw d;Array.isArray(d)||(d=[d]),a=a.map((c,u)=>typeof d[u]=="undefined"?c:d[u])}let r=await l(a,o.bind(t));for(const s of t.pluginOptionsList[i])if(r=await s(...a,r),isError(r))throw r;return r}catch(a){throw a}};class BaseService extends events.exports.EventEmitter{constructor(t=[],o=[]){super();g(this,"pluginOptionsList",{});g(this,"middleware",{});g(this,"taskList",[]);g(this,"doingTask",!1);t.forEach(n=>{const i=this,l=i[n],a=methodName("before",n),r=methodName("after",n);this.pluginOptionsList[a]=[],this.pluginOptionsList[r]=[],this.middleware[n]=[];const s=compose(this.middleware[n]);Object.defineProperty(i,n,{value:async(...d)=>{if(!o.includes(n))return doAction(d,i,l,a,r,s);const c=new Promise((u,f)=>{this.taskList.push(async()=>{try{const m=await doAction(d,i,l,a,r,s);u(m)}catch(m){f(m)}})});return this.doingTask||this.doTask(),c}})})}use(t){Object.entries(t).forEach(([o,n])=>{typeof n=="function"&&this.middleware[o].push(n)})}usePlugin(t){Object.entries(t).forEach(([o,n])=>{typeof n=="function"&&this.pluginOptionsList[o].push(n)})}async doTask(){this.doingTask=!0;let t=this.taskList.shift();for(;t;)await t(),t=this.taskList.shift();this.doingTask=!1}}class History extends BaseService{constructor(){super([]);g(this,"state",reactive({pageSteps:{},pageId:void 0,canRedo:!1,canUndo:!1}));this.on("change",this.setCanUndoRedo)}changePage(t){if(!!t){if(this.state.pageId=t.id,!this.state.pageSteps[this.state.pageId]){const o=new UndoRedo;o.pushElement({data:t,modifiedNodeIds:new Map,nodeId:t.id}),this.state.pageSteps[this.state.pageId]=o}this.setCanUndoRedo()}}empty(){this.state.pageId=void 0,this.state.pageSteps={},this.state.canRedo=!1,this.state.canUndo=!1}push(t){const o=this.getUndoRedo();return o?(o.pushElement(t),this.emit("change",t),t):null}undo(){const t=this.getUndoRedo();if(!t)return null;const o=t.undo();return this.emit("change",o),o}redo(){const t=this.getUndoRedo();if(!t)return null;const o=t.redo();return this.emit("change",o),o}destroy(){this.empty(),this.removeAllListeners()}getUndoRedo(){return this.state.pageId?this.state.pageSteps[this.state.pageId]:null}setCanUndoRedo(){const t=this.getUndoRedo();this.state.canRedo=(t==null?void 0:t.canRedo())||!1,this.state.canUndo=(t==null?void 0:t.canUndo())||!1}}var historyService=new History;class Props extends BaseService{constructor(){super(["setPropsConfig","getPropsConfig","setPropsValue","getPropsValue"]);g(this,"state",reactive({propsConfigMap:{},propsValueMap:{}}))}setPropsConfigs(t){Object.keys(t).forEach(o=>{this.setPropsConfig(toLine(o),t[o])}),this.emit("props-configs-change")}setPropsConfig(t,o){this.state.propsConfigMap[t]=fillConfig(Array.isArray(o)?o:[o])}async getPropsConfig(t){return t==="area"?await this.getPropsConfig("button"):cloneDeep(this.state.propsConfigMap[t]||DEFAULT_CONFIG)}setPropsValues(t){Object.keys(t).forEach(o=>{this.setPropsValue(toLine(o),t[o])})}setPropsValue(t,o){this.state.propsValueMap[t]=o}async getPropsValue(t){if(t==="area"){const o=await this.getPropsValue("button");return o.className="action-area",o.text="",o.style&&(o.style.backgroundColor="rgba(255, 255, 255, 0)"),o}return cloneDeep(_(_({},getDefaultPropsValue(t)),this.state.propsValueMap[t]||{}))}}var propsService=new Props,LayerOffset=(e=>(e.TOP="top",e.BOTTOM="bottom",e))(LayerOffset||{}),Layout=(e=>(e.FLEX="flex",e.FIXED="fixed",e.RELATIVE="relative",e.ABSOLUTE="absolute",e))(Layout||{}),Keys=(e=>(e.ESCAPE="Space",e))(Keys||{});const COPY_STORAGE_KEY="$MagicEditorCopyData",generateId=e=>`${e}_${random(1e4,!1)}`,getPageList=e=>e.items&&Array.isArray(e.items)?e.items.filter(t=>t.type===NodeType.PAGE):[],getPageNameList=e=>e.map(t=>t.name||"index"),generatePageName=e=>{let t=e.length;if(!t)return"index";let o=`page_${t}`;for(;e.includes(o);)t+=1,o=`page_${t}`;return o},generatePageNameByApp=e=>generatePageName(getPageNameList(getPageList(e))),updatePopId=(e,t,o)=>{var n;(n=o.items)==null||n.forEach(i=>{if(i.pop===e){i.pop=t;return}if(i.popId===e){i.popId=t;return}Array.isArray(i.items)&&updatePopId(e,t,i)})},setNewItemId=(e,t)=>{var n;const o=e.id;e.id=generateId(e.type),e.name=`${(n=e.name)==null?void 0:n.replace(/_(\d+)$/,"")}_${e.id}`,isPop(e)&&(t==null?void 0:t.type)===NodeType.PAGE&&updatePopId(o,e.id,t),e.items&&Array.isArray(e.items)&&e.items.forEach(i=>setNewItemId(i,e))},isFixed$1=e=>{var t;return((t=e.style)==null?void 0:t.position)==="fixed"},getNodeIndex=(e,t)=>((t==null?void 0:t.items)||[]).findIndex(n=>`${n.id}`==`${e.id}`),toRelative=e=>(e.style=V(_({},e.style||{}),{position:"relative",top:0,left:0}),e),initPosition=(e,t)=>t===Layout.ABSOLUTE?(e.style=_({position:"absolute"},e.style||{}),e):t===Layout.RELATIVE?toRelative(e):e,setLayout=(e,t)=>{var o;return(o=e.items)==null||o.forEach(n=>{isPop(n)||(n.style=n.style||{},n.style.position!=="fixed"&&(t!==Layout.RELATIVE?n.style.position="absolute":(toRelative(n),n.style.right="auto",n.style.bottom="auto")))}),e},change2Fixed=(e,t)=>{const o=getNodePath(e.id,t.items),n={left:0,top:0};return o.forEach(i=>{var l,a;n.left=n.left+globalThis.parseFloat(((l=i.style)==null?void 0:l.left)||0),n.top=n.top+globalThis.parseFloat(((a=i.style)==null?void 0:a.top)||0)}),e.style=_(_({},e.style||{}),n),e},Fixed2Other=async(e,t,o)=>{var s,d;const n=getNodePath(e.id,t.items),i=n.pop(),l={left:((s=i==null?void 0:i.style)==null?void 0:s.left)||0,top:((d=i==null?void 0:i.style)==null?void 0:d.top)||0};n.forEach(c=>{var u,f;l.left=l.left-globalThis.parseFloat(((u=c.style)==null?void 0:u.left)||0),l.top=l.top-globalThis.parseFloat(((f=c.style)==null?void 0:f.top)||0)});const a=n.pop();return a&&await o(a)!==Layout.RELATIVE?(e.style=V(_(_({},e.style||{}),l),{position:"absolute"}),e):toRelative(e)};class Editor$2 extends BaseService{constructor(){super(["getLayout","select","add","remove","update","sort","copy","paste","alignCenter","moveLayer","undo","redo","highlight"],["select","update","moveLayer"]);g(this,"isHistoryStateChange",!1);g(this,"state",reactive({root:null,page:null,parent:null,node:null,stage:null,highlightNode:null,modifiedNodeIds:new Map}))}set(e,t){this.state[e]=t,e==="root"&&this.emit("root-change",t)}get(e){return this.state[e]}getNodeInfo(e){const t=this.get("root");if(!t)return{};if(e===t.id)return{node:t};const o=getNodePath(e,t.items);if(!o.length)return{};o.unshift(t);const n={};return n.node=o[o.length-1],n.parent=o[o.length-2],o.forEach(i=>{if(i.type===NodeType.PAGE){n.page=i;return}}),n}getNodeById(e){const{node:t}=this.getNodeInfo(e);return t}getParentById(e){if(!this.get("root"))return;const{parent:t}=this.getNodeInfo(e);return t}async getLayout(e){var t;return e.layout?e.layout:((t=e.style)==null?void 0:t.position)?Layout.ABSOLUTE:Layout.RELATIVE}async select(e){const{node:t,page:o,parent:n}=this.selectedConfigExceptionHandler(e);return this.set("node",t),this.set("page",o||null),this.set("parent",n||null),o?historyService.changePage(toRaw(o)):historyService.empty(),t}highlight(e){const{node:t}=this.selectedConfigExceptionHandler(e);this.get("highlightNode")!==t&&this.set("highlightNode",t)}async add(n,o){var i=n,{type:e}=i,t=z(i,["type"]);var c;const l=this.get("node");let a;if(e===NodeType.PAGE?a=this.get("root"):o&&typeof o!="function"?a=o:l.items?a=l:a=this.getParentById(l.id),!a)throw new Error("\u672A\u627E\u5230\u7236\u5143\u7D20");const r=await this.getLayout(a),s=initPosition(_(_({},toRaw(await propsService.getPropsValue(e))),t),r);if(((a==null?void 0:a.type)===NodeType.ROOT||l.type===NodeType.ROOT)&&s.type!==NodeType.PAGE)throw new Error("app\u4E0B\u4E0D\u80FD\u6DFB\u52A0\u7EC4\u4EF6");(c=a==null?void 0:a.items)==null||c.push(s);const d=this.get("stage");return await(d==null?void 0:d.add({config:cloneDeep(s),root:cloneDeep(this.get("root"))})),await this.select(s),this.addModifiedNodeId(s.id),e!==NodeType.PAGE&&this.pushHistoryState(),d==null||d.select(s.id),s}async remove(e){var a;if(!(e==null?void 0:e.id))return;const t=this.get("root");if(!t)throw new Error("\u6CA1\u6709root");const{parent:o,node:n}=this.getNodeInfo(e.id);if(!o||!n)throw new Error("\u627E\u4E0D\u8981\u5220\u9664\u7684\u8282\u70B9");const i=getNodeIndex(n,o);if(typeof i!="number"||i===-1)throw new Error("\u627E\u4E0D\u8981\u5220\u9664\u7684\u8282\u70B9");(a=o.items)==null||a.splice(i,1);const l=this.get("stage");return l==null||l.remove({id:e.id,root:this.get("root")}),e.type===NodeType.PAGE?t.items[0]&&(await this.select(t.items[0]),l==null||l.select(t.items[0].id)):(await this.select(o),l==null||l.select(o.id)),this.addModifiedNodeId(o.id),this.pushHistoryState(),e}async update(e){var d;if(!(e==null?void 0:e.id))throw new Error("\u6CA1\u6709\u914D\u7F6E\u6216\u8005\u914D\u7F6E\u7F3A\u5C11id\u503C");const t=this.getNodeInfo(e.id);if(!t.node)throw new Error(`\u83B7\u53D6\u4E0D\u5230id\u4E3A${e.id}\u7684\u8282\u70B9`);const o=cloneDeep(toRaw(t.node));let n=await this.toggleFixedPosition(toRaw(e),o,this.get("root"));if(n=mergeWith(cloneDeep(o),n,(c,u)=>{if(Array.isArray(u))return u}),!n.type)throw new Error("\u914D\u7F6E\u7F3A\u5C11type\u503C");if(n.type===NodeType.ROOT)return this.set("root",n),n;const{parent:i}=t;if(!i)throw new Error("\u83B7\u53D6\u4E0D\u5230\u7236\u7EA7\u8282\u70B9");const l=i.items,a=getNodeIndex(n,i);if(!l||typeof a=="undefined"||a===-1)throw new Error("\u66F4\u65B0\u7684\u8282\u70B9\u672A\u627E\u5230");const r=await this.getLayout(n),s=await this.getLayout(o);return r!==s&&(n=setLayout(n,r)),l[a]=n,`${n.id}`==`${this.get("node").id}`&&this.set("node",n),(d=this.get("stage"))==null||d.update({config:cloneDeep(n),root:this.get("root")}),n.type===NodeType.PAGE&&this.set("page",n),this.addModifiedNodeId(n.id),this.pushHistoryState(),n}async sort(e,t){var a;const o=this.get("node"),n=cloneDeep(toRaw(this.get("parent"))),i=n.items.findIndex(r=>`${r.id}`==`${t}`);if(i<0)return;const l=n.items.findIndex(r=>`${r.id}`==`${e}`);n.items.splice(i,0,...n.items.splice(l,1)),await this.update(n),await this.select(o),(a=this.get("stage"))==null||a.update({config:cloneDeep(o),root:this.get("root")}),this.addModifiedNodeId(n.id),this.pushHistoryState()}async copy(e){globalThis.localStorage.setItem(COPY_STORAGE_KEY,serializeJavascript(e))}async paste(position={}){const configStr=globalThis.localStorage.getItem(COPY_STORAGE_KEY);let config={};if(!!configStr){try{eval(`config = ${configStr}`)}catch(e){console.error(e);return}return setNewItemId(config,this.get("root")),config.style&&(config.style=_(_({},config.style),position)),await this.add(config)}}async alignCenter(e){var i,l,a;const t=this.get("parent"),o=this.get("node");if(await this.getLayout(t)!==Layout.RELATIVE)return((i=t.style)==null?void 0:i.width)&&((l=o.style)==null?void 0:l.width)&&(o.style.left=(t.style.width-o.style.width)/2),await this.update(o),(a=this.get("stage"))==null||a.update({config:cloneDeep(toRaw(o)),root:this.get("root")}),this.addModifiedNodeId(e.id),this.pushHistoryState(),e}async moveLayer(e){var l;const t=this.get("parent"),o=this.get("node"),n=(t==null?void 0:t.items)||[],i=n.findIndex(a=>`${a.id}`==`${o==null?void 0:o.id}`);e===LayerOffset.BOTTOM?n.splice(n.length-1,0,n.splice(i,1)[0]):e===LayerOffset.TOP?n.splice(0,0,n.splice(i,1)[0]):n.splice(i+parseInt(`${e}`,10),0,n.splice(i,1)[0]),(l=this.get("stage"))==null||l.update({config:cloneDeep(toRaw(t)),root:this.get("root")})}async undo(){const e=historyService.undo();return await this.changeHistoryState(e),e}async redo(){const e=historyService.redo();return await this.changeHistoryState(e),e}destroy(){this.removeAllListeners(),this.set("root",null),this.set("node",null),this.set("page",null),this.set("parent",null)}resetModifiedNodeId(){this.get("modifiedNodeIds").clear()}addModifiedNodeId(e){this.isHistoryStateChange||this.get("modifiedNodeIds").set(e,e)}pushHistoryState(){const e=cloneDeep(toRaw(this.get("node")));this.isHistoryStateChange||historyService.push({data:cloneDeep(toRaw(this.get("page"))),modifiedNodeIds:this.get("modifiedNodeIds"),nodeId:e.id}),this.isHistoryStateChange=!1}async changeHistoryState(e){!e||(this.isHistoryStateChange=!0,await this.update(e.data),this.set("modifiedNodeIds",e.modifiedNodeIds),setTimeout(async()=>{var t;!e.nodeId||(await this.select(e.nodeId),(t=this.get("stage"))==null||t.select(e.nodeId))},0))}async toggleFixedPosition(e,t,o){var i;let n=cloneDeep(e);return!isPop(t)&&((i=n.style)==null?void 0:i.position)&&(isFixed$1(n)&&!isFixed$1(t)?n=change2Fixed(n,o):!isFixed$1(n)&&isFixed$1(t)&&(n=await Fixed2Other(n,o,this.getLayout))),n}selectedConfigExceptionHandler(e){var l;let t;if(typeof e=="string"||typeof e=="number"?t=e:t=e.id,!t)throw new Error("\u6CA1\u6709ID\uFF0C\u65E0\u6CD5\u9009\u4E2D");const{node:o,parent:n,page:i}=this.getNodeInfo(t);if(!o)throw new Error("\u83B7\u53D6\u4E0D\u5230\u7EC4\u4EF6\u4FE1\u606F");if(o.id===((l=this.state.root)==null?void 0:l.id))throw new Error("\u4E0D\u80FD\u9009\u6839\u8282\u70B9");return{node:o,parent:n,page:i}}}var editorService=new Editor$2;const COMMON_EVENT_PREFIX="magic:common:events:",COMMON_METHOD_PREFIX="magic:common:actions:",CommonMethod={SHOW:"show",HIDE:"hide",SCROLL_TO_VIEW:"scrollIntoView",SCROLL_TO_TOP:"scrollToTop"},DEFAULT_EVENTS=[{label:"\u70B9\u51FB",value:`${COMMON_EVENT_PREFIX}click`}],DEFAULT_METHODS=[{label:"\u663E\u793A",value:`${COMMON_METHOD_PREFIX}${CommonMethod.SHOW}`},{label:"\u9690\u85CF",value:`${COMMON_METHOD_PREFIX}${CommonMethod.HIDE}`},{label:"\u6EDA\u52A8\u5230\u8BE5\u7EC4\u4EF6",value:`${COMMON_METHOD_PREFIX}${CommonMethod.SCROLL_TO_VIEW}`},{label:"\u56DE\u5230\u9876\u90E8",value:`${COMMON_METHOD_PREFIX}${CommonMethod.SCROLL_TO_TOP}`}];var resetcss="";const eventMap=reactive({}),methodMap=reactive({});class Events extends BaseService{constructor(){super([])}init(t){t.forEach(o=>{o.items.forEach(n=>{const i=toLine(n.type);this.getEvent(i)||this.setEvent(i,DEFAULT_EVENTS),this.getMethod(i)||this.setMethod(i,DEFAULT_METHODS)})})}setEvents(t){Object.keys(t).forEach(o=>{this.setEvent(toLine(o),t[o]||[])})}setEvent(t,o){eventMap[t]=[...DEFAULT_EVENTS,...o]}getEvent(t){return cloneDeep(eventMap[t]||DEFAULT_EVENTS)}setMethods(t){Object.keys(t).forEach(o=>{this.setMethod(toLine(o),t[o]||[])})}setMethod(t,o){methodMap[t]=[...DEFAULT_METHODS,...o]}getMethod(t){return cloneDeep(methodMap[t]||DEFAULT_METHODS)}}var eventsService=new Events;const fillConfig=(e=[])=>[{type:"tab",items:[{title:"\u5C5E\u6027",labelWidth:"80px",items:[{text:"type",name:"type",type:"hidden"},{name:"id",type:"display",text:"id"},{name:"name",text:"\u7EC4\u4EF6\u540D\u79F0"},...e]},{title:"\u6837\u5F0F",labelWidth:"80px",items:[{name:"style",items:[{type:"fieldset",legend:"\u4F4D\u7F6E",items:[{name:"position",type:"checkbox",activeValue:"fixed",inactiveValue:"absolute",defaultValue:"absolute",text:"\u56FA\u5B9A\u5B9A\u4F4D"},{name:"left",text:"left"},{name:"top",text:"top",disabled:(t,{model:o})=>o.position==="fixed"&&o._magic_position==="fixedBottom"},{name:"right",text:"right"},{name:"bottom",text:"bottom",disabled:(t,{model:o})=>o.position==="fixed"&&o._magic_position==="fixedTop"}]},{type:"fieldset",legend:"\u76D2\u5B50",items:[{name:"width",text:"\u5BBD\u5EA6"},{name:"height",text:"\u9AD8\u5EA6"}]},{type:"fieldset",legend:"\u80CC\u666F",items:[{name:"backgroundImage",text:"\u80CC\u666F\u56FE"},{name:"backgroundColor",text:"\u80CC\u666F\u989C\u8272",type:"colorPicker"},{name:"backgroundRepeat",text:"\u80CC\u666F\u56FE\u91CD\u590D",type:"select",defaultValue:"no-repeat",options:[{text:"repeat",value:"repeat"},{text:"repeat-x",value:"repeat-x"},{text:"repeat-y",value:"repeat-y"},{text:"no-repeat",value:"no-repeat"},{text:"inherit",value:"inherit"}]},{name:"backgroundSize",text:"\u80CC\u666F\u56FE\u5927\u5C0F",defaultValue:"100% 100%"}]}]}]},{title:"\u4E8B\u4EF6",items:[{type:"table",name:"events",items:[{name:"name",label:"\u4E8B\u4EF6\u540D",type:"select",options:(t,{formValue:o})=>eventsService.getEvent(o.type).map(n=>({text:n.label,value:n.value}))},{name:"to",label:"\u8054\u52A8\u7EC4\u4EF6",type:"ui-select"},{name:"method",label:"\u52A8\u4F5C",type:"select",options:(t,{model:o})=>{const n=editorService.getNodeById(o.to);return n?eventsService.getMethod(n.type).map(i=>({text:i.label,value:i.value})):[]}}]}]},{title:"\u9AD8\u7EA7",labelWidth:"80px",items:[{type:"code-link",name:"created",text:"created",formTitle:"created"}]}]}],DEFAULT_CONFIG=fillConfig([]),getDefaultPropsValue=e=>({type:e,id:generateId(e),style:{},name:e}),_sfc_main$S=defineComponent({components:{Plus},setup(){const e=inject("services");return{clickHandler(){const{editorService:t}=e||{};!t||t.add({type:NodeType.PAGE,name:generatePageNameByApp(toRaw(t.get("root")))})}}}}),_hoisted_1$x={class:"m-editor-empty-panel"},_hoisted_2$i={class:"m-editor-empty-content"},_hoisted_3$e=createBaseVNode("p",null,"\u65B0\u589E\u9875\u9762",-1);function _sfc_render$N(e,t,o,n,i,l){const a=resolveComponent("plus"),r=resolveComponent("el-icon");return openBlock(),createElementBlock("div",_hoisted_1$x,[createBaseVNode("div",_hoisted_2$i,[createBaseVNode("div",{class:"m-editor-empty-button",onClick:t[0]||(t[0]=(...s)=>e.clickHandler&&e.clickHandler(...s))},[createBaseVNode("div",null,[createVNode(r,null,{default:withCtx(()=>[createVNode(a)]),_:1})]),_hoisted_3$e])])])}var AddPageBox=_export_sfc(_sfc_main$S,[["render",_sfc_render$N]]);const _sfc_main$R=defineComponent({name:"m-editor-resize",props:{type:{type:String}},setup(e){const t=inject("services"),o=ref();let n;return onMounted(()=>{!o.value||(n=new Gesto(o.value,{container:window,pinchOutside:!0}).on("drag",i=>{if(!o.value||!t)return;let{left:l,right:a}=_({},toRaw(t.uiService.get("columnWidth")));e.type==="left"?l+=i.deltaX:e.type==="right"&&(a-=i.deltaX),t.uiService.set("columnWidth",{left:l,right:a})}))}),onUnmounted(()=>{n==null||n.unset()}),{target:o}}}),_hoisted_1$w={ref:"target",class:"m-editor-resizer"};function _sfc_render$M(e,t,o,n,i,l){return openBlock(),createElementBlock("span",_hoisted_1$w,[renderSlot(e.$slots,"default")],512)}var Resizer=_export_sfc(_sfc_main$R,[["render",_sfc_render$M]]);const _sfc_main$Q=defineComponent({components:{AddPageBox,Resizer},setup(){const services=inject("services"),root=computed(()=>services==null?void 0:services.editorService.get("root"));return{root,pageLength:computed(()=>{var e,t;return((t=(e=root.value)==null?void 0:e.items)==null?void 0:t.length)||0}),showSrc:computed(()=>services==null?void 0:services.uiService.get("showSrc")),columnWidth:computed(()=>services==null?void 0:services.uiService.get("columnWidth")),saveCode(value){try{services==null||services.editorService.set("root",eval(value))}catch(e){console.error(e)}}}}}),_hoisted_1$v={class:"m-editor"},_hoisted_2$h={key:1,class:"m-editor-content"};function _sfc_render$L(e,t,o,n,i,l){var c,u,f;const a=resolveComponent("magic-code-editor"),r=resolveComponent("resizer"),s=resolveComponent("el-scrollbar"),d=resolveComponent("add-page-box");return openBlock(),createElementBlock("div",_hoisted_1$v,[renderSlot(e.$slots,"nav",{class:"m-editor-nav-menu"}),e.showSrc?(openBlock(),createBlock(a,{key:0,class:"m-editor-content","init-values":e.root,onSave:e.saveCode},null,8,["init-values","onSave"])):(openBlock(),createElementBlock("div",_hoisted_2$h,[createBaseVNode("div",{class:"m-editor-framework-left",style:normalizeStyle(`width: ${(c=e.columnWidth)==null?void 0:c.left}px`)},[renderSlot(e.$slots,"sidebar")],4),createVNode(r,{type:"left"}),e.pageLength>0?(openBlock(),createElementBlock(Fragment,{key:0},[createBaseVNode("div",{class:"m-editor-framework-center",style:normalizeStyle(`width: ${(u=e.columnWidth)==null?void 0:u.center}px`)},[renderSlot(e.$slots,"workspace")],4),createVNode(r,{type:"right"}),createBaseVNode("div",{class:"m-editor-framework-right",style:normalizeStyle(`width: ${(f=e.columnWidth)==null?void 0:f.right}px`)},[createVNode(s,null,{default:withCtx(()=>[renderSlot(e.$slots,"propsPanel")]),_:3})],4)],64)):renderSlot(e.$slots,"empty",{key:1},()=>[createVNode(d)])]))])}var Framework=_export_sfc(_sfc_main$Q,[["render",_sfc_render$L]]);const _sfc_main$P=defineComponent({name:"m-icon",components:{Edit},props:{icon:{type:[String,Object]}},setup(){return{toRaw}}}),_hoisted_1$u=["src"];function _sfc_render$K(e,t,o,n,i,l){const a=resolveComponent("edit"),r=resolveComponent("el-icon");return e.icon?typeof e.icon=="string"&&e.icon.startsWith("http")?(openBlock(),createElementBlock("img",{key:1,src:e.icon},null,8,_hoisted_1$u)):typeof e.icon=="string"?(openBlock(),createElementBlock("i",{key:2,class:normalizeClass(e.icon)},null,2)):(openBlock(),createBlock(r,{key:3},{default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(e.toRaw(e.icon))))]),_:1})):(openBlock(),createBlock(r,{key:0},{default:withCtx(()=>[createVNode(a)]),_:1}))}var MIcon=_export_sfc(_sfc_main$P,[["render",_sfc_render$K]]);const _sfc_main$O=defineComponent({components:{MIcon,ArrowDown},props:{data:{type:[Object,String],require:!0,default:()=>({type:"text",display:!1})}},setup(e){const t=inject("services"),o=t==null?void 0:t.uiService,n=()=>o==null?void 0:o.set("zoom",l.value+.1),i=()=>o==null?void 0:o.set("zoom",l.value-.1),l=computed(()=>{var c;return(c=o==null?void 0:o.get("zoom"))!=null?c:1}),a=computed(()=>{var c;return(c=o==null?void 0:o.get("showGuides"))!=null?c:!0}),r=computed(()=>{var c;return(c=o==null?void 0:o.get("showRule"))!=null?c:!0}),s=computed(()=>{if(typeof e.data!="string")return e.data;switch(e.data){case"/":return{type:"divider"};case"zoom":return{type:"zoom"};case"delete":return{type:"button",icon:Delete,tooltip:"\u522A\u9664",disabled:()=>{var c;return((c=t==null?void 0:t.editorService.get("node"))==null?void 0:c.type)===NodeType.PAGE},handler:()=>t==null?void 0:t.editorService.remove(t==null?void 0:t.editorService.get("node"))};case"undo":return{type:"button",icon:Back,tooltip:"\u540E\u9000",disabled:()=>!(t==null?void 0:t.historyService.state.canUndo),handler:()=>t==null?void 0:t.editorService.undo()};case"redo":return{type:"button",icon:Right,tooltip:"\u524D\u8FDB",disabled:()=>!(t==null?void 0:t.historyService.state.canRedo),handler:()=>t==null?void 0:t.editorService.redo()};case"zoom-in":return{type:"button",icon:ZoomIn,tooltip:"\u653E\u5927",handler:n};case"zoom-out":return{type:"button",icon:ZoomOut,tooltip:"\u7E2E\u5C0F",handler:i};case"rule":return{type:"button",icon:ScaleToOriginal,tooltip:r.value?"\u9690\u85CF\u6807\u5C3A":"\u663E\u793A\u6807\u5C3A",handler:()=>o==null?void 0:o.set("showRule",!r.value)};case"guides":return{type:"button",icon:Grid,tooltip:a.value?"\u9690\u85CF\u53C2\u8003\u7EBF":"\u663E\u793A\u53C2\u8003\u7EBF",handler:()=>o==null?void 0:o.set("showGuides",!a.value)};default:return{type:"text",text:e.data}}}),d=computed(()=>typeof s.value=="string"||s.value.type==="component"?!1:typeof s.value.disabled=="function"?s.value.disabled(t):s.value.disabled);return{ZoomIn,ZoomOut,item:s,zoom:l,disabled:d,display:computed(()=>{var c;return s.value?typeof s.value=="string"?!0:typeof s.value.display=="function"?s.value.display(t):(c=s.value.display)!=null?c:!0:!1}),zoomInHandler:n,zoomOutHandler:i,dropdownHandler(c){c.item.handler&&c.item.handler(t)},buttonHandler(c){var u;d.value||typeof c.handler=="function"&&((u=c.handler)==null||u.call(c,t))}}}}),_hoisted_1$t={key:0,class:"menu-item"},_hoisted_2$g={key:1,class:"menu-item-text"},_hoisted_3$d={class:"menu-item-text",style:{margin:"0 5px"}},_hoisted_4$a={class:"el-dropdown-link menubar-menu-button"};function _sfc_render$J(e,t,o,n,i,l){const a=resolveComponent("el-divider"),r=resolveComponent("m-icon"),s=resolveComponent("el-button"),d=resolveComponent("el-tooltip"),c=resolveComponent("arrow-down"),u=resolveComponent("el-icon"),f=resolveComponent("el-dropdown-item"),m=resolveComponent("el-dropdown-menu"),h=resolveComponent("el-dropdown");return e.display?(openBlock(),createElementBlock("div",_hoisted_1$t,[e.item.type==="divider"?(openBlock(),createBlock(a,{key:0,direction:"vertical"})):e.item.type==="text"?(openBlock(),createElementBlock("div",_hoisted_2$g,toDisplayString(e.item.text),1)):e.item.type==="zoom"?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(s,{size:"small",type:"text"},{default:withCtx(()=>[createVNode(r,{icon:e.ZoomIn,onClick:e.zoomInHandler},null,8,["icon","onClick"])]),_:1}),createBaseVNode("span",_hoisted_3$d,toDisplayString(parseInt(`${e.zoom*100}`,10))+"%",1),createVNode(s,{size:"small",type:"text"},{default:withCtx(()=>[createVNode(r,{icon:e.ZoomOut,onClick:e.zoomOutHandler},null,8,["icon","onClick"])]),_:1})],64)):e.item.type==="button"?(openBlock(),createBlock(d,{key:3,effect:"dark",placement:"bottom-start",content:e.item.tooltip||e.item.text},{default:withCtx(()=>[createVNode(s,{size:"small",type:"text",disabled:e.disabled,onClick:t[0]||(t[0]=w=>e.buttonHandler(e.item))},{default:withCtx(()=>[createVNode(r,{icon:e.item.icon},null,8,["icon"]),createBaseVNode("span",null,toDisplayString(e.item.text),1)]),_:1},8,["disabled"])]),_:1},8,["content"])):e.item.type==="dropdown"?(openBlock(),createBlock(h,{key:4,trigger:"click",disabled:e.disabled,onCommand:e.dropdownHandler},{dropdown:withCtx(()=>[e.item.items&&e.item.items.length?(openBlock(),createBlock(m,{key:0},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.item.items,(w,E)=>(openBlock(),createBlock(f,{key:E,command:{item:e.item,subItem:w}},{default:withCtx(()=>[createTextVNode(toDisplayString(w.text),1)]),_:2},1032,["command"]))),128))]),_:1})):createCommentVNode("",!0)]),default:withCtx(()=>[createBaseVNode("span",_hoisted_4$a,[createTextVNode(toDisplayString(e.item.text),1),createVNode(u,{class:"el-icon--right"},{default:withCtx(()=>[createVNode(c)]),_:1})])]),_:1},8,["disabled","onCommand"])):e.item.type==="component"?(openBlock(),createBlock(resolveDynamicComponent(e.item.component),normalizeProps(mergeProps({key:5},e.item.props||{})),null,16)):createCommentVNode("",!0)])):createCommentVNode("",!0)}var ToolButton=_export_sfc(_sfc_main$O,[["render",_sfc_render$J]]);const _sfc_main$N=defineComponent({name:"nav-menu",components:{ToolButton},props:{data:{type:Object,default:()=>({})},height:{type:Number}},setup(e){const t=inject("services");return{keys:computed(()=>Object.keys(e.data)),columnWidth:computed(()=>t==null?void 0:t.uiService.get("columnWidth"))}}});function _sfc_render$I(e,t,o,n,i,l){const a=resolveComponent("tool-button");return openBlock(),createElementBlock("div",{class:"m-editor-nav-menu",style:normalizeStyle({height:`${e.height}px`})},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.keys,r=>{var s;return openBlock(),createElementBlock("div",{class:normalizeClass(`menu-${r}`),key:r,style:normalizeStyle(`width: ${(s=e.columnWidth)==null?void 0:s[r]}px`)},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.data[r],(d,c)=>(openBlock(),createBlock(a,{data:d,key:c},null,8,["data"]))),128))],6)}),128))],4)}var NavMenu=_export_sfc(_sfc_main$N,[["render",_sfc_render$I]]);const _sfc_main$M=defineComponent({name:"m-editor-props-panel",emits:["mounted"],setup(e,{emit:t}){const o=getCurrentInstance(),n=ref({}),i=ref(),l=ref([]),a=inject("services"),r=computed(()=>a==null?void 0:a.editorService.get("node")),s=async()=>{if(!r.value){l.value=[];return}n.value=r.value;const d=r.value.type||(r.value.items?"container":"text");l.value=await(a==null?void 0:a.propsService.getPropsConfig(d))||[]};return watchEffect(s),a==null||a.propsService.on("props-configs-change",s),onMounted(()=>{t("mounted",o)}),{values:n,configForm:i,curFormConfig:l,async submit(){var d;try{const c=await((d=i.value)==null?void 0:d.submitForm());a==null||a.editorService.update(c)}catch(c){console.error(c),ElMessage.closeAll(),ElMessage.error({duration:1e4,showClose:!0,message:c.message,dangerouslyUseHTMLString:!0})}}}}});function _sfc_render$H(e,t,o,n,i,l){const a=resolveComponent("m-form");return openBlock(),createBlock(a,{class:"m-editor-props-panel","popper-class":"m-editor-props-panel-popper",ref:"configForm",size:"small","init-values":e.values,config:e.curFormConfig,onChange:e.submit},null,8,["init-values","config","onChange"])}var PropsPanel=_export_sfc(_sfc_main$M,[["render",_sfc_render$H]]);const _sfc_main$L=defineComponent({name:"ui-component-panel",components:{MIcon},setup(){const e=ref(""),t=inject("services"),o=computed(()=>t==null?void 0:t.componentListService.getList().map(i=>V(_({},i),{items:i.items.filter(l=>l.text.includes(e.value))}))),n=computed(()=>{var i;return Array((i=o.value)==null?void 0:i.length).fill(1).map((l,a)=>a)});return{searchText:e,collapseValue:n,list:o,appendComponent(r){var s=r,{text:i,type:l}=s,a=z(s,["text","type"]);t==null||t.editorService.add(_({name:i,type:l},a))}}}}),_hoisted_1$s=createBaseVNode("i",{class:"el-icon-s-grid"},null,-1),_hoisted_2$f=["onClick"];function _sfc_render$G(e,t,o,n,i,l){const a=resolveComponent("el-input"),r=resolveComponent("m-icon"),s=resolveComponent("el-tooltip"),d=resolveComponent("el-collapse-item"),c=resolveComponent("el-collapse"),u=resolveComponent("el-scrollbar");return openBlock(),createBlock(u,null,{default:withCtx(()=>[createVNode(c,{class:"ui-component-panel","model-value":e.collapseValue},{default:withCtx(()=>[createVNode(a,{"prefix-icon":"el-icon-search",placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4",class:"search-input",size:"small",clearable:"",modelValue:e.searchText,"onUpdate:modelValue":t[0]||(t[0]=f=>e.searchText=f)},null,8,["modelValue"]),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.list,(f,m)=>(openBlock(),createElementBlock(Fragment,null,[f.items&&f.items.length?(openBlock(),createBlock(d,{key:m,name:m},{title:withCtx(()=>[_hoisted_1$s,createTextVNode(toDisplayString(f.title),1)]),default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(f.items,h=>(openBlock(),createElementBlock("div",{class:"component-item",key:h.type,onClick:w=>e.appendComponent(h)},[createVNode(r,{icon:h.icon},null,8,["icon"]),createVNode(s,{effect:"dark",placement:"bottom",content:h.text},{default:withCtx(()=>[createBaseVNode("span",null,toDisplayString(h.text),1)]),_:2},1032,["content"])],8,_hoisted_2$f))),128))]),_:2},1032,["name"])):createCommentVNode("",!0)],64))),256))]),_:1},8,["model-value"])]),_:1})}var ComponentListPanel=_export_sfc(_sfc_main$L,[["render",_sfc_render$G]]);const _sfc_main$K=defineComponent({name:"magic-editor-content-menu",setup(){const e=inject("services"),t=ref(!1),o=computed(()=>e==null?void 0:e.editorService.get("node"));return{subVisible:t,node:o,componentGroupList:computed(()=>e==null?void 0:e.componentListService.getList()),append(n){e==null||e.editorService.add({name:n.text,type:n.type})},remove(){o.value&&(e==null||e.editorService.remove(o.value))},copy(n){n&&(e==null||e.editorService.copy(n))},setSubVisitable(n){t.value=n}}}}),_hoisted_1$r={key:0,class:"magic-editor-content-menu"},_hoisted_2$e=["onClick"],_hoisted_3$c=createBaseVNode("div",{class:"separation"},null,-1);function _sfc_render$F(e,t,o,n,i,l){const a=resolveComponent("el-scrollbar");return e.node?(openBlock(),createElementBlock("div",_hoisted_1$r,[e.node.items?(openBlock(),createElementBlock("div",{key:0,class:"magic-editor-content-menu-item",onMouseenter:t[0]||(t[0]=r=>e.setSubVisitable(!0)),onMouseleave:t[1]||(t[1]=r=>e.setSubVisitable(!1))}," \u65B0\u589E ",32)):createCommentVNode("",!0),e.node.type!=="app"?(openBlock(),createElementBlock("div",{key:1,class:"magic-editor-content-menu-item",onClick:t[2]||(t[2]=()=>e.copy(e.node))},"\u590D\u5236")):createCommentVNode("",!0),e.node.type!=="app"&&e.node.type!=="page"?(openBlock(),createElementBlock("div",{key:2,class:"magic-editor-content-menu-item",onClick:t[3]||(t[3]=()=>e.remove())}," \u5220\u9664 ")):createCommentVNode("",!0),withDirectives(createBaseVNode("div",{class:"subMenu",onMouseenter:t[5]||(t[5]=r=>e.setSubVisitable(!0)),onMouseleave:t[6]||(t[6]=r=>e.setSubVisitable(!1))},[createVNode(a,null,{default:withCtx(()=>[e.node.type==="tabs"?(openBlock(),createElementBlock("div",{key:0,class:"magic-editor-content-menu-item",onClick:t[4]||(t[4]=()=>e.append({type:"tab-pane"}))}," \u6807\u7B7E ")):e.node.items?(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(e.componentGroupList,r=>(openBlock(),createElementBlock("div",{key:r.title},[(openBlock(!0),createElementBlock(Fragment,null,renderList(r.items,s=>(openBlock(),createElementBlock(Fragment,null,[s?(openBlock(),createElementBlock("div",{class:"magic-editor-content-menu-item",key:s.type,onClick:()=>e.append(s)},toDisplayString(s.text),9,_hoisted_2$e)):createCommentVNode("",!0)],64))),256)),_hoisted_3$c]))),128)):createCommentVNode("",!0)]),_:1})],544),[[vShow,e.subVisible]])])):createCommentVNode("",!0)}var LayerMenu=_export_sfc(_sfc_main$K,[["render",_sfc_render$F]]);const throttleTime$1=150,select=async(e,t)=>{var o;if(!e.id)throw new Error("\u6CA1\u6709id");await(t==null?void 0:t.select(e)),(o=t==null?void 0:t.get("stage"))==null||o.select(e.id)},highlight=(e,t)=>{var o;if(!(e==null?void 0:e.id))throw new Error("\u6CA1\u6709id");t==null||t.highlight(e),(o=t==null?void 0:t.get("stage"))==null||o.highlight(e.id)},useDrop=(e,t)=>({allowDrop:(o,n,i)=>{const{data:l}=n||{},{data:a}=o,{type:r}=a;return r!==NodeType.PAGE&&l.type===NodeType.PAGE||r===NodeType.PAGE&&l.type!==NodeType.PAGE||!l||!l.type?!1:!!(["prev","next"].includes(i)||l.items||l.type==="container")},handleDragEnd(){if(!e.value)return;const{data:o}=e.value,[n]=o;t==null||t.update(n)}}),useStatus=(e,t)=>{const o=ref(),n=ref(),i=computed(()=>t==null?void 0:t.get("page"));return watchEffect(()=>{if(!e.value)return;n.value=t==null?void 0:t.get("node"),n.value&&e.value.setCurrentKey(n.value.id,!0);const l=t==null?void 0:t.get("parent");if(!(l==null?void 0:l.id))return;const a=e.value.getNode(l.id);a==null||a.updateChildren(),o.value=t==null?void 0:t.get("highlightNode")}),{values:computed(()=>i.value?[i.value]:[]),loadItems:(l,a)=>{var r,s;if(Array.isArray(l.data))return a(l.data);if(Array.isArray((r=l.data)==null?void 0:r.items))return a((s=l.data)==null?void 0:s.items);a([])},highlightNode:o,clickNode:n,expandedKeys:computed(()=>n.value?[n.value.id]:[])}},useFilter=e=>({filterText:ref(""),filterNode:(t,o)=>{if(!t)return!0;let n="";return o.name?n=o.name:o.items&&(n="container"),`${o.id}${n}${o.type}`.indexOf(t)!==-1},filterTextChangeHandler(t){var o;(o=e.value)==null||o.filter(t)}}),useContentMenu=e=>{const t=ref({position:"absolute",left:"0",top:"0",display:"none"});return onMounted(()=>{document.addEventListener("click",()=>{t.value.display="none"},!0)}),{menuStyle:t,contextmenu(o,n){const i=globalThis.document.body.clientHeight,l=`${o.clientX+20}px`;let a=`${o.clientY-10}px`;o.clientY+300>i&&(a=`${i-300}px`),t.value.left=l,t.value.top=a,t.value.display="",select(n,e)}}},_sfc_main$J=defineComponent({name:"magic-editor-layer-panel",components:{LayerMenu},setup(){const e=inject("services"),t=ref(),o=ref(!1),n=e==null?void 0:e.editorService,i=throttle(s=>{highlight(s,n)},throttleTime$1),l=()=>{o.value=!o.value},a=useStatus(t,n),r=computed(()=>{var s,d;return((s=a.highlightNode.value)==null?void 0:s.id)!==((d=a.clickNode.value)==null?void 0:d.id)&&!o.value});return V(_(_(_(_({tree:t},a),useDrop(t,n)),useFilter(t)),useContentMenu(n)),{clickHandler(s){var d;if(e==null?void 0:e.uiService.get("uiSelectMode")){document.dispatchEvent(new CustomEvent("ui-select",{detail:s}));return}(d=t.value)==null||d.setCurrentKey(s.id),select(s,n)},highlightHandler:i,toogleClickFlag:l,canHighlight:r})}}),_hoisted_1$q=["id","onMouseenter"];function _sfc_render$E(e,t,o,n,i,l){const a=resolveComponent("el-input"),r=resolveComponent("el-tree"),s=resolveComponent("layer-menu"),d=resolveComponent("el-scrollbar");return openBlock(),createBlock(d,{class:"magic-editor-layer-panel"},{default:withCtx(()=>[createVNode(a,{class:"filterInput",size:"small",placeholder:"\u8F93\u5165\u5173\u952E\u5B57\u8FDB\u884C\u8FC7\u6EE4",clearable:"",modelValue:e.filterText,"onUpdate:modelValue":t[0]||(t[0]=c=>e.filterText=c),onChange:e.filterTextChangeHandler},null,8,["modelValue","onChange"]),e.values.length?(openBlock(),createBlock(r,{key:0,ref:"tree","node-key":"id",draggable:"","default-expanded-keys":e.expandedKeys,load:e.loadItems,data:e.values,"expand-on-click-node":!1,"highlight-current":!0,props:{children:"items"},"filter-node-method":e.filterNode,"allow-drop":e.allowDrop,onNodeClick:e.clickHandler,onNodeContextmenu:e.contextmenu,onNodeDragEnd:e.handleDragEnd,"empty-text":"\u9875\u9762\u7A7A\u8361\u8361\u7684"},{default:withCtx(({node:c,data:u})=>{var f;return[createBaseVNode("div",{id:u.id,class:normalizeClass(["cus-tree-node",{"cus-tree-node-hover":e.canHighlight&&u.id===((f=e.highlightNode)==null?void 0:f.id)}]),onMousedown:t[1]||(t[1]=(...m)=>e.toogleClickFlag&&e.toogleClickFlag(...m)),onMouseup:t[2]||(t[2]=(...m)=>e.toogleClickFlag&&e.toogleClickFlag(...m)),onMouseenter:m=>e.highlightHandler(u)},[renderSlot(e.$slots,"layer-node-content",{node:c,data:u},()=>[createBaseVNode("span",null,toDisplayString(`${u.name} (${u.id})`),1)])],42,_hoisted_1$q)]}),_:3},8,["default-expanded-keys","load","data","filter-node-method","allow-drop","onNodeClick","onNodeContextmenu","onNodeDragEnd"])):createCommentVNode("",!0),(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(s,{style:normalizeStyle(e.menuStyle)},null,8,["style"])]))]),_:3})}var LayerPanel=_export_sfc(_sfc_main$J,[["render",_sfc_render$E]]);const _sfc_main$I=defineComponent({name:"m-sidebar",components:{MIcon},props:{data:{type:Object,default:()=>({type:"tabs",status:"\u7EC4\u4EF6",items:["component-list","layer"]})}},setup(e){var o;const t=ref((o=e.data)==null?void 0:o.status);return watch(()=>{var n;return(n=e.data)==null?void 0:n.status},n=>{t.value=n||"0"}),{activeTabName:t,items:computed(()=>{var n;return(n=e.data)==null?void 0:n.items.map(i=>{if(typeof i!="string")return i;switch(i){case"component-list":return{type:"component",icon:Coin,text:"\u7EC4\u4EF6",component:ComponentListPanel,slots:{}};case"layer":return{type:"component",icon:Files,text:"\u5DF2\u9009\u7EC4\u4EF6",component:LayerPanel,slots:{}};default:return{}}})})}}}),_hoisted_1$p={key:1,class:"magic-editor-tab-panel-title"};function _sfc_render$D(e,t,o,n,i,l){const a=resolveComponent("m-icon"),r=resolveComponent("el-tab-pane"),s=resolveComponent("el-tabs");return e.data.type==="tabs"?(openBlock(),createBlock(s,{key:0,class:"m-editor-sidebar",modelValue:e.activeTabName,"onUpdate:modelValue":t[0]||(t[0]=d=>e.activeTabName=d),type:"card","tab-position":"left"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.items,d=>(openBlock(),createBlock(r,{key:d.text,name:d.text},{label:withCtx(()=>[createBaseVNode("span",null,[d.icon?(openBlock(),createBlock(a,{key:0,icon:d.icon},null,8,["icon"])):createCommentVNode("",!0),d.text?(openBlock(),createElementBlock("div",_hoisted_1$p,toDisplayString(d.text),1)):createCommentVNode("",!0)])]),default:withCtx(()=>{var c;return[(openBlock(),createBlock(resolveDynamicComponent(d.component),mergeProps(d.props||{},toHandlers(d.listeners||{})),createSlots({_:2},[((c=d.slots)==null?void 0:c.layerNodeContent)?{name:"layer-node-content",fn:withCtx(({data:u,node:f})=>[(openBlock(),createBlock(resolveDynamicComponent(d.slots.layerNodeContent),{data:u,node:f},null,8,["data","node"]))])}:void 0]),1040))]}),_:2},1032,["name"]))),128))]),_:1},8,["modelValue"])):createCommentVNode("",!0)}var Sidebar=_export_sfc(_sfc_main$I,[["render",_sfc_render$D]]);const useScroll=e=>{const t=ref(),o=ref(),n=ref(0),i=ref(!1),l=computed(()=>n.value-105);let a=0;const r=new ResizeObserver(c=>{for(const{contentRect:u}of c){const{width:f}=u;n.value=f||0,s()}}),s=()=>{o.value&&(i.value=o.value.scrollWidth>n.value-105)},d=c=>{if(!o.value)return;const u=o.value.scrollWidth-l.value;c==="left"?(a+=100,a>0&&(a=0)):c==="right"?(a-=100,-a>u&&(a=-u)):c==="start"?a=0:c==="end"&&(a=-u),o.value.style.transform=`translate(${a}px, 0px)`};return onMounted(()=>{t.value&&r.observe(t.value)}),onUnmounted(()=>{r.disconnect()}),watch(()=>{var c;return(c=e.value)==null?void 0:c.items.length},(c=0,u=0)=>{setTimeout(()=>{s(),c<u?d("start"):d("end")})}),{pageBar:t,itemsContainer:o,canScroll:i,itemsContainerWidth:l,scroll:d}},_sfc_main$H=defineComponent({components:{ArrowLeftBold,ArrowRightBold,CaretBottom,Plus},setup(){const e=inject("services"),t=e==null?void 0:e.editorService,o=computed(()=>t==null?void 0:t.get("root"));return V(_({},useScroll(o)),{root:o,page:computed(()=>t==null?void 0:t.get("page")),switchPage(n){t==null||t.select(n)},addPage(){if(!t)return;const n={type:NodeType.PAGE,name:generatePageNameByApp(toRaw(t.get("root")))};t.add(n)},copy(n){n&&(t==null||t.copy(n)),t==null||t.paste({left:0,top:0})},remove(n){t==null||t.remove(n)}})}}),_hoisted_1$o={class:"m-editor-page-bar",ref:"pageBar"},_hoisted_2$d=["onClick"],_hoisted_3$b={class:"m-editor-page-bar-title"},_hoisted_4$9=["onClick"],_hoisted_5$6=["onClick"];function _sfc_render$C(e,t,o,n,i,l){const a=resolveComponent("plus"),r=resolveComponent("el-icon"),s=resolveComponent("arrow-left-bold"),d=resolveComponent("el-tooltip"),c=resolveComponent("caret-bottom"),u=resolveComponent("el-popover"),f=resolveComponent("arrow-right-bold");return openBlock(),createElementBlock("div",_hoisted_1$o,[createBaseVNode("div",{id:"m-editor-page-bar-add-icon",class:"m-editor-page-bar-item m-editor-page-bar-item-icon",onClick:t[0]||(t[0]=(...m)=>e.addPage&&e.addPage(...m))},[createVNode(r,null,{default:withCtx(()=>[createVNode(a)]),_:1})]),e.canScroll?(openBlock(),createElementBlock("div",{key:0,class:"m-editor-page-bar-item m-editor-page-bar-item-icon",onClick:t[1]||(t[1]=m=>e.scroll("left"))},[createVNode(r,null,{default:withCtx(()=>[createVNode(s)]),_:1})])):createCommentVNode("",!0),e.root?(openBlock(),createElementBlock("div",{key:1,class:"m-editor-page-bar-items",ref:"itemsContainer",style:normalizeStyle(`width: ${e.itemsContainerWidth}px`)},[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.root.items,m=>{var h;return openBlock(),createElementBlock("div",{key:m.key,class:normalizeClass(["m-editor-page-bar-item",{active:((h=e.page)==null?void 0:h.id)===m.id}]),onClick:w=>e.switchPage(m)},[createBaseVNode("div",_hoisted_3$b,[renderSlot(e.$slots,"page-bar-title",{page:m},()=>[createVNode(d,{effect:"dark",placement:"top-start",content:m.name},{default:withCtx(()=>[createBaseVNode("span",null,toDisplayString(m.name),1)]),_:2},1032,["content"])])]),createVNode(u,{placement:"top",width:160,trigger:"hover"},{reference:withCtx(()=>[createVNode(r,{class:"m-editor-page-bar-menu-icon"},{default:withCtx(()=>[createVNode(c)]),_:1})]),default:withCtx(()=>[createBaseVNode("div",null,[renderSlot(e.$slots,"page-bar-popover",{page:m},()=>[createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:()=>e.copy(m)},"\u590D\u5236",8,_hoisted_4$9),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:()=>e.remove(m)},"\u5220\u9664",8,_hoisted_5$6)])])]),_:2},1024)],10,_hoisted_2$d)}),128))],4)):createCommentVNode("",!0),e.canScroll?(openBlock(),createElementBlock("div",{key:2,class:"m-editor-page-bar-item m-editor-page-bar-item-icon",onClick:t[2]||(t[2]=m=>e.scroll("right"))},[createVNode(r,null,{default:withCtx(()=>[createVNode(f)]),_:1})])):createCommentVNode("",!0)],512)}var PageBar=_export_sfc(_sfc_main$H,[["render",_sfc_render$C]]);const GHOST_EL_ID_PREFIX="ghost_el_",DRAG_EL_ID_PREFIX="drag_el_",DEFAULT_ZOOM=1;var GuidesType=(e=>(e.HORIZONTAL="horizontal",e.VERTICAL="vertical",e))(GuidesType||{}),ZIndex=(e=>(e.MASK="99999",e.SELECTED_EL="666",e))(ZIndex||{}),MouseButton=(e=>(e[e.LEFT=0]="LEFT",e[e.MIDDLE=1]="MIDDLE",e[e.RIGHT=2]="RIGHT",e))(MouseButton||{}),Mode=(e=>(e.ABSOLUTE="absolute",e.FIXED="fixed",e.SORTABLE="sortable",e))(Mode||{});const SELECTED_CLASS="tmagic-stage-selected-area",getOffset=e=>{const{transform:t}=getComputedStyle(e),{offsetParent:o}=e;let n=e.offsetLeft,i=e.offsetTop;if(t.indexOf("matrix")>-1){let l=1,a=1,r=1,s=1,d=0,c=0;t.replace(/matrix\((.+), (.+), (.+), (.+), (.+), (.+)\)/,(u,f,m,h,w,E,y)=>(l=+f,a=+m,r=+h,s=+w,d=+E,c=+y,t)),n=l*n+r*i+d,i=a*n+s*i+c}if(o){const l=getOffset(o);return{left:n+l.left,top:i+l.top}}return{left:n,top:i}},getAbsolutePosition=(e,{top:t,left:o})=>{const{offsetParent:n}=e;if(n){const i=getOffset(n);return{left:o-i.left,top:t-i.top}}return{left:o,top:t}},getHost=e=>{var t;return(t=e.match(/\/\/([^/]+)/))==null?void 0:t[1]},isSameDomain=(e="",t=globalThis.location.host)=>/^(http[s]?:)?\/\//.test(e)?getHost(e)===t:!0,isAbsolute=e=>e?getComputedStyle(e).position==="absolute":!1,isRelative=e=>e?getComputedStyle(e).position==="relative":!1,isStatic=e=>e?getComputedStyle(e).position==="static":!1,isFixed=e=>e?getComputedStyle(e).position==="fixed":!1,isFixedParent=e=>{let t=!1,o=e;for(;o&&(t=isFixed(o),!t);){const{parentElement:n}=o;if(!n||n.tagName==="BODY")break;o=n}return t},getMode=e=>isFixedParent(e)?Mode.FIXED:isStatic(e)||isRelative(e)?Mode.SORTABLE:Mode.ABSOLUTE,getScrollParent=(e,t=!1)=>{let o=getComputedStyle(e);const n=t?/(auto|scroll|hidden)/:/(auto|scroll)/;if(isFixed(e))return null;for(let i=e;i.parentElement;)if(i=i.parentElement,o=getComputedStyle(i),!(isAbsolute(e)&&isStatic(e))&&n.test(o.overflow+o.overflowY+o.overflowX))return i;return null},createDiv=({className:e,cssText:t})=>{const o=globalThis.document.createElement("div");return o.className=e,o.style.cssText=t,o},removeSelectedClassName=e=>{var o;const t=e.querySelector(`.${SELECTED_CLASS}`);t&&(t.classList.remove(SELECTED_CLASS),(o=t.parentNode)==null||o.classList.remove(`${SELECTED_CLASS}-parent`))},addSelectedClassName=e=>{var t;e.classList.add(SELECTED_CLASS),(t=e.parentNode)==null||t.classList.add(`${SELECTED_CLASS}-parent`)};class StageDragResize extends events.exports.EventEmitter{constructor(t){super();g(this,"core");g(this,"container");g(this,"target");g(this,"dragEl");g(this,"moveable");g(this,"horizontalGuidelines",[]);g(this,"verticalGuidelines",[]);g(this,"elementGuidelines",[]);g(this,"moveableOptions",{});g(this,"dragStatus","end");g(this,"ghostEl");g(this,"mode",Mode.ABSOLUTE);g(this,"moveableHelper");this.core=t.core,this.container=t.container,this.dragEl=globalThis.document.createElement("div"),this.container.append(this.dragEl)}select(t,o){var i;const n=this.target;this.target=t,this.init(t),!this.moveable||this.target!==n?(this.moveableHelper=MoveableHelper.create({useBeforeRender:!0,useRender:!1,createAuto:!0}),this.initMoveable()):this.updateMoveable(),o&&((i=this.moveable)==null||i.dragStart(o))}updateMoveable(t=this.target){if(!this.moveable)throw new Error("\u672A\u521D\u59CB\u5316moveable");if(!t)throw new Error("\u4E3A\u9009\u4E2D\u4EFB\u4F55\u8282\u70B9");this.target=t,this.init(t),Object.entries(this.moveableOptions).forEach(([o,n])=>{this.moveable[o]=n}),this.moveable.updateTarget()}setGuidelines(t,o){t===GuidesType.HORIZONTAL?(this.horizontalGuidelines=o,this.moveableOptions.horizontalGuidelines=o):t===GuidesType.VERTICAL&&(this.verticalGuidelines=o,this.moveableOptions.verticalGuidelines=o),this.updateMoveable()}clearGuides(){this.horizontalGuidelines=[],this.verticalGuidelines=[],this.moveableOptions.horizontalGuidelines=[],this.moveableOptions.verticalGuidelines=[],this.updateMoveable()}destroy(){var t;(t=this.moveable)==null||t.destroy(),this.destroyGhostEl(),this.destroyDragEl(),this.dragStatus="end",this.removeAllListeners()}init(t){/(auto|scroll)/.test(t.style.overflow)&&(t.style.overflow="hidden"),this.mode=getMode(t),this.destroyGhostEl(),this.updateDragEl(t),this.moveableOptions=this.getOptions({target:this.dragEl})}initMoveable(){var t;(t=this.moveable)==null||t.destroy(),this.moveable=new Moveable(this.container,_({},this.moveableOptions)),this.bindResizeEvent(),this.bindDragEvent()}bindResizeEvent(){if(!this.moveable)throw new Error("moveable \u4E3A\u521D\u59CB\u5316");this.moveable.on("resizeStart",t=>{if(t.dragStart){const o=this.moveable.getRect(),n=getAbsolutePosition(t.target,o);t.dragStart.set([n.left,n.top])}}).on("resize",({width:t,height:o,drag:n})=>{if(!this.moveable||!this.target||!this.dragEl)return;const{beforeTranslate:i}=n;if(this.dragStatus="ing",this.target.style.width=`${t}px`,this.target.style.height=`${o}px`,this.dragEl.style.width=`${t}px`,this.dragEl.style.height=`${o}px`,this.mode===Mode.SORTABLE){this.dragEl.style.top=`${i[1]}px`,this.target.style.top="0px";return}this.dragEl.style.left=`${i[0]}px`,this.dragEl.style.top=`${i[1]}px`;const l=getAbsolutePosition(this.target,{left:i[0],top:i[1]});this.target.style.left=`${l.left}px`,this.target.style.top=`${l.top}px`}).on("resizeEnd",()=>{this.dragStatus="end",this.update(!0)})}bindDragEvent(){if(!this.moveable)throw new Error("moveable \u4E3A\u521D\u59CB\u5316");let t=null;this.moveable.on("dragStart",o=>{var n;if(!this.target)throw new Error("\u672A\u9009\u4E2D\u7EC4\u4EF6");this.dragStatus="start",(n=this.moveableHelper)==null||n.onDragStart(o),this.mode===Mode.SORTABLE&&(this.ghostEl=this.generateGhostEl(this.target))}).on("drag",o=>{var l;if(!this.target||!this.dragEl)return;t||(t=getAbsolutePosition(this.target,{left:0,top:0})),this.dragStatus="ing";const{left:n,top:i}=o;if(this.ghostEl){this.dragEl.style.top=`${i}px`,this.ghostEl.style.top=`${i+t.top}px`;return}(l=this.moveableHelper)==null||l.onDrag(o),this.target.style.left=`${n+t.left}px`,this.target.style.top=`${i+t.top}px`}).on("dragEnd",()=>{if(this.dragStatus==="ing")switch(this.mode){case Mode.SORTABLE:this.sort();break;default:this.update()}t=null,this.dragStatus="end",this.destroyGhostEl()})}getSnapElements(t,o){const{renderer:n,mask:i}=this.core;return((t==null?void 0:t.getSnapElements)||(()=>{var r;const a=(r=n.contentWindow)==null?void 0:r.document;return a?Array.from(a.querySelectorAll("[id]")):[]}))(o).filter(a=>{var r;return a!==this.target&&!((r=this.target)==null?void 0:r.contains(a))&&a!==i.page})}sort(){if(!this.target||!this.ghostEl)throw new Error("\u672A\u77E5\u9519\u8BEF");const{top:t}=this.ghostEl.getBoundingClientRect(),{top:o}=this.target.getBoundingClientRect(),n=t-o;Math.abs(n)>=this.target.clientHeight/2?n>0?this.emit("sort",down(n,this.target)):this.emit("sort",up(n,this.target)):this.emit("sort",{src:this.target.id,dist:this.target.id})}update(t=!1){const o=this.moveable.getRect(),n=this.mode===Mode.SORTABLE?{left:0,top:0}:getAbsolutePosition(this.target,o),i=this.calcValueByFontsize(n.left),l=this.calcValueByFontsize(n.top),a=this.calcValueByFontsize(o.width),r=this.calcValueByFontsize(o.height);this.emit("update",{el:this.target,style:t?{left:i,top:l,width:a,height:r}:{left:i,top:l}})}generateGhostEl(t){this.ghostEl&&this.destroyGhostEl();const o=t.cloneNode(!0),{top:n,left:i}=getAbsolutePosition(t,getOffset(t));return o.id=`${GHOST_EL_ID_PREFIX}${t.id}`,o.style.zIndex="5",o.style.opacity=".5",o.style.position="absolute",o.style.left=`${i}px`,o.style.top=`${n}px`,t.after(o),o}destroyGhostEl(){var t;(t=this.ghostEl)==null||t.remove(),this.ghostEl=void 0}updateDragEl(t){const{width:o,height:n}=t.getBoundingClientRect(),i=getOffset(t);this.dragEl.style.cssText=`
      position: absolute;
      left: ${i.left}px;
      top: ${i.top}px;
      width: ${o}px;
      height: ${n}px;
    `,this.dragEl.id=`${DRAG_EL_ID_PREFIX}${t.id}`}destroyDragEl(){var t;(t=this.dragEl)==null||t.remove()}getOptions(t={}){if(!this.target)return{};const o=this.mode===Mode.ABSOLUTE;let{moveableOptions:n={}}=this.core.config;return typeof n=="function"&&(n=n(this.core)),_(_({origin:!1,rootContainer:this.core.container,zoom:1,dragArea:!1,draggable:!0,resizable:!0,snappable:o,snapGap:o,snapThreshold:5,snapDigit:0,throttleDrag:0,isDisplaySnapDigit:o,snapDirections:{top:o,right:o,bottom:o,left:o,center:o,middle:o},elementSnapDirections:{top:o,right:o,bottom:o,left:o},isDisplayInnerSnapDigit:!0,horizontalGuidelines:this.horizontalGuidelines,verticalGuidelines:this.verticalGuidelines,elementGuidelines:this.elementGuidelines,bounds:_({top:0,left:0,right:this.container.clientWidth,bottom:this.container.clientHeight},n.bounds||{})},t),n)}calcValueByFontsize(t){const{contentWindow:o}=this.core.renderer,n=o==null?void 0:o.document.documentElement.style.fontSize;if(n){const i=globalThis.parseFloat(n)/100;return(t/i).toFixed(2)}return t}}const down=(e,t)=>{var r,s;let o=0,n=t.clientHeight;const i=Array.from(((r=t.parentNode)==null?void 0:r.children)||[]).filter(d=>!d.id.startsWith(GHOST_EL_ID_PREFIX)),l=i.indexOf(t),a=i.slice(l+1);for(let d=0;d<a.length;d++){const c=a[d];if(((s=c.style)==null?void 0:s.position)!=="fixed"){if(n+=c.clientHeight/2,e<=n)break;n+=c.clientHeight/2,o=d}}return{src:t.id,dist:a.length&&o>-1?a[o].id:t.id}},up=(e,t)=>{var r;const o=Array.from(((r=t.parentNode)==null?void 0:r.children)||[]).filter(s=>!s.id.startsWith(GHOST_EL_ID_PREFIX)),n=o.indexOf(t),i=o.slice(0,n);let l=t.clientHeight,a=i.length-1;for(let s=i.length-1;s>=0;s--){const d=i[s];if(!!d&&d.style.position!=="fixed"){if(l+=d.clientHeight/2,-e<=l)break;l+=d.clientHeight/2,a=s}}return{src:t.id,dist:i.length&&a>-1?i[a].id:t.id}};class StageHighlight extends events.exports.EventEmitter{constructor(t){super();g(this,"core");g(this,"container");g(this,"target");g(this,"moveable");this.core=t.core,this.container=t.container}highlight(t){var o;!t||t===this.target||(this.target=t,(o=this.moveable)==null||o.destroy(),this.moveable=new Moveable(this.container,{target:this.target,scrollable:!0,origin:!1}))}clearHighlight(){!this.moveable||(this.moveable.target=null,this.moveable.updateTarget())}destroy(){var t;(t=this.moveable)==null||t.destroy()}}class Rule extends EventEmitter{constructor(t){super();g(this,"hGuides");g(this,"vGuides");g(this,"horizontalGuidelines",[]);g(this,"verticalGuidelines",[]);g(this,"container");g(this,"containerResizeObserver");g(this,"getGuidesStyle",t=>({position:"fixed",zIndex:1,left:t===GuidesType.HORIZONTAL?0:"-30px",top:t===GuidesType.HORIZONTAL?"-30px":0,width:t===GuidesType.HORIZONTAL?"100%":"30px",height:t===GuidesType.HORIZONTAL?"30px":"100%"}));g(this,"createGuides",(t,o=[])=>new Guides(this.container,{type:t,defaultGuides:o,displayDragPos:!0,backgroundColor:"#fff",lineColor:"#000",textColor:"#000",style:this.getGuidesStyle(t)}));g(this,"hGuidesChangeGuidesHandler",t=>{this.horizontalGuidelines=t.guides,this.emit("changeGuides",{type:GuidesType.HORIZONTAL,guides:this.horizontalGuidelines})});g(this,"vGuidesChangeGuidesHandler",t=>{this.verticalGuidelines=t.guides,this.emit("changeGuides",{type:GuidesType.VERTICAL,guides:this.verticalGuidelines})});this.container=t,this.hGuides=this.createGuides(GuidesType.HORIZONTAL),this.vGuides=this.createGuides(GuidesType.VERTICAL),this.hGuides.on("changeGuides",this.hGuidesChangeGuidesHandler),this.vGuides.on("changeGuides",this.vGuidesChangeGuidesHandler),this.containerResizeObserver=new ResizeObserver(()=>{this.vGuides.resize(),this.hGuides.resize()}),this.containerResizeObserver.observe(this.container)}showGuides(t=!0){this.hGuides.setState({showGuides:t}),this.vGuides.setState({showGuides:t})}clearGuides(){this.horizontalGuidelines=[],this.verticalGuidelines=[],this.vGuides.setState({defaultGuides:[]}),this.hGuides.setState({defaultGuides:[]}),this.emit("changeGuides",{type:GuidesType.VERTICAL,guides:[]}),this.emit("changeGuides",{type:GuidesType.HORIZONTAL,guides:[]})}showRule(t=!0){t?(this.hGuides.destroy(),this.hGuides=this.createGuides(GuidesType.HORIZONTAL,this.horizontalGuidelines),this.vGuides.destroy(),this.vGuides=this.createGuides(GuidesType.VERTICAL,this.verticalGuidelines)):(this.hGuides.setState({rulerStyle:{visibility:"hidden"}}),this.vGuides.setState({rulerStyle:{visibility:"hidden"}}))}scrollRule(t){this.hGuides.scrollGuides(t),this.hGuides.scroll(0),this.vGuides.scrollGuides(0),this.vGuides.scroll(t)}destroy(){this.hGuides.off("changeGuides",this.hGuidesChangeGuidesHandler),this.vGuides.off("changeGuides",this.vGuidesChangeGuidesHandler),this.containerResizeObserver.disconnect(),this.removeAllListeners()}}const wrapperClassName="editor-mask-wrapper",throttleTime=300,hideScrollbar=()=>{const e=globalThis.document.createElement("style");e.innerHTML=`
    .${wrapperClassName}::-webkit-scrollbar { width: 0 !important; display: none }
  `,globalThis.document.head.appendChild(e)},createContent=()=>createDiv({className:"editor-mask",cssText:`
    position: absolute;
    top: 0;
    left: 0;
    transform: translate3d(0, 0, 0);
  `}),createWrapper=()=>{const e=createDiv({className:wrapperClassName,cssText:`
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 100%;
      overflow: hidden;
      z-index: ${ZIndex.MASK};
    `});return hideScrollbar(),e};class StageMask extends Rule{constructor(t){const o=createWrapper();super(o);g(this,"content",createContent());g(this,"wrapper");g(this,"core");g(this,"page",null);g(this,"pageScrollParent",null);g(this,"scrollTop",0);g(this,"scrollLeft",0);g(this,"width",0);g(this,"height",0);g(this,"wrapperHeight",0);g(this,"wrapperWidth",0);g(this,"mode",Mode.ABSOLUTE);g(this,"pageResizeObserver",null);g(this,"wrapperResizeObserver",null);g(this,"highlightHandler",throttle(t=>{this.emit("highlight",t)},throttleTime));g(this,"mouseDownHandler",t=>{this.emit("clearHighlight"),t.stopImmediatePropagation(),t.stopPropagation(),!(t.button!==MouseButton.LEFT&&t.button!==MouseButton.RIGHT)&&t.target.className.indexOf("moveable-control")===-1&&(this.content.removeEventListener("mousemove",this.highlightHandler),this.emit("beforeSelect",t),globalThis.document.addEventListener("mouseup",this.mouseUpHandler))});g(this,"mouseUpHandler",()=>{globalThis.document.removeEventListener("mouseup",this.mouseUpHandler),this.content.addEventListener("mousemove",this.highlightHandler),this.emit("select")});g(this,"mouseWheelHandler",t=>{if(this.emit("clearHighlight"),!this.page)throw new Error("page \u672A\u521D\u59CB\u5316");const{deltaY:o,deltaX:n}=t,{height:i,wrapperHeight:l,width:a,wrapperWidth:r}=this,s=i-l,d=a-r;s>0&&(o>0?this.scrollTop=this.scrollTop+Math.min(s-this.scrollTop,o):this.scrollTop=Math.max(this.scrollTop+o,0)),a>r&&(n>0?this.scrollLeft=this.scrollLeft+Math.min(d-this.scrollLeft,n):this.scrollLeft=Math.max(this.scrollLeft+n,0)),this.mode!==Mode.FIXED&&this.scrollTo(this.scrollLeft,this.scrollTop),this.pageScrollParent&&this.pageScrollParent.scrollTo({top:this.scrollTop,left:this.scrollLeft}),this.scroll(),this.emit("scroll",t)});this.wrapper=o,this.core=t.core,this.content.addEventListener("mousedown",this.mouseDownHandler),this.wrapper.appendChild(this.content),this.content.addEventListener("wheel",this.mouseWheelHandler),this.content.addEventListener("mousemove",this.highlightHandler)}setMode(t){this.mode=t,this.scroll(),t===Mode.FIXED?(this.content.style.width=`${this.wrapperWidth}px`,this.content.style.height=`${this.wrapperHeight}px`):(this.content.style.width=`${this.width}px`,this.content.style.height=`${this.height}px`)}observe(t){var o,n;!t||(this.page=t,this.pageScrollParent=getScrollParent(t)||((o=this.core.renderer.contentWindow)==null?void 0:o.document.documentElement)||null,(n=this.pageResizeObserver)==null||n.disconnect(),typeof ResizeObserver!="undefined"&&(this.pageResizeObserver=new ResizeObserver(i=>{const[l]=i,{clientHeight:a,clientWidth:r}=l.target;this.setHeight(a),this.setWidth(r)}),this.pageResizeObserver.observe(t),this.wrapperResizeObserver=new ResizeObserver(i=>{const[l]=i,{clientHeight:a,clientWidth:r}=l.target;this.wrapperHeight=a,this.wrapperWidth=r}),this.wrapperResizeObserver.observe(this.wrapper)))}mount(t){if(!this.content)throw new Error("content \u4E0D\u5B58\u5728");t.appendChild(this.wrapper)}setLayout(t){this.setMode(isFixedParent(t)?Mode.FIXED:Mode.ABSOLUTE)}destroy(){var t,o,n;(t=this.content)==null||t.remove(),this.page=null,this.pageScrollParent=null,(o=this.pageResizeObserver)==null||o.disconnect(),(n=this.wrapperResizeObserver)==null||n.disconnect(),super.destroy()}scroll(){let{scrollLeft:t,scrollTop:o}=this;this.mode===Mode.FIXED&&(t=0,o=0),this.scrollRule(o),this.scrollTo(t,o)}scrollTo(t,o){this.content.style.transform=`translate3d(${-t}px, ${-o}px, 0)`}setHeight(t){this.height=t,this.content.style.height=`${t}px`}setWidth(t){this.width=t,this.content.style.width=`${t}px`}}class StageRender extends events.exports.EventEmitter{constructor({core:t}){super();g(this,"contentWindow",null);g(this,"runtime",null);g(this,"iframe");g(this,"runtimeUrl");g(this,"core");g(this,"render");g(this,"getMagicApi",()=>({onPageElUpdate:t=>this.emit("page-el-update",t),onRuntimeReady:t=>{this.runtime=t,globalThis.runtime=t,this.emit("runtime-ready",t)}}));g(this,"getRuntime",()=>this.runtime?Promise.resolve(this.runtime):new Promise(t=>{const o=n=>{this.off("runtime-ready",o),t(n)};this.on("runtime-ready",o)}));g(this,"loadHandler",async()=>{var t,o,n;if(this.emit("onload"),this.render){const i=await this.render(this.core);i&&((n=(o=(t=this.iframe)==null?void 0:t.contentDocument)==null?void 0:o.body)==null||n.appendChild(i))}if(this.contentWindow){const i=this.contentWindow.document.createElement("style");i.id="tmagic-stage-render",i.innerHTML=`
        .${SELECTED_CLASS}, .${SELECTED_CLASS}-parent {
          z-index: ${ZIndex.SELECTED_EL};
        }
      `,this.contentWindow.document.head.appendChild(i)}});this.core=t,this.runtimeUrl=t.config.runtimeUrl||"",this.render=t.config.render,this.iframe=globalThis.document.createElement("iframe"),this.iframe.src=isSameDomain(this.runtimeUrl)?this.runtimeUrl:"",this.iframe.style.cssText=`
      border: 0;
      width: 100%;
      height: 100%;
    `,this.iframe.addEventListener("load",this.loadHandler)}async mount(t){var o;if(this.iframe){if(!isSameDomain(this.runtimeUrl)&&this.runtimeUrl){let n=await fetch(this.runtimeUrl).then(l=>l.text());const i=`${location.protocol}//${getHost(this.runtimeUrl)}`;n=n.replace("<head>",`<head>
<base href="${i}">`),this.iframe.srcdoc=n}t.appendChild(this.iframe),this.contentWindow=(o=this.iframe)==null?void 0:o.contentWindow,this.contentWindow.magic=this.getMagicApi()}else throw Error("mount \u5931\u8D25")}destroy(){var t,o;(t=this.iframe)==null||t.removeEventListener("load",this.loadHandler),this.contentWindow=null,(o=this.iframe)==null||o.remove(),this.iframe=void 0,this.removeAllListeners()}}class StageCore extends events.exports.EventEmitter{constructor(t){super();g(this,"selectedDom");g(this,"highlightedDom");g(this,"renderer");g(this,"mask");g(this,"dr");g(this,"highlightLayer");g(this,"config");g(this,"zoom",DEFAULT_ZOOM);g(this,"container");g(this,"canSelect");this.config=t,this.setZoom(t.zoom),this.canSelect=t.canSelect||(o=>!!o.id),this.renderer=new StageRender({core:this}),this.mask=new StageMask({core:this}),this.dr=new StageDragResize({core:this,container:this.mask.content}),this.highlightLayer=new StageHighlight({core:this,container:this.mask.wrapper}),this.renderer.on("runtime-ready",o=>{this.emit("runtime-ready",o)}),this.renderer.on("page-el-update",o=>{var n;(n=this.mask)==null||n.observe(o)}),this.mask.on("beforeSelect",o=>{this.setElementFromPoint(o)}).on("select",()=>{this.emit("select",this.selectedDom)}).on("changeGuides",o=>{this.dr.setGuidelines(o.type,o.guides),this.emit("changeGuides",o)}).on("highlight",async o=>{if(await this.setElementFromPoint(o),this.highlightedDom===this.selectedDom){this.highlightLayer.clearHighlight();return}this.highlightLayer.highlight(this.highlightedDom),this.emit("highlight",this.highlightedDom)}).on("clearHighlight",async()=>{this.highlightLayer.clearHighlight()}),this.dr.on("update",o=>{setTimeout(()=>this.emit("update",o))}).on("sort",o=>{setTimeout(()=>this.emit("sort",o))})}async setElementFromPoint(t){var c;const{renderer:o,zoom:n}=this,i=(c=o.contentWindow)==null?void 0:c.document;let l=t.clientX,a=t.clientY;if(o.iframe){const u=o.iframe.getClientRects()[0];u&&(l=l-u.left,a=a-u.top)}const r=i==null?void 0:i.elementsFromPoint(l/n,a/n);let s=!1;const d=()=>s=!0;for(const u of r)if(!u.id.startsWith(GHOST_EL_ID_PREFIX)&&await this.canSelect(u,t,d)){if(s)break;if(t.type==="mousemove"){this.highlight(u);break}this.select(u,t);break}}async select(t,o){var l;const n=await this.getTargetElement(t);if(n===this.selectedDom)return;const i=await this.renderer.getRuntime();await((l=i==null?void 0:i.select)==null?void 0:l.call(i,n.id)),(i==null?void 0:i.beforeSelect)&&await i.beforeSelect(n),this.mask.setLayout(n),this.dr.select(n,o),this.selectedDom=n,this.renderer.contentWindow&&(removeSelectedClassName(this.renderer.contentWindow.document),this.selectedDom&&addSelectedClassName(this.selectedDom))}update(t){var n;const{config:o}=t;(n=this.renderer)==null||n.getRuntime().then(i=>{var l;(l=i==null?void 0:i.update)==null||l.call(i,t),setTimeout(()=>{var r,s;const a=(r=this.renderer.contentWindow)==null?void 0:r.document.getElementById(`${o.id}`);a&&a.id===((s=this.selectedDom)==null?void 0:s.id)&&(this.selectedDom=a,this.mask.setLayout(a),this.dr.updateMoveable(a))},0)})}async highlight(t){let o;try{o=await this.getTargetElement(t)}catch{this.highlightLayer.clearHighlight();return}o!==this.highlightedDom&&(this.highlightLayer.highlight(o),this.highlightedDom=o)}sortNode(t){var o;(o=this.renderer)==null||o.getRuntime().then(n=>{var i;return(i=n==null?void 0:n.sortNode)==null?void 0:i.call(n,t)})}add(t){var o;(o=this.renderer)==null||o.getRuntime().then(n=>{var i;return(i=n==null?void 0:n.add)==null?void 0:i.call(n,t)})}remove(t){var o;(o=this.renderer)==null||o.getRuntime().then(n=>{var i;return(i=n==null?void 0:n.remove)==null?void 0:i.call(n,t)})}setZoom(t=DEFAULT_ZOOM){this.zoom=t}mount(t){this.container=t;const{mask:o,renderer:n}=this;n.mount(t),o.mount(t),this.emit("mounted")}clearGuides(){this.mask.clearGuides(),this.dr.clearGuides()}destroy(){const{mask:t,renderer:o,dr:n,highlightLayer:i}=this;o.destroy(),t.destroy(),n.destroy(),i.destroy(),this.removeAllListeners(),this.container=void 0}async getTargetElement(t){var o;if(typeof t=="string"||typeof t=="number"){const n=(o=this.renderer.contentWindow)==null?void 0:o.document.getElementById(`${t}`);if(!n)throw new Error(`\u4E0D\u5B58\u5728ID\u4E3A${t}\u7684\u5143\u7D20`);return n}return t}}class ScrollViewer$1{constructor(t){g(this,"enter",!1);g(this,"targetEnter",!1);g(this,"keydown",!1);g(this,"container");g(this,"target");g(this,"zoom",1);g(this,"scrollLeft",0);g(this,"scrollTop",0);g(this,"x",0);g(this,"y",0);g(this,"resizeObserver",new ResizeObserver(t=>{for(const{contentRect:o}of t){const{width:n,height:i}=o,l=this.target.getBoundingClientRect(),a=l.width*this.zoom,r=Number(this.target.style.marginTop)||0,s=(l.height+r)*this.zoom;a<n&&(this.target._left=0),s<i&&(this.target._top=0),this.scroll()}}));g(this,"wheelHandler",t=>{if(this.targetEnter)return;const{deltaX:o,deltaY:n,currentTarget:i}=t;i===this.container&&(this.setScrollOffset(o,n),this.scroll(),this.scrollLeft=this.target._left,this.scrollTop=this.target._top)});g(this,"mouseEnterHandler",()=>{this.enter=!0});g(this,"mouseLeaveHandler",()=>{this.enter=!1});g(this,"targetMouseEnterHandler",()=>{this.targetEnter=!0});g(this,"targetMouseLeaveHandler",()=>{this.targetEnter=!1});g(this,"mousedownHandler",t=>{!this.keydown||(t.stopImmediatePropagation(),t.stopPropagation(),this.target.style.cursor="grabbing",this.x=t.clientX,this.y=t.clientY,document.addEventListener("mousemove",this.mousemoveHandler),document.addEventListener("mouseup",this.mouseupHandler))});g(this,"mouseupHandler",()=>{this.x=0,this.y=0,this.scrollLeft=this.target._left,this.scrollTop=this.target._top,this.removeHandler()});g(this,"mousemoveHandler",t=>{t.stopImmediatePropagation(),t.stopPropagation();const o=t.clientX-this.x,n=t.clientY-this.y;this.setScrollOffset(o,n),this.scroll()});g(this,"keydownHandler",t=>{t.code===Keys.ESCAPE&&this.enter&&(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation()),!(t.code!==Keys.ESCAPE||!this.enter||this.keydown)&&(this.keydown=!0,this.target.style.cursor="grab",this.container.addEventListener("mousedown",this.mousedownHandler))});g(this,"keyupHandler",t=>{t.code!==Keys.ESCAPE||!this.keydown||(t.preventDefault(),t.stopImmediatePropagation(),t.stopPropagation(),this.keydown=!1,t.preventDefault(),this.removeHandler())});this.container=t.container,this.target=t.target,this.zoom=t.zoom,globalThis.addEventListener("keydown",this.keydownHandler),globalThis.addEventListener("keyup",this.keyupHandler),this.container.addEventListener("mouseenter",this.mouseEnterHandler),this.container.addEventListener("mouseleave",this.mouseLeaveHandler),this.target.addEventListener("mouseenter",this.targetMouseEnterHandler),this.target.addEventListener("mouseleave",this.targetMouseLeaveHandler),this.container.addEventListener("wheel",this.wheelHandler),this.resizeObserver.observe(this.container)}destroy(){this.resizeObserver.disconnect(),this.container.removeEventListener("mouseenter",this.mouseEnterHandler),this.container.removeEventListener("mouseleave",this.mouseLeaveHandler),this.target.removeEventListener("mouseenter",this.targetMouseEnterHandler),this.target.removeEventListener("mouseleave",this.targetMouseLeaveHandler),globalThis.removeEventListener("keydown",this.keydownHandler),globalThis.removeEventListener("keyup",this.keyupHandler)}setZoom(t){this.zoom=t}scroll(){const t=this.target._left,o=this.target._top;this.target.style.transform=`translate(${t}px, ${o}px)`}removeHandler(){this.target.style.cursor="",this.target.removeEventListener("mousedown",this.mousedownHandler),document.removeEventListener("mousemove",this.mousemoveHandler),document.removeEventListener("mouseup",this.mouseupHandler)}setScrollOffset(t,o){const{width:n,height:i}=this.container.getBoundingClientRect(),l=this.target.getBoundingClientRect(),a=l.width*this.zoom,r=l.height*this.zoom;let s=0;r>i&&(o>0?s=this.scrollTop+Math.min(r-i-this.scrollTop,o):s=this.scrollTop+Math.max(-(r-i+this.scrollTop),o));let d=0;a>n&&(t>0?d=this.scrollLeft+Math.min(a-n-this.scrollLeft,t):d=this.scrollLeft+Math.max(-(a-n+this.scrollLeft),t)),this.target._left=d,this.target._top=s}}const _sfc_main$G=defineComponent({name:"m-editor-scroll-viewer",props:{width:Number,height:Number,zoom:{type:Number,default:1}},setup(e){const t=ref(),o=ref();let n;return onMounted(()=>{!t.value||!o.value||(n=new ScrollViewer$1({container:t.value,target:o.value,zoom:e.zoom}))}),onUnmounted(()=>{n.destroy()}),watch(()=>e.zoom,()=>{n.setZoom(e.zoom)}),{container:t,el:o,style:computed(()=>`
        width: ${e.width}px;
        height: ${e.height}px;
        position: absolute;
        margin-top: 30px;
      `)}}}),_hoisted_1$n={class:"m-editor-scroll-viewer-container",ref:"container"};function _sfc_render$B(e,t,o,n,i,l){return openBlock(),createElementBlock("div",_hoisted_1$n,[createBaseVNode("div",{ref:"el",style:normalizeStyle(e.style)},[renderSlot(e.$slots,"default")],4)],512)}var ScrollViewer=_export_sfc(_sfc_main$G,[["render",_sfc_render$B]]);const _sfc_main$F=defineComponent({name:"magic-editor-ui-viewer-menu",setup(){const e=inject("services"),t=e==null?void 0:e.editorService,o=ref(),n=ref(!1),i=ref(!1),l=computed(()=>t==null?void 0:t.get("node")),a=computed(()=>t==null?void 0:t.get("parent"));return onMounted(()=>{const r=globalThis.localStorage.getItem(COPY_STORAGE_KEY);n.value=r!=="undefined"&&!!r}),watch(a,async()=>{var s;if(!a.value||!t)return i.value=!1;const r=await t.getLayout(a.value);i.value=[Layout.ABSOLUTE,Layout.FIXED].includes(r)&&![NodeType.ROOT,NodeType.PAGE,"pop"].includes(`${(s=l.value)==null?void 0:s.type}`)},{immediate:!0}),{menu:o,canPaste:n,canDelete:computed(()=>{var r;return((r=l.value)==null?void 0:r.type)!==NodeType.PAGE}),canMoveZPos:computed(()=>{var r;return((r=l.value)==null?void 0:r.type)!==NodeType.PAGE}),canCenter:i,center(){l.value&&(t==null||t.alignCenter(l.value))},copy(){l.value&&(t==null||t.copy(l.value)),n.value=!0},paste(){var d,c;const r=((d=o.value)==null?void 0:d.offsetTop)||0,s=((c=o.value)==null?void 0:c.offsetLeft)||0;t==null||t.paste({left:s,top:r})},remove(){l.value&&(t==null||t.remove(l.value))},top(){t==null||t.moveLayer(LayerOffset.TOP)},bottom(){t==null||t.moveLayer(LayerOffset.BOTTOM)},topItem(){t==null||t.moveLayer(1)},bottomItem(){t==null||t.moveLayer(-1)},clearGuides(){t==null||t.get("stage").clearGuides()}}}}),_hoisted_1$m={class:"magic-editor-content-menu",ref:"menu"},_hoisted_2$c=createBaseVNode("div",{class:"separation"},null,-1),_hoisted_3$a=createBaseVNode("div",{class:"separation"},null,-1),_hoisted_4$8=createBaseVNode("div",{class:"separation"},null,-1);function _sfc_render$A(e,t,o,n,i,l){return openBlock(),createElementBlock("div",_hoisted_1$m,[createBaseVNode("div",null,[e.canCenter?(openBlock(),createElementBlock("div",{key:0,class:"magic-editor-content-menu-item",onClick:t[0]||(t[0]=()=>e.center())},"\u6C34\u5E73\u5C45\u4E2D")):createCommentVNode("",!0),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[1]||(t[1]=()=>e.copy())},"\u590D\u5236"),e.canPaste?(openBlock(),createElementBlock("div",{key:1,class:"magic-editor-content-menu-item",onClick:t[2]||(t[2]=(...a)=>e.paste&&e.paste(...a))},"\u7C98\u8D34")):createCommentVNode("",!0),e.canMoveZPos?(openBlock(),createElementBlock(Fragment,{key:2},[_hoisted_2$c,createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[3]||(t[3]=(...a)=>e.topItem&&e.topItem(...a))},"\u4E0A\u79FB\u4E00\u5C42"),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[4]||(t[4]=(...a)=>e.bottomItem&&e.bottomItem(...a))},"\u4E0B\u79FB\u4E00\u5C42"),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[5]||(t[5]=(...a)=>e.top&&e.top(...a))},"\u7F6E\u9876"),createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[6]||(t[6]=(...a)=>e.bottom&&e.bottom(...a))},"\u7F6E\u5E95")],64)):createCommentVNode("",!0),e.canDelete?(openBlock(),createElementBlock(Fragment,{key:3},[_hoisted_3$a,createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[7]||(t[7]=()=>e.remove())},"\u5220\u9664")],64)):createCommentVNode("",!0),_hoisted_4$8,createBaseVNode("div",{class:"magic-editor-content-menu-item",onClick:t[8]||(t[8]=(...a)=>e.clearGuides&&e.clearGuides(...a))},"\u6E05\u7A7A\u53C2\u8003\u7EBF")])],512)}var ViewerMenu=_export_sfc(_sfc_main$F,[["render",_sfc_render$A]]);const useMenu=()=>{const e=ref(),t=ref({display:"none",left:"0",top:"0"});return onMounted(()=>{document.addEventListener("click",()=>{t.value.display="none"},!0)}),{menu:e,menuStyle:t,contextmenuHandler(o){var l;o.preventDefault();const n=(l=e.value)==null?void 0:l.$el.clientHeight;let i=o.clientY;n+o.clientY>document.body.clientHeight&&(i=document.body.clientHeight-n),t.value={display:"block",top:`${i}px`,left:`${o.clientX}px`}}}},_sfc_main$E=defineComponent({name:"magic-stage",components:{ViewerMenu,ScrollViewer},props:{render:{type:Function},runtimeUrl:String,canSelect:{type:Function,default:e=>Boolean(e.id)},moveableOptions:{type:[Object,Function],default:()=>e=>{var t,o;return{container:(o=(t=e==null?void 0:e.renderer)==null?void 0:t.contentWindow)==null?void 0:o.document.getElementById("app")}}}},setup(e){const t=inject("services"),o=ref(),n=ref(),i=computed(()=>t==null?void 0:t.uiService.get("stageRect")),l=computed(()=>t==null?void 0:t.uiService.get("uiSelectMode")),a=computed(()=>t==null?void 0:t.editorService.get("root")),r=computed(()=>t==null?void 0:t.editorService.get("page")),s=computed(()=>t==null?void 0:t.uiService.get("zoom")),d=computed(()=>t==null?void 0:t.editorService.get("node"));let c=null,u=null;watchEffect(()=>{var m;c||!n.value||!(e.runtimeUrl||e.render)||!a.value||(c=new StageCore({render:e.render,runtimeUrl:e.runtimeUrl,zoom:s.value,canSelect:(h,w,E)=>{const y=e.canSelect(h);return l.value&&y&&w.type==="mousedown"?(document.dispatchEvent(new CustomEvent("ui-select",{detail:h})),E()):y},moveableOptions:e.moveableOptions}),t==null||t.editorService.set("stage",markRaw(c)),c==null||c.mount(n.value),c==null||c.on("select",h=>{t==null||t.editorService.select(h.id)}),c==null||c.on("highlight",h=>{t==null||t.editorService.highlight(h.id)}),c==null||c.on("update",h=>{t==null||t.editorService.update({id:h.el.id,style:h.style})}),c==null||c.on("sort",h=>{t==null||t.editorService.sort(h.src,h.dist)}),c==null||c.on("changeGuides",()=>{t==null||t.uiService.set("showGuides",!0)}),!!((m=d.value)==null?void 0:m.id)&&(c==null||c.on("runtime-ready",h=>{var w,E;u=h,a.value&&(u==null||u.updateRootConfig(cloneDeep(toRaw(a.value)))),((w=r.value)==null?void 0:w.id)&&((E=u==null?void 0:u.updatePageId)==null||E.call(u,r.value.id)),setTimeout(()=>{d.value&&(c==null||c.select(toRaw(d.value.id)))})})))}),watch(s,m=>{!c||!m||c.setZoom(m)}),watch(a,m=>{u&&m&&u.updateRootConfig(cloneDeep(toRaw(m)))});const f=new ResizeObserver(m=>{for(const{contentRect:h}of m)t==null||t.uiService.set("stageContainerRect",{width:h.width,height:h.height})});return onMounted(()=>{var m;((m=o.value)==null?void 0:m.container)&&f.observe(o.value.container)}),onUnmounted(()=>{c==null||c.destroy(),f.disconnect(),t==null||t.editorService.set("stage",null)}),_({stageWrap:o,stageContainer:n,stageRect:i,zoom:s},useMenu())}});function _sfc_render$z(e,t,o,n,i,l){var s,d;const a=resolveComponent("viewer-menu"),r=resolveComponent("scroll-viewer");return openBlock(),createBlock(r,{class:"m-editor-stage",ref:"stageWrap",width:(s=e.stageRect)==null?void 0:s.width,height:(d=e.stageRect)==null?void 0:d.height,zoom:e.zoom},{default:withCtx(()=>[createBaseVNode("div",{class:"m-editor-stage-container",ref:"stageContainer",onContextmenu:t[0]||(t[0]=(...c)=>e.contextmenuHandler&&e.contextmenuHandler(...c)),style:normalizeStyle(`transform: scale(${e.zoom})`)},null,36),(openBlock(),createBlock(Teleport,{to:"body"},[createVNode(a,{ref:"menu",style:normalizeStyle(e.menuStyle)},null,8,["style"])]))]),_:1},8,["width","height","zoom"])}var MagicStage=_export_sfc(_sfc_main$E,[["render",_sfc_render$z]]);const _sfc_main$D=defineComponent({name:"m-editor-workspace",components:{PageBar,MagicStage},props:{runtimeUrl:String,render:{type:Function},moveableOptions:{type:[Object,Function]},canSelect:{type:Function}},setup(){const e=inject("services");return{page:computed(()=>e==null?void 0:e.editorService.get("page"))}}}),_hoisted_1$l={class:"m-editor-workspace"};function _sfc_render$y(e,t,o,n,i,l){var s;const a=resolveComponent("magic-stage"),r=resolveComponent("page-bar");return openBlock(),createElementBlock("div",_hoisted_1$l,[(openBlock(),createBlock(a,{key:(s=e.page)==null?void 0:s.id,"runtime-url":e.runtimeUrl,render:e.render,"moveable-options":e.moveableOptions,"can-select":e.canSelect},null,8,["runtime-url","render","moveable-options","can-select"])),renderSlot(e.$slots,"workspace-content"),createVNode(r,null,{"page-bar-title":withCtx(({page:d})=>[renderSlot(e.$slots,"page-bar-title",{page:d})]),"page-bar-popover":withCtx(({page:d})=>[renderSlot(e.$slots,"page-bar-popover",{page:d})]),_:3})])}var Workspace=_export_sfc(_sfc_main$D,[["render",_sfc_render$y]]);class ComponentList extends BaseService{constructor(){super([]);g(this,"state",reactive({list:[]}))}setList(t){this.state.list=t}getList(){return this.state.list}}var componentListService=new ComponentList;const DEFAULT_LEFT_COLUMN_WIDTH=310,DEFAULT_RIGHT_COLUMN_WIDTH=480,state=reactive({uiSelectMode:!1,showSrc:!1,zoom:1,stageContainerRect:{width:0,height:0},stageRect:{width:375,height:817},columnWidth:{left:DEFAULT_LEFT_COLUMN_WIDTH,center:globalThis.document.body.clientWidth-DEFAULT_LEFT_COLUMN_WIDTH-DEFAULT_RIGHT_COLUMN_WIDTH,right:DEFAULT_RIGHT_COLUMN_WIDTH},showGuides:!0,showRule:!0});class Ui extends BaseService{constructor(){super([]);globalThis.addEventListener("resize",()=>{this.setColumnWidth({center:"auto"})})}set(t,o){var i;const n=(i=editorService.get("stage"))==null?void 0:i.mask;if(t==="columnWidth"){this.setColumnWidth(o);return}if(t==="stageRect"){this.setStageRect(o);return}t==="showGuides"&&(n==null||n.showGuides(o)),t==="showRule"&&(n==null||n.showRule(o)),state[t]=o,t==="stageContainerRect"&&(state.zoom=this.calcZoom())}get(t){return state[t]}setColumnWidth({left:t,center:o,right:n}){const i=_({},toRaw(this.get("columnWidth")));if(t&&(i.left=t),n&&(i.right=n),!o||o==="auto"){const l=globalThis.document.body.clientWidth;i.center=l-((i==null?void 0:i.left)||0)-((i==null?void 0:i.right)||0)}else i.center=o;state.columnWidth=i}setStageRect(t){state.stageRect=_(_({},state.stageRect),t),state.zoom=this.calcZoom()}calcZoom(){const{stageRect:t,stageContainerRect:o}=state,{height:n,width:i}=o;return!i||!n||i>t.width&&n>t.height?1:Math.min((i-100)/t.width||1,(n-100)/t.height||1)}}var uiService=new Ui;const _sfc_main$C=defineComponent({name:"m-editor",components:{NavMenu,Sidebar,Workspace,PropsPanel,Framework},props:{modelValue:{type:Object,default:()=>({}),require:!0},componentGroupList:{type:Array,default:()=>[]},sidebar:{type:Object},menu:{type:Object,default:()=>({left:[],right:[]})},render:{type:Function},runtimeUrl:String,propsConfigs:{type:Object,default:()=>({})},propsValues:{type:Object,default:()=>({})},eventMethodList:{type:Object,default:()=>({})},moveableOptions:{type:[Object,Function]},defaultSelected:{type:[Number,String]},canSelect:{type:Function},stageRect:{type:[String,Object]}},emits:["props-panel-mounted","update:modelValue"],setup(e,{emit:t}){editorService.on("root-change",()=>{const n=editorService.get("node")||e.defaultSelected;n&&editorService.select(n),t("update:modelValue",toRaw(editorService.get("root")))}),watch(()=>e.modelValue,n=>editorService.set("root",n),{immediate:!0}),watch(()=>e.componentGroupList,n=>componentListService.setList(n),{immediate:!0}),watch(()=>e.propsConfigs,n=>propsService.setPropsConfigs(n),{immediate:!0}),watch(()=>e.propsValues,n=>propsService.setPropsValues(n),{immediate:!0}),watch(()=>e.eventMethodList,n=>{const i={},l={};Object.keys(n).forEach(a=>{i[a]=n[a].events,l[a]=n[a].methods}),eventsService.setEvents(i),eventsService.setMethods(l)},{immediate:!0}),watch(()=>e.defaultSelected,n=>n&&editorService.select(n),{immediate:!0}),watch(()=>e.stageRect,n=>n&&uiService.set("stageRect",n),{immediate:!0}),onUnmounted(()=>editorService.destroy());const o={componentListService,eventsService,historyService,propsService,editorService,uiService};return provide("services",o),o}});function _sfc_render$x(e,t,o,n,i,l){const a=resolveComponent("nav-menu"),r=resolveComponent("sidebar"),s=resolveComponent("workspace"),d=resolveComponent("props-panel"),c=resolveComponent("framework");return openBlock(),createBlock(c,null,{nav:withCtx(()=>[renderSlot(e.$slots,"nav",{editorService:e.editorService},()=>[createVNode(a,{data:e.menu},null,8,["data"])])]),sidebar:withCtx(()=>[renderSlot(e.$slots,"sidebar",{editorService:e.editorService},()=>[createVNode(r,{data:e.sidebar},null,8,["data"])])]),workspace:withCtx(()=>[renderSlot(e.$slots,"workspace",{},()=>[createVNode(s,{"runtime-url":e.runtimeUrl,render:e.render,"moveable-options":e.moveableOptions,"can-select":e.canSelect},{"workspace-content":withCtx(()=>[renderSlot(e.$slots,"workspace-content",{editorService:e.editorService})]),"page-bar-title":withCtx(({page:u})=>[renderSlot(e.$slots,"page-bar-title",{page:u})]),"page-bar-popover":withCtx(({page:u})=>[renderSlot(e.$slots,"page-bar-popover",{page:u})]),_:3},8,["runtime-url","render","moveable-options","can-select"])])]),propsPanel:withCtx(()=>[renderSlot(e.$slots,"propsPanel",{},()=>[createVNode(d,{ref:"propsPanel",onMounted:t[0]||(t[0]=u=>e.$emit("props-panel-mounted",u))},null,512)])]),empty:withCtx(()=>[renderSlot(e.$slots,"empty",{editorService:e.editorService})]),_:3})}var Editor$1=_export_sfc(_sfc_main$C,[["render",_sfc_render$x]]),index$2="";const defaultInstallOpt$1={};var MagicEditor={install:(e,t)=>{const o=Object.assign(defaultInstallOpt$1,t||{});e.config.globalProperties.$TMAGIC_EDITOR=o,e.component(Editor$1.name,Editor$1),e.component(uiSelect.name,uiSelect),e.component(CodeLink.name,CodeLink),e.component(Code.name,Code),e.component(CodeEditor.name,CodeEditor)}};const isTableSelect=e=>typeof e=="string"&&["table-select","tableSelect"].includes(e),asyncLoadConfig=(e,t,{asyncLoad:o,name:n,type:i})=>{i==="html"&&typeof o=="object"&&typeof n!="undefined"&&(o.name=n,e.asyncLoad=typeof t.asyncLoad=="object"?t.asyncLoad:o)},isMultipleValue=e=>typeof e=="string"&&["checkbox-group","checkboxGroup","table","cascader","group-list","groupList","dynamic-tab","dynamicTab"].includes(e),initItemsValue=(e,t,o,{items:n,name:i,extensible:l})=>{Array.isArray(o[i])?t[i]=o[i].map(a=>init(e,n,a)):(t[i]=init(e,n,o[i],t[i]),l&&(t[i]=Object.assign({},o[i],t[i])))},setValue=(e,t,o,n)=>{const{items:i,name:l,type:a,checkbox:r}=n;isMultipleValue(a)&&(t[l]=o[l]||[]),i?initItemsValue(e,t,o,n):t[l]=getDefaultValue(e,n),a==="fieldset"&&r&&typeof t[l]=="object"&&(t[l].value=typeof o[l]=="object"&&o[l].value||0)},initValueItem=function(e,t,o,n){const{items:i}=t,{names:l}=t,{type:a,name:r}=t;return isTableSelect(a)&&r?(n[r]=o[r]||"",n):(asyncLoadConfig(n,o,t),r&&!i&&typeof o[r]!="undefined"?(typeof n[r]=="undefined"&&(n[r]=typeof o[r]=="object"?cloneDeep(o[r]):o[r]),n):l?l.forEach(s=>n[s]=o[s]||""):r?(setValue(e,n,o,t),n):init(e,i,o,n))},init=function(e,t=[],o={},n={}){return Array.isArray(t)&&t.forEach(i=>{initValueItem(e,i,o,n)}),n},getDefaultValue=function(e,{defaultValue:t,type:o,filter:n,multiple:i}){if(typeof t=="function")return t(e);if(t!=="undefined")return typeof t!="undefined"?t:o==="number"||n==="number"?0:["switch","checkbox"].includes(o)?!1:i?[]:""},filterFunction=(e,t,o)=>typeof t!="function"?t:t(e,{values:(e==null?void 0:e.initValues)||{},model:o.model,parent:(e==null?void 0:e.parentValues)||{},formValue:(e==null?void 0:e.values)||o.model,prop:o.prop}),display=function(e,t,o){return typeof t=="function"?filterFunction(e,t,o):t!==!1},getRules=function(e,t=[],o){return t=cloneDeep(t),typeof t=="object"&&!Array.isArray(t)&&(t=[t]),t.map(n=>{if(typeof n.validator=="function"){const i=n.validator;n.validator=(l,a,r,s,d)=>i({rule:l,value:a,callback:r,source:s,options:d},{values:(e==null?void 0:e.initValues)||{},model:o.model,parent:(e==null?void 0:e.parentValues)||{},formValue:(e==null?void 0:e.values)||o.model,prop:o.prop},e)}return n})},initValue=async(e,{initValues:t,config:o})=>{if(!Array.isArray(o))throw new Error("config\u5E94\u8BE5\u4E3A\u6570\u7EC4");let n=init(e,o,toRaw(t),{});const[i]=o;return i&&typeof i.onInitValue=="function"&&(n=await i.onInitValue(e,{formValue:n,initValue:t})),n||{}},_sfc_main$B=defineComponent({name:"m-form-container",components:{WarningFilled},props:{labelWidth:String,expandMore:Boolean,model:{type:[Object,Array],required:!0},config:{type:Object,required:!0},prop:{type:String,default:()=>""},stepActive:{type:[String,Number]},size:{type:String,default:"small"}},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(!1),i=computed(()=>e.config.name||""),l=computed(()=>e.config.items),a=computed(()=>i.value?`${e.prop}${e.prop?".":""}${i.value}`:e.prop),r=computed(()=>{const b=resolveComponent(`m-${l.value?"form":"fields"}-${f.value}`);return typeof b!="string"?b:"m-fields-text"}),s=computed(()=>filterFunction(o,e.config.disabled,e)),d=computed(()=>filterFunction(o,e.config.tooltip,e)),c=computed(()=>filterFunction(o,e.config.extra,e)),u=computed(()=>getRules(o,e.config.rules,e)),f=computed(()=>{let{type:b}=e.config;return typeof b=="function"&&(b=b(o,{model:e.model})),b==="form"?"":(b==null?void 0:b.replace(/([A-Z])/g,"-$1").toLowerCase())||(l.value?"":"text")}),m=computed(()=>e.config.display==="expand"?n.value:display(o,e.config.display,e));watchEffect(()=>{n.value=e.expandMore});const h=()=>n.value=!n.value,w=b=>b[o==null?void 0:o.keyProps],E=(b,k)=>typeof b=="function"?b(o,k,{model:e.model,values:o==null?void 0:o.initValues,formValue:o==null?void 0:o.values,prop:a.value}):b==="number"?+k:k,y=(b,k)=>{if(typeof b=="function")return b(o,k,{model:e.model,values:o==null?void 0:o.initValues,formValue:o==null?void 0:o.values,prop:a.value})},$=(b,k)=>{if(typeof k=="string"&&b)return k.replace(/^\s*/,"").replace(/\s*$/,"")};return{expand:n,name:i,type:f,disabled:s,itemProp:a,items:l,display:m,tagName:r,rule:u,tooltip:d,extra:c,key:w,onChangeHandler:async function(b,k){var A,H;const{filter:B,onChange:S,trim:D,name:T,dynamicKey:L}=e.config;let N=b;try{N=E(B,b),N=(A=await y(S,N))!=null?A:N,N=(H=$(D,N))!=null?H:N}catch(O){console.error(O)}(T||T===0)&&e.model!==N&&(b!==N||e.model[T]!==N)&&(e.model[T]=N),k!==void 0&&L&&(e.model[k]=N),t("change",e.model)},expandHandler:h}}}),_hoisted_1$k=["innerHTML"],_hoisted_2$b=["innerHTML"],_hoisted_3$9=["innerHTML"],_hoisted_4$7=["innerHTML"],_hoisted_5$5={key:4,style:{"text-align":"center"}};function _sfc_render$w(e,t,o,n,i,l){const a=resolveComponent("m-fields-hidden"),r=resolveComponent("el-tooltip"),s=resolveComponent("el-form-item"),d=resolveComponent("warning-filled"),c=resolveComponent("el-icon"),u=resolveComponent("m-form-container"),f=resolveComponent("el-button");return e.config?(openBlock(),createElementBlock("div",{key:0,style:normalizeStyle(e.config.tip?"display: flex;align-items: baseline;":""),class:normalizeClass([e.config.className,"m-form-container"])},[e.type==="hidden"?(openBlock(),createBlock(a,{key:0,model:e.model,config:e.config,name:e.config.name,disabled:e.disabled,prop:e.itemProp},null,8,["model","config","name","disabled","prop"])):e.items&&!e.config.text&&e.type&&e.display?(openBlock(),createBlock(resolveDynamicComponent(e.tagName),{key:e.key(e.config),size:e.size,model:e.model,config:e.config,name:e.name,prop:e.itemProp,"step-active":e.stepActive,"expand-more":e.expand,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.onChangeHandler},null,8,["size","model","config","name","prop","step-active","expand-more","label-width","onChange"])):e.type&&e.display?(openBlock(),createElementBlock(Fragment,{key:2},[createVNode(s,{style:normalizeStyle(e.config.tip?"flex: 1":""),prop:e.itemProp,"label-width":e.config.text?e.config.labelWidth||e.labelWidth:"0",rules:e.rule},{label:withCtx(()=>[createBaseVNode("span",{innerHTML:e.type==="checkbox"?"":e.config.text},null,8,_hoisted_1$k)]),default:withCtx(()=>[e.tooltip?(openBlock(),createBlock(r,{key:0},{content:withCtx(()=>[createBaseVNode("div",{innerHTML:e.tooltip},null,8,_hoisted_2$b)]),default:withCtx(()=>[(openBlock(),createBlock(resolveDynamicComponent(e.tagName),{key:e.key(e.config),size:e.size,model:e.model,config:e.config,name:e.name,disabled:e.disabled,prop:e.itemProp,onChange:e.onChangeHandler},null,8,["size","model","config","name","disabled","prop","onChange"]))]),_:1})):(openBlock(),createBlock(resolveDynamicComponent(e.tagName),{key:e.key(e.config),size:e.size,model:e.model,config:e.config,name:e.name,disabled:e.disabled,prop:e.itemProp,onChange:e.onChangeHandler},null,8,["size","model","config","name","disabled","prop","onChange"])),e.extra?(openBlock(),createElementBlock("div",{key:2,innerHTML:e.extra,class:"m-form-tip"},null,8,_hoisted_3$9)):createCommentVNode("",!0)]),_:1},8,["style","prop","label-width","rules"]),e.config.tip?(openBlock(),createBlock(r,{key:0,placement:"top"},{content:withCtx(()=>[createBaseVNode("div",{innerHTML:e.config.tip},null,8,_hoisted_4$7)]),default:withCtx(()=>[createVNode(c,{style:{"line-height":"40px","margin-left":"5px"}},{default:withCtx(()=>[createVNode(d)]),_:1})]),_:1})):createCommentVNode("",!0)],64)):e.items&&e.display?(openBlock(),createElementBlock(Fragment,{key:3},[(e.name||e.name===0?e.model[e.name]:e.model)?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.items,m=>(openBlock(),createBlock(u,{key:e.key(m),model:e.name||e.name===0?e.model[e.name]:e.model,config:m,size:e.size,"step-active":e.stepActive,"expand-more":e.expand,"label-width":e.config.labelWidth||e.labelWidth,prop:e.itemProp,onChange:e.onChangeHandler},null,8,["model","config","size","step-active","expand-more","label-width","prop","onChange"]))),128)):createCommentVNode("",!0)],64)):createCommentVNode("",!0),e.config.expand&&e.type!=="fieldset"?(openBlock(),createElementBlock("div",_hoisted_5$5,[createVNode(f,{type:"text",onClick:e.expandHandler},{default:withCtx(()=>[createTextVNode(toDisplayString(e.expand?"\u6536\u8D77\u914D\u7F6E":"\u5C55\u5F00\u66F4\u591A\u914D\u7F6E"),1)]),_:1},8,["onClick"])])):createCommentVNode("",!0)],6)):createCommentVNode("",!0)}var Container=_export_sfc(_sfc_main$B,[["render",_sfc_render$w]]);const _sfc_main$A=defineComponent({name:"m-form-fieldset",props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},rules:{type:Object,default:()=>({})},prop:{type:String,default:()=>""},size:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=computed(()=>e.config.name||""),i=computed(()=>{var s;return e.config.expand&&n.value?(s=e.model[n.value])==null?void 0:s.value:!0}),l=computed(()=>e.config.items?e.config.labelWidth||e.labelWidth:e.config.labelWidth||e.labelWidth||(e.config.text?null:"0"));return{show:i,name:n,mForm:o,lWidth:l,key:(s,d)=>{var c;return(c=s[(o==null?void 0:o.keyProp)||"__key"])!=null?c:d},change:()=>{t("change",e.model)}}}}),_hoisted_1$j=["innerHTML"],_hoisted_2$a=["innerHTML"],_hoisted_3$8={key:1},_hoisted_4$6=["innerHTML"],_hoisted_5$4=["innerHTML"],_hoisted_6$2={key:2},_hoisted_7$2=["innerHTML"],_hoisted_8$1=["innerHTML"],_hoisted_9$1={key:3,style:{display:"flex"}},_hoisted_10$1={style:{flex:"1"}},_hoisted_11=["src"];function _sfc_render$v(e,t,o,n,i,l){const a=resolveComponent("el-checkbox"),r=resolveComponent("m-form-container");return(e.name?e.model[e.name]:e.model)?(openBlock(),createElementBlock("fieldset",{key:0,class:"m-fieldset",style:normalizeStyle(e.show?"padding: 15px 15px 0 5px;":"border: 0")},[!e.show&&e.name?(openBlock(),createBlock(a,{key:0,modelValue:e.model[e.name].value,"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name].value=s),prop:`${e.prop}${e.prop?".":""}${e.config.name}.value`,"true-label":1,"false-label":0,onChange:e.change},{default:withCtx(()=>[createBaseVNode("span",{innerHTML:e.config.legend},null,8,_hoisted_1$j),e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_2$a)):createCommentVNode("",!0)]),_:1},8,["modelValue","prop","onChange"])):e.config.checkbox&&e.name?(openBlock(),createElementBlock("legend",_hoisted_3$8,[createVNode(a,{modelValue:e.model[e.name].value,"onUpdate:modelValue":t[1]||(t[1]=s=>e.model[e.name].value=s),prop:`${e.prop}${e.prop?".":""}${e.config.name}.value`,"true-label":1,"false-label":0,onChange:e.change},{default:withCtx(()=>[createBaseVNode("span",{innerHTML:e.config.legend},null,8,_hoisted_4$6),e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_5$4)):createCommentVNode("",!0)]),_:1},8,["modelValue","prop","onChange"])])):(openBlock(),createElementBlock("legend",_hoisted_6$2,[createBaseVNode("span",{innerHTML:e.config.legend},null,8,_hoisted_7$2),e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_8$1)):createCommentVNode("",!0)])),e.config.schematic&&e.show?(openBlock(),createElementBlock("div",_hoisted_9$1,[createBaseVNode("div",_hoisted_10$1,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(s,d)=>(openBlock(),createBlock(r,{key:e.key(s,d),model:e.name?e.model[e.name]:e.model,rules:e.name?e.rules[e.name]:[],config:s,prop:e.prop,labelWidth:e.lWidth,size:e.size,onChange:e.change},null,8,["model","rules","config","prop","labelWidth","size","onChange"]))),128))]),createBaseVNode("img",{class:"m-form-schematic",src:e.config.schematic},null,8,_hoisted_11)])):e.show?(openBlock(!0),createElementBlock(Fragment,{key:4},renderList(e.config.items,(s,d)=>(openBlock(),createBlock(r,{key:e.key(s,d),model:e.name?e.model[e.name]:e.model,rules:e.name?e.rules[e.name]:[],config:s,prop:e.prop,labelWidth:e.lWidth,size:e.size,onChange:e.change},null,8,["model","rules","config","prop","labelWidth","size","onChange"]))),128)):createCommentVNode("",!0)],4)):createCommentVNode("",!0)}var Fieldset=_export_sfc(_sfc_main$A,[["render",_sfc_render$v]]);const _sfc_main$z=defineComponent({name:"m-form-group-list-item",components:{CaretRight,CaretBottom:CaretBottom$1},props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,size:String,index:{type:[Number,String,Symbol],default:0},groupModel:{type:Array,default:()=>[]}},emits:["swap-item","remove-item","change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(!1);watchEffect(()=>{n.value=!e.index});const i=computed(()=>({type:"row",span:e.config.span||24,items:e.config.items,labelWidth:e.config.labelWidth,[(o==null?void 0:o.keyProp)||"__key"]:`${e.config[(o==null?void 0:o.keyProp)||"__key"]}${String(e.index)}`})),l=computed(()=>e.config.titleKey&&e.model[e.config.titleKey]?e.model[e.config.titleKey]:`\u7EC4 ${String(e.index)}`),a=computed(()=>{var h;return((h=e.groupModel)==null?void 0:h.length)||0}),r=computed(()=>filterFunction(o,e.config.itemExtra,e));return{expand:n,expandHandler:()=>{n.value=!n.value},title:l,showDelete:h=>{const w=e.config.delete;return w&&typeof w=="function"?w(e.model,h,o==null?void 0:o.values):!0},removeHandler:()=>t("remove-item",e.index),movable:()=>{const{movable:h}=e.config;return h===void 0?!0:typeof h=="function"?h(o,e.index||0,e.model,e.groupModel):h},changeOrder:(h=0)=>t("swap-item",e.index,`${String(e.index)}${h}`),itemExtra:r,rowConfig:i,changeHandler:()=>t("change"),length:a,Delete:Delete$1}}}),_hoisted_1$i={class:"m-fields-group-list-item"},_hoisted_2$9=createTextVNode("\u4E0A\u79FB"),_hoisted_3$7=createTextVNode("\u4E0B\u79FB"),_hoisted_4$5=["innerHTML"];function _sfc_render$u(e,t,o,n,i,l){const a=resolveComponent("caret-bottom"),r=resolveComponent("caret-right"),s=resolveComponent("el-icon"),d=resolveComponent("el-button"),c=resolveComponent("CaretRight"),u=resolveComponent("CaretBottom"),f=resolveComponent("m-form-container");return openBlock(),createElementBlock("div",_hoisted_1$i,[createBaseVNode("div",null,[createVNode(s,{style:{"margin-right":"7px"},onClick:e.expandHandler},{default:withCtx(()=>[e.expand?(openBlock(),createBlock(a,{key:0})):(openBlock(),createBlock(r,{key:1}))]),_:1},8,["onClick"]),createVNode(d,{type:"text",onClick:e.expandHandler},{default:withCtx(()=>[createTextVNode(toDisplayString(e.title),1)]),_:1},8,["onClick"]),withDirectives(createVNode(d,{type:"text",icon:e.Delete,style:{color:"#f56c6c"},onClick:e.removeHandler},null,8,["icon","onClick"]),[[vShow,e.showDelete(parseInt(String(e.index)))]]),e.movable()?(openBlock(),createElementBlock(Fragment,{key:0},[withDirectives(createVNode(d,{type:"text",size:"small",onClick:t[0]||(t[0]=m=>e.changeOrder(-1))},{default:withCtx(()=>[_hoisted_2$9,createVNode(s,null,{default:withCtx(()=>[createVNode(c)]),_:1})]),_:1},512),[[vShow,e.index!==0]]),withDirectives(createVNode(d,{type:"text",size:"small",onClick:t[1]||(t[1]=m=>e.changeOrder(1))},{default:withCtx(()=>[_hoisted_3$7,createVNode(s,null,{default:withCtx(()=>[createVNode(u)]),_:1})]),_:1},512),[[vShow,e.index!==e.length-1]])],64)):createCommentVNode("",!0),e.itemExtra?(openBlock(),createElementBlock("span",{key:1,innerHTML:e.itemExtra,class:"m-form-tip"},null,8,_hoisted_4$5)):createCommentVNode("",!0)]),e.expand?(openBlock(),createBlock(f,{key:0,config:e.rowConfig,model:e.model,labelWidth:e.labelWidth,prop:`${e.prop}${e.prop?".":""}${String(e.index)}`,size:e.size,onChange:e.changeHandler},null,8,["config","model","labelWidth","prop","size","onChange"])):createCommentVNode("",!0)])}var MFieldsGroupListItem=_export_sfc(_sfc_main$z,[["render",_sfc_render$u]]);const _sfc_main$y=defineComponent({name:"m-form-group-list",components:{MFieldsGroupListItem},props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:{type:String,default:""},size:String,name:{type:String,default:""}},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=computed(()=>e.name?typeof e.config.addable=="function"?e.config.addable(o,{model:e.model[e.name],formValue:o==null?void 0:o.values}):typeof e.config.addable=="undefined"?!0:e.config.addable:!1),i=()=>{if(!e.name)return!1;t("change",e.model[e.name])};return{addable:n,toggleMode:()=>{e.config.type="table",e.config.groupItems=e.config.items,e.config.items=e.config.tableItems||e.config.items.map(d=>V(_({},d),{label:d.label||d.text,text:null}))},removeHandler:d=>{if(!e.name)return!1;e.model[e.name].splice(d,1),i()},swapHandler:(d,c)=>{if(!e.name)return!1;const[u]=e.model[e.name].splice(d,1);e.model[e.name].splice(c,0,u),i()},changeHandler:i,addHandler:async()=>{if(!e.name)return!1;let d={};typeof e.config.defaultAdd=="function"?d=await e.config.defaultAdd(o,{model:e.model[e.name],formValue:o==null?void 0:o.values}):e.config.defaultAdd&&(d=e.config.defaultAdd);const c=await initValue(o,{config:e.config.items,initValues:d});e.model[e.name].push(c)}}}}),_hoisted_1$h={class:"m-fields-group-list"},_hoisted_2$8=["innerHTML"],_hoisted_3$6={key:1,class:"el-table__empty-block"},_hoisted_4$4=createBaseVNode("span",{class:"el-table__empty-text"},"\u6682\u65E0\u6570\u636E",-1),_hoisted_5$3=[_hoisted_4$4],_hoisted_6$1=createTextVNode("\u6DFB\u52A0\u7EC4"),_hoisted_7$1=createTextVNode("\u5207\u6362\u4E3A\u8868\u683C");function _sfc_render$t(e,t,o,n,i,l){const a=resolveComponent("m-fields-group-list-item"),r=resolveComponent("el-button");return openBlock(),createElementBlock("div",_hoisted_1$h,[e.config.extra?(openBlock(),createElementBlock("div",{key:0,innerHTML:e.config.extra,style:{color:"rgba(0, 0, 0, 0.45)"}},null,8,_hoisted_2$8)):createCommentVNode("",!0),!e.model[e.name]||!e.model[e.name].length?(openBlock(),createElementBlock("div",_hoisted_3$6,_hoisted_5$3)):(openBlock(!0),createElementBlock(Fragment,{key:2},renderList(e.model[e.name],(s,d)=>(openBlock(),createBlock(a,{key:d,model:s,config:e.config,prop:e.prop,index:d,"label-width":e.labelWidth,size:e.size,"group-model":e.model[e.name],onRemoveItem:e.removeHandler,onSwapItem:e.swapHandler,onChange:e.changeHandler},null,8,["model","config","prop","index","label-width","size","group-model","onRemoveItem","onSwapItem","onChange"]))),128)),e.addable?(openBlock(),createBlock(r,{key:3,onClick:e.addHandler,size:"small"},{default:withCtx(()=>[_hoisted_6$1]),_:1},8,["onClick"])):createCommentVNode("",!0),e.config.enableToggleMode?(openBlock(),createBlock(r,{key:4,icon:"el-icon-s-grid",size:"small",onClick:e.toggleMode},{default:withCtx(()=>[_hoisted_7$1]),_:1},8,["onClick"])):createCommentVNode("",!0)])}var GroupList=_export_sfc(_sfc_main$y,[["render",_sfc_render$t]]);const _sfc_main$x=defineComponent({name:"m-form-panel",components:{CaretBottom:CaretBottom$1,CaretRight},props:{labelWidth:String,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,size:String,name:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(e.config.expand!==!1),i=computed(()=>e.config.items);return{mForm:o,expand:n,items:i,filter:r=>filterFunction(o,r,e),changeHandler:()=>t("change",e.model)}}}),_hoisted_1$g={class:"clearfix"},_hoisted_2$7=["innerHTML"],_hoisted_3$5={key:0,style:{display:"flex"}},_hoisted_4$3={style:{flex:"1"}},_hoisted_5$2=["src"];function _sfc_render$s(e,t,o,n,i,l){const a=resolveComponent("caret-bottom"),r=resolveComponent("caret-right"),s=resolveComponent("el-icon"),d=resolveComponent("m-form-container"),c=resolveComponent("el-card");return e.items&&e.items.length?(openBlock(),createBlock(c,{key:0,class:"box-card m-form-panel","body-style":{display:e.expand?"block":"none"}},{header:withCtx(()=>[createBaseVNode("div",_hoisted_1$g,[createBaseVNode("a",{href:"javascript:",style:{width:"100%",display:"block"},onClick:t[0]||(t[0]=u=>e.expand=!e.expand)},[createVNode(s,null,{default:withCtx(()=>[e.expand?(openBlock(),createBlock(a,{key:0})):(openBlock(),createBlock(r,{key:1}))]),_:1}),createTextVNode(" "+toDisplayString(e.filter(e.config.title))+" ",1),e.config&&e.config.extra?(openBlock(),createElementBlock("span",{key:0,innerHTML:e.config.extra,class:"m-form-tip"},null,8,_hoisted_2$7)):createCommentVNode("",!0)])])]),default:withCtx(()=>[createBaseVNode("div",null,[renderSlot(e.$slots,"default"),e.config.schematic?(openBlock(),createElementBlock("div",_hoisted_3$5,[createBaseVNode("div",_hoisted_4$3,[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.items,(u,f)=>{var m,h;return openBlock(),createBlock(d,{key:(h=u[((m=e.mForm)==null?void 0:m.keyProp)||"__key"])!=null?h:f,config:u,model:e.name?e.model[e.name]:e.model,prop:e.prop,size:e.size,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","onChange"])}),128))]),createBaseVNode("img",{class:"m-form-schematic",src:e.config.schematic},null,8,_hoisted_5$2)])):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(e.items,(u,f)=>{var m,h;return openBlock(),createBlock(d,{key:(h=u[((m=e.mForm)==null?void 0:m.keyProp)||"__key"])!=null?h:f,config:u,model:e.name?e.model[e.name]:e.model,prop:e.prop,size:e.size,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","onChange"])}),128))])]),_:3},8,["body-style"])):createCommentVNode("",!0)}var Panel=_export_sfc(_sfc_main$x,[["render",_sfc_render$s]]);const _sfc_main$w=defineComponent({name:"m-form-row",props:{labelWidth:String,expandMore:Boolean,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,name:String,size:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm");return{mForm:o,display(i){return display(o,i.display,e)},changeHandler:()=>t("change",e.name?e.model[e.name]:e.model)}}});function _sfc_render$r(e,t,o,n,i,l){const a=resolveComponent("m-form-container"),r=resolveComponent("el-col"),s=resolveComponent("el-row");return openBlock(),createBlock(s,{gutter:10},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(d,c)=>{var u,f;return openBlock(),createBlock(r,{style:normalizeStyle(!e.display(d)||d.type==="hidden"?"display: none":""),key:(f=d[((u=e.mForm)==null?void 0:u.keyProp)||"__key"])!=null?f:c,span:d.span||e.config.span||24/e.config.items.length},{default:withCtx(()=>[createVNode(a,{model:e.name?e.model[e.name]:e.model,config:d,prop:e.prop,"label-width":e.config.labelWidth||e.labelWidth,"expand-more":e.expandMore,size:e.size,onChange:e.changeHandler},null,8,["model","config","prop","label-width","expand-more","size","onChange"])]),_:2},1032,["style","span"])}),128))]),_:1})}var Row=_export_sfc(_sfc_main$w,[["render",_sfc_render$r]]);const _sfc_main$v=defineComponent({name:"m-form-step",props:{model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},stepActive:{type:Number,default:()=>1},size:String,labelWidth:String},emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=ref(1);return watchEffect(()=>{n.value=e.stepActive}),{mForm:o,active:n,stepClick:a=>{n.value=a+1,o==null||o.$emit("update:stepActive",n.value)},changeHandler:()=>{t("change",e.model)}}}});function _sfc_render$q(e,t,o,n,i,l){const a=resolveComponent("el-step"),r=resolveComponent("el-steps"),s=resolveComponent("m-form-container");return openBlock(),createElementBlock("div",null,[createVNode(r,{active:e.active,"align-center":"",space:e.config.space},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(d,c)=>(openBlock(),createBlock(a,{key:d.__key,title:d.title,active:e.active,onClick:u=>e.stepClick(c)},null,8,["title","active","onClick"]))),128))]),_:1},8,["active","space"]),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(d,c)=>(openBlock(),createElementBlock(Fragment,null,[(openBlock(!0),createElementBlock(Fragment,null,renderList(d.items,u=>{var f;return openBlock(),createElementBlock(Fragment,null,[u?withDirectives((openBlock(),createBlock(s,{key:u[((f=e.mForm)==null?void 0:f.keyProp)||"__key"],config:u,model:d.name?e.model[d.name]:e.model,prop:d.name,size:e.size,"label-width":e.config.labelWidth||e.labelWidth,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","onChange"])),[[vShow,e.active-1===c]]):createCommentVNode("",!0)],64)}),256))],64))),256))])}var MStep=_export_sfc(_sfc_main$v,[["render",_sfc_render$q]]);let loadedAMapJS=!1,firstLoadingAMapJS=!0;const _sfc_main$u=defineComponent({name:"m-form-table",props:{name:{type:String,required:!0},model:{type:Object,required:!0,default:()=>({})},config:{type:Object,required:!0,default:()=>({})},prop:{type:String},labelWidth:{type:String},sort:{type:Boolean,default:!1},sortKey:{type:String,default:""},text:{type:String},size:String,enableToggleMode:{type:Boolean,default:!0}},emits:["change","select"],setup(e,{emit:t}){let o=null;const n=inject("mForm"),i=ref(),l=ref(),a=ref(),r=ref(10),s=ref(0),d=ref(1),c=ref(!1),u=computed(()=>e.name||e.config.name||""),f=({prop:y,order:$})=>{$==="ascending"?e.model[u.value]=e.model[u.value].sort((C,b)=>C[y]-b[y]):$==="descending"&&(e.model[u.value]=e.model[u.value].sort((C,b)=>b[y]-C[y]))},m=()=>{d.value+=1,setTimeout(()=>w())},h=(y,$)=>{if([e.model[u.value][y]]=e.model[u.value].splice($,1,e.model[u.value][y]),e.sortKey)for(let C=e.model[u.value].length-1,b=0;C>=0;C--,b++)e.model[u.value][b][e.sortKey]=C;n==null||n.$emit("field-change",e.prop,e.model[u.value])},w=()=>{var $;const y=($=i.value)==null?void 0:$.$el;if(y==null?void 0:y.querySelectorAll(".el-table__body > tbody")){const C=y.querySelectorAll(".el-table__body > tbody")[0],b=Sortable.create(C,{onEnd:({newIndex:k,oldIndex:B})=>{typeof k!="undefined"&&typeof B!="undefined"&&(h(k,B),t("change",e.model[u.value]),m(),b.destroy(),n==null||n.$emit("field-change",e.prop,e.model[u.value]),sleep(1e3).then(()=>{const S=y.querySelectorAll(".el-table__body > tbody > tr");(S==null?void 0:S[k])&&(S[k].style.backgroundColor="rgba(243, 89, 59, 0.2)",sleep(1e3).then(()=>{S[k].style.backgroundColor=""}))}))}})}},E=async y=>{if(e.config.max&&e.model[u.value].length>=e.config.max){ElMessage.error(`\u6700\u591A\u65B0\u589E\u914D\u7F6E\u4E0D\u80FD\u8D85\u8FC7${e.config.max}\u6761`);return}const $=e.config.items,C=e.config.enum||[];let b=[];const{length:k}=e.model[u.value],B=e.config.key||"id";let S={};if(C.length){if(k>=C.length)return;b=C.filter(D=>{let T=0;for(;T<k&&D[B]!==e.model[u.value][T][B];T++);return T===k}),b.length>0&&(S=b[0])}else Array.isArray(y)?$.forEach((D,T)=>{D.name&&(S[D.name]=y[T])}):(typeof e.config.defaultAdd=="function"?S=await e.config.defaultAdd(n,{model:e.model[u.value],formValue:n==null?void 0:n.values}):e.config.defaultAdd&&(S=e.config.defaultAdd),S=await initValue(n,{config:$,initValues:S}));e.sortKey&&k&&(S[e.sortKey]=e.model[u.value][k-1][e.sortKey]-1),e.model[u.value].push(S),t("change",e.model[u.value])};return!loadedAMapJS&&firstLoadingAMapJS&&!globalThis.XLSX&&(firstLoadingAMapJS=!1,asyncLoadJs("https://cdn.bootcdn.net/ajax/libs/xlsx/0.17.0/xlsx.full.min.js").then(()=>{loadedAMapJS=!0}).catch(()=>{firstLoadingAMapJS=!0})),onMounted(()=>{e.config.defautSort&&f(e.config.defautSort),e.sort&&e.sortKey&&e.model[u.value].sort((y,$)=>$[e.sortKey]-y[e.sortKey]),e.config.dropSort&&w()}),{mForm:n,pagesize:r,pagecontext:s,foreUpdate:m,isFullscreen:c,elTable:i,mTable:a,excelBtn:l,modelName:u,updateKey:d,ArrowDown:ArrowDown$1,ArrowUp,Delete:Delete$1,FullScreen,Grid:Grid$1,data:computed(()=>e.model[u.value].filter((y,$)=>$>=s.value*r.value&&$+1<=(s.value+1)*r.value)),addable:computed(()=>e.model[u.value].length?typeof e.config.addable=="function"?e.config.addable(n,{model:e.model[u.value],formValue:n==null?void 0:n.values,prop:e.prop}):typeof e.config.addable=="undefined"?!0:e.config.addable:!0),selection:computed(()=>typeof e.config.selection=="function"?e.config.selection(n,{model:e.model[u.value]}):e.config.selection),importable:computed(()=>typeof e.config.importable=="function"?e.config.importable(n,{formValue:n==null?void 0:n.values,model:e.model[u.value]}):typeof e.config.importable=="undefined"?!1:e.config.importable),sortChange:f,display(y){return display(n,y,e)},itemExtra(y,$){return typeof y=="function"?y(n,{values:n==null?void 0:n.initValues,model:e.model,formValue:n?n.values:e.model,prop:e.prop,index:$}):y},newHandler:E,removeHandler(y){e.model[u.value].splice(y,1),t("change",e.model[u.value])},selectHandle(y,$){var C,b;typeof e.config.selection=="string"&&e.config.selection==="single"&&((C=i.value)==null||C.clearSelection(),(b=i.value)==null||b.toggleRowSelection($,!0)),t("select",y,$),typeof e.config.onSelect=="function"&&e.config.onSelect(n,{selection:y,row:$})},toggleRowSelection(y,$){var C;(C=i.value)==null||C.toggleRowSelection.call(i.value,y,$)},makeConfig(y){const $=cloneDeep(y);return delete $.display,$},upHandler(y){o&&clearTimeout(o),o=setTimeout(()=>{h(y,y-1)},300)},topHandler(y){o&&clearTimeout(o);const $=y;for(let C=0;C<$;C++)h(y,y-1),y-=1},downHandler(y){o&&clearTimeout(o),o=setTimeout(()=>{h(y,y+1)},300)},bottomHandler(y){o&&clearTimeout(o);const $=e.model[u.value].length-1-y;for(let C=0;C<$;C++)h(y,y+1),y+=1},showDelete(y){const $=e.config.delete;return $&&typeof $=="function"?$(e.model[u.value],y,n==null?void 0:n.values):!0},clearHandler(){const y=e.model[u.value].length;e.model[u.value].splice(0,y),n==null||n.$emit("field-change",e.prop,e.model[u.value])},excelHandler(y){if(!y||!y.raw)return!1;const $=new FileReader;return $.onload=()=>{const C=$.result,b=globalThis.XLSX.read(C,{type:"array"});b.SheetNames.forEach(k=>{const B=globalThis.XLSX.utils.sheet_to_json(b.Sheets[k],{header:1});(B==null?void 0:B[0])&&B.forEach(S=>{E(S)}),setTimeout(()=>{var S;(S=l.value)==null||S.clearFiles()},300)})},$.readAsArrayBuffer(y.raw),!1},handleSizeChange(y){r.value=y},handleCurrentChange(y){s.value=y-1},toggleMode(){const y=$=>{var k;if(!$)return"0px";const C=((k=$.match(/[^\x00-\xff]/g))==null?void 0:k.length)||0,b=$.length-C;return`${Math.max(b*8+C*20,80)}px`};e.config.type="groupList",e.config.enableToggleMode=!0,e.config.tableItems=e.config.items,e.config.items=e.config.groupItems||e.config.items.map($=>{const C=$.text||$.label,b=y(C);return V(_({},$),{text:C,labelWidth:b,span:$.span||12})})},toggleFullscreen(){var y,$;c.value?((y=a.value)==null||y.classList.remove("fixed"),c.value=!1):(($=a.value)==null||$.classList.add("fixed"),c.value=!0)},getProp(y){const{prop:$}=toRefs(e);return`${$.value}${$.value?".":""}${y+1+s.value*r.value-1}`}}}}),_hoisted_1$f=["innerHTML"],_hoisted_2$6={class:"el-form-item__content"},_hoisted_3$4=["innerHTML"],_hoisted_4$2=createTextVNode("\u6DFB\u52A0"),_hoisted_5$1=createTextVNode(" \xA0 "),_hoisted_6=createTextVNode("\u5C55\u5F00\u914D\u7F6E"),_hoisted_7=createTextVNode("\u5BFC\u5165EXCEL"),_hoisted_8=createTextVNode("\xA0 "),_hoisted_9=createTextVNode("\u6E05\u7A7A"),_hoisted_10={class:"bottom",style:{"text-align":"right"}};function _sfc_render$p(e,t,o,n,i,l){const a=resolveComponent("el-table-column"),r=resolveComponent("el-button"),s=resolveComponent("el-tooltip"),d=resolveComponent("m-form-container"),c=resolveComponent("el-table"),u=resolveComponent("el-upload"),f=resolveComponent("el-pagination");return openBlock(),createElementBlock("div",{ref:"mTable",class:normalizeClass(["m-fields-table",{"m-fields-table-item-extra":e.config.itemExtra}])},[e.config.extra?(openBlock(),createElementBlock("span",{key:0,style:{color:"rgba(0, 0, 0, 0.45)"},innerHTML:e.config.extra},null,8,_hoisted_1$f)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_2$6,[createVNode(s,{content:"\u62D6\u62FD\u53EF\u6392\u5E8F",placement:"left-start",disabled:e.config.dropSort!==!0},{default:withCtx(()=>[e.model[e.modelName]?(openBlock(),createBlock(c,{ref:"elTable",style:{width:"100%"},data:e.model[e.modelName],border:e.config.border,"max-height":e.config.maxHeight,"default-expand-all":!0,key:e.updateKey,onSelect:e.selectHandle,onSortChange:e.sortChange},{default:withCtx(()=>[e.config.itemExtra?(openBlock(),createBlock(a,{key:0,fixed:"left",width:"30",type:"expand"},{default:withCtx(m=>[createBaseVNode("span",{innerHTML:e.itemExtra(e.config.itemExtra,m.$index),class:"m-form-tip"},null,8,_hoisted_3$4)]),_:1})):createCommentVNode("",!0),createVNode(a,{label:"\u64CD\u4F5C",width:"60",fixed:e.config.fixed===!1?void 0:"left"},{default:withCtx(m=>[withDirectives(createVNode(r,{style:{color:"#f56c6c"},type:"text",icon:e.Delete,onClick:h=>e.removeHandler(m.$index+1+e.pagecontext*e.pagesize-1)},null,8,["icon","onClick"]),[[vShow,e.showDelete(m.$index+1+e.pagecontext*e.pagesize-1)]])]),_:1},8,["fixed"]),e.sort&&e.model[e.modelName]&&e.model[e.modelName].length>1?(openBlock(),createBlock(a,{key:1,label:"\u6392\u5E8F",width:"60"},{default:withCtx(m=>[m.$index+1+e.pagecontext*e.pagesize-1!==0?(openBlock(),createBlock(s,{key:0,content:"\u70B9\u51FB\u4E0A\u79FB\uFF0C\u53CC\u51FB\u7F6E\u9876",placement:"top"},{default:withCtx(()=>[createVNode(r,{plain:"",size:"small",icon:e.ArrowUp,type:"text",onClick:h=>e.upHandler(m.$index+1+e.pagecontext*e.pagesize-1),onDblclick:h=>e.topHandler(m.$index+1+e.pagecontext*e.pagesize-1)},null,8,["icon","onClick","onDblclick"])]),_:2},1024)):createCommentVNode("",!0),m.$index+1+e.pagecontext*e.pagesize-1!==e.model[e.modelName].length-1?(openBlock(),createBlock(s,{key:1,content:"\u70B9\u51FB\u4E0B\u79FB\uFF0C\u53CC\u51FB\u7F6E\u5E95",placement:"top"},{default:withCtx(()=>[createVNode(r,{plain:"",size:"small",icon:e.ArrowDown,type:"text",onClick:h=>e.downHandler(m.$index+1+e.pagecontext*e.pagesize-1),onDblclick:h=>e.bottomHandler(m.$index+1+e.pagecontext*e.pagesize-1)},null,8,["icon","onClick","onDblclick"])]),_:2},1024)):createCommentVNode("",!0)]),_:1})):createCommentVNode("",!0),e.selection?(openBlock(),createBlock(a,{key:2,align:"center","header-align":"center",type:"selection",width:"45"})):createCommentVNode("",!0),createVNode(a,{width:"60",label:"\u5E8F\u53F7"},{default:withCtx(m=>[createTextVNode(toDisplayString(m.$index+1+e.pagecontext*e.pagesize),1)]),_:1}),(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.items,(m,h)=>{var w,E;return openBlock(),createElementBlock(Fragment,null,[m.type!=="hidden"&&e.display(m.display)?(openBlock(),createBlock(a,{prop:m.name,width:m.width,label:m.label,sortable:m.sortable,"sort-orders":["ascending","descending"],key:(E=m[((w=e.mForm)==null?void 0:w.keyProp)||"__key"])!=null?E:h,"class-name":e.config.dropSort===!0?"el-table__column--dropable":""},{default:withCtx(y=>[y.$index>-1?(openBlock(),createBlock(d,{key:0,labelWidth:"0",prop:e.getProp(y.$index),rules:m.rules,config:e.makeConfig(m),model:y.row,size:e.size,onChange:t[0]||(t[0]=$=>e.$emit("change",e.model[e.modelName]))},null,8,["prop","rules","config","model","size"])):createCommentVNode("",!0)]),_:2},1032,["prop","width","label","sortable","class-name"])):createCommentVNode("",!0)],64)}),256))]),_:1},8,["data","border","max-height","onSelect","onSortChange"])):createCommentVNode("",!0)]),_:1},8,["disabled"]),renderSlot(e.$slots,"default"),e.addable?(openBlock(),createBlock(r,{key:0,size:"small",type:"primary",plain:"",onClick:t[1]||(t[1]=m=>e.newHandler())},{default:withCtx(()=>[_hoisted_4$2]),_:1})):createCommentVNode("",!0),_hoisted_5$1,e.enableToggleMode&&!e.isFullscreen?(openBlock(),createBlock(r,{key:1,icon:e.Grid,size:"small",onClick:e.toggleMode},{default:withCtx(()=>[_hoisted_6]),_:1},8,["icon","onClick"])):createCommentVNode("",!0),e.config.enableFullscreen!==!1?(openBlock(),createBlock(r,{key:2,icon:e.FullScreen,size:"small",onClick:e.toggleFullscreen},{default:withCtx(()=>[createTextVNode(toDisplayString(e.isFullscreen?"\u9000\u51FA\u5168\u5C4F":"\u5168\u5C4F\u7F16\u8F91"),1)]),_:1},8,["icon","onClick"])):createCommentVNode("",!0),e.importable?(openBlock(),createBlock(u,{key:3,ref:"excelBtn",action:"/noop","on-change":e.excelHandler,"auto-upload":!1,style:{display:"inline-block"}},{default:withCtx(()=>[createVNode(r,{size:"small",type:"success",plain:""},{default:withCtx(()=>[_hoisted_7]),_:1})]),_:1},8,["on-change"])):createCommentVNode("",!0),_hoisted_8,e.importable?(openBlock(),createBlock(r,{key:4,size:"small",type:"warning",plain:"",onClick:t[2]||(t[2]=m=>e.clearHandler())},{default:withCtx(()=>[_hoisted_9]),_:1})):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_10,[createVNode(f,{layout:"total, sizes, prev, pager, next, jumper","hide-on-single-page":e.model[e.modelName].length<e.pagesize,"current-page":e.pagecontext+1,"page-sizes":[e.pagesize,60,120,300],"page-size":e.pagesize,total:e.model[e.modelName].length,onSizeChange:e.handleSizeChange,onCurrentChange:e.handleCurrentChange},null,8,["hide-on-single-page","current-page","page-sizes","page-size","total","onSizeChange","onCurrentChange"])])],2)}var Table$1=_export_sfc(_sfc_main$u,[["render",_sfc_render$p]]);const getActive=(e,t,o)=>{const{config:n,model:i,prop:l}=t,{active:a}=n;return typeof a=="function"?a(e,{model:i,formValue:e==null?void 0:e.values,prop:l}):+o>=t.config.items.length?"0":typeof a!="undefined"?a:"0"},tabClickHandler=(e,t,o)=>{const{config:n,model:i,prop:l}=o;t.name=t.paneName,typeof n.onTabClick=="function"&&n.onTabClick(e,t,{model:i,formValue:e==null?void 0:e.values,prop:l});const a=n.items.find(r=>t.name===r.status);a&&typeof a.onTabClick=="function"&&a.onTabClick(e,t,{model:i,formValue:e==null?void 0:e.values,prop:l})},Tab=defineComponent({name:"m-form-tab",props:{labelWidth:String,expandMore:Boolean,model:{type:Object,default:()=>({})},config:{type:Object,default:()=>({})},prop:String,size:String},emits:{change(e){return e}},setup(e,{emit:t}){const o=inject("mForm"),n=ref(getActive(o,e,"")),i=computed(()=>{if(e.config.dynamic){if(!e.config.name)throw new Error("dynamic tab \u5FC5\u987B\u914D\u7F6Ename");return e.model[e.config.name]||[]}return e.config.items}),l=a=>filterFunction(o,a,e);return watchEffect(()=>{typeof e.config.activeChange=="function"&&e.config.activeChange(o,n.value,{model:e.model,prop:e.prop})}),{mForm:o,activeTabName:n,tabs:i,filter:l,tabItems:a=>e.config.dynamic?e.config.items:a.items,tabClickHandler:a=>tabClickHandler(o,a,e),onTabAdd:()=>{if(!e.config.name)throw new Error("dynamic tab \u5FC5\u987B\u914D\u7F6Ename");if(typeof e.config.onTabAdd=="function")e.config.onTabAdd(o,{model:e.model});else if(i.value.length>0){const a=cloneDeep(i.value[0]);a.title=`\u6807\u7B7E${i.value.length+1}`,e.model[e.config.name].push(a)}t("change",e.model),o==null||o.$emit("field-change",e.prop,e.model[e.config.name])},onTabRemove:a=>{if(!e.config.name)throw new Error("dynamic tab \u5FC5\u987B\u914D\u7F6Ename");typeof e.config.onTabRemove=="function"?e.config.onTabRemove(o,a,{model:e.model}):(e.model[e.config.name].splice(+a,1),(a<n.value||n.value>=e.model[e.config.name].length)&&(n.value=(+n.value-1).toString(),tabClickHandler(o,{name:n.value},e))),t("change",e.model),o==null||o.$emit("field-change",e.prop,e.model[e.config.name])},display:a=>display(o,a,e),changeHandler:()=>{t("change",e.model),typeof e.config.onChange=="function"&&e.config.onChange(o,{model:e.model})}}}}),_sfc_main$t=Tab;function _sfc_render$o(e,t,o,n,i,l){const a=resolveComponent("m-form-container"),r=resolveComponent("el-tab-pane"),s=resolveComponent("el-tabs");return openBlock(),createBlock(s,{modelValue:e.activeTabName,"onUpdate:modelValue":t[0]||(t[0]=d=>e.activeTabName=d),class:normalizeClass(e.config.dynamic?"magic-form-dynamic-tab":"magic-form-tab"),type:e.config.tabType,editable:e.config.editable||!1,"tab-position":e.config.tabPosition||"top",onTabClick:e.tabClickHandler,onTabAdd:e.onTabAdd,onTabRemove:e.onTabRemove},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tabs,(d,c)=>{var u,f;return openBlock(),createElementBlock(Fragment,null,[e.display(d.display)&&e.tabItems(d).length?(openBlock(),createBlock(r,{key:(f=d[((u=e.mForm)==null?void 0:u.keyProp)||"__key"])!=null?f:c,name:e.filter(d.status)||c.toString(),label:e.filter(d.title),lazy:d.lazy||!1},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.tabItems(d),m=>{var h;return openBlock(),createBlock(a,{key:m[((h=e.mForm)==null?void 0:h.keyProp)||"__key"],config:m,model:e.config.dynamic?e.model[e.config.name||""][c]:d.name?e.model[d.name]:e.model,prop:e.config.dynamic?`${e.prop}${e.prop?".":""}${String(c)}`:e.prop,size:e.size,"label-width":d.labelWidth||e.labelWidth,"expand-more":e.expandMore,onChange:e.changeHandler},null,8,["config","model","prop","size","label-width","expand-more","onChange"])}),128))]),_:2},1032,["name","label","lazy"])):createCommentVNode("",!0)],64)}),256))]),_:1},8,["modelValue","class","type","editable","tab-position","onTabClick","onTabAdd","onTabRemove"])}var Tabs=_export_sfc(_sfc_main$t,[["render",_sfc_render$o]]);let $MAGIC_FORM={};const setConfig=e=>{$MAGIC_FORM=e},getConfig=e=>$MAGIC_FORM[e];var fieldProps={model:{type:Object,required:!0,default:()=>({})},name:{type:String,default:""},disabled:{type:Boolean,default:!1},size:String,prop:String,initValues:Object,values:Object};const useAddField=e=>{if(!e)return;const t=inject("mForm"),o=getCurrentInstance();watch(()=>o==null?void 0:o.proxy,n=>{n?t==null||t.setField(e,n):t==null||t.deleteField(e)},{immediate:!0})},_sfc_main$s=defineComponent({name:"m-fields-cascader",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){const o=inject("mForm"),n=getCurrentInstance();useAddField(e.prop);const i=getConfig("request"),l=ref(null),a=ref(null),r=Array.isArray(e.config.options)?ref(e.config.options):ref([]),s=ref(null),d=async function(){const{config:u}=e,{option:f}=u;if(!f)return;let{body:m}=f;const h={url:f.url,cache:f.cache,timeout:f.timeout,data:{}};m&&o&&(typeof m=="function"&&e.model&&o&&(m=m(o,{model:e.model,formValue:null,formValues:o.values})),h.data=m);const w=await i(h);s.value=w[f.root],s.value&&typeof(f==null?void 0:f.item)=="function"&&(r.value=f.item(w[f.root]))};typeof e.config.options=="function"&&e.model&&o?watchEffect(()=>r.value=e.config.options(n,{model:e.model,formValues:o.values})):(!e.config.options||!e.config.options.length||e.config.remote)&&Promise.resolve(d());const c=computed(()=>{var u;return((u=e.config.add)==null?void 0:u.action.method)==="post"?f=>{var m,h;return i(_(_({},(h=(m=e.config)==null?void 0:m.add)==null?void 0:h.action.body),f))}:null});return{options:r,remoteData:s,addButtonStyle:{top:0,left:0,width:"auto"},dialogVisible:!1,cascader:l,dialog:a,action:c,setRemoteOptions:d,changeHandler:u=>{!l.value||(l.value.query="",l.value.previousQuery=null,t("change",u))},addHandler:()=>{!a.value||(a.value.dialogVisible=!0)},editAfterAction:()=>{d()}}}}),_hoisted_1$e={class:"m-cascader",style:{width:"100%"}};function _sfc_render$n(e,t,o,n,i,l){const a=resolveComponent("el-cascader");return openBlock(),createElementBlock("div",_hoisted_1$e,[createVNode(a,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),ref:"cascader",style:{width:"100%"},clearable:"",filterable:"",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,options:e.options,props:{multiple:e.config.multiple},onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","options","props","onChange"])])}var Cascader=_export_sfc(_sfc_main$s,[["render",_sfc_render$n]]);const _sfc_main$r=defineComponent({name:"m-fields-checkbox",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){return useAddField(e.prop),{activeValue:computed(()=>{if(typeof e.config.activeValue=="undefined"){if(e.config.filter==="number")return 1}else return e.config.activeValue;return"true"}),inactiveValue:computed(()=>{if(typeof e.config.inactiveValue=="undefined"){if(e.config.filter==="number")return 0}else return e.config.inactiveValue;return"false"}),changeHandler(o){t("change",o)}}}});function _sfc_render$m(e,t,o,n,i,l){const a=resolveComponent("el-checkbox");return openBlock(),createBlock(a,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),size:e.size,trueLabel:e.activeValue,falseLabel:e.inactiveValue,disabled:e.disabled,label:e.config.text,onChange:e.changeHandler},null,8,["modelValue","size","trueLabel","falseLabel","disabled","label","onChange"])}var Checkbox=_export_sfc(_sfc_main$r,[["render",_sfc_render$m]]);const _sfc_main$q=defineComponent({name:"m-fields-checkbox-group",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){return useAddField(e.prop),e.model&&!e.model[e.name]&&(e.model[e.name]=[]),{changeHandler:o=>{t("change",o)}}}});function _sfc_render$l(e,t,o,n,i,l){const a=resolveComponent("el-checkbox"),r=resolveComponent("el-checkbox-group");return openBlock(),createBlock(r,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),size:e.size,disabled:e.disabled,onChange:e.changeHandler},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.options,s=>(openBlock(),createBlock(a,{label:s.value,key:s.value},{default:withCtx(()=>[createTextVNode(toDisplayString(s.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","size","disabled","onChange"])}var CheckboxGroup=_export_sfc(_sfc_main$q,[["render",_sfc_render$l]]);const _hoisted_1$d={key:0},__default__$2=defineComponent({name:"m-fields-color-picker"}),_sfc_main$p=defineComponent(V(_({},__default__$2),{props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const n=i=>t("change",i);return(i,l)=>{const a=resolveComponent("el-color-picker");return i.model?(openBlock(),createElementBlock("div",_hoisted_1$d,[createVNode(a,{modelValue:i.model[i.name],"onUpdate:modelValue":l[0]||(l[0]=r=>i.model[i.name]=r),size:i.size,disabled:i.disabled,showAlpha:!0,onChange:n},null,8,["modelValue","size","disabled"])])):createCommentVNode("",!0)}}})),_sfc_main$o=defineComponent({name:"m-fields-date",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){useAddField(e.prop);const o=computed(()=>e.prop||e.config.name||"");return e.model[o.value]=datetimeFormatter(e.model[o.value],""),{modelName:o,changeHandler(n){t("change",n)}}}}),_hoisted_1$c={key:0};function _sfc_render$k(e,t,o,n,i,l){const a=resolveComponent("el-date-picker");return e.model?(openBlock(),createElementBlock("div",_hoisted_1$c,[createVNode(a,{modelValue:e.model[e.modelName],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.modelName]=r),type:"date",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,format:e.config.format,"value-format":e.config.format||"YYYY-MM-DD HH:mm:ss",onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","format","value-format","onChange"])])):createCommentVNode("",!0)}var Date$1=_export_sfc(_sfc_main$o,[["render",_sfc_render$k]]);const _sfc_main$n=defineComponent({name:"m-fields-daterange",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const{names:o}=e.config,n=ref([]);e.model!==void 0&&((o==null?void 0:o.length)?n.value=o.map(l=>{var a;return datetimeFormatter((a=e.model)==null?void 0:a[l],"")}):e.name&&e.model[e.name]&&(n.value=e.model[e.name].map(l=>datetimeFormatter(l,""))));const i=l=>{(o==null?void 0:o.length)&&l instanceof Array?o.forEach((a,r)=>{e.model&&(e.model[a]=datetimeFormatter(l[r].toString(),""))}):e.model&&e.name&&l instanceof Date&&(e.model[e.name]=datetimeFormatter(l.toString(),""))};return{value:n,changeHandler(l){i(l),t("change",l)}}}});function _sfc_render$j(e,t,o,n,i,l){const a=resolveComponent("el-date-picker");return openBlock(),createElementBlock("div",null,[createVNode(a,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=r=>e.value=r),type:"datetimerange","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F",size:e.size,"unlink-panels":!0,disabled:e.disabled,onChange:e.changeHandler},null,8,["modelValue","size","disabled","onChange"])])}var Daterange=_export_sfc(_sfc_main$n,[["render",_sfc_render$j]]);const _sfc_main$m=defineComponent({name:"m-fields-datetime",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){var n;useAddField(e.prop);const o=(n=e.model)==null?void 0:n[e.name].toString();return e.model&&(o==="Invalid Date"?e.model[e.name]="":e.model[e.name]=datetimeFormatter(e.model[e.name],"",e.config.valueFormat)),{value:o,changeHandler:i=>{t("change",i)}}}}),_hoisted_1$b={key:0};function _sfc_render$i(e,t,o,n,i,l){const a=resolveComponent("el-date-picker");return e.model?(openBlock(),createElementBlock("div",_hoisted_1$b,[createVNode(a,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),"popper-class":"magic-datetime-picker-popper",type:"datetime",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,format:e.config.format||"YYYY-MM-DD HH:mm:ss","value-format":e.config.valueFormat||"YYYY-MM-DD HH:mm:ss",onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","format","value-format","onChange"])])):createCommentVNode("",!0)}var DateTime=_export_sfc(_sfc_main$m,[["render",_sfc_render$i]]);const _hoisted_1$a={key:0},__default__$1=defineComponent({name:"m-fields-display"}),_sfc_main$l=defineComponent(V(_({},__default__$1),{props:V(_({},fieldProps),{config:{type:Object,required:!0}}),setup(e){const t=e,o=computed(()=>t.name||t.config.name||"");return t.config.initValue&&o.value&&t.model&&(t.model[o.value]=t.config.initValue),useAddField(t.prop),(n,i)=>n.model?(openBlock(),createElementBlock("span",_hoisted_1$a,toDisplayString(n.model[unref(o)]),1)):createCommentVNode("",!0)}})),_sfc_main$k=defineComponent({name:"m-fields-dynamic-field",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const o=getConfig("request"),n=reactive({value:{}}),i=reactive({value:{}}),l=async()=>{if(typeof e.config.returnFields!="function"||!e.model)return;const r=await e.config.returnFields(e.config,e.model,o);n.value={},i.value={},r.forEach(s=>{var c;if(typeof s!="object"||s.name===void 0)return;let d=((c=e.model)==null?void 0:c[s.name])||"";!d&&s.defaultValue!==void 0&&(d=s.defaultValue,t("change",d,s.name)),n.value[s.name]=d,i.value[s.name]=s.label||""})},a=watch(()=>{var r;return(r=e.model)==null?void 0:r[e.config.dynamicKey]},r=>{r!==""&&l()},{immediate:!0});return onBeforeUnmount(()=>{typeof a=="function"&&a()}),{request:o,fieldMap:n,fieldLabelMap:i,unwatch:a,changeFieldMap:l,inputChangeHandler:r=>{t("change",n.value[r],r)}}},methods:{init(){}}}),_hoisted_1$9={class:"m-fields-dynamic-field"};function _sfc_render$h(e,t,o,n,i,l){const a=resolveComponent("el-input"),r=resolveComponent("el-form-item"),s=resolveComponent("el-form");return openBlock(),createElementBlock("div",_hoisted_1$9,[createVNode(s,{size:"small"},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(Object.keys(e.fieldMap.value),d=>(openBlock(),createBlock(r,{key:d,label:e.fieldLabelMap.value[d]},{default:withCtx(()=>[createVNode(a,{modelValue:e.fieldMap.value[d],"onUpdate:modelValue":c=>e.fieldMap.value[d]=c,placeholder:e.fieldLabelMap.value[d],onChange:c=>e.inputChangeHandler(d)},null,8,["modelValue","onUpdate:modelValue","placeholder","onChange"])]),_:2},1032,["label"]))),128))]),_:1})])}var DynamicField=_export_sfc(_sfc_main$k,[["render",_sfc_render$h]]);const __default__=defineComponent({name:"m-fields-hidden"}),_sfc_main$j=defineComponent(V(_({},__default__),{props:V(_({},fieldProps),{config:{type:Object,required:!0}}),setup(e){const t=e,o=computed(()=>t.name||t.config.name||"");return useAddField(t.prop),(n,i)=>n.model?withDirectives((openBlock(),createElementBlock("input",{key:0,"onUpdate:modelValue":i[0]||(i[0]=l=>n.model[unref(o)]=l),type:"hidden"},null,512)),[[vModelText,n.model[unref(o)]]]):createCommentVNode("",!0)}})),_sfc_main$i=defineComponent({name:"m-fields-link",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){useAddField(e.prop);const o=ref({}),n=ref(),i=inject("mForm"),l=computed(()=>{var r;return typeof e.config.href=="function"&&e.model?e.config.href(e.model):e.config.href||((r=e.model)==null?void 0:r[e.name])}),a=()=>{var r;o.value=((r=e.model)==null?void 0:r[e.name])||{}};return{formValue:o,editor:n,href:l,formConfig:computed(()=>typeof e.config.form=="function"?e.config.form(i,{model:e.model||{},values:e.values||{}}):e.config.form),disable:computed(()=>typeof e.config.disabled!="undefined"?e.config.disabled:!l.value),displayText:computed(()=>typeof e.config.displayText=="function"?e.config.displayText(i,{model:e.model||{}}):e.config.displayText?e.config.displayText:"\u8DF3\u8F6C"),init:a,editHandler:()=>{a(),n.value&&(n.value.dialogVisible=!0)},action:r=>{e.model&&(e.model[e.name]=r,o.value=r,t("change",e.model[e.name])),n.value&&(n.value.dialogVisible=!1)}}}}),_hoisted_1$8=["href"],_hoisted_2$5={key:2,class:"m-fields-link"},_hoisted_3$3=createTextVNode("\u70B9\u51FB\u7F16\u8F91");function _sfc_render$g(e,t,o,n,i,l){const a=resolveComponent("el-button"),r=resolveComponent("m-form-dialog");return e.config.href&&!e.disabled?(openBlock(),createElementBlock("a",{key:0,target:"_blank",href:e.href,style:normalizeStyle(e.config.css||{})},toDisplayString(e.displayText),13,_hoisted_1$8)):e.config.href&&e.disabled?(openBlock(),createElementBlock("span",{key:1,style:normalizeStyle(e.config.disabledCss||{})},toDisplayString(e.displayText),5)):(openBlock(),createElementBlock("div",_hoisted_2$5,[createVNode(a,{type:"text",onClick:e.editHandler},{default:withCtx(()=>[_hoisted_3$3]),_:1},8,["onClick"]),createVNode(r,{ref:"editor",title:e.config.formTitle||"\u7F16\u8F91\u6269\u5C55\u914D\u7F6E",width:e.config.formWidth,values:e.formValue,config:e.formConfig,parentValues:e.values,fullscreen:e.config.fullscreen,onSubmit:e.action},null,8,["title","width","values","config","parentValues","fullscreen","onSubmit"])]))}var Link=_export_sfc(_sfc_main$i,[["render",_sfc_render$g]]);const _sfc_main$h=defineComponent({name:"m-fields-number",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){useAddField(e.prop);const o=inject("mForm");return{mForm:o,changeHandler:n=>{t("change",n)},inputHandler:n=>{t("input",n),o==null||o.$emit("field-input",e.prop,n)}}}});function _sfc_render$f(e,t,o,n,i,l){const a=resolveComponent("el-input-number");return e.model?(openBlock(),createBlock(a,{key:0,modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),clearable:"","controls-position":"right",size:e.size,max:e.config.max,min:e.config.min,step:e.config.step,placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler,onInput:e.inputHandler},null,8,["modelValue","size","max","min","step","placeholder","disabled","onChange","onInput"])):createCommentVNode("",!0)}var Number$1=_export_sfc(_sfc_main$h,[["render",_sfc_render$f]]);const _sfc_main$g=defineComponent({name:"m-fields-radio-group",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){return useAddField(e.prop),{changeHandler:o=>t("change",o)}}});function _sfc_render$e(e,t,o,n,i,l){const a=resolveComponent("el-radio"),r=resolveComponent("el-radio-group");return e.model?(openBlock(),createBlock(r,{key:0,modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.name]=s),size:e.size,disabled:e.disabled,onChange:e.changeHandler},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.options,s=>(openBlock(),createBlock(a,{label:s.value,key:s.value},{default:withCtx(()=>[createTextVNode(toDisplayString(s.text),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue","size","disabled","onChange"])):createCommentVNode("",!0)}var RadioGroup=_export_sfc(_sfc_main$g,[["render",_sfc_render$e]]);const _sfc_main$f=defineComponent({name:"m-fields-select",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){if(!e.model)throw new Error("\u4E0D\u80FD\u6CA1\u6709model");useAddField(e.prop);const o=ref(),n=inject("mForm"),i=ref([]),l=ref([]),a=ref(!1),r=ref(!1),s=ref(0),d=ref(0),c=ref(20),u=ref(""),f=ref([]),m=ref(!0),h=(C,b)=>{if(typeof b=="object"){const k=e.config.valueKey||"value";return b[k]===C[k]}return C===b},w=C=>{const{option:b}=e.config,{text:k}=b,{value:B}=b;return C.map(S=>({text:typeof k=="function"?k(S):S[k||"text"],value:typeof B=="function"?B(S):S[B||"value"]}))},E=async()=>{var A;if(!e.model)return[];if(l.value.length)return l.value;a.value=!0;let C=[];const{config:b}=e,{option:k}=b;let{body:B}=k,S={method:k.method||"POST",url:k.url,cache:k.cache,timeout:k.timeout,mode:k.mode,headers:k.headers||{},json:k.json||!1};B&&(typeof B=="function"&&(B=B(n,{model:e.model,formValue:n==null?void 0:n.values,formValues:n==null?void 0:n.values})),B.query=u.value,B.pgSize=c.value,B.pgIndex=d.value,S.data=B);const D=getConfig("request");typeof k.beforeRequest=="function"&&(S=k.beforeRequest(n,S,{model:e.model,formValue:n==null?void 0:n.values})),((A=k.method)==null?void 0:A.toLocaleLowerCase())==="jsonp"&&(S.jsonpCallback=k.jsonpCallback||"callback");let T=await D(S);typeof k.afterRequest=="function"&&(T=k.afterRequest(n,T,{model:e.model,formValue:n==null?void 0:n.values,formValues:n==null?void 0:n.values}));const L=T[k.root];T.total>0&&(s.value=T.total),f.value=f.value.concat(L),L&&(typeof k.item=="function"?C=k.item(L):L.map&&(C=w(L))),a.value=!1;const N=[];return e.config.multiple&&e.model[e.name]&&i.value.forEach(H=>{var R;((R=e.model)==null?void 0:R[e.name].includes(H.value))&&!C.find(G=>G.value===H.value)&&N.push(H)}),d.value===0?N.concat(C):i.value.concat(C)},y=async()=>{if(!e.model)return[];const C=e.model[e.name],{config:b}=e;return l.value=await E(),m.value=!1,b.group?b.multiple&&C.findIndex?l.value.filter(k=>k.options.findIndex(B=>C.find(S=>h(B.value,S))>-1)>-1):l.value.filter(k=>k.options.findIndex(B=>h(B.value,C))>-1):b.multiple&&C.findIndex?l.value.filter(k=>C.findIndex(B=>h(k.value,B))>-1):l.value.filter(k=>h(k.value,C))},$=async()=>{var N;if(!e.model)return[];const{config:C}=e,{option:b}=C;let k=[],B=b.initUrl;if(!B)return y();typeof B=="function"&&(B=await B(n,{model:e.model,formValue:n==null?void 0:n.values}));const S={method:b.method||"POST",url:B,data:{id:e.model[e.name]},mode:b.mode,headers:b.headers||{},json:b.json||!1};((N=b.method)==null?void 0:N.toLocaleLowerCase())==="jsonp"&&(S.jsonpCallback=b.jsonpCallback||"callback");let L=(await getConfig("request")(S))[b.root];return L&&(Array.isArray(L)||(L=[L]),typeof b.item=="function"?k=b.item(L):L.map&&(k=w(L))),k};return typeof e.config.options=="function"?watch(()=>n==null?void 0:n.values,()=>{typeof e.config.options=="function"&&Promise.resolve(e.config.options(n,{model:e.model,prop:e.prop,formValues:n==null?void 0:n.values,formValue:n==null?void 0:n.values})).then(C=>{i.value=C})},{deep:!0,immediate:!0}):Array.isArray(e.config.options)?watch(()=>e.config.options,()=>{i.value=e.config.options},{immediate:!0}):e.config.option&&onBeforeMount(()=>{if(!e.model)return;const C=e.model[e.name];(Array.isArray(C)?C.length:C)&&$().then(b=>{i.value=b})}),e.config.remote&&onMounted(()=>{var C;(C=o.value)==null||C.scrollbar.wrap$.addEventListener("scroll",async b=>{const k=b.currentTarget;r.value||k.scrollHeight-k.clientHeight-k.scrollTop>1||s.value<=i.value.length||(r.value=!0,d.value+=1,i.value=await E(),r.value=!1)})}),{select:o,loading:a,remote:m,options:i,moreLoadingVisible:r,popperClass:n==null?void 0:n.popperClass,getRequestFuc(){return getConfig("request")},async getInitOption(){},changeHandler(C){t("change",C)},async visibleHandler(C){var b;!C||!e.config.remote||(u.value&&o.value?(o.value.query=u.value,o.value.previousQuery=u.value,o.value.selectedLabel=u.value):i.value.length<=(e.config.multiple?(b=e.model)==null?void 0:b[e.name].length:1)&&(i.value=await E()))},async editAfterAction(){d.value=0,i.value=await E()},async remoteMethod(C){l.value.length||(u.value=C,d.value=0,i.value=await E(),e.config.multiple&&setTimeout(()=>{var b;(b=o.value)==null||b.setSelected()},0))}}}}),_hoisted_1$7={key:2};function _sfc_render$d(e,t,o,n,i,l){const a=resolveComponent("el-option"),r=resolveComponent("el-option-group"),s=resolveComponent("el-select"),d=resolveDirective("loading");return e.model?withDirectives((openBlock(),createBlock(s,{key:0,modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=c=>e.model[e.name]=c),class:"m-select",ref:"select",clearable:"",filterable:"","popper-class":`m-select-popper ${e.popperClass}`,size:e.size,remote:e.remote,placeholder:e.config.placeholder,multiple:e.config.multiple,"value-key":e.config.valueKey||"value","allow-create":e.config.allowCreate,disabled:e.disabled,"remote-method":e.remoteMethod,onChange:e.changeHandler,onVisibleChange:e.visibleHandler},{default:withCtx(()=>[e.config.group?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.options,(c,u)=>(openBlock(),createBlock(r,{key:c.label+u,label:c.label,disabled:c.disabled},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(c.options,(f,m)=>(openBlock(),createBlock(a,{key:f.label+m,label:f.label,value:f.value,disabled:f.disabled},null,8,["label","value","disabled"]))),128))]),_:2},1032,["label","disabled"]))),128)):(openBlock(!0),createElementBlock(Fragment,{key:1},renderList(e.options,c=>(openBlock(),createBlock(a,{label:c.text,value:c.value,key:e.config.valueKey?c.value[e.config.valueKey]:c.value,disabled:c.disabled},null,8,["label","value","disabled"]))),128)),e.moreLoadingVisible?withDirectives((openBlock(),createElementBlock("div",_hoisted_1$7,null,512)),[[d,!0]]):createCommentVNode("",!0)]),_:1},8,["modelValue","popper-class","size","remote","placeholder","multiple","value-key","allow-create","disabled","remote-method","onChange","onVisibleChange"])),[[d,e.loading]]):createCommentVNode("",!0)}var Select=_export_sfc(_sfc_main$f,[["render",_sfc_render$d]]);const _sfc_main$e=defineComponent({name:"m-fields-switch",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change"],setup(e,{emit:t}){return useAddField(e.prop),{n:computed(()=>e.name||e.config.name||""),activeValue:computed(()=>{if(typeof e.config.activeValue=="undefined"){if(e.config.filter==="number")return 1}else return e.config.activeValue;return!0}),inactiveValue:computed(()=>{if(typeof e.config.inactiveValue=="undefined"){if(e.config.filter==="number")return 0}else return e.config.inactiveValue;return!1}),changeHandler:o=>{t("change",o)}}}});function _sfc_render$c(e,t,o,n,i,l){const a=resolveComponent("el-switch");return e.model?(openBlock(),createBlock(a,{key:0,modelValue:e.model[e.n],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.n]=r),size:e.size,activeValue:e.activeValue,inactiveValue:e.inactiveValue,disabled:e.disabled,onChange:e.changeHandler},null,8,["modelValue","size","activeValue","inactiveValue","disabled","onChange"])):createCommentVNode("",!0)}var Switch=_export_sfc(_sfc_main$e,[["render",_sfc_render$c]]);const _sfc_main$d=defineComponent({name:"m-fields-text",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:["change","input"],setup(e,{emit:t}){useAddField(e.prop);const o=computed(()=>e.name||e.config.name||"");return{modelName:o,changeHandler(n){t("change",n)},inputHandler(n){const i=inject("mForm");t("input",n),i==null||i.$emit("field-input",e.prop,n)},buttonClickHandler(){var i;const n=inject("mForm");typeof e.config.append!="string"&&((i=e.config.append)==null?void 0:i.handler)&&e.config.append.handler(n,{model:e.model,values:n==null?void 0:n.values})},keyUpHandler(n){if(!e.model||!o.value)return;const i=n.key==="ArrowUp",l=n.key==="ArrowDown";if(!i&&!l)return;const a=e.model[o.value];let r,s;if(/^([0-9.]+)$/.test(a)?r=+a:a.replace(/^([0-9.]+)([a-z%]+)$/,(f,m,h)=>{r=+m,s=h}),r===void 0)return;const d=navigator.platform.match("Mac")?n.metaKey:n.ctrlKey,c=n.shiftKey,u=n.altKey;i?d?r+=100:u?r=(r*1e4+1e3)/1e4:c?r=r+10:r+=1:l&&(d?r-=100:u?r=(r*1e4-1e3)/1e4:c?r-=10:r-=1),e.model[o.value]=`${r}${s||""}`,t("change",e.model[o.value])}}}}),_hoisted_1$6={key:0};function _sfc_render$b(e,t,o,n,i,l){const a=resolveComponent("el-button"),r=resolveComponent("el-input");return openBlock(),createBlock(r,{modelValue:e.model[e.modelName],"onUpdate:modelValue":t[0]||(t[0]=s=>e.model[e.modelName]=s),clearable:"",size:e.size,placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler,onInput:e.inputHandler,onKeyup:t[1]||(t[1]=s=>e.keyUpHandler(s))},createSlots({_:2},[e.config.append?{name:"append",fn:withCtx(()=>[typeof e.config.append=="string"?(openBlock(),createElementBlock("span",_hoisted_1$6,toDisplayString(e.config.append),1)):createCommentVNode("",!0),typeof e.config.append=="object"&&e.config.append.type==="button"?(openBlock(),createBlock(a,{key:1,style:{color:"#409eff"},onClick:withModifiers(e.buttonClickHandler,["prevent"])},{default:withCtx(()=>[createTextVNode(toDisplayString(e.config.append.text),1)]),_:1},8,["onClick"])):createCommentVNode("",!0)])}:void 0]),1032,["modelValue","size","placeholder","disabled","onChange","onInput"])}var Text=_export_sfc(_sfc_main$d,[["render",_sfc_render$b]]);const _sfc_main$c=defineComponent({name:"m-fields-textarea",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:{change(e){return e},input(e){return e}},setup(e,{emit:t}){useAddField(e.prop);const o=inject("mForm");return{mForm:o,changeHandler:n=>{t("change",n)},inputHandler:n=>{t("input",n),o==null||o.$emit("field-input",e.prop,n)}}}}),_hoisted_1$5={key:0};function _sfc_render$a(e,t,o,n,i,l){const a=resolveComponent("el-input");return e.model?(openBlock(),createElementBlock("div",_hoisted_1$5,[createVNode(a,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),type:"textarea",size:e.size,clearable:"",placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler,onInput:e.inputHandler},null,8,["modelValue","size","placeholder","disabled","onChange","onInput"])])):createCommentVNode("",!0)}var Textarea=_export_sfc(_sfc_main$c,[["render",_sfc_render$a]]);const _sfc_main$b=defineComponent({name:"m-fields-time",props:V(_({},fieldProps),{config:{type:Object,required:!0}}),emits:{change(e){return e}},setup(e,{emit:t}){return useAddField(e.prop),{changeHandler:o=>{t("change",o)}}}});function _sfc_render$9(e,t,o,n,i,l){const a=resolveComponent("el-time-picker");return openBlock(),createElementBlock("div",null,[createVNode(a,{modelValue:e.model[e.name],"onUpdate:modelValue":t[0]||(t[0]=r=>e.model[e.name]=r),size:e.size,"value-format":"HH:mm:ss",placeholder:e.config.placeholder,disabled:e.disabled,onChange:e.changeHandler},null,8,["modelValue","size","placeholder","disabled","onChange"])])}var Time=_export_sfc(_sfc_main$b,[["render",_sfc_render$9]]);const _sfc_main$a=defineComponent({name:"m-form",props:{initValues:{type:Object,required:!0,default:()=>({})},parentValues:{type:Object,default:()=>({})},config:{type:Array,required:!0,default:()=>[]},labelWidth:{type:String,default:()=>"200px"},disabled:{type:Boolean,default:()=>!1},height:{type:String,default:()=>"auto"},stepActive:{type:[String,Number],default:()=>1},size:{type:String},inline:{type:Boolean,default:!1},labelPosition:{type:String,default:"right"},keyProp:{type:String,default:"__key"},popperClass:{type:String}},emits:["change","field-input","field-change"],setup(e,{emit:t}){const o=ref(),n=ref(!1),i=ref({}),l=new Map,a=getConfig("request"),r=reactive({keyProp:e.keyProp,popperClass:e.popperClass,config:e.config,initValues:e.initValues,parentValues:e.parentValues,values:i,$emit:t,fields:l,setField:(s,d)=>l.set(s,d),getField:s=>l.get(s),deleteField:s=>l.delete(s),post:s=>{if(a)return a(V(_({},s),{method:"POST"}))}});return provide("mForm",r),watch([()=>e.config,()=>e.initValues],([s],[d])=>{isEqual(toRaw(s),toRaw(d))||(n.value=!1),initValue(r,{initValues:e.initValues,config:e.config}).then(c=>{i.value=c,n.value=!0})},{immediate:!0}),{initialized:n,values:i,elForm:o,formState:r,changeHandler:()=>{t("change",i.value)},resetForm:()=>{var s;return(s=o.value)==null?void 0:s.resetFields()},submitForm:async s=>{var d;try{return await((d=o.value)==null?void 0:d.validate()),s?i.value:cloneDeep(i.value)}catch(c){const u=[];throw Object.entries(c).forEach(([,f])=>{f.forEach(({field:m,message:h})=>{m&&h&&u.push(`${m} -> ${h}`),m&&!h&&u.push(`${m} -> \u51FA\u73B0\u9519\u8BEF`),!m&&h&&u.push(`${h}`)})}),new Error(u.join("<br>"))}}}}});function _sfc_render$8(e,t,o,n,i,l){const a=resolveComponent("m-form-container"),r=resolveComponent("el-form");return openBlock(),createBlock(r,{class:"m-form",ref:"elForm",model:e.values,"label-width":e.labelWidth,disabled:e.disabled,style:normalizeStyle(`height: ${e.height}`),inline:e.inline,"label-position":e.labelPosition},{default:withCtx(()=>[e.initialized&&Array.isArray(e.config)?(openBlock(!0),createElementBlock(Fragment,{key:0},renderList(e.config,(s,d)=>{var c;return openBlock(),createBlock(a,{key:(c=s[e.keyProp])!=null?c:d,config:s,model:e.values,"label-width":s.labelWidth||e.labelWidth,"step-active":e.stepActive,size:e.size,onChange:e.changeHandler},null,8,["config","model","label-width","step-active","size","onChange"])}),128)):createCommentVNode("",!0)]),_:1},8,["model","label-width","disabled","style","inline","label-position"])}var MForm=_export_sfc(_sfc_main$a,[["render",_sfc_render$8]]);const _sfc_main$9=defineComponent({name:"m-form-dialog",props:{values:{type:Object,default:()=>({})},width:[Number,String],fullscreen:Boolean,title:String,config:{type:Array,required:!0,default:()=>[]},labelWidth:[Number,String],size:String,confirmText:{type:String,default:"\u786E\u5B9A"}},emits:["close","submit","error","change"],setup(e,{emit:t}){const o=ref(),n=ref(!1),i=ref(!1),l=ref(1),a=ref(`${document.body.clientHeight-194}px`),r=computed(()=>{const{length:w}=e.config;for(let E=0;E<w;E++)if(e.config[E].type==="step")return e.config[E].items.length;return 0}),s=computed(()=>{const{length:w}=e.config;for(let E=0;E<w;E++)if(e.config[E].type==="step")return!0;return!1});return{form:o,saveFetch:i,stepActive:l,dialogVisible:n,bodyHeight:a,stepCount:r,hasStep:s,cancel:()=>{n.value=!1},closeHandler:()=>{l.value=1,t("close")},save:async()=>{var w;try{const E=await((w=o.value)==null?void 0:w.submitForm());t("submit",E)}catch(E){t("error",E)}},preStep:()=>{l.value-=1},nextStep:()=>{l.value+=1},changeHandler:w=>{t("change",w)}}}}),_hoisted_1$4={style:{"min-height":"1px"}},_hoisted_2$4=createTextVNode("\u53D6 \u6D88"),_hoisted_3$2=createTextVNode("\u4E0A\u4E00\u6B65"),_hoisted_4$1=createTextVNode("\u4E0B\u4E00\u6B65");function _sfc_render$7(e,t,o,n,i,l){const a=resolveComponent("m-form"),r=resolveComponent("el-col"),s=resolveComponent("el-button"),d=resolveComponent("el-row"),c=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",null,[createVNode(c,{modelValue:e.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=u=>e.dialogVisible=u),"custom-class":"m-form-dialog",top:"20px",title:e.title,appendToBody:!0,width:e.width,fullscreen:e.fullscreen,"close-on-click-modal":!1,onClose:e.closeHandler},{footer:withCtx(()=>[createVNode(d,{class:"dialog-footer"},{default:withCtx(()=>[createVNode(r,{span:12,style:{"text-align":"left"}},{default:withCtx(()=>[createBaseVNode("div",_hoisted_1$4,[renderSlot(e.$slots,"left")])]),_:3}),createVNode(r,{span:12},{default:withCtx(()=>[renderSlot(e.$slots,"footer",{},()=>[createVNode(s,{onClick:e.cancel,size:"small"},{default:withCtx(()=>[_hoisted_2$4]),_:1},8,["onClick"]),e.hasStep&&e.stepActive>1?(openBlock(),createBlock(s,{key:0,type:"info",size:"small",onClick:e.preStep},{default:withCtx(()=>[_hoisted_3$2]),_:1},8,["onClick"])):createCommentVNode("",!0),e.hasStep&&e.stepCount>e.stepActive?(openBlock(),createBlock(s,{key:1,type:"info",size:"small",onClick:e.nextStep},{default:withCtx(()=>[_hoisted_4$1]),_:1},8,["onClick"])):(openBlock(),createBlock(s,{key:2,type:"primary",size:"small",loading:e.saveFetch,onClick:e.save},{default:withCtx(()=>[createTextVNode(toDisplayString(e.confirmText),1)]),_:1},8,["loading","onClick"]))])]),_:3})]),_:3})]),default:withCtx(()=>[createBaseVNode("div",{class:"m-dialog-body",style:normalizeStyle(`max-height: ${e.bodyHeight}; overflow-y: auto; overflow-x: hidden;`)},[createVNode(a,{modelValue:e.stepActive,"onUpdate:modelValue":t[0]||(t[0]=u=>e.stepActive=u),ref:"form",size:e.size,config:e.config,"init-values":e.values,"label-width":e.labelWidth,onChange:e.changeHandler},null,8,["modelValue","size","config","init-values","label-width","onChange"]),renderSlot(e.$slots,"default")],4)]),_:3},8,["modelValue","title","width","fullscreen","onClose"])])}var FormDialog=_export_sfc(_sfc_main$9,[["render",_sfc_render$7]]),index$1="";const defaultInstallOpt={},install=(e,t)=>{const o=Object.assign(defaultInstallOpt,t);e.config.globalProperties.$MAGIC_FORM=o,setConfig(o),e.component(MForm.name,MForm),e.component(FormDialog.name,FormDialog),e.component(Container.name,Container),e.component(Fieldset.name,Fieldset),e.component(GroupList.name,GroupList),e.component(Panel.name,Panel),e.component(Row.name,Row),e.component(MStep.name,MStep),e.component(Table$1.name,Table$1),e.component(Tabs.name,Tabs),e.component(Text.name,Text),e.component(Number$1.name,Number$1),e.component(Textarea.name,Textarea),e.component(_sfc_main$j.name,_sfc_main$j),e.component(Date$1.name,Date$1),e.component(DateTime.name,DateTime),e.component(Time.name,Time),e.component(Checkbox.name,Checkbox),e.component(Switch.name,Switch),e.component(Daterange.name,Daterange),e.component(_sfc_main$p.name,_sfc_main$p),e.component(CheckboxGroup.name,CheckboxGroup),e.component(RadioGroup.name,RadioGroup),e.component(_sfc_main$l.name,_sfc_main$l),e.component(Link.name,Link),e.component(Select.name,Select),e.component(Cascader.name,Cascader),e.component(DynamicField.name,DynamicField)};var MagicForm={install};const _hoisted_1$3=createTextVNode("\u4FDD\u5B58"),_hoisted_2$3=createTextVNode("\u53D6\u6D88"),_sfc_main$8=defineComponent({props:{columns:{type:Array,require:!0,default:()=>[]},config:{type:Object,require:!0,default:()=>{}},rowkeyName:{type:String,default:"c_id"},editState:{type:Object,default:()=>{}}},emits:["afterAction"],setup(e,{emit:t}){const o=e,n=(c,u)=>typeof c=="function"?c.call(this,this,u):!0,i=(c,u)=>{var f;ElMessage.success(c),(f=u.after)==null||f.call(u)},l=c=>ElMessage.error(c),a=async(c,u)=>{var m;await ElMessageBox.confirm(`\u786E\u8BA4\u5220\u9664${u[c.name||"c_name"]}(${u[o.rowkeyName]})?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"});const f=await((m=c.handler)==null?void 0:m.call(c,u));f.ret===0?i("\u5220\u9664\u6210\u529F!",c):l(f.msg||"\u5220\u9664\u5931\u8D25")},r=async(c,u)=>{var f;await ElMessageBox.confirm(`\u786E\u5B9A\u590D\u5236${u[c.name||"c_name"]}(${u.c_id})?`,"\u63D0\u793A",{confirmButtonText:"\u786E\u5B9A",cancelButtonText:"\u53D6\u6D88",type:"warning"});try{const m=await((f=c.handler)==null?void 0:f.call(c,u));m.ret===0?i("\u590D\u5236\u6210\u529F!",c):l(`\u590D\u5236\u5931\u8D25!${m.msg}`)}catch{l("\u590D\u5236\u5931\u8D25!")}},s=async(c,u,f)=>{var m,h;c.type==="delete"?await a(c,u):c.type==="copy"?await r(c,u):c.type==="edit"?o.editState[f]=u:(await((m=c.handler)==null?void 0:m.call(c,u)),(h=c.after)==null||h.call(c))},d=async(c,u)=>{var E,y;const f=(y=(E=u.actions)==null?void 0:E.find($=>$.type==="edit"))==null?void 0:y.action;if(!f)return;const m={},h=o.editState[c];o.columns.filter($=>$.type).forEach($=>{m[$.prop]=h[$.prop]});const w=await f({data:m});w?w.ret===0?(ElMessage.success("\u4FDD\u5B58\u6210\u529F"),o.editState[c]=void 0,t("afterAction")):ElMessage.error({duration:1e4,showClose:!0,dangerouslyUseHTMLString:!0,message:w.msg||"\u4FDD\u5B58\u5931\u8D25"}):(o.editState[c]=void 0,t("afterAction"))};return(c,u)=>{const f=resolveComponent("el-button"),m=resolveComponent("el-table-column");return openBlock(),createBlock(m,{label:e.config.label,width:e.config.width,fixed:e.config.fixed},{default:withCtx(h=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.config.actions,(w,E)=>withDirectives((openBlock(),createBlock(f,{innerHTML:w.text,class:"action-btn",type:"text",size:"small",key:E,onClick:y=>s(w,h.row,h.$index)},null,8,["innerHTML","onClick"])),[[vShow,n(w.display,h.row)&&!e.editState[h.$index]]])),128)),withDirectives(createVNode(f,{class:"action-btn",type:"text",size:"small",onClick:w=>d(h.$index,e.config)},{default:withCtx(()=>[_hoisted_1$3]),_:2},1032,["onClick"]),[[vShow,e.editState[h.$index]]]),withDirectives(createVNode(f,{class:"action-btn",type:"text",size:"small",onClick:w=>e.editState[h.$index]=void 0},{default:withCtx(()=>[_hoisted_2$3]),_:2},1032,["onClick"]),[[vShow,e.editState[h.$index]]])]),_:1},8,["label","width","fixed"])}}}),_sfc_main$7=defineComponent({components:{MForm},props:{config:{type:Object,default:()=>({}),required:!0}}});function _sfc_render$6(e,t,o,n,i,l){const a=resolveComponent("m-table"),r=resolveComponent("m-form"),s=resolveComponent("el-table-column");return openBlock(),createBlock(s,{type:"expand"},{default:withCtx(d=>[e.config.table?(openBlock(),createBlock(a,{key:0,"show-header":!1,columns:e.config.table,data:d.row[e.config.prop]},null,8,["columns","data"])):createCommentVNode("",!0),e.config.form?(openBlock(),createBlock(r,{key:1,config:e.config.form,"init-values":e.config.values||d.row[e.config.prop]||{}},null,8,["config","init-values"])):createCommentVNode("",!0)]),_:1})}var ExpandColumn=_export_sfc(_sfc_main$7,[["render",_sfc_render$6]]);const formatter=(e,t)=>{if(e.formatter){e.formatter==="datetime"&&(e.formatter=o=>datetimeFormatter(o));try{return e.formatter(t[e.prop],t)}catch{return t[e.prop]}}else return t[e.prop]},_sfc_main$6=defineComponent({props:{config:{type:Object,default:()=>({}),required:!0}},setup(){return{formatter}}});function _sfc_render$5(e,t,o,n,i,l){const a=resolveComponent("m-table"),r=resolveComponent("el-button"),s=resolveComponent("el-popover"),d=resolveComponent("el-table-column");return openBlock(),createBlock(d,{label:e.config.label,width:e.config.width,fixed:e.config.fixed},{default:withCtx(c=>[createVNode(s,{placement:e.config.popover.placement,width:e.config.popover.width,trigger:e.config.popover.trigger},{reference:withCtx(()=>[createVNode(r,{type:"text"},{default:withCtx(()=>[createTextVNode(toDisplayString(e.config.text||e.formatter(e.config,c.row)),1)]),_:2},1024)]),default:withCtx(()=>[e.config.popover.tableEmbed?(openBlock(),createBlock(a,{key:0,"show-header":e.config.showHeader,columns:e.config.table,data:c.row[e.config.prop]},null,8,["show-header","columns","data"])):createCommentVNode("",!0)]),_:2},1032,["placement","width","trigger"])]),_:1},8,["label","width","fixed"])}var PopoverColumn=_export_sfc(_sfc_main$6,[["render",_sfc_render$5]]);const _sfc_main$5=defineComponent({props:{config:{type:Object,default:()=>({}),required:!0},editState:{type:Object,default:()=>{}}},setup(){return{formatter}}}),_hoisted_1$2=["href"],_hoisted_2$2=["src"],_hoisted_3$1=["href"],_hoisted_4=createTextVNode("\u6269\u5C55\u914D\u7F6E"),_hoisted_5=["innerHTML"];function _sfc_render$4(e,t,o,n,i,l){const a=resolveComponent("m-form-container"),r=resolveComponent("el-form"),s=resolveComponent("el-button"),d=resolveComponent("el-tooltip"),c=resolveComponent("el-tag"),u=resolveComponent("el-table-column");return openBlock(),createBlock(u,{"show-overflow-tooltip":"",label:e.config.label,width:e.config.width,fixed:e.config.fixed,sortable:e.config.sortable,prop:e.config.prop},{default:withCtx(f=>[e.config.type&&e.editState[f.$index]?(openBlock(),createBlock(r,{key:0,"label-width":"0",model:e.editState[f.$index]},{default:withCtx(()=>[createVNode(a,{prop:e.config.prop,rules:e.config.rules,config:e.config,name:e.config.prop,model:e.editState[f.$index]},null,8,["prop","rules","config","name","model"])]),_:2},1032,["model"])):e.config.action==="actionLink"?(openBlock(),createBlock(s,{key:1,type:"text",onClick:m=>e.config.handler(f.row)},{default:withCtx(()=>[createTextVNode(toDisplayString(e.formatter(e.config,f.row)),1)]),_:2},1032,["onClick"])):e.config.action==="img"?(openBlock(),createElementBlock("a",{key:2,target:"_blank",href:f.row[e.config.prop]},[createBaseVNode("img",{src:f.row[e.config.prop],height:"50"},null,8,_hoisted_2$2)],8,_hoisted_1$2)):e.config.action==="link"?(openBlock(),createElementBlock("a",{key:3,target:"_blank",href:f.row[e.config.prop],class:"keep-all"},toDisplayString(f.row[e.config.prop]),9,_hoisted_3$1)):e.config.action==="tip"?(openBlock(),createBlock(d,{key:4,placement:"left"},{content:withCtx(()=>[createBaseVNode("div",null,toDisplayString(e.formatter(e.config,f.row)),1)]),default:withCtx(()=>[createVNode(s,{type:"text"},{default:withCtx(()=>[_hoisted_4]),_:1})]),_:2},1024)):e.config.action==="tag"?(openBlock(),createBlock(c,{key:5,type:typeof e.config.type=="function"?e.config.type(f.row[e.config.prop],f.row):e.config.type,"close-transition":""},{default:withCtx(()=>[createTextVNode(toDisplayString(e.formatter(e.config,f.row)),1)]),_:2},1032,["type"])):(openBlock(),createElementBlock("div",{key:6,innerHTML:e.formatter(e.config,f.row)},null,8,_hoisted_5))]),_:1},8,["label","width","fixed","sortable","prop"])}var TextColumn=_export_sfc(_sfc_main$5,[["render",_sfc_render$4]]),Table_vue_vue_type_style_index_0_lang="";const _sfc_main$4=defineComponent({name:"m-table",components:{ExpandColumn,ActionsColumn:_sfc_main$8,PopoverColumn,TextColumn},props:{data:{type:Array,require:!0},columns:{type:Array,require:!0,default:()=>[]},spanMethod:{type:Function},fetch:{type:Boolean,default:!1},bodyHeight:{type:[String,Number]},showHeader:{type:Boolean,default:!0},emptyText:{type:String},defaultExpandAll:{type:Boolean,default:!1},rowkeyName:{type:String},border:{type:Boolean,default:!1}},emits:["sort-change","afterAction","select","select-all","selection-change"],data(){return{editState:[]}},computed:{tableData(){return this.selectionColumn?this.data||[]:cloneDeep(this.data)||[]},selectionColumn(){const e=this.columns.filter(t=>t.selection);return e.length?e[0]:null},hasBorder(){return typeof this.border!="undefined"?this.border:!0}},methods:{sortChange(e){this.$emit("sort-change",e)},selectHandler(e,t){const o=this.selectionColumn;!o||(o.selection==="single",this.$emit("select",e,t))},selectAllHandler(e){this.$emit("select-all",e)},selectionChangeHandler(e){this.$emit("selection-change",e)},toggleRowSelection(e,t){const o=this.$refs.table;o.toggleRowSelection.bind(o)(e,t)},toggleRowExpansion(e,t){const o=this.$refs.table;o.toggleRowExpansion.bind(o)(e,t)},clearSelection(){const e=this.$refs.table;e.clearSelection.bind(e)()},objectSpanMethod(e){return typeof this.spanMethod=="function"?this.spanMethod(e):()=>({rowspan:0,colspan:0})}}});function _sfc_render$3(e,t,o,n,i,l){const a=resolveComponent("expand-column"),r=resolveComponent("el-table-column"),s=resolveComponent("actions-column"),d=resolveComponent("popover-column"),c=resolveComponent("text-column"),u=resolveComponent("el-table");return openBlock(),createBlock(u,{data:e.tableData,"show-header":e.showHeader,"max-height":e.bodyHeight,"tooltip-effect":"dark",class:"m-table",ref:"table","default-expand-all":e.defaultExpandAll,border:e.hasBorder,"row-key":e.rowkeyName||"c_id","tree-props":{children:"children"},"empty-text":e.emptyText||"\u6682\u65E0\u6570\u636E","span-method":e.objectSpanMethod,onSortChange:e.sortChange,onSelect:e.selectHandler,onSelectAll:e.selectAllHandler,onSelectionChange:e.selectionChangeHandler},{default:withCtx(()=>[(openBlock(!0),createElementBlock(Fragment,null,renderList(e.columns,(f,m)=>(openBlock(),createElementBlock(Fragment,null,[f.type==="expand"?(openBlock(),createBlock(a,{config:f,key:m},null,8,["config"])):f.selection?(openBlock(),createBlock(r,{type:"selection",key:m,width:"40",selectable:f.selectable},null,8,["selectable"])):f.actions?(openBlock(),createBlock(s,{columns:e.columns,config:f,"rowkey-name":e.rowkeyName,"edit-state":e.editState,key:m,onAfterAction:t[0]||(t[0]=h=>e.$emit("afterAction"))},null,8,["columns","config","rowkey-name","edit-state"])):f.type==="popover"?(openBlock(),createBlock(d,{key:m,config:f},null,8,["config"])):(openBlock(),createBlock(c,{key:m,config:f,"edit-state":e.editState},null,8,["config","edit-state"]))],64))),256))]),_:1},8,["data","show-header","max-height","default-expand-all","border","row-key","empty-text","span-method","onSortChange","onSelect","onSelectAll","onSelectionChange"])}var Table=_export_sfc(_sfc_main$4,[["render",_sfc_render$3]]);const components=[Table];var MagicTable={install(e){components.forEach(t=>{e.component(t.name,t)})}},App_vue_vue_type_style_index_0_lang="";const _sfc_main$3={name:"App"};function _sfc_render$2(e,t,o,n,i,l){const a=resolveComponent("router-view");return openBlock(),createBlock(a)}var App=_export_sfc(_sfc_main$3,[["render",_sfc_render$2]]),config={id:"75f0extui9d7yksklx27hff8xg",name:"test",type:"app",items:[{type:"page",id:"page_299",name:"index",title:"",layout:"absolute",style:{position:"relative",left:0,top:0,right:"",bottom:"",width:"375",height:"1728",backgroundImage:"",backgroundColor:"rgba(248, 218, 218, 1)",backgroundRepeat:"no-repeat",backgroundSize:"100% 100%"},events:[],created:"",items:[{id:"container_3001",style:{left:0,top:175,width:375,height:100,position:"absolute"},type:"container",name:"\u7EC4",items:[{id:"button_5137",style:{left:57,top:31,width:270,height:38,position:"absolute",border:0,backgroundColor:"#fb6f00"},type:"button",name:"\u6309\u94AE",text:"\u8BF7\u8F93\u5165\u6587\u672C\u5185\u5BB9",multiple:!0}]}]}]},Editor_vue_vue_type_style_index_0_lang="";const RUNTIME_PATH="/tmagic-editor/playground/runtime/vue3",_sfc_main$2=defineComponent({name:"EditorApp",setup(){const e=ref(),t=ref(!1),o=ref(config),n=ref(config.items[0].id),i=ref({}),l=ref({}),a=ref({}),r={left:[{type:"text",text:"\u9B54\u65B9"}],center:["delete","undo","redo","guides","rule","zoom"],right:[{type:"button",text:"\u9884\u89C8",icon:Connection,handler:()=>{t.value=!0}},{type:"button",text:"\u4FDD\u5B58",icon:Coin$1,handler:s=>{localStorage.setItem("magicUiConfig",serializeJavascript(toRaw(o.value),{space:2,unsafe:!0}).replace(/"(\w+)":\s/g,"$1: ")),s==null||s.editorService.resetModifiedNodeId(),ElMessage.success("\u4FDD\u5B58\u6210\u529F")}},"/",{type:"button",icon:Document,tooltip:"\u6E90\u7801",handler:s=>s==null?void 0:s.uiService.set("showSrc",!(s==null?void 0:s.uiService.get("showSrc")))}]};return asyncLoadJs(`${RUNTIME_PATH}/assets/config.js`).then(()=>{l.value=globalThis.magicPresetConfigs}),asyncLoadJs(`${RUNTIME_PATH}/assets/value.js`).then(()=>{i.value=globalThis.magicPresetValues}),asyncLoadJs(`${RUNTIME_PATH}/assets/event.js`).then(()=>{a.value=globalThis.magicPresetEvents}),{RUNTIME_PATH,editor:e,menu:r,value:o,defaultSelected:n,propsValues:i,propsConfigs:l,eventMethodList:a,previewVisible:t,runtimeUrl:`${RUNTIME_PATH}/playground.html`,componentGroupList:ref([{title:"\u793A\u4F8B\u5BB9\u5668",items:[{icon:FolderOpened,text:"\u7EC4",type:"container"}]},{title:"\u793A\u4F8B\u7EC4\u4EF6",items:[{icon:Tickets,text:"\u6587\u672C",type:"text"},{icon:SwitchButton,text:"\u6309\u94AE",type:"button"}]}]),moveableOptions:s=>{var m,h;const d={},c=(h=(m=s==null?void 0:s.dr)==null?void 0:m.target)==null?void 0:h.id;if(!c||!e.value)return d;const u=e.value.editorService.getNodeById(c);if(!u)return d;const f=u.type===NodeType.PAGE;return d.draggable=!f,d.resizable=!f,d}}}}),_hoisted_1$1={class:"editor-app"},_hoisted_2$1=["src"];function _sfc_render$1(e,t,o,n,i,l){const a=resolveComponent("m-editor"),r=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",_hoisted_1$1,[createVNode(a,{modelValue:e.value,"onUpdate:modelValue":t[0]||(t[0]=s=>e.value=s),ref:"editor",menu:e.menu,"runtime-url":e.runtimeUrl,"props-configs":e.propsConfigs,"props-values":e.propsValues,"event-method-list":e.eventMethodList,"component-group-list":e.componentGroupList,"default-selected":e.defaultSelected,"moveable-options":e.moveableOptions},null,8,["modelValue","menu","runtime-url","props-configs","props-values","event-method-list","component-group-list","default-selected","moveable-options"]),createVNode(r,{modelValue:e.previewVisible,"onUpdate:modelValue":t[1]||(t[1]=s=>e.previewVisible=s),"destroy-on-close":"",width:375,"custom-class":"pre-viewer",title:"\u9884\u89C8"},{default:withCtx(()=>{var s;return[e.previewVisible?(openBlock(),createElementBlock("iframe",{key:0,width:"100%",height:"817",src:`${e.RUNTIME_PATH}/page.html?localPreview=1&page=${(s=e.editor)==null?void 0:s.editorService.get("page").id}`},null,8,_hoisted_2$1)):createCommentVNode("",!0)]}),_:1},8,["modelValue"])])}var Editor=_export_sfc(_sfc_main$2,[["render",_sfc_render$1]]);const _sfc_main$1=defineComponent({name:"App",data(){return{resultVisible:!1,result:"",config:[{text:"\u6587\u672C",name:"text",tooltip:(e,{model:t})=>t.text,extra:(e,{model:t})=>`${t.text}extra`,rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}]},{type:"checkbox",text:"checkbox",name:"option",activeValue:1,inactiveValue:0,defaultValue:1},{type:"link",displayText:"\u94FE\u63A5",text:"link",name:"link",href:"",tooltip:"element-ui"},{type:"display",text:"\u5C55\u793A",name:"display",initValue:"display",tooltip:"hello"},{type:"number",text:"\u8BA1\u6570\u5668",name:"number"},{type:"textarea",text:"\u8F93\u5165\u6846",name:"textarea1"},{type:"datetime",text:"\u65E5\u671F",name:"datetime"},{type:"switch",text:"\u5F00\u5173",name:"switch",filter:"number",defaultValue:1},{type:"daterange",text:"\u65E5\u671F\u8303\u56F4",name:"daterange"},{type:"time",text:"\u65E5\u671F\u9009\u62E9",name:"time"},{type:"colorPicker",text:"\u53D6\u8272\u5668",name:"colorPicker"},{type:"checkbox-group",text:"\u9009\u9879\u7EC4",name:"checkGroup",options:[{value:1,text:"one"},{value:2,text:"two"}]},{type:"radio-group",text:"\u5355\u9009\u6846",name:"radioGroup",options:[{value:1,text:"one"},{value:2,text:"two"}]},{type:"cascader",text:"\u7EA7\u8054\u9009\u62E9",placeholder:"test",name:"cascader",options:[{value:1,label:"one",children:[{value:3,label:"three",children:[{value:8,label:"eight"}]},{value:4,label:"four"},{value:6,label:"six"}]},{value:2,label:"two",children:[{value:5,label:"five"},{value:7,label:"seven"}]}]},{type:"dynamic-field",name:"dynamic-field",dynamicKey:"textarea",text:"\u52A8\u6001\u8868\u5355",returnFields:()=>[{name:"one",label:"number",defaultValue:"yes"}]},{type:"row",items:[{type:"date",text:"\u65E5\u671F",name:"date"},{type:"checkbox",text:"\u591A\u9009\u6846",name:"checkbox",tooltip:"\u5206\u7EC4xxxxxxxxxxxx",extra:"extra"}]},{type:"fieldset",name:"fieldset",text:"\u5206\u7EC4",extra:"extra",checkbox:!0,expand:"checkbox",items:[{type:"select",text:"\u4E0B\u62C9\u9009\u9879",name:"select",options:[{text:"\u9009\u98791",value:1},{text:"\u9009\u98792",value:2}]}]},{type:"table",name:"table",defautSort:{prop:"name",order:"descending"},extra:"extra",itemExtra:(e,{model:t})=>`${t.text}itemExtra`,items:[{label:"id",name:"id",sortable:!0,tooltip:"\u5206\u7EC4xxxxxxxxxxxx",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}]},{label:"\u540D\u79F0",name:"name"}]},{type:"groupList",name:"groupList",extra:"\u5206\u7EC4xxxxxxxxxxxx",itemExtra:(e,{model:t})=>`${t.name}extra`,items:[{text:"id",name:"id",rules:[{required:!0,message:"\u8BF7\u8F93\u5165\u6D3B\u52A8\u540D\u79F0",trigger:"blur"}]},{text:"\u540D\u79F0",name:"name"}]},{type:"panel",title:"panel",extra:"panel",schematic:"https://vfiles.gtimg.cn/vupload/20210329/9712631617027075445.png",items:[{text:"\u540D\u79F0",name:"name"}]},{type:"step",items:[{name:"step1",title:"step1",items:[{text:"\u540D\u79F0",name:"name"}]},{name:"step2",title:"step2",items:[{text:"\u540D\u79F02",name:"name"}]}]}],initValue:{text:"\u6587\u672C",number:10,fieldset:{select:1},table:[{id:1,name:"a"},{id:2,name:"b"}]},tableConfig:[{label:"id",prop:"id"},{label:"name",prop:"name"}],tableData:[{id:1,name:"xx"},{id:2,name:"xx2"}]}},methods:{async submit(){try{const e=await this.$refs.form.submitForm();this.resultVisible=!0,this.result=JSON.stringify(e,null,2)}catch(e){console.error(e),ElMessage.error({duration:1e4,showClose:!0,message:e.message,dangerouslyUseHTMLString:!0})}},spanMethod({rowIndex:e,columnIndex:t}){if(t===0)return e%2===0?{rowspan:2,colspan:1}:{rowspan:0,colspan:0}}}}),_hoisted_1={style:{padding:"20px"}},_hoisted_2=createTextVNode("\u63D0\u4EA4"),_hoisted_3=["innerHTML"];function _sfc_render(e,t,o,n,i,l){const a=resolveComponent("m-form"),r=resolveComponent("el-button"),s=resolveComponent("el-dialog");return openBlock(),createElementBlock("div",_hoisted_1,[createVNode(a,{ref:"form",config:e.config,"init-values":e.initValue,size:"small"},null,8,["config","init-values"]),createVNode(r,{onClick:e.submit},{default:withCtx(()=>[_hoisted_2]),_:1},8,["onClick"]),createVNode(s,{modelValue:e.resultVisible,"onUpdate:modelValue":t[0]||(t[0]=d=>e.resultVisible=d),title:"result"},{default:withCtx(()=>[createBaseVNode("pre",null,[createBaseVNode("code",{class:"language-javascript hljs",innerHTML:e.result},null,8,_hoisted_3)])]),_:1},8,["modelValue"])])}var Form=_export_sfc(_sfc_main$1,[["render",_sfc_render]]);const _sfc_main=defineComponent({setup(e){const t=ref([{type:"expand",prop:"b",table:[{prop:"a",label:"1"}]},{prop:"a",label:"1231"}]),o=ref([{a:"a1",b:[{a:1}]}]);return(n,i)=>{const l=resolveComponent("m-table");return openBlock(),createBlock(l,{columns:t.value,data:o.value,"show-header":!0},null,8,["columns","data"])}}}),routes=[{path:"/",component:Editor},{path:"/form",component:Form},{path:"/table",component:_sfc_main}];var router=createRouter({history:createWebHashHistory(),routes}),index="";globalThis.MonacoEnvironment={getWorker(e,t){return t==="json"?new WorkerWrapper:t==="css"||t==="scss"||t==="less"?new WorkerWrapper$1:t==="html"||t==="handlebars"||t==="razor"?new WorkerWrapper$2:t==="typescript"||t==="javascript"?new WorkerWrapper$3:new WorkerWrapper$4}};languages.typescript.typescriptDefaults.setEagerModelSync(!0);const app=createApp(App);app.use(router);app.use(installer,{locale:zhCn});app.use(MagicEditor);app.use(MagicForm);app.use(MagicTable);app.mount("#app");
//# sourceMappingURL=index.4dd41af8.js.map
